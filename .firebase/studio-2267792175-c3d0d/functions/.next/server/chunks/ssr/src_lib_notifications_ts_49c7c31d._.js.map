{"version":3,"sources":["../../../../src/lib/notifications.ts"],"sourcesContent":["import { addDoc, collection, Firestore } from 'firebase/firestore';\r\n\r\nexport type NotificationType =\r\n    | 'WELCOME'\r\n    | 'NEW_MESSAGE'\r\n    | 'NEW_REQUEST'\r\n    | 'REQUEST_ACCEPTED'\r\n    | 'REQUEST_REJECTED'\r\n    | 'MAINTENANCE_REQUEST'\r\n    | 'RENT_DUE'\r\n    | 'LEASE_GENERATED'\r\n    | 'LEASE_SIGNED'\r\n    | 'TENANCY_ENDED'\r\n    | 'REVIEW_SUBMITTED'\r\n    | 'OFFLINE_PAYMENT_PENDING'\r\n    | 'OFFLINE_PAYMENT_APPROVED'\r\n    | 'OFFLINE_PAYMENT_REJECTED'\r\n    | 'LEASE_EXPIRED'\r\n    | 'LEASE_TERMS_CHANGED'\r\n    | 'PROPERTY_OCCUPIED'\r\n    | 'TENANCY_TERMINATING';\r\n\r\ninterface NotificationPayload {\r\n    toUserId: string;\r\n    type: NotificationType;\r\n    firestore: Firestore;\r\n    // Dynamic data for messages\r\n    senderName?: string;\r\n    propertyName?: string;\r\n    propertyTitle?: string;\r\n    tenantName?: string;\r\n    link?: string;\r\n    transactionId?: string;\r\n    customMessage?: string;\r\n}\r\n\r\nexport const sendNotification = async ({\r\n    toUserId,\r\n    type,\r\n    firestore,\r\n    senderName,\r\n    propertyName,\r\n    propertyTitle,\r\n    tenantName,\r\n    link,\r\n    transactionId,\r\n    customMessage\r\n}: NotificationPayload) => {\r\n    let title = 'New Notification';\r\n    let message = '';\r\n    let uiType: 'info' | 'success' | 'warning' | 'error' = 'info';\r\n    let finalLink = link || '#';\r\n\r\n    switch (type) {\r\n        // ... (existing cases)\r\n\r\n        case 'OFFLINE_PAYMENT_PENDING':\r\n            title = 'Offline Payment Submitted';\r\n            message = `${tenantName || 'A tenant'} has submitted an offline payment for ${propertyTitle || 'a property'}. Please verify and accept the transfer in Lease Requests.`;\r\n            uiType = 'warning';\r\n            finalLink = `/landlord/requests`;\r\n            break;\r\n\r\n        // ... (other cases)\r\n    }\r\n\r\n    try {\r\n        const notificationsRef = collection(firestore, 'notifications');\r\n        await addDoc(notificationsRef, {\r\n            userId: toUserId,\r\n            title,\r\n            message,\r\n            type: uiType,\r\n            read: false,\r\n            createdAt: new Date().toISOString(),\r\n            link: finalLink\r\n        });\r\n    } catch (error) {\r\n        console.error(\"Failed to send notification:\", error);\r\n    }\r\n};\r\n"],"names":[],"mappings":"uCAAA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAoCO,IAAM,EAAmB,MAAO,UACnC,CAAQ,MACR,CAAI,WACJ,CAAS,YACT,CAAU,cACV,CAAY,eACZ,CAAa,YACb,CAAU,MACV,CAAI,CACJ,eAAa,eACb,CAAa,CACK,IAClB,IAAI,EAAQ,mBACR,EAAU,GACV,EAAmD,OACnD,EAAY,GAAQ,IAKf,4BAHD,IAIA,EAAQ,4BACR,EAAU,CAAA,EAAG,GAAc,WAAW,sCAAsC,EAAE,GAAiB,aAAa,0DAA0D,CAAC,CACvK,EAAS,UACT,EAAY,CAAC,kBAAkB,CAAC,EAMxC,GAAI,CACA,IAAM,EAAmB,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAW,gBAC/C,OAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,EAAkB,CAC3B,OAAQ,QACR,UACA,EACA,KAAM,EACN,KAAM,GACN,UAAW,IAAI,OAAO,WAAW,GACjC,KAAM,CACV,EACJ,CAAE,MAAO,EAAO,CACZ,QAAQ,KAAK,CAAC,+BAAgC,EAClD,CACJ"}