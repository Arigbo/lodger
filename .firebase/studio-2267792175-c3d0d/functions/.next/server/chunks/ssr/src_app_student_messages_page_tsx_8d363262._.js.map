{"version":3,"sources":["../../../../src/app/student/messages/page.tsx"],"sourcesContent":["\r\n'use client';\r\n\r\nimport { useState, useEffect, useMemo, useRef } from 'react';\r\nimport { useSearchParams, useRouter, usePathname } from 'next/navigation';\r\nimport { cn } from '@/utils';\r\nimport type { UserProfile as User, Message, Property } from '@/types';\r\nimport { Send, Search, MessageSquare, MoreVertical, ArrowLeft, Flag } from 'lucide-react';\r\nimport { useUser, useFirestore, useCollection, useMemoFirebase, useDoc, errorEmitter, FirestorePermissionError } from '@/firebase';\r\nimport { collection, query, where, getDocs, doc, addDoc, serverTimestamp, limit, documentId, updateDoc, writeBatch } from 'firebase/firestore';\r\nimport Loading from '@/app/loading';\r\nimport { sendNotification } from '@/lib/notifications';\r\nimport { Card } from '@/components/ui/card';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\r\nimport { Button } from '@/components/ui/button';\r\nimport { format, formatDistanceToNow } from 'date-fns';\r\nimport { ReportUserDialog } from '@/components/report-user-dialog';\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\n\r\ntype Conversation = {\r\n    id: string;\r\n    participant: User;\r\n    otherUser: User;\r\n    lastMessage: Message | null;\r\n    lastMessageTimestamp: Date | null;\r\n    unreadCount: number;\r\n};\r\n\r\nexport default function MessagesPage() {\r\n    const { user, isUserLoading } = useUser();\r\n    const firestore = useFirestore();\r\n    const router = useRouter();\r\n    const pathname = usePathname();\r\n    const searchParams = useSearchParams();\r\n    const [reportDialogOpen, setReportDialogOpen] = useState(false);\r\n\r\n    const [conversations, setConversations] = useState<Conversation[]>([]);\r\n    const [selectedParticipant, setSelectedParticipant] = useState<User | null>(null);\r\n    const [isClient, setIsClient] = useState(false);\r\n    const [isDataLoading, setIsDataLoading] = useState(true);\r\n\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [newMessage, setNewMessage] = useState('');\r\n    const [localSelectedConversationId, setLocalSelectedConversationId] = useState<string | null>(null);\r\n    const [isSidebarOpen, setIsSidebarOpen] = useState(true);\r\n    const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n    const scrollToBottom = () => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n    };\r\n\r\n    const selectedConversationId = searchParams.get('conversationId');\r\n    const contactId = searchParams.get('contact');\r\n\r\n    // Handle initial state and mobile view switching\r\n    useEffect(() => {\r\n        if (selectedConversationId || contactId) {\r\n            setIsSidebarOpen(false);\r\n        }\r\n    }, [selectedConversationId, contactId]);\r\n\r\n    const { data: newContact } = useDoc<User>(\r\n        useMemoFirebase(() => (contactId ? doc(firestore, 'users', contactId) : null), [contactId, firestore])\r\n    );\r\n\r\n    // Fetch current user's profile for avatar\r\n    const userDocRef = useMemoFirebase(\r\n        () => user ? doc(firestore, 'users', user.uid) : null,\r\n        [user, firestore]\r\n    );\r\n    const { data: userProfile } = useDoc<User>(userDocRef);\r\n\r\n    useEffect(() => {\r\n        setIsClient(true);\r\n    }, []);\r\n\r\n    const allMessagesQuery = useMemoFirebase(() => {\r\n        if (!user) return null;\r\n        return query(\r\n            collection(firestore, 'messages'),\r\n            where('participantIds', 'array-contains', user.uid)\r\n        );\r\n    }, [firestore, user]);\r\n\r\n    const { data: allStudentMessages, isLoading: messagesLoading } = useCollection<Message>(allMessagesQuery);\r\n\r\n    useEffect(() => {\r\n        if (isUserLoading || messagesLoading) return;\r\n        if (!user) {\r\n            setIsDataLoading(false);\r\n            return;\r\n        }\r\n\r\n        const processConversations = async () => {\r\n            setIsDataLoading(true);\r\n\r\n            const conversationsMap = new Map<string, { lastMessage: Message, participantId: string }>();\r\n            (allStudentMessages || []).forEach(msg => {\r\n                const otherParticipantId = msg.participantIds.find(id => id !== user.uid);\r\n                if (otherParticipantId) {\r\n                    if (!conversationsMap.has(otherParticipantId) || (msg.timestamp && conversationsMap.get(otherParticipantId)!.lastMessage.timestamp && msg.timestamp.toMillis() > conversationsMap.get(otherParticipantId)!.lastMessage.timestamp.toMillis())) {\r\n                        conversationsMap.set(otherParticipantId, { lastMessage: msg, participantId: otherParticipantId });\r\n                    }\r\n                }\r\n            });\r\n\r\n            const participantIds = new Set(Array.from(conversationsMap.keys()));\r\n\r\n            // Also find the landlord of the currently rented property\r\n            const rentedPropertiesQuery = query(collection(firestore, 'properties'), where('currentTenantId', '==', user.uid), limit(1));\r\n            const rentedPropertiesSnapshot = await getDocs(rentedPropertiesQuery);\r\n            if (!rentedPropertiesSnapshot.empty) {\r\n                const property = rentedPropertiesSnapshot.docs[0].data() as Property;\r\n                participantIds.add(property.landlordId);\r\n            }\r\n\r\n            if (newContact) {\r\n                participantIds.add(newContact.id);\r\n            }\r\n\r\n            if (participantIds.size === 0) {\r\n                setConversations([]);\r\n                setIsDataLoading(false);\r\n                return;\r\n            }\r\n\r\n            const allParticipantIds = Array.from(participantIds);\r\n            const usersQuery = query(collection(firestore, 'users'), where(documentId(), 'in', allParticipantIds));\r\n            const usersSnapshot = await getDocs(usersQuery);\r\n            const usersMap = new Map<string, User>();\r\n            usersSnapshot.forEach((docSnap: any) => usersMap.set(docSnap.id, { id: docSnap.id, ...docSnap.data() } as User));\r\n\r\n            const convos = allParticipantIds.map(pId => {\r\n                const participant = usersMap.get(pId);\r\n                if (!participant) return null;\r\n\r\n                const convoData = conversationsMap.get(pId);\r\n\r\n                // Calculate unread count: messages where read is false and sender is the other participant\r\n                const unreadCount = (allStudentMessages || []).filter(msg =>\r\n                    msg.participantIds.includes(pId) &&\r\n                    msg.read === false &&\r\n                    msg.senderId !== user.uid\r\n                ).length;\r\n\r\n                return {\r\n                    id: pId,\r\n                    participant,\r\n                    otherUser: participant,\r\n                    lastMessage: convoData?.lastMessage || null,\r\n                    lastMessageTimestamp: convoData?.lastMessage.timestamp?.toDate() || new Date(0),\r\n                    unreadCount,\r\n                } as Conversation;\r\n            }).filter(Boolean) as Conversation[];\r\n\r\n            convos.sort((a, b) => (b.lastMessageTimestamp?.getTime() || 0) - (a.lastMessageTimestamp?.getTime() || 0));\r\n            setConversations(convos);\r\n            setIsDataLoading(false);\r\n        };\r\n\r\n        processConversations();\r\n    }, [user, firestore, newContact, isUserLoading, allStudentMessages, messagesLoading]);\r\n\r\n    const messages = useMemo(() => {\r\n        if (!allStudentMessages || !selectedParticipant) return [];\r\n        return allStudentMessages\r\n            .filter(msg => msg.participantIds.includes(selectedParticipant.id))\r\n            .sort((a, b) => {\r\n                if (a.timestamp && b.timestamp) {\r\n                    return a.timestamp.toMillis() - b.timestamp.toMillis();\r\n                }\r\n                return 0;\r\n            });\r\n    }, [allStudentMessages, selectedParticipant]);\r\n\r\n    useEffect(() => {\r\n        if (selectedConversationId) {\r\n            const participant = conversations.find(c => c.id === selectedConversationId)?.participant;\r\n            if (participant) {\r\n                setSelectedParticipant(participant);\r\n                setLocalSelectedConversationId(selectedConversationId);\r\n            }\r\n        } else if (contactId && newContact) {\r\n            setSelectedParticipant(newContact);\r\n            setLocalSelectedConversationId(contactId);\r\n        }\r\n    }, [selectedConversationId, contactId, conversations, newContact]);\r\n\r\n    // Mark messages as read when conversation is opened\r\n    useEffect(() => {\r\n        if (!user || !selectedParticipant || !firestore || !allStudentMessages) return;\r\n\r\n        const markAsRead = async () => {\r\n            const unreadMessages = allStudentMessages.filter(msg =>\r\n                msg.participantIds.includes(selectedParticipant.id) &&\r\n                msg.read === false &&\r\n                msg.senderId === selectedParticipant.id\r\n            );\r\n\r\n            if (unreadMessages.length === 0) return;\r\n\r\n            const batch = writeBatch(firestore);\r\n            unreadMessages.forEach(msg => {\r\n                const msgRef = doc(firestore, 'messages', msg.id);\r\n                batch.update(msgRef, { read: true });\r\n            });\r\n\r\n            try {\r\n                await batch.commit();\r\n            } catch (error) {\r\n                console.error('Error marking messages as read:', error);\r\n            }\r\n        };\r\n\r\n        markAsRead();\r\n    }, [selectedParticipant, user, firestore, allStudentMessages]);\r\n\r\n    useEffect(() => {\r\n        if (messagesEndRef.current) {\r\n            scrollToBottom();\r\n        }\r\n    }, [messages]);\r\n\r\n    const handleSendMessage = () => {\r\n        if (!newMessage.trim() || !user || !selectedParticipant || !firestore) return;\r\n\r\n        const messagesRef = collection(firestore, 'messages');\r\n        const messageData = {\r\n            text: newMessage,\r\n            senderId: user.uid,\r\n            recipientId: selectedParticipant.id,\r\n            participantIds: [user.uid, selectedParticipant.id].sort(),\r\n            timestamp: serverTimestamp(),\r\n            read: false,\r\n        };\r\n\r\n        addDoc(messagesRef, messageData)\r\n            .then(() => {\r\n                setNewMessage('');\r\n                scrollToBottom();\r\n                return sendNotification({\r\n                    toUserId: selectedParticipant.id,\r\n                    type: 'NEW_MESSAGE',\r\n                    firestore: firestore,\r\n                    senderName: user.displayName || 'Tenant',\r\n                    customMessage: newMessage,\r\n                    link: `/landlord/messages?conversationId=${user.uid}`\r\n                });\r\n            })\r\n            .catch((serverError: any) => {\r\n                console.error(\"FAILED_TO_SEND_MESSAGE\", serverError);\r\n                // const permissionError = new FirestorePermissionError({\r\n                //     path: messagesRef.path,\r\n                //     operation: 'create',\r\n                //     requestResourceData: messageData,\r\n                // });\r\n                // errorEmitter.emit('permission-error', permissionError);\r\n                alert(`Failed to send message: ${serverError.message || 'Unknown error'}`);\r\n            });\r\n    };\r\n\r\n    const selectedConversation = conversations.find(c => c.id === localSelectedConversationId);\r\n    const filteredConversations = conversations.filter(c =>\r\n        c.participant.name?.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    if (isUserLoading || isDataLoading) {\r\n        return <Loading />;\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex h-[calc(100dvh-7rem)] md:h-[calc(100vh-8rem)] gap-0 md:gap-8 animate-in fade-in duration-700 overflow-hidden -mt-4 md:mt-0\">\r\n            {/* Conversation List */}\r\n            <div className={cn(\r\n                \"w-full md:w-80 lg:w-96 flex-shrink-0 flex flex-col gap-4 md:gap-6 transition-all duration-300\",\r\n                !isSidebarOpen && \"hidden md:flex\"\r\n            )}>\r\n                <div className=\"px-2\">\r\n                    <h1 className=\"text-2xl md:text-3xl font-black uppercase tracking-tight\">Messages<span className=\"text-primary\">.</span></h1>\r\n                    <p className=\"text-[10px] md:text-sm font-medium text-muted-foreground mt-1 text-left\">Your direct connection to landlords.</p>\r\n                </div>\r\n\r\n                <Card className=\"flex-1 flex flex-col rounded-[2rem] md:rounded-[2.5rem] border-2 border-white/40 shadow-xl shadow-black/[0.02] overflow-hidden bg-white/60 backdrop-blur-xl\">\r\n                    <div className=\"p-6 border-b border-muted/20\">\r\n                        <div className=\"relative group\">\r\n                            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground/40 group-focus-within:text-primary transition-colors\" />\r\n                            <Input\r\n                                placeholder=\"Search conversations...\"\r\n                                className=\"pl-12 h-12 rounded-2xl border-none bg-muted/20 focus:bg-white focus:ring-4 focus:ring-primary/10 transition-all font-bold\"\r\n                                value={searchTerm}\r\n                                onChange={(e) => setSearchTerm(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex-1 overflow-y-auto custom-scrollbar p-2\">\r\n                        {isDataLoading ? ( // Use isDataLoading for conversation list loading\r\n                            <div className=\"space-y-4 p-4\">\r\n                                {[1, 2, 3].map((i) => (\r\n                                    <div key={i} className=\"flex gap-4 items-center animate-pulse\">\r\n                                        <div className=\"h-14 w-14 rounded-2xl bg-muted/40\" />\r\n                                        <div className=\"flex-1 space-y-2\">\r\n                                            <div className=\"h-4 w-1/2 bg-muted/40 rounded-full\" />\r\n                                            <div className=\"h-3 w-3/4 bg-muted/40 rounded-full\" />\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        ) : filteredConversations.length === 0 ? (\r\n                            <div className=\"flex flex-col items-center justify-center h-full p-8 text-center space-y-4\">\r\n                                <div className=\"h-16 w-16 rounded-2xl bg-muted/20 flex items-center justify-center\">\r\n                                    <MessageSquare className=\"h-8 w-8 text-muted-foreground/20\" />\r\n                                </div>\r\n                                <p className=\"text-sm font-black text-muted-foreground uppercase tracking-widest leading-relaxed\">No conversations found</p>\r\n                            </div>\r\n                        ) : (\r\n                            filteredConversations.map((conv) => {\r\n                                const hasUnread = conv.unreadCount > 0;\r\n                                return (\r\n                                    <button\r\n                                        key={conv.id}\r\n                                        onClick={() => {\r\n                                            setLocalSelectedConversationId(conv.id);\r\n                                            setIsSidebarOpen(false);\r\n                                            router.replace(`${pathname}?conversationId=${conv.id}`, { scroll: false });\r\n                                        }}\r\n                                        className={cn(\r\n                                            \"w-full flex gap-4 items-center p-3 md:p-4 rounded-2xl md:rounded-3xl transition-all duration-300 border-2 relative\",\r\n                                            localSelectedConversationId === conv.id\r\n                                                ? \"bg-white border-primary/10 shadow-lg scale-[1.02]\"\r\n                                                : hasUnread\r\n                                                    ? \"bg-primary/5 border-primary/20 hover:bg-primary/10 hover:border-primary/30\"\r\n                                                    : \"border-transparent hover:bg-white/40 hover:border-white/60 grayscale-[0.5] hover:grayscale-0\"\r\n                                        )}\r\n                                    >\r\n                                        <div className=\"relative\">\r\n                                            <Avatar className=\"h-14 w-14 rounded-2xl border-2 border-background shadow-sm\">\r\n                                                <AvatarImage src={conv.otherUser?.profileImageUrl} className=\"object-cover\" />\r\n                                                <AvatarFallback className={cn(\r\n                                                    \"text-xl font-black\",\r\n                                                    hasUnread ? \"bg-primary/10 text-primary\" : \"bg-primary/5 text-primary\"\r\n                                                )}>\r\n                                                    {conv.otherUser?.name?.[0] || 'U'}\r\n                                                </AvatarFallback>\r\n                                            </Avatar>\r\n                                            {hasUnread && (\r\n                                                <div className=\"absolute -top-1 -right-1 h-5 w-5 bg-primary rounded-full border-2 border-white flex items-center justify-center\">\r\n                                                    <span className=\"text-[10px] font-black text-white\">{conv.unreadCount}</span>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                        <div className=\"flex-1 text-left min-w-0\">\r\n                                            <div className=\"flex justify-between items-start mb-0.5\">\r\n                                                <h3 className={cn(\r\n                                                    \"font-black text-xs uppercase tracking-tight truncate pr-2\",\r\n                                                    hasUnread && \"text-primary\"\r\n                                                )}>{conv.otherUser?.name || 'Unknown User'}</h3>\r\n                                                <span className=\"text-[10px] font-bold text-muted-foreground/40 whitespace-nowrap\">\r\n                                                    {conv.lastMessage?.timestamp ? formatDistanceToNow(new Date(conv.lastMessage.timestamp.toDate()), { addSuffix: false }) : ''}\r\n                                                </span>\r\n                                            </div>\r\n                                            <p className=\"text-xs font-medium truncate pr-4 leading-tight w-full overflow-hidden text-ellipsis whitespace-nowrap\">\r\n                                                {conv.lastMessage?.senderId === user?.uid ? 'You: ' : ''}{conv.lastMessage?.text || 'No messages yet'}\r\n                                            </p>\r\n                                        </div>\r\n                                    </button>\r\n                                );\r\n                            })\r\n                        )}\r\n                    </div>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Chat Area */}\r\n            <div className={cn(\r\n                \"flex-1 h-full\",\r\n                isSidebarOpen && \"hidden md:block\"\r\n            )}>\r\n                {localSelectedConversationId ? (\r\n                    <Card className=\"h-full flex flex-col rounded-none md:rounded-[3rem] border-0 md:border-2 border-white/40 shadow-2xl shadow-black/[0.03] bg-white overflow-hidden relative\">\r\n                        <div className=\"p-4 md:p-8 border-b-2 border-muted/5 flex items-center justify-between bg-white text-left\">\r\n                            <div className=\"flex items-center gap-3 md:gap-6\">\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"icon\"\r\n                                    className=\"md:hidden h-10 w-10 rounded-xl\"\r\n                                    onClick={() => {\r\n                                        setIsSidebarOpen(true);\r\n                                        router.replace(pathname, { scroll: false });\r\n                                    }}\r\n                                >\r\n                                    <ArrowLeft className=\"h-5 w-5\" />\r\n                                </Button>\r\n                                <Avatar className=\"h-10 w-10 md:h-16 md:w-16 rounded-xl md:rounded-[1.25rem] border-2 border-primary/5 shadow-md\">\r\n                                    <AvatarImage src={selectedConversation?.otherUser?.profileImageUrl} className=\"object-cover\" />\r\n                                    <AvatarFallback className=\"bg-muted text-xl md:text-2xl font-black\">{selectedConversation?.otherUser?.name?.[0]}</AvatarFallback>\r\n                                </Avatar>\r\n                                <div className=\"space-y-0.5\">\r\n                                    <div className=\"flex items-center gap-2 md:gap-3\">\r\n                                        <h2 className=\"text-base md:text-xl font-black uppercase tracking-tight leading-none truncate max-w-[150px] md:max-w-none\">{selectedConversation?.otherUser?.name}</h2>\r\n                                        <div className=\"h-1 md:h-1.5 w-1 md:w-1.5 rounded-full bg-green-500 shadow-[0_0_12px_rgba(34,197,94,0.5)]\" />\r\n                                    </div>\r\n                                    <p className=\"text-[7px] md:text-[10px] font-bold text-muted-foreground/40 uppercase tracking-[0.1em]\">Verified Landlord Connection</p>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex gap-2\">\r\n                                <DropdownMenu>\r\n                                    <DropdownMenuTrigger asChild>\r\n                                        <Button variant=\"ghost\" size=\"icon\" className=\"h-10 w-10 md:h-12 md:w-12 rounded-xl md:rounded-2xl hover:bg-muted/30 transition-all text-muted-foreground\">\r\n                                            <MoreVertical className=\"h-5 w-5\" />\r\n                                        </Button>\r\n                                    </DropdownMenuTrigger>\r\n                                    <DropdownMenuContent align=\"end\" className=\"w-48 rounded-xl\">\r\n                                        <DropdownMenuItem\r\n                                            className=\"text-destructive focus:text-destructive focus:bg-destructive/10 font-bold cursor-pointer\"\r\n                                            onClick={() => setReportDialogOpen(true)}\r\n                                        >\r\n                                            <Flag className=\"mr-2 h-4 w-4\" />\r\n                                            Report Landlord\r\n                                        </DropdownMenuItem>\r\n                                    </DropdownMenuContent>\r\n                                </DropdownMenu>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 overflow-y-auto p-4 md:p-10 space-y-6 md:space-y-8 custom-scrollbar relative\">\r\n                            {/* Texture Overlay */}\r\n                            <div className=\"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] bg-fixed opacity-[0.03] pointer-events-none\" />\r\n\r\n                            <div className=\"relative z-10 space-y-6 md:space-y-8\">\r\n                                {Object.entries(\r\n                                    messages.reduce((groups, msg) => {\r\n                                        const date = format(msg.timestamp ? msg.timestamp.toDate() : new Date(), 'MMMM d, yyyy');\r\n                                        if (!groups[date]) groups[date] = [];\r\n                                        groups[date].push(msg);\r\n                                        return groups;\r\n                                    }, {} as Record<string, typeof messages>)\r\n                                ).map(([date, groupMessages]) => (\r\n                                    <div key={date} className=\"space-y-8\">\r\n                                        <div className=\"flex justify-center py-4 relative\">\r\n                                            <div className=\"absolute inset-x-0 top-1/2 h-px bg-muted/10\" />\r\n                                            <span className=\"relative z-10 px-6 py-2 rounded-full bg-white border-2 border-muted/5 text-[10px] font-black uppercase tracking-[0.2em] shadow-sm\">{date}</span>\r\n                                        </div>\r\n                                        {groupMessages.map((msg) => (\r\n                                            <div\r\n                                                key={msg.id}\r\n                                                className={cn(\r\n                                                    \"flex gap-4 max-w-[85%] animate-in slide-in-from-bottom-2 duration-500\",\r\n                                                    msg.senderId === user?.uid ? \"ml-auto flex-row-reverse\" : \"mr-auto\"\r\n                                                )}\r\n                                            >\r\n                                                <Avatar className=\"h-10 w-10 flex-shrink-0 rounded-xl mt-1 shadow-sm border-2 border-white\">\r\n                                                    <AvatarImage src={msg.senderId === user?.uid ? userProfile?.profileImageUrl : selectedParticipant?.profileImageUrl} className=\"object-cover\" />\r\n                                                    <AvatarFallback className=\"text-[10px] font-black\">{msg.senderId === user?.uid ? 'ME' : 'U'}</AvatarFallback>\r\n                                                </Avatar>\r\n                                                <div className=\"space-y-2\">\r\n                                                    <div\r\n                                                        className={cn(\r\n                                                            \"p-6 rounded-[2rem] text-sm font-medium leading-relaxed shadow-xl transition-all hover:scale-[1.01]\",\r\n                                                            msg.senderId === user?.uid\r\n                                                                ? \"bg-foreground text-white rounded-tr-none shadow-black/10\"\r\n                                                                : \"bg-white border-2 border-muted/10 text-foreground rounded-tl-none shadow-black/5\"\r\n                                                        )}\r\n                                                    >\r\n                                                        {msg.text}\r\n                                                    </div>\r\n                                                    <p className={cn(\r\n                                                        \"text-[8px] font-bold text-muted-foreground/30 uppercase tracking-widest\",\r\n                                                        msg.senderId === user?.uid ? \"text-right\" : \"text-left\"\r\n                                                    )}>\r\n                                                        {format(msg.timestamp ? msg.timestamp.toDate() : new Date(), 'HH:mm')} â€¢ {msg.senderId === user?.uid ? 'Delivered' : 'Received'}\r\n                                                    </p>\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                ))}\r\n                                <div ref={messagesEndRef} />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-4 md:p-8 border-t-2 border-muted/5 bg-white relative\">\r\n                            <form\r\n                                onSubmit={(e) => {\r\n                                    e.preventDefault();\r\n                                    handleSendMessage();\r\n                                }}\r\n                                className=\"relative\"\r\n                            >\r\n                                <Input\r\n                                    placeholder=\"Draft your message...\"\r\n                                    className=\"h-14 md:h-20 rounded-2xl md:rounded-[2.5rem] border-2 bg-muted/5 pl-6 md:pl-8 pr-20 md:pr-28 text-sm font-medium focus:bg-white focus:ring-8 focus:ring-primary/5 transition-all shadow-inner placeholder:text-muted-foreground/40\"\r\n                                    value={newMessage}\r\n                                    onChange={(e) => setNewMessage(e.target.value)}\r\n                                />\r\n                                <Button\r\n                                    type=\"submit\"\r\n                                    className=\"absolute right-2 top-1/2 -translate-y-1/2 h-10 md:h-14 px-4 md:px-8 rounded-xl md:rounded-full bg-primary hover:bg-primary/90 text-white shadow-xl shadow-primary/20 transition-all active:scale-95 disabled:opacity-50 disabled:scale-100\"\r\n                                    disabled={!newMessage.trim()}\r\n                                >\r\n                                    <Send className=\"h-4 w-4 md:h-5 md:w-5\" />\r\n                                </Button>\r\n                            </form>\r\n                        </div>\r\n                    </Card>\r\n                ) : (\r\n                    <Card className=\"h-full flex flex-col items-center justify-center rounded-[2rem] md:rounded-[3rem] border-2 border-dashed border-muted/10 bg-muted/5 p-8 md:p-20 text-center space-y-6 md:space-y-8 animate-in zoom-in duration-700\">\r\n                        <div className=\"h-20 w-20 md:h-32 md:w-32 rounded-2xl md:rounded-[2.5rem] bg-white shadow-2xl flex items-center justify-center mx-auto relative group overflow-hidden\">\r\n                            <div className=\"absolute inset-0 bg-primary/5 rounded-2xl md:rounded-[2.5rem] animate-pulse\" />\r\n                            <MessageSquare className=\"h-8 w-8 md:h-14 md:w-14 text-muted-foreground/20 group-hover:scale-110 transition-transform duration-500\" />\r\n                        </div>\r\n                        <div className=\"space-y-2 md:space-y-3\">\r\n                            <h3 className=\"text-xl md:text-3xl font-black uppercase tracking-tight\">Channel <span className=\"text-primary\">Hibernated</span></h3>\r\n                            <p className=\"text-sm md:text-lg text-muted-foreground font-medium max-w-sm mx-auto leading-relaxed\">\r\n                                Select a landlord thread to initiate communication.\r\n                            </p>\r\n                        </div>\r\n                    </Card>\r\n                )}\r\n            </div>\r\n            {selectedConversation && selectedConversation.otherUser && (\r\n                <ReportUserDialog\r\n                    isOpen={reportDialogOpen}\r\n                    onClose={() => setReportDialogOpen(false)}\r\n                    reportedUserId={selectedConversation.otherUser.id}\r\n                    reportedUserName={selectedConversation.otherUser.name}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}