{"version":3,"sources":["../../../../src/app/student/tenancy/page.tsx"],"sourcesContent":["\r\n'use client';\r\n\r\nimport { useRouter } from 'next/navigation';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport Link from 'next/link';\r\nimport { useUser, useFirestore, useCollection, useMemoFirebase } from '@/firebase';\r\nimport { collection, query, where, getDocs, documentId } from 'firebase/firestore';\r\nimport type { LeaseAgreement, Property } from '@/types';\r\nimport { Building } from 'lucide-react';\r\nimport { Skeleton } from '@/components/ui/skeleton';\r\nimport PropertyCard from '@/components/property-card';\r\nimport React from 'react';\r\nimport Loading from '@/app/loading';\r\nimport { Badge } from '@/components/ui/badge';\r\n\r\n// Helper function to split an array into chunks\r\nfunction chunkArray<T>(array: T[], size: number): T[][] {\r\n    const chunks: T[][] = [];\r\n    for (let i = 0; i < array.length; i += size) {\r\n        chunks.push(array.slice(i, i + size));\r\n    }\r\n    return chunks;\r\n}\r\n\r\n\r\nexport default function TenancyDashboardPage() {\r\n    const { user, isUserLoading } = useUser();\r\n    const firestore = useFirestore();\r\n    const [properties, setProperties] = React.useState<Property[]>([]);\r\n    const [isLoading, setIsLoading] = React.useState(true);\r\n\r\n    const leasesQuery = useMemoFirebase(() => {\r\n        if (!user) return null;\r\n        return query(\r\n            collection(firestore, 'leaseAgreements'),\r\n            where('tenantId', '==', user.uid),\r\n            where('status', 'in', ['active', 'pending', 'terminating'])\r\n        );\r\n    }, [user, firestore]);\r\n\r\n    const { data: leases, isLoading: areLeasesLoading } = useCollection<LeaseAgreement>(leasesQuery);\r\n\r\n    React.useEffect(() => {\r\n        if (areLeasesLoading) return;\r\n        if (!leases || !firestore) {\r\n            setIsLoading(false);\r\n            return;\r\n        };\r\n\r\n        const fetchProperties = async () => {\r\n            if (leases.length === 0) {\r\n                setProperties([]);\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            const propertyIds = leases.map(lease => lease.propertyId);\r\n\r\n            if (propertyIds.length === 0) {\r\n                setProperties([]);\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            const propertyChunks = chunkArray(propertyIds, 30);\r\n            const fetchedProperties: Property[] = [];\r\n            for (const chunk of propertyChunks) {\r\n                const propertiesQuery = query(collection(firestore, 'properties'), where(documentId(), 'in', chunk));\r\n                const propertySnapshots = await getDocs(propertiesQuery);\r\n                propertySnapshots.forEach((doc: any) => {\r\n                    fetchedProperties.push(doc.data() as Property);\r\n                });\r\n            }\r\n\r\n            setProperties(fetchedProperties);\r\n            setIsLoading(false);\r\n        }\r\n        fetchProperties();\r\n    }, [leases, areLeasesLoading, firestore]);\r\n\r\n\r\n    if (isUserLoading || isLoading) {\r\n        return <Loading />;\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-12\">\r\n            {/* Header Section */}\r\n            <div className=\"flex flex-col items-start justify-between gap-6 sm:flex-row sm:items-center\">\r\n                <div className=\"space-y-1\">\r\n                    <h1 className=\"font-headline text-4xl font-extrabold tracking-tight text-foreground\">\r\n                        My Tenancies <Building className=\"inline h-8 w-8 text-primary/40 ml-2\" />\r\n                    </h1>\r\n                    <p className=\"text-lg font-medium text-muted-foreground/80\">\r\n                        Manage your active rental agreements and track your home details.\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {properties && properties.length > 0 ? (\r\n                <div className=\"grid grid-cols-1 gap-10 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3\">\r\n                    {properties.map((property, idx) => (\r\n                        <Link\r\n                            key={property.id}\r\n                            href={`/student/tenancy/${property.id}`}\r\n                            className=\"group block animate-in fade-in slide-in-from-bottom-6 duration-700 hover:-translate-y-2 transition-all\"\r\n                            style={{ animationDelay: `${idx * 100}ms` }}\r\n                        >\r\n                            <div className=\"relative\">\r\n                                <PropertyCard property={property} as=\"div\" />\r\n                                <div className=\"absolute top-4 right-4 z-10\">\r\n                                    <Badge className=\"bg-white/90 backdrop-blur-md text-primary font-black px-4 py-1.5 rounded-full shadow-xl border-none tracking-tighter uppercase text-[10px]\">\r\n                                        Active Tenancy\r\n                                    </Badge>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"mt-4 flex items-center justify-between px-2\">\r\n                                <span className=\"text-sm font-bold text-primary group-hover:underline underline-offset-4 decoration-2\">Manage Tenancy →</span>\r\n                                <span className=\"text-xs font-bold text-muted-foreground/60\">{property.type} • {property.bedrooms} Bed</span>\r\n                            </div>\r\n                        </Link>\r\n                    ))}\r\n                </div>\r\n            ) : (\r\n                <Card className=\"overflow-hidden border-none bg-white shadow-xl shadow-black/[0.02]\">\r\n                    <CardContent className=\"flex flex-col items-center justify-center py-24 text-center\">\r\n                        <div className=\"relative mb-10\">\r\n                            <div className=\"absolute inset-0 bg-primary/10 blur-3xl rounded-full scale-150 animate-pulse\" />\r\n                            <div className=\"relative flex h-32 w-32 items-center justify-center rounded-[2.5rem] bg-muted/30 transition-transform hover:scale-110 hover:rotate-3\">\r\n                                <Building className=\"h-16 w-16 text-primary opacity-20\" />\r\n                            </div>\r\n                        </div>\r\n                        <h2 className=\"text-3xl font-black tracking-tight\">No Active Tenancies</h2>\r\n                        <p className=\"mx-auto mt-4 max-w-sm text-lg font-medium text-muted-foreground/80 leading-relaxed\">\r\n                            Once your rental application is approved and the lease is signed, your home details will appear here.\r\n                        </p>\r\n                        <Button size=\"lg\" className=\"mt-10 rounded-2xl px-10 font-bold\" asChild>\r\n                            <Link href=\"/student/properties\">Start Searching</Link>\r\n                        </Button>\r\n                    </CardContent>\r\n                </Card>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"wDAIA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAYe,SAAS,IACpB,GAAM,MAAE,CAAI,eAAE,CAAa,CAAE,CAAG,CAAA,EAAA,EAAA,OAAA,AAAO,IACjC,EAAY,CAAA,EAAA,EAAA,YAAA,AAAY,IACxB,CAAC,EAAY,EAAc,CAAG,EAAA,OAAK,CAAC,QAAQ,CAAa,EAAE,EAC3D,CAAC,EAAW,EAAa,CAAG,EAAA,OAAK,CAAC,QAAQ,EAAC,GAE3C,EAAc,CAAA,EAAA,EAAA,eAAA,AAAe,EAAC,IAChC,AAAK,EACE,CAAA,CADH,CACG,CADI,CACJ,KAAA,AAAK,EACR,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAW,mBACtB,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,WAAY,KAAM,EAAK,GAAG,EAChC,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,SAAU,KAAM,CAAC,SAAU,UAAW,cAAc,GAJ5C,KAMnB,CAAC,EAAM,EAAU,EAEd,CAAE,KAAM,CAAM,CAAE,UAAW,CAAgB,CAAE,CAAG,CAAA,EAAA,EAAA,aAAA,AAAa,EAAiB,SAyCpF,CAvCA,EAAA,OAAK,CAAC,SAAS,CAAC,KACZ,AAAI,IACC,AAAD,GAAY,EAiChB,CA5BwB,IALT,IADO,AACK,EAMvB,GAAsB,IAAlB,EAAO,MAAM,CAAQ,CACrB,EAAc,EAAE,EAChB,GAAa,GACb,MACJ,CAEA,IAAM,EAAc,EAAO,GAAG,CAAC,GAAS,EAAM,UAAU,EAExD,GAA2B,IAAvB,EAAY,MAAM,CAAQ,CAC1B,EAAc,EAAE,EAChB,GAAa,GACb,MACJ,CAEA,IAAM,EAAiB,AAhDnC,SAAS,AAAc,CAAU,CAAE,CAAY,EAC3C,IAAM,EAAgB,EAAE,CACxB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAM,MAAM,CAAE,GA8CqB,EA9ChB,CACnC,EAAO,EADkC,EAC9B,CAAC,EAAM,KAAK,CAAC,EAAG,IAAI,GAEnC,OAAO,CACX,EA0C8C,KAC5B,EAAgC,EAAE,CACxC,IAAK,IAAM,KAAS,EAAgB,CAChC,IAAM,EAAkB,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAW,cAAe,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,CAAA,EAAA,EAAA,UAAU,AAAV,IAAc,KAAM,IAE7F,CAD0B,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,EAAA,EACtB,OAAO,CAAC,AAAC,IACvB,EAAkB,IAAI,CAAC,EAAI,IAAI,GACnC,EACJ,CAEA,EAAc,GACd,GAAa,GACjB,IA/BI,EAAa,IAiCrB,EAAG,CAAC,EAAQ,EAAkB,EAAU,EAGpC,GAAiB,GACV,CAAA,EAAA,EAAA,GAAA,AADqB,EACpB,EAAA,OAAO,CAAA,CAAA,GAIf,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uBAEX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uFACX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACX,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,CAAG,UAAU,iFAAuE,gBACpE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,UAAU,2CAErC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,wDAA+C,2EAMnE,GAAc,EAAW,MAAM,CAAG,EAC/B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gFACV,EAAW,GAAG,CAAC,CAAC,EAAU,IACvB,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,OAAI,CAAA,CAED,KAAM,CAAC,iBAAiB,EAAE,EAAS,EAAE,CAAA,CAAE,CACvC,UAAU,yGACV,MAAO,CAAE,eAAgB,CAAA,EAAS,IAAN,EAAU,EAAE,CAAC,AAAC,YAE1C,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,qBACX,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAY,CAAA,CAAC,SAAU,EAAU,GAAG,QACrC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uCACX,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,UAAU,sJAA6I,wBAKtK,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wDACX,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,gGAAuF,qBACvG,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,uDAA8C,EAAS,IAAI,CAAC,MAAI,EAAS,QAAQ,CAAC,eAfjG,EAAS,EAAE,KAqB5B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,8EACZ,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,wEACnB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2BACX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iFACf,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gJACX,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,UAAU,2CAG5B,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,8CAAqC,wBACnD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,8FAAqF,0GAGlG,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,KAAK,KAAK,UAAU,oCAAoC,OAAO,CAAA,CAAA,WACnE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAK,+BAAsB,6BAO7D"}