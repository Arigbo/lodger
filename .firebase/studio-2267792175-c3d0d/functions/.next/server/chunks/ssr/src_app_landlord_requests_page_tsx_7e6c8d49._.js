module.exports=[80193,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(91119),e=a.i(99570),f=a.i(72233),g=a.i(33441),h=a.i(33508),i=a.i(23312),j=a.i(46842),k=a.i(56738),l=a.i(4416),m=a.i(41710),n=a.i(52495),o=a.i(38246),p=a.i(69082);a.i(79597);var q=a.i(36505);a.i(69387);var r=a.i(60574),s=a.i(57136),t=a.i(42816),u=a.i(48711),v=a.i(23690),w=a.i(54614);function x(a,b){if(0===a.length)return[];let c=[];for(let d=0;d<a.length;d+=b)c.push(a.slice(d,d+b));return c}function y(){let{user:a,isUserLoading:y}=(0,q.useUser)(),z=(0,q.useFirestore)(),{toast:A}=(0,w.useToast)(),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)([]),[H,I]=(0,c.useState)(!0),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)([]);c.useEffect(()=>{if(!a||!z){y||I(!1);return}(async()=>{try{let b=(0,r.doc)(z,"users",a.uid),c=await (0,r.getDoc)(b);c.exists()&&K({id:c.id,...c.data()})}catch(a){console.error("Error fetching landlord profile:",a)}})(),(async()=>{I(!0);let b=(0,r.query)((0,r.collection)(z,"rentalApplications"),(0,r.where)("landlordId","==",a.uid)),c=(await (0,r.getDocs)(b)).docs.map(a=>({id:a.id,...a.data()}));if(0===c.length){G([]),I(!1);return}let d=[...new Set(c.map(a=>a.tenantId))].filter(Boolean),e=[...new Set(c.map(a=>a.propertyId))].filter(Boolean),f=new Map,g=new Map;if(d.length>0)for(let a of x(d,30)){let b=(0,r.query)((0,r.collection)(z,"users"),(0,r.where)((0,r.documentId)(),"in",a));(await (0,r.getDocs)(b)).forEach(a=>f.set(a.id,{id:a.id,...a.data()}))}if(e.length>0)for(let a of x(e,30)){let b=(0,r.query)((0,r.collection)(z,"properties"),(0,r.where)((0,r.documentId)(),"in",a));(await (0,r.getDocs)(b)).forEach(a=>g.set(a.id,{id:a.id,...a.data()}))}G(c.map(a=>({request:a,applicant:f.get(a.tenantId)||null,property:g.get(a.propertyId)||null})).sort((a,b)=>new Date(b.request.applicationDate).getTime()-new Date(a.request.applicationDate).getTime())),I(!1)})(),(async()=>{let b=(0,r.query)((0,r.collection)(z,"leaseAgreements"),(0,r.where)("landlordId","==",a.uid),(0,r.where)("paymentMethod","==","offline"),(0,r.where)("paymentConfirmed","==",!1)),c=(await (0,r.getDocs)(b)).docs.map(a=>({id:a.id,...a.data()}));if(0===c.length)return M([]);let d=[...new Set(c.map(a=>a.tenantId))].filter(Boolean),e=[...new Set(c.map(a=>a.propertyId))].filter(Boolean),f=new Map,g=new Map;if(d.length>0)for(let a of x(d,30)){let b=(0,r.query)((0,r.collection)(z,"users"),(0,r.where)((0,r.documentId)(),"in",a));(await (0,r.getDocs)(b)).forEach(a=>f.set(a.id,{id:a.id,...a.data()}))}if(e.length>0)for(let a of x(e,30)){let b=(0,r.query)((0,r.collection)(z,"properties"),(0,r.where)((0,r.documentId)(),"in",a));(await (0,r.getDocs)(b)).forEach(a=>g.set(a.id,{id:a.id,...a.data()}))}M(c.map(a=>({lease:a,tenant:f.get(a.tenantId)||null,property:g.get(a.propertyId)||null})))})()},[a,z,y]);let N=F.filter(a=>"pending"===a.request.status),O=async b=>{if(D&&a){let{request:c,property:d}=D;if(!d)return;let e=(0,r.doc)(z,"rentalApplications",c.id);(0,s.updateDocumentNonBlocking)(e,{status:"approved"});let f=new Date().toISOString(),g=(0,r.collection)(z,"leaseAgreements"),h=await (0,r.addDoc)(g,{propertyId:d.id,landlordId:a.uid,tenantId:c.tenantId,leaseText:b,landlordSigned:!0,tenantSigned:!1,startDate:f,endDate:new Date(new Date().setFullYear(new Date().getFullYear()+1)).toISOString(),status:"pending"});await (0,r.updateDoc)(h,{id:h.id}),await (0,u.sendNotification)({toUserId:c.tenantId,type:"REQUEST_ACCEPTED",firestore:z,propertyName:d.title,link:`/student/leases/${h.id}`}),await (0,u.sendNotification)({toUserId:c.tenantId,type:"LEASE_GENERATED",firestore:z,propertyName:d.title,link:`/student/leases/${h.id}`}),G(a=>a.map(a=>a.request.id===c.id?{...a,request:{...a.request,status:"approved"}}:a)),A({title:"Authority Granted",description:"Lease protocol initiated and tenant notified."})}},P=async(b,c,d,e)=>{try{let f=(0,r.doc)(z,"leaseAgreements",b),g=(0,r.doc)(z,"properties",d);await (0,r.updateDoc)(f,{paymentConfirmed:!0,landlordApprovedOfflinePayment:!0,status:"active"});let h=(await (0,r.getDoc)(f)).data();await (0,r.updateDoc)(g,{status:"occupied",currentTenantId:c,leaseStartDate:h.startDate});let i=L.find(a=>a.lease.id===b)?.property;await (0,r.addDoc)((0,r.collection)(z,"transactions"),{landlordId:a.uid,tenantId:c,propertyId:d,amount:h.offlinePaymentAmount||i?.price||0,months:h.offlinePaymentMonths||1,currency:h.currency||i?.currency||"USD",date:new Date().toISOString(),type:"Rent",paymentMethod:"Offline",status:"Completed"}),await (0,u.sendNotification)({toUserId:c,type:"OFFLINE_PAYMENT_APPROVED",firestore:z,propertyTitle:e,link:"/student/tenancy"}),M(a=>a.filter(a=>a.lease.id!==b)),A({title:"Revenue Confirmed",description:"Offline payment authenticated successfully."})}catch(a){console.error("Error approving offline payment:",a),A({variant:"destructive",title:"Authentication Error",description:"Failed to confirm offline revenue."})}},Q=async(a,b,c)=>{try{let d=(0,r.doc)(z,"leaseAgreements",a);await (0,r.updateDoc)(d,{paymentMethod:null,paymentConfirmed:!1}),await (0,u.sendNotification)({toUserId:b,type:"OFFLINE_PAYMENT_REJECTED",firestore:z,propertyTitle:c,link:`/student/leases/${a}`}),M(b=>b.filter(b=>b.lease.id!==a)),A({title:"Payment Rejected",description:"Tenant redirected to re-choose payment protocol."})}catch(a){console.error("Error rejecting offline payment:",a)}};return y||H?(0,b.jsx)(t.default,{}):(0,b.jsxs)("div",{className:"space-y-16 pb-32 animate-in fade-in duration-1000",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-8 px-2",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("h1",{className:"font-headline text-4xl md:text-5xl font-black tracking-tight uppercase",children:["Requests",(0,b.jsx)("span",{className:"text-primary text-xl ml-1",children:"."})]}),(0,b.jsx)("p",{className:"text-lg text-muted-foreground font-medium max-w-2xl leading-relaxed",children:"Manage your incoming applications and verify offline payment transactions in a centralized workflow."})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,b.jsxs)("div",{className:"bg-white px-6 md:px-8 py-4 md:py-5 rounded-2xl md:rounded-[2rem] border-2 border-muted/10 shadow-sm flex flex-col justify-center flex-1 md:min-w-[160px]",children:[(0,b.jsx)("p",{className:"text-[8px] md:text-[10px] font-black uppercase tracking-[0.2em] text-muted-foreground/60 mb-1",children:"Active Requests"}),(0,b.jsx)("p",{className:"text-2xl md:text-3xl font-black tracking-tighter",children:N.length})]}),L.length>0&&(0,b.jsxs)("div",{className:"bg-orange-600 text-white px-6 md:px-8 py-4 md:py-5 rounded-2xl md:rounded-[2rem] shadow-xl shadow-orange-600/20 flex flex-col justify-center flex-1 md:min-w-[160px] animate-in zoom-in duration-500",children:[(0,b.jsx)("p",{className:"text-[8px] md:text-[10px] font-black uppercase tracking-[0.2em] text-white/60 mb-1",children:"Payment Tasks"}),(0,b.jsx)("p",{className:"text-2xl md:text-3xl font-black tracking-tighter",children:L.length})]})]})]}),(0,b.jsxs)("div",{className:"space-y-10",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 px-2",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-xl bg-primary/10 flex items-center justify-center",children:(0,b.jsx)(j.User,{className:"h-5 w-5 text-primary"})}),(0,b.jsx)("h2",{className:"text-3xl font-black uppercase tracking-tight",children:"Active Applications"})]}),0===N.length?(0,b.jsxs)(d.Card,{className:"rounded-[3.5rem] border-2 border-dashed border-foreground/10 bg-muted/5 p-24 text-center space-y-8",children:[(0,b.jsxs)("div",{className:"h-32 w-32 rounded-[2.5rem] bg-white shadow-2xl flex items-center justify-center mx-auto relative group overflow-hidden",children:[(0,b.jsx)(i.Bell,{className:"h-14 w-14 text-muted-foreground/20 group-hover:scale-110 transition-transform"}),(0,b.jsx)("div",{className:"absolute inset-0 bg-primary/5 rounded-[2.5rem]"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h3",{className:"text-2xl font-black uppercase tracking-tight",children:"No Requests"}),(0,b.jsx)("p",{className:"text-lg text-muted-foreground max-w-sm mx-auto",children:"No incoming applications at the moment."})]})]}):(0,b.jsx)("div",{className:"grid grid-cols-1 gap-8",children:N.map(a=>{let{request:c,applicant:i,property:j}=a;return i&&j?(0,b.jsx)(d.Card,{className:"group overflow-hidden rounded-[3rem] border-2 border-foreground/5 bg-white hover:shadow-3xl transition-all duration-500 p-8 md:p-10",children:(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row gap-10",children:[(0,b.jsxs)("div",{className:"flex items-center gap-6 lg:w-1/3 border-r-2 border-muted/5 pr-10",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)(f.Avatar,{className:"h-24 w-24 rounded-[2rem] ring-4 ring-primary/5 ring-offset-4 ring-offset-white",children:[(0,b.jsx)(f.AvatarImage,{src:i?.profileImageUrl,className:"object-cover"}),(0,b.jsx)(f.AvatarFallback,{className:"bg-muted text-2xl font-black uppercase",children:i?.name?.[0]})]}),(0,b.jsx)("div",{className:"absolute -bottom-2 -right-2 h-10 w-10 rounded-2xl bg-primary text-white flex items-center justify-center shadow-lg",children:(0,b.jsx)(l.ShieldCheck,{className:"h-5 w-5"})})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-[10px] font-black uppercase tracking-widest text-primary",children:"APPLICANT PROFILE"}),(0,b.jsx)("h3",{className:"text-2xl font-black uppercase tracking-tight",children:i?.name}),(0,b.jsx)("p",{className:"text-xs font-bold text-muted-foreground/60",children:i?.email})]})]}),(0,b.jsxs)("div",{className:"flex-1 space-y-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-[10px] font-black uppercase tracking-widest text-muted-foreground/40",children:"PROPERTY"}),(0,b.jsxs)(o.default,{href:`/landlord/properties/${j.id}`,className:"group/link flex items-center gap-2 text-xl font-black uppercase tracking-tight hover:text-primary transition-colors",children:[j.title," ",(0,b.jsx)(n.ExternalLink,{className:"h-4 w-4 opacity-0 group-hover/link:opacity-100 transition-opacity"})]}),(0,b.jsxs)("p",{className:"text-xs font-medium text-muted-foreground leading-relaxed",children:['"',c.messageToLandlord||"Application submitted without a message.",'"']})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-[10px] font-black uppercase tracking-widest text-muted-foreground/40",children:"SUBMITTED ON"}),(0,b.jsx)("p",{className:"text-sm font-black text-foreground",children:new Date(c.applicationDate).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 pt-4 border-t-2 border-muted/5",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-muted/20 text-[10px] font-black uppercase tracking-widest",children:[(0,b.jsx)(m.Clock,{className:"h-3 w-3 text-primary"})," Status: ",c.status]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-muted/20 text-[10px] font-black uppercase tracking-widest",children:[(0,b.jsx)(k.Wallet,{className:"h-3 w-3 text-primary"})," Monthly Rent: ",(0,v.formatPrice)(j.price,j.currency)]})]})]}),(0,b.jsxs)("div",{className:"lg:w-1/4 flex flex-col sm:flex-row lg:flex-col gap-4 justify-center items-stretch lg:border-l-2 lg:border-muted/5 lg:pl-10",children:[(0,b.jsxs)(e.Button,{onClick:()=>{E(a),C(!0)},className:"h-16 flex-1 rounded-2xl bg-foreground text-white hover:bg-primary transition-all font-black text-[10px] md:text-xs uppercase tracking-widest gap-3 shadow-xl",children:[(0,b.jsx)(g.Check,{className:"h-5 w-5"})," ACCEPT"]}),(0,b.jsxs)(e.Button,{variant:"outline",onClick:()=>{var a;let b,d;return a=c.id,b=(0,r.doc)(z,"rentalApplications",a),(0,s.updateDocumentNonBlocking)(b,{status:"declined"}),void((d=F.find(b=>b.request.id===a))&&d.request.tenantId&&(0,u.sendNotification)({toUserId:d.request.tenantId,type:"REQUEST_REJECTED",firestore:z,propertyName:d.property?.title,link:"/student/requests"}),G(b=>b.map(b=>b.request.id===a?{...b,request:{...b.request,status:"declined"}}:b)),A({title:"Inquiry Declined",description:"The applicant has been notified of your decision."}))},className:"h-16 flex-1 rounded-2xl border-2 hover:bg-destructive hover:text-white hover:border-destructive transition-all font-black text-[10px] md:text-xs uppercase tracking-widest gap-3",children:[(0,b.jsx)(h.X,{className:"h-5 w-5"})," DECLINE"]})]})]})},c.id):null})})]}),L.length>0&&(0,b.jsxs)("div",{className:"space-y-10",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 px-2",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-xl bg-orange-500/10 flex items-center justify-center",children:(0,b.jsx)(k.Wallet,{className:"h-5 w-5 text-orange-600"})}),(0,b.jsxs)("h2",{className:"text-3xl font-black uppercase tracking-tight",children:["Offline Payment ",(0,b.jsx)("span",{className:"text-orange-600",children:"Verification"})]})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:L.map(({lease:a,tenant:c,property:i})=>c&&i?(0,b.jsxs)(d.Card,{className:"group relative overflow-hidden rounded-[3rem] border-2 border-orange-500/10 bg-white hover:shadow-2xl transition-all duration-500 p-8",children:[(0,b.jsx)("div",{className:"absolute top-0 right-0 w-24 h-24 bg-orange-500/5 rounded-bl-[4rem] -mr-6 -mt-6"}),(0,b.jsxs)("div",{className:"space-y-8 relative z-10",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)(f.Avatar,{className:"h-16 w-16 rounded-2xl ring-2 ring-orange-500/10",children:[(0,b.jsx)(f.AvatarImage,{src:c.profileImageUrl,className:"object-cover"}),(0,b.jsx)(f.AvatarFallback,{className:"bg-muted text-xl font-black uppercase",children:c.name?.[0]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-xl font-black uppercase tracking-tight",children:c.name}),(0,b.jsx)("p",{className:"text-[10px] font-black uppercase tracking-widest text-muted-foreground/40",children:"TENANT"})]})]}),(0,b.jsxs)("div",{className:"p-6 rounded-2xl bg-orange-500/5 border-2 border-orange-500/5 space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("p",{className:"text-[10px] font-black uppercase tracking-widest text-orange-600/60",children:"OFFLINE PAYMENT"}),(0,b.jsx)("p",{className:"text-2xl font-black text-orange-600",children:(0,v.formatPrice)(a.offlinePaymentAmount||i.price,i.currency)})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-orange-500/10",children:[(0,b.jsx)("p",{className:"text-xs font-bold text-muted-foreground/60",children:"LEASE TERM"}),(0,b.jsxs)("p",{className:"text-xs font-black uppercase",children:[a.offlinePaymentMonths||1," Month(s) Pre-Paid"]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("p",{className:"text-[10px] font-black uppercase tracking-widest text-muted-foreground/40 text-center",children:"Verify physical receipt of funds before proceeding"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)(e.Button,{onClick:()=>P(a.id,c.id,i.id,i.title),className:"h-14 rounded-xl bg-orange-600 text-white hover:bg-orange-700 transition-all font-black text-[10px] uppercase tracking-widest gap-2 shadow-lg",children:[(0,b.jsx)(g.Check,{className:"h-4 w-4"})," VERIFY PAYMENT"]}),(0,b.jsxs)(e.Button,{variant:"outline",onClick:()=>Q(a.id,c.id,i.title),className:"h-14 rounded-xl border-2 border-orange-500/20 hover:bg-orange-50 text-orange-600 transition-all font-black text-[10px] uppercase tracking-widest gap-2",children:[(0,b.jsx)(h.X,{className:"h-4 w-4"})," REJECT"]})]})]})]})]},a.id):null)})]}),D&&J&&D.applicant&&D.property?.leaseTemplate&&(0,b.jsx)(p.default,{isOpen:B,onClose:()=>C(!1),onLeaseSigned:O,landlord:J,tenant:D.applicant,property:D.property,templateText:D.property.leaseTemplate})]})}a.s(["default",()=>y])}];

//# sourceMappingURL=src_app_landlord_requests_page_tsx_7e6c8d49._.js.map