module.exports=[35156,a=>{"use strict";a.i(60121);var b=a.i(5420);async function c(a){let b=await new Promise((b,c)=>{let d=new FileReader;d.onloadend=()=>{b(d.result.split(",")[1])},d.onerror=c,d.readAsDataURL(a)}),c=await fetch("/api/moderate-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageBase64:b,mimeType:a.type})});if(!c.ok){if(429===c.status)throw Error("Rate limit exceeded. Please wait and try again.");throw Error("Moderation check failed")}return await c.json()}async function d(a,d,e,f){try{if(!e.type.startsWith("image/"))return{success:!1,error:"Invalid file type. Please upload an image file."};if(e.size>5242880)return{success:!1,error:"File is too large. Maximum size is 5MB."};if(f?.skipModeration){let c=(0,b.ref)(a,d),f={contentType:e.type,cacheControl:"public, max-age=3600"},g=await (0,b.uploadBytes)(c,e,f),h=await (0,b.getDownloadURL)(g.ref);return{success:!0,downloadURL:h}}let g=await c(e);if("UNSAFE"===g.safety)return{success:!1,blocked:!0,analysis:g,error:g.reason||"Image contains inappropriate content and cannot be uploaded."};if("IRRELEVANT"===g.context&&!f?.allowIrrelevant)return{success:!1,blocked:!1,analysis:g,error:g.reason||"Image may not be relevant to property listings."};let h=(0,b.ref)(a,d),i={contentType:e.type,cacheControl:"public, max-age=3600",customMetadata:{moderationSafety:g.safety,moderationContext:g.context}},j=await (0,b.uploadBytes)(h,e,i),k=await (0,b.getDownloadURL)(j.ref);return{success:!0,downloadURL:k,analysis:g}}catch(a){return console.error("Moderation and upload error:",a),{success:!1,error:a.message||"Upload failed. Please try again."}}}async function e(a,c,d){try{if(!d.type.startsWith("image/"))throw Error("Invalid file type. Please upload an image file.");if(d.size>5242880)throw Error("File is too large. Maximum size is 5MB.");let e=(0,b.ref)(a,`users/${c}/profile-picture`),f={contentType:d.type,cacheControl:"public, max-age=3600"};console.log(`Starting upload for user ${c}, file: ${d.name}, size: ${d.size}, type: ${d.type}`);let g=await (0,b.uploadBytes)(e,d,f);console.log("Upload successful, retrieving download URL...");let h=await (0,b.getDownloadURL)(g.ref);return console.log("Download URL retrieved successfully"),h}catch(a){throw console.error("Profile image upload error:",{code:a.code,message:a.message,serverResponse:a.serverResponse,fullError:a}),Error(`Upload failed: ${a.message||"Unknown error"}`)}}a.s(["moderateAndUpload",()=>d,"moderateImage",()=>c,"uploadProfileImage",()=>e])}];

//# sourceMappingURL=src_firebase_storage_ts_96b0bb55._.js.map