module.exports=[23010,a=>{"use strict";var b=a.i(87924),c=a.i(50944),d=a.i(91119),e=a.i(72233),f=a.i(99570),g=a.i(5084),h=a.i(63519),i=a.i(92258),j=a.i(73570);let k=(0,a.i(70106).default)("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);var l=a.i(99464),m=a.i(46842),n=a.i(38246),o=a.i(72228),p=a.i(48532),q=a.i(58419);function r(a,b){let c=(0,q.toDate)(a),d=(0,q.toDate)(b),e=s(c,d),f=Math.abs((0,p.differenceInCalendarDays)(c,d));c.setDate(c.getDate()-e*f);let g=Number(s(c,d)===-e),h=e*(f-g);return 0===h?0:h}function s(a,b){let c=a.getFullYear()-b.getFullYear()||a.getMonth()-b.getMonth()||a.getDate()-b.getDate()||a.getHours()-b.getHours()||a.getMinutes()-b.getMinutes()||a.getSeconds()-b.getSeconds()||a.getMilliseconds()-b.getMilliseconds();return c<0?-1:c>0?1:c}var t=a.i(95680),u=a.i(77151),v=a.i(23690),w=a.i(86192),x=a.i(86304),y=a.i(72131);a.i(79597);var z=a.i(36505),A=a.i(28137),B=a.i(73810);a.i(69387);var C=a.i(60574),D=a.i(54614),E=a.i(57136),F=a.i(42816);function G(){let p=(0,c.useParams)(),q=Array.isArray(p.id)?p.id[0]:p.id,{user:s,isUserLoading:G}=(0,z.useUser)(),H=(0,z.useFirestore)(),I=(0,z.useMemoFirebase)(()=>q?(0,C.doc)(H,"users",q):null,[H,q]),{data:J,isLoading:K}=(0,A.useDoc)(I),L=(0,z.useMemoFirebase)(()=>q&&s?(0,C.query)((0,C.collection)(H,"leaseAgreements"),(0,C.where)("tenantId","==",q),(0,C.where)("landlordId","==",s.uid),(0,C.where)("status","==","active")):null,[q,s,H]),{data:M,isLoading:N}=(0,B.useCollection)(L),O=M?.[0],P=(0,z.useMemoFirebase)(()=>O?(0,C.doc)(H,"properties",O.propertyId):null,[O,H]),{data:Q,isLoading:R}=(0,A.useDoc)(P),S=(0,z.useMemoFirebase)(()=>J?(0,C.query)((0,C.collection)(H,"transactions"),(0,C.where)("tenantId","==",J.id)):null,[J,H]),{data:T,isLoading:U}=(0,B.useCollection)(S),{toast:V}=(0,D.useToast)(),[W,X]=(0,y.useState)(null),Y=async()=>{if(O&&Q&&J&&W)try{let b=(0,C.doc)(H,"leaseAgreements",O.id);if("Paid"===W.status){let c=new Date;c.setDate(c.getDate()+3),await (0,E.updateDocumentNonBlocking)(b,{status:"terminating",terminationGracePeriodEnd:c.toISOString(),calculatedRefund:W.calculatedRefund}),await a.A(78121).then(({sendNotification:a})=>{a({toUserId:J.id,type:"TENANCY_TERMINATING",firestore:H,propertyName:Q.title,link:`/student/tenancy/${Q.id}`,customMessage:`Landlord has requested to end the tenancy. A refund of ${(0,v.formatPrice)(W.calculatedRefund,Q.currency)} has been calculated. Please confirm receipt of compensation within 3 days.`})}),V({title:"Termination Initiated",description:`The tenant has been notified. A 3-day grace period has started for the refund of ${(0,v.formatPrice)(W.calculatedRefund,Q.currency)}.`})}else await (0,E.updateDocumentNonBlocking)(b,{status:"terminating",terminationGracePeriodEnd:new Date().toISOString(),calculatedRefund:0}),await a.A(78121).then(({sendNotification:a})=>{a({toUserId:J.id,type:"TENANCY_TERMINATING",firestore:H,propertyName:Q.title,link:`/student/tenancy/${Q.id}`,customMessage:"Landlord has ended the tenancy due to overdue rent. Please vacate the property."})}),V({title:"Termination Initiated",description:"The tenant has been notified. Tenancy will be finalized once tenant confirms."})}catch(a){console.error("Error ending tenancy:",a),V({variant:"destructive",title:"Error",description:"Could not end tenancy. Please try again."})}};return((0,y.useEffect)(()=>{if(!O||!Q||!T){N||R||X({status:"Inactive",text:"No active lease",isLeaseActive:!1,isLeaseEndingSoon:!1,leaseEndDate:null,leaseDaysRemaining:0,calculatedRefund:0});return}let a=new Date,b=new Date(O.startDate),c=new Date(O.endDate),d=T.filter(a=>"Rent"===a.type&&"Completed"===a.status).sort((a,b)=>new Date(b.date).getTime()-new Date(a.date).getTime())[0],e="active"===O.status||"terminating"===O.status,f=b,g="Inactive",h="Lease Inactive";if(e){if(d){let a=d.months||1;f=(0,u.addMonths)(new Date(d.date),a)}else f=b;(0,t.isPast)(f)?(g="Due",h=`Due on ${(0,o.format)(f,"MMM do, yyyy")}`):(g="Paid",h=`Next due on ${(0,o.format)(f,"MMM do, yyyy")}`)}let i=r(c,a),j=e&&i<=90,k=0;if("Paid"===g&&e){let b=Q.price/30,c=r(f,a);c>0&&(k=Math.floor(c/30)*Q.price+c%30*b)}X({status:g,text:h,isLeaseActive:e,isLeaseEndingSoon:j,leaseEndDate:c,leaseDaysRemaining:i,calculatedRefund:k})},[O,Q,T,N,R]),G||K||N||R||U||!W)?(0,b.jsx)(F.default,{}):K||J?(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{className:"font-headline text-3xl font-bold",children:"Tenant Details"})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[(0,b.jsxs)(e.Avatar,{className:"h-24 w-24",children:[(0,b.jsx)(e.AvatarImage,{src:J?.profileImageUrl,alt:J?.name}),(0,b.jsx)(e.AvatarFallback,{children:(0,b.jsx)(m.User,{className:"h-12 w-12 text-muted-foreground"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold",children:J?.name}),(0,b.jsx)("p",{className:"text-muted-foreground",children:J?.role})]})]}),(0,b.jsx)(g.Separator,{className:"my-6"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(i.Mail,{className:"h-5 w-5 text-muted-foreground"}),(0,b.jsx)("a",{href:`mailto:${J?.email}`,className:"text-primary hover:underline",children:J?.email})]}),J?.phone&&(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(h.Phone,{className:"h-5 w-5 text-muted-foreground"}),(0,b.jsx)("span",{children:J?.phone})]})]})]})]}),Q&&W?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Tenancy Overview"})}),(0,b.jsx)(d.CardContent,{className:"space-y-6",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"rounded-lg border bg-secondary/50 p-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Rented Property"}),(0,b.jsx)(n.default,{href:`/landlord/properties/${Q.id}`,className:"text-lg font-bold text-primary hover:underline",children:Q.title})]}),(0,b.jsxs)("div",{className:"rounded-lg border bg-secondary/50 p-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Rent Status"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(x.Badge,{variant:"Due"===W.status?"destructive":"Paid"===W.status?"secondary":"outline",children:W.status}),(0,b.jsx)("p",{className:"text-sm",children:W.text})]})]}),(0,b.jsx)("div",{className:(0,v.cn)("rounded-lg border p-4 col-span-full",W.isLeaseEndingSoon?"border-amber-500/50 bg-amber-50":"bg-secondary/50"),children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Lease End Date"}),(0,b.jsx)("p",{className:(0,v.cn)("text-xl font-bold",W.isLeaseEndingSoon&&"text-amber-600"),children:W.leaseEndDate&&(0,o.format)(W.leaseEndDate,"MMMM do, yyyy")}),W.isLeaseEndingSoon&&(0,b.jsxs)("p",{className:"text-xs text-amber-500 mt-1",children:[W.leaseDaysRemaining," days remaining"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[W.isLeaseEndingSoon&&(0,b.jsx)(j.AlertTriangle,{className:"h-5 w-5 text-amber-500"}),(0,b.jsxs)(f.Button,{variant:"outline",disabled:!0,children:[(0,b.jsx)(l.Pencil,{className:"mr-2 h-4 w-4"})," Edit Lease"]})]})]})})]})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Landlord Actions"})}),(0,b.jsxs)(d.CardContent,{className:"flex flex-col gap-2 sm:flex-row",children:[(0,b.jsx)(f.Button,{variant:"outline",asChild:!0,children:(0,b.jsxs)(n.default,{href:`/landlord/messages?conversationId=${J?.id}`,children:[(0,b.jsx)(i.Mail,{className:"mr-2 h-4 w-4"})," Message Tenant"]})}),(0,b.jsxs)(w.AlertDialog,{children:[(0,b.jsx)(w.AlertDialogTrigger,{asChild:!0,children:(0,b.jsx)(f.Button,{variant:"destructive",disabled:!W.isLeaseActive||O?.status==="terminating",children:O?.status==="terminating"?"Termination Pending":"End Tenancy"})}),(0,b.jsxs)(w.AlertDialogContent,{children:[(0,b.jsxs)(w.AlertDialogHeader,{children:[(0,b.jsxs)(w.AlertDialogTitle,{children:["End Tenancy for ",J?.name,"?"]}),(0,b.jsx)(w.AlertDialogDescription,{children:"Ending the tenancy will terminate the lease before its official end date. This action can have legal implications. You will be charged a compassion fee calculated based on the remaining lease term."})]}),(0,b.jsxs)(d.Card,{className:"my-4",children:[(0,b.jsxs)(d.CardHeader,{className:"flex-row items-center justify-between",children:[(0,b.jsx)(d.CardTitle,{children:"Compassion Fee"}),(0,b.jsx)(k,{className:"h-6 w-6 text-muted-foreground"})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("p",{className:"text-3xl font-bold text-destructive",children:(0,v.formatPrice)(W.calculatedRefund,Q.currency)}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Pro-rated based on days remaining in current paid period + any prepaid full months."})]})]}),(0,b.jsxs)(w.AlertDialogFooter,{children:[(0,b.jsx)(w.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(w.AlertDialogAction,{onClick:Y,className:"bg-destructive hover:bg-destructive/90",children:"Confirm & End Tenancy"})]})]})]})]})]})]}):(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"No Active Tenancy"}),(0,b.jsx)(d.CardDescription,{children:"This user is not currently renting any of your properties."})]})})]}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center text-center py-20",children:[(0,b.jsx)("div",{className:"rounded-full bg-secondary p-4",children:(0,b.jsx)(m.User,{className:"h-10 w-10 text-muted-foreground"})}),(0,b.jsx)("h1",{className:"mt-6 text-2xl font-bold",children:"Tenant Not Found"}),(0,b.jsx)("p",{className:"mt-2 text-muted-foreground",children:"The user you are looking for does not exist or their profile could not be loaded."}),(0,b.jsx)(f.Button,{asChild:!0,className:"mt-6",children:(0,b.jsx)(n.default,{href:"/landlord/tenants",children:"Back to All Tenants"})})]})}a.s(["default",()=>G],23010)}];

//# sourceMappingURL=src_app_landlord_tenants_%5Bid%5D_page_tsx_256f3549._.js.map