{"version":3,"sources":["../../../src/firebase/admin.ts"],"sourcesContent":["import * as admin from 'firebase-admin';\r\n\r\n// Refined Private Key Parsing\r\nfunction formatPrivateKey(key: string | undefined) {\r\n    if (!key) return undefined;\r\n    return key.replace(/\\\\n/g, '\\n').replace(/\"/g, '');\r\n}\r\n\r\n// Lazy Initialization - only runs when actually needed\r\nlet initialized = false;\r\n\r\nfunction initializeAdmin() {\r\n    if (initialized || admin.apps.length > 0) return;\r\n\r\n    try {\r\n        const privateKey = formatPrivateKey(process.env.FIREBASE_PRIVATE_KEY);\r\n        const projectId = process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID || 'studio-2267792175-c3d0d';\r\n        const clientEmail = process.env.FIREBASE_CLIENT_EMAIL;\r\n\r\n        if (privateKey && clientEmail) {\r\n            admin.initializeApp({\r\n                credential: admin.credential.cert({\r\n                    projectId,\r\n                    clientEmail,\r\n                    privateKey,\r\n                }),\r\n            });\r\n            initialized = true;\r\n        } else {\r\n            if (process.env.NODE_ENV !== 'production') {\r\n                console.warn(\"Firebase Admin: Missing credentials. Skipping initialization.\");\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.error('Firebase admin initialization error:', error);\r\n    }\r\n}\r\n\r\n// Getter functions instead of direct exports to prevent build-time execution\r\nexport function getAdminDb() {\r\n    initializeAdmin();\r\n    return admin.firestore();\r\n}\r\n\r\nexport function getAdminAuth() {\r\n    initializeAdmin();\r\n    return admin.auth();\r\n}\r\n\r\n// For backward compatibility, export as db and auth but wrapped\r\nexport const db = new Proxy({} as admin.firestore.Firestore, {\r\n    get: (_target, prop) => {\r\n        const firestore = getAdminDb();\r\n        // @ts-ignore\r\n        const value = firestore[prop];\r\n        return typeof value === 'function' ? value.bind(firestore) : value;\r\n    }\r\n});\r\n\r\nexport const auth = new Proxy({} as admin.auth.Auth, {\r\n    get: (_target, prop) => {\r\n        const authInstance = getAdminAuth();\r\n        // @ts-ignore\r\n        const value = authInstance[prop];\r\n        return typeof value === 'function' ? value.bind(authInstance) : value;\r\n    }\r\n});\r\n"],"names":[],"mappings":"u+BAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OASA,IAAI,GAAc,EAElB,SAAS,IACL,IAAI,KAAe,EAAA,IAAU,CAAC,MAAM,EAAG,EAEvC,CAF0C,EAEtC,CACA,IAAM,EAAa,AAZ3B,SAAS,AAAiB,CAAuB,EAC7C,GAAK,CAAD,CACJ,GADU,IACH,EAAI,CADM,MACC,CAAC,OAAQ,MAAM,OAAO,CAAC,KAAM,GACnD,EAS4C,QAAQ,GAAG,CAAC,oBAAoB,EAE9D,EAAc,QAAQ,GAAG,CAAC,qBAAqB,CAEjD,GAAc,IACd,EAAA,OAD2B,MACR,CAAC,CAChB,WAAY,EAAA,UAAgB,CAAC,IAAI,CAAC,CAC9B,UANM,0BAON,IAPqD,qBAQrD,CACJ,EACJ,GACA,GAAc,EAMtB,CAAE,MAAO,EAAO,CACZ,QAAQ,KAAK,CAAC,uCAAwC,EAC1D,CACJ,CAGO,SAAS,IAEZ,OADA,IACO,EAAA,SAAe,EAC1B,CAQO,IAAM,EAAK,IAAI,MAAM,CAAC,EAAgC,CACzD,IAAK,CAAC,EAAS,KACX,IAAM,EAAY,IAEZ,EAAQ,CAAS,CAAC,EAAK,CAC7B,MAAO,AAAiB,mBAAV,EAAuB,EAAM,IAAI,CAAC,GAAa,CACjE,CACJ,GAEoB,IAAI,MAAM,CAAC,EAAsB,CACjD,IAAK,CAAC,EAAS,KACX,IAAM,GAhBV,IACO,EAAA,IAAU,EAeQ,EAEf,EAAQ,CAAY,CAAC,EAAK,CAChC,MAAwB,YAAjB,OAAO,EAAuB,EAAM,IAAI,CAAC,GAAgB,CACpE,CACJ"}