{"version":3,"sources":["../../../src/firebase/config.ts","../../../src/firebase/server.ts"],"sourcesContent":["export const firebaseConfig = {\r\n  \"projectId\": \"studio-2267792175-c3d0d\",\r\n  \"appId\": \"1:300603419642:web:45d0d0f2168c0180e41243\",\r\n  \"storageBucket\": \"studio-2267792175-c3d0d.firebasestorage.app\",\r\n  \"apiKey\": \"AIzaSyCO-2ySCn-hSI606tvGfXrF8Jhxxcv5glk\",\r\n  \"authDomain\": \"studio-2267792175-c3d0d.firebaseapp.com\",\r\n  \"measurementId\": \"\",\r\n  \"messagingSenderId\": \"300603419642\"\r\n};\r\n\r\n\r\n","\r\n// IMPORTANT: This file is only used on the server and should not be included in the client-side bundle.\r\n\r\nimport { initializeApp, getApps, getApp, cert, App } from 'firebase-admin/app';\r\nimport { getFirestore, Firestore } from 'firebase-admin/firestore';\r\nimport { getAuth, Auth } from 'firebase-admin/auth';\r\nimport { firebaseConfig } from './config';\r\n\r\nlet adminApp: App | undefined;\r\nlet firestoreInstance: Firestore | undefined;\r\nlet authInstance: Auth | undefined;\r\n\r\n// The service account key is retrieved from environment variables.\r\n// This is a secure way to handle credentials on the server.\r\ntry {\r\n  if (!getApps().length) {\r\n    const serviceAccountVar = process.env.FIREBASE_SERVICE_ACCOUNT;\r\n    let serviceAccount = serviceAccountVar ? JSON.parse(serviceAccountVar) : undefined;\r\n\r\n    // Fallback to individual variables (useful for Firebase App Hosting secrets)\r\n    if (!serviceAccount && process.env.FIREBASE_PRIVATE_KEY && process.env.FIREBASE_CLIENT_EMAIL) {\r\n      // Clean the private key: handle escaped newlines and ensure it's not wrapped in literal quotes\r\n      let privateKey = process.env.FIREBASE_PRIVATE_KEY;\r\n\r\n      // Remove literal quotes if present\r\n      if (privateKey.startsWith('\"') && privateKey.endsWith('\"')) {\r\n        privateKey = privateKey.substring(1, privateKey.length - 1);\r\n      }\r\n\r\n      // Convert escaped \\n back to real newlines\r\n      privateKey = privateKey.replace(/\\\\n/g, '\\n');\r\n\r\n      serviceAccount = {\r\n        projectId: firebaseConfig.projectId,\r\n        clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\r\n        privateKey: privateKey,\r\n      };\r\n    }\r\n\r\n    if (serviceAccount) {\r\n      try {\r\n        adminApp = initializeApp({\r\n          credential: cert(serviceAccount),\r\n          databaseURL: `https://${firebaseConfig.projectId}.firebaseio.com`,\r\n        });\r\n        firestoreInstance = getFirestore(adminApp);\r\n        authInstance = getAuth(adminApp);\r\n      } catch (initError: any) {\r\n        console.error(\"Firebase Admin SDK initialization failed with valid looking credentials:\", initError.message);\r\n        // Fallback to undefined if cert parsing failed\r\n        adminApp = undefined;\r\n      }\r\n    } else {\r\n      console.warn(\"Firebase Admin SDK not initialized. Missing credentials or invalid format.\");\r\n    }\r\n  } else {\r\n    adminApp = getApp();\r\n    firestoreInstance = getFirestore(adminApp);\r\n    authInstance = getAuth(adminApp);\r\n  }\r\n} catch (error) {\r\n  console.error(\"Failed to parse FIREBASE_SERVICE_ACCOUNT or initialize Firebase Admin SDK.\", error);\r\n}\r\n\r\n// Export the instances directly. They will be undefined if initialization failed.\r\n// Code that uses these exports on the server MUST handle the undefined case.\r\nexport const firestore: Firestore | undefined = firestoreInstance;\r\nexport const auth: Auth | undefined = authInstance;\r\n\r\n\r\n"],"names":[],"mappings":"k+CAA8B,CAC5B,UAAa,0BACb,MAAS,4CACT,cAAiB,8CACjB,OAAU,0CACV,WAAc,0CACd,cAAiB,GACjB,kBAAqB,cACvB,uCCAI,EACA,EACA,EAPJ,IAAA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,gDAQA,GAAI,CACF,GAAK,CAAD,AAAC,EAAA,EAAA,OAAA,AAAO,IAAG,MAAM,CAyCnB,EAAW,CAAA,EAAA,EAAA,MAAA,AAAM,IACjB,EAAoB,CAAA,EAAA,EAAA,YAAA,AAAY,EAAC,GACjC,EAAe,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,OA3CF,CACrB,IAAM,EAAoB,QAAQ,GAAG,CAAC,wBAAwB,CAC1D,EAAiB,EAAoB,KAAK,KAAK,CAAC,QAAqB,EAGzE,GAAI,CAAC,GAAkB,QAAQ,GAAG,CAAC,oBAAoB,EAAI,QAAQ,GAAG,CAAC,qBAAqB,CAAE,CAE5F,IAAI,EAAa,QAAQ,GAAG,CAAC,oBAAoB,CAG7C,EAAW,UAAU,CAAC,MAAQ,EAAW,QAAQ,CAAC,MAAM,CAC1D,EAAa,EAAW,SAAS,CAAC,EAAG,EAAW,MAAM,CAAG,EAAA,EAI3D,EAAa,EAAW,OAAO,CAAC,OAAQ,MAExC,EAAiB,CACf,UAAW,EAAA,cAAc,CAAC,SAAS,CACnC,YAAa,QAAQ,GAAG,CAAC,qBAAqB,CAC9C,WAAY,CACd,CACF,CAEA,GAAI,EACF,GAAI,CACF,EAAW,CAAA,EAAA,EAAA,GAFK,UAEL,AAAa,EAAC,CACvB,WAAY,CAAA,EAAA,EAAA,IAAA,AAAI,EAAC,GACjB,YAAa,CAAC,QAAQ,EAAE,EAAA,cAAc,CAAC,SAAS,CAAC,eAAe,CAAC,AACnE,GACA,EAAoB,CAAA,EAAA,EAAA,YAAA,AAAY,EAAC,GACjC,EAAe,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,EACzB,CAAE,MAAO,EAAgB,CACvB,QAAQ,KAAK,CAAC,2EAA4E,EAAU,OAAO,EAE3G,OAAW,CACb,MAEA,QAAQ,IAAI,CAAC,6EAEjB,CAKF,CAAE,KALO,CAKA,EAAO,CACd,QAAQ,KAAK,CAAC,6EAA8E,EAC9F,CAIO,IAAM,EAAmC,EACnC,EAAyB"}