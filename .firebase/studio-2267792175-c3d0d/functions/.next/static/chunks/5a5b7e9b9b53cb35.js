(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67034,(e,t,n)=>{var r={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return(n+r)*3/4-r},t.toByteArray=function(e){var t,n,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(n=0;n<c;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[h++]=255&t),1===o&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],a=0,o=r-i;a<o;a+=16383)s.push(function(e,t,r){for(var i,s=[],a=t;a<r;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[i>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&s.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)n[a]=s[a],r[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}r[45]=62,r[95]=63},72:function(e,t,n){"use strict";var r=n(675),i=n(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(r,i),l=a(s),u=l.write(r,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(D(e,ArrayBuffer)||e&&D(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(D(e,SharedArrayBuffer)||e&&D(e.buffer,SharedArrayBuffer)))return function(e,t,n){var r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),o.prototype),r}(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,n);var g=function(e){if(o.isBuffer(e)){var t=0|d(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(g)return g;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),n=a(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,n){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return A(e).length;default:if(i)return r?-1:S(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,n){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=N[e[s]];return i}(this,t,n);case"utf8":case"utf-8":return v(this,t,n);case"ascii":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":return i=this,s=t,a=n,0===s&&a===i.length?r.fromByteArray(i):r.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}(this,t,n);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function p(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){var s;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(i)return -1;else n=e.length-1;else if(n<0)if(!i)return -1;else n=0;if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return y(e,[t],n,r,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var s,a=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=n;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),D(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:+(r<n)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,r=o.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(D(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?v(this,0,e):g.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,n,r,i){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var s=i-r,a=n-t,l=Math.min(s,a),u=this.slice(r,i),h=e.slice(t,n),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)};function v(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=n)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=c}var d=r,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var g="",p=0;p<f;)g+=String.fromCharCode.apply(String,d.slice(p,p+=4096));return g}function w(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function b(e,t,n,r,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function E(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function _(e,t,n,r,s){return t*=1,n>>>=0,s||E(e,t,n,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,n,r,23,4),n+4}function T(e,t,n,r,s){return t*=1,n>>>=0,s||E(e,t,n,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,n,r,52,8),n+8}o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var f=!1;;)switch(r){case"hex":return function(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;r>s/2&&(r=s/2);for(var a=0;a<r;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[n+a]=l}return a}(this,e,t,n);case"utf8":case"utf-8":return i=t,s=n,C(S(e,this.length-i),this,i,s);case"ascii":return a=t,o=n,C(x(e),this,a,o);case"latin1":case"binary":return function(e,t,n,r){return C(x(t),e,n,r)}(this,e,t,n);case"base64":return l=t,u=n,C(A(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=n,C(function(e,t){for(var n,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,o.prototype),r},o.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},o.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||w(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},o.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;b(this,e,t,n,i,0)}var s=1,a=0;for(this[t]=255&e;++a<n&&(s*=256);)this[t+a]=e/s&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;b(this,e,t,n,i,0)}var s=n-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);b(this,e,t,n,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<n&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);b(this,e,t,n,i-1,-i)}var s=n-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,n){return _(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return _(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return T(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return T(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var s=i-1;s>=0;--s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===r&&s<128||"latin1"===r)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,r),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%l]}return this};var I=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var n,r=e.length,i=null,s=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319||a+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function x(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function A(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(I,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function C(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function D(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var N=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}()},783:function(e,t){t.read=function(e,t,n,r,i){var s,a,o=8*i-r-1,l=(1<<o)-1,u=l>>1,h=-7,c=n?i-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=r;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),s-=u}return(f?-1:1)*a*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=r?0:s-1,g=r?1:-1,p=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&o,f+=g,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[n+f]=255&a,f+=g,a/=256,u-=8);e[n+f-g]|=128*p}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}},a=!0;try{r[e](n,n.exports,s),a=!1}finally{a&&delete i[e]}return n.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},36180,17875,e=>{"use strict";var t,n,r,i,s,a,o,l,u,h,c,d,f,g,p=e.i(47167),m=e.i(67034),y=e.i(85086);let v=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},w=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},b={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),r.push(n[u],n[h],n[c],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(v(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):w(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new E;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class E extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let _=function(e){let t=v(e);return b.encodeByteArray(t,!0)},T=function(e){return _(e).replace(/\./g,"")},I=function(e){try{return b.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function S(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g}let x=()=>{try{return S().__FIREBASE_DEFAULTS__||(()=>{if(void 0===p.default||void 0===p.default.env)return;let e=p.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&I(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}};function A(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(e){return!1}}async function C(e){return(await fetch(e,{credentials:"include"})).ok}let D={},N=!1;function k(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function R(){var t;let n=null==(t=x())?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function O(){return!R()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function M(){return!R()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}class L extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,L.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,P.prototype.create)}}class P{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(n=a,r=i,n.replace(F,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new L(s,l,i)}}let F=/\{\$([^}]+)}/g;function V(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(B(n)&&B(s)){if(!V(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function B(e){return null!==e&&"object"==typeof e}function U(e){return e&&e._delegate?e._delegate:e}class q{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}var j=e.i(68483),z="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,$={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}var r=function(){this.blockSize=-1};function i(){}function s(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+0xd76aa478|0;a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[1]+0xe8c7b756|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[2]+0x242070db|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[3]+0xc1bdceee|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[4]+0xf57c0faf|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[5]+0x4787c62a|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[6]+0xa8304613|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[7]+0xfd469501|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[8]+0x698098d8|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[9]+0x8b44f7af|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[10]+0xffff5bb1|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[11]+0x895cd7be|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[12]+0x6b901122|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[13]+0xfd987193|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[14]+0xa679438e|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(a<<22|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,a=t+((n=i+(a<<20|a>>>12))^i^s)+r[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[11]+0x6d9d6122|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[14]+0xfde5380c|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[7]+0xf6bb4b60|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[10]+0xbebfbc70|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[3]+0xd4ef3085|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[6]+0x4881d05|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[15]+0x1fa27cf8|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(a<<23|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function a(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}i.prototype=r.prototype,e.D=r.prototype,e.prototype=new i,e.prototype.constructor=e,e.C=function(e,t,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return r.prototype[t].apply(e,i)},e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.B,i=this.h,a=0;a<t;){if(0==i)for(;a<=n;)s(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(r[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,r),i=0;break}}else for(;a<t;)if(r[i++]=e[a++],i==this.blockSize){s(this,r),i=0;break}}this.h=i,this.o+=t},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var o,l={};function u(e){var t;return -128<=e&&128>e?(t=function(e){return new a([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new a([0|e],0>e?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return m(h(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new a(t,0)}var c=u(0),d=u(1),f=u(0x1000000);function g(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function p(e){return -1==e.h}function m(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new a(n,~e.h).add(d)}function y(e,t){return e.add(m(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function w(e,t){this.g=e,this.h=t}function b(e,t){if(g(t))throw Error("division by zero");if(g(e))return new w(c,c);if(p(e))return t=b(m(e),t),new w(m(t.g),m(t.h));if(p(t))return t=b(e,m(t)),new w(m(t.g),t.h);if(30<e.g.length){if(p(e)||p(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=E(n),r=E(r);var i=_(n,1),s=_(r,1);for(r=_(r,2),n=_(n,2);!g(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=_(r,1),n=_(n,1)}return t=y(e,i.j(t)),new w(i,t)}for(i=c;0<=e.l(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=h(n)).j(t);p(a)||0<a.l(e);)n-=r,a=(s=h(n)).j(t);g(s)&&(s=d),i=i.add(s),e=y(e,a)}return new w(i,e)}function E(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new a(n,e.h)}function _(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new a(i,e.h)}(o=a.prototype).m=function(){if(p(this))return-m(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:0x100000000+r)*t,t*=0x100000000}return e},o.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(g(this))return"0";if(p(this))return"-"+m(this).toString(e);for(var t=h(Math.pow(e,6)),n=this,r="";;){var i=b(n,t).g,s=((0<(n=y(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(g(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},o.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},o.l=function(e){return p(e=y(this,e))?-1:+!g(e)},o.abs=function(){return p(this)?m(this):this},o.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.i(i))+(65535&e.i(i)),o=(s>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new a(n,-0x80000000&n[n.length-1]?-1:0)},o.j=function(e){if(g(this)||g(e))return c;if(p(this))return p(e)?m(this).j(m(e)):m(m(this).j(e));if(p(e))return m(this.j(m(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.i(r)>>>16,o=65535&this.i(r),l=e.i(i)>>>16,u=65535&e.i(i);n[2*r+2*i]+=o*u,v(n,2*r+2*i),n[2*r+2*i+1]+=s*u,v(n,2*r+2*i+1),n[2*r+2*i+1]+=o*l,v(n,2*r+2*i+1),n[2*r+2*i+2]+=s*l,v(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new a(n,0)},o.A=function(e){return b(this,e).h},o.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new a(n,this.h&e.h)},o.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new a(n,this.h|e.h)},o.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new a(n,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,n=$.Md5=e,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return m(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=h(Math.pow(n,8)),i=c,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=h(Math.pow(n,a)),i=i.j(a).add(h(o))):i=(i=i.j(r)).add(h(o))}return i},t=$.Integer=a}).apply(void 0!==z?z:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var K="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,G={};(function(){var e,t,n,c="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},d=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof K&&K];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=d;e=e.split(".");for(var r=0;r<e.length-1;r++){var i=e[r];if(!(i in n))break e;n=n[i]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&c(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,n,r,i;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),n=0,r=!1,(i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return i},i}});var f=f||{},g=this||self;function p(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function y(e,t,n){return e.call.apply(e.bind,arguments)}function v(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function w(e,t,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function E(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function _(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function T(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(p(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function I(e){return/^[\s\xa0]*$/.test(e)}function S(){var e=g.navigator;return e&&(e=e.userAgent)?e:""}function x(e){return x[" "](e),e}x[" "]=function(){};var A=-1!=S().indexOf("Gecko")&&(-1==S().toLowerCase().indexOf("webkit")||-1!=S().indexOf("Edge"))&&-1==S().indexOf("Trident")&&-1==S().indexOf("MSIE")&&-1==S().indexOf("Edge");function C(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function D(e){let t={};for(let n in e)t[n]=e[n];return t}let N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<N.length;t++)n=N[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}var R=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new O,e=>e.reset());class O{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let M,L=!1,P=new class{constructor(){this.h=this.g=null}add(e,t){let n=R.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},F=()=>{let e=g.Promise.resolve(void 0);M=()=>{e.then(V)}};var V=()=>{let e;for(var t;e=null,P.g&&(e=P.g,P.g=P.g.next,P.g||(P.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){g.setTimeout(()=>{throw e},0)}(e)}R.j(t),100>R.h&&(R.h++,t.next=R.g,R.g=t)}L=!1};function B(){this.s=this.s,this.C=this.C}function U(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}B.prototype.s=!1,B.prototype.ma=function(){this.s||(this.s=!0,this.N())},B.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},U.prototype.h=function(){this.defaultPrevented=!0};var q=function(){if(!g.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};g.addEventListener("test",e,t),g.removeEventListener("test",e,t)}catch(e){}return e}();function j(e,t){if(U.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(A){e:{try{x(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:z[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&j.aa.h.call(this)}}E(j,U);var z={2:"touch",3:"pen",4:"mouse"};j.prototype.h=function(){j.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var $="closure_listenable_"+(1e6*Math.random()|0),Q=0;function W(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++Q,this.da=this.fa=!1}function H(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function X(e){this.src=e,this.g={},this.h=0}function J(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(H(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Y(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}X.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=Y(e,t,r,i);return -1<a?(t=e[a],n||(t.fa=!1)):((t=new W(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var Z="closure_lm_"+(1e6*Math.random()|0),ee={};function et(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=m(i)?!!i.capture:!!i,o=es(e);if(o||(e[Z]=o=new X(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return ei.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)q||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(er(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function en(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[$])J(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(er(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=es(t))?(J(n,e),0==n.h&&(n.src=null,t[Z]=null)):H(e)}}}function er(e){return e in ee?ee[e]:ee[e]="on"+e}function ei(e,t){if(e.da)e=!0;else{t=new j(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&en(e),e=n.call(r,t)}return e}function es(e){return(e=e[Z])instanceof X?e:null}var ea="__closure_events_fn_"+(1e9*Math.random()>>>0);function eo(e){return"function"==typeof e?e:(e[ea]||(e[ea]=function(t){return e.handleEvent(t)}),e[ea])}function el(){B.call(this),this.i=new X(this),this.M=this,this.F=null}function eu(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new U(t,e);else if(t instanceof U)t.target=t.target||e;else{var i=t;k(t=new U(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=eh(a,r,!0,t)&&i}if(i=eh(a=t.g=e,r,!0,t)&&i,i=eh(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=eh(a=t.g=n[s],r,!1,t)&&i}function eh(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.fa&&J(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}function ec(e,t,n){if("function"==typeof e)n&&(e=w(e,n));else if(e&&"function"==typeof e.handleEvent)e=w(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:g.setTimeout(e,t||0)}E(el,B),el.prototype[$]=!0,el.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=m(i)?!!i.capture:!!i,r=eo(r),t&&t[$])?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=Y(a=t.g[n],r,i,s))&&(H(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=es(t))&&(n=t.g[n.toString()],t=-1,n&&(t=Y(n,r,i,s)),(r=-1<t?n[t]:null)&&en(r))}(this,e,t,n,r)},el.prototype.N=function(){if(el.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)H(n[r]);delete t.g[e],t.h--}}this.F=null},el.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},el.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ed extends B{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ec(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(g.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ef(e){B.call(this),this.h=e,this.g={}}E(ef,B);var eg=[];function ep(e){C(e.g,function(e,t){this.g.hasOwnProperty(t)&&en(e)},e),e.g={}}ef.prototype.N=function(){ef.aa.N.call(this),ep(this)},ef.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var em=g.JSON.stringify,ey=g.JSON.parse,ev=class{stringify(e){return g.JSON.stringify(e,void 0)}parse(e){return g.JSON.parse(e,void 0)}};function ew(){}function eb(e){return e.h||(e.h=e.i())}function eE(){}ew.prototype.h=null;var e_={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eT(){U.call(this,"d")}function eI(){U.call(this,"c")}E(eT,U),E(eI,U);var eS={},ex=null;function eA(){return ex=ex||new el}function eC(e){U.call(this,eS.La,e)}function eD(e){let t=eA();eu(t,new eC(t))}function eN(e,t){U.call(this,eS.STAT_EVENT,e),this.stat=t}function ek(e){let t=eA();eu(t,new eN(t,e))}function eR(e,t){U.call(this,eS.Ma,e),this.size=t}function eO(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return g.setTimeout(function(){e()},t)}function eM(){this.g=!0}function eL(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return em(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eS.La="serverreachability",E(eC,U),eS.STAT_EVENT="statevent",E(eN,U),eS.Ma="timingevent",E(eR,U),eM.prototype.xa=function(){this.g=!1},eM.prototype.info=function(){};var eP={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eF={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eV(){}function eB(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ef(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eU}function eU(){this.i=null,this.g="",this.h=!1}E(eV,ew),eV.prototype.g=function(){return new XMLHttpRequest},eV.prototype.i=function(){return{}},t=new eV;var eq={},ej={};function ez(e,t,n){e.L=1,e.v=ti(e9(t)),e.m=n,e.P=!0,e$(e,null)}function e$(e,t){e.F=Date.now(),eG(e),e.A=e9(e.v);var n,r,i,s,a,o,l=e.A,u=e.R;Array.isArray(u)||(u=[String(u)]),ty(l.i,"t",u),e.C=0,l=e.j.J,e.h=new eU,e.g=t6(e.j,l?t:null,!e.m),0<e.O&&(e.M=new ed(w(e.Y,e,e.g),e.O)),t=e.U,l=e.g,u=e.ca;var h="readystatechange";Array.isArray(h)||(h&&(eg[0]=h.toString()),h=eg);for(var c=0;c<h.length;c++){var d=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=eo(r),t&&t[$]?t.L(n,r,m(i)?!!i.capture:!!i,s):et(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=eo(r),t&&t[$]?t.K(n,r,m(i)?!!i.capture:!!i,s):et(t,n,r,!1,i,s)}(l,h[c],u||t.handleEvent,!1,t.h||t);if(!d)break;t.g[d.key]=d}t=e.H?D(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),eD(),n=e.i,r=e.u,i=e.A,s=e.l,a=e.R,o=e.m,n.info(function(){if(n.g)if(o)for(var e="",t=o.split("&"),l=0;l<t.length;l++){var u=t[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");e=2<=c.length&&"type"==c[1]?e+(h+"=")+u+"&":e+(h+"=redacted&")}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function eK(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function eG(e){e.S=Date.now()+e.I,eQ(e,e.I)}function eQ(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eO(w(e.ba,e),t)}function eW(e){e.B&&(g.clearTimeout(e.B),e.B=null)}function eH(e){0==e.j.G||e.J||tY(e.j,e)}function eX(e){eW(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ep(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eJ(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||e2(n.h,e))){if(!e.K&&e2(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)tJ(n),tq(n);else break e;tW(n),ek(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=eO(w(n.Za,n),6e3));if(1>=e1(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else t0(n,11)}else if((e.K||n.g==e)&&tJ(n),!I(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(n.T=o[0],o=o[1],2==n.G)if("c"==o[0]){n.K=o[1],n.ia=o[2];let t=o[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));let i=o[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(n.L=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(e6(s,s.h),s.h=null))}if(r.D){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,tr(r.I,r.D,e))}}if(n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms")),(r=n).qa=t2(r,r.J?r.ia:null,r.W),e.K){e3(r.h,e);var a=r.L;a&&(e.I=a),e.B&&(eW(e),eG(e)),r.g=e}else tQ(r);0<n.i.length&&tz(n)}else"stop"!=o[0]&&"close"!=o[0]||t0(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?t0(n,7):tU(n):"noop"!=o[0]&&n.l&&n.l.ta(o),n.v=0)}}eD(4)}catch(e){}}eB.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tP(e)?t.j():this.Y(e)},eB.prototype.Y=function(e){try{if(e==this.g)e:{let v=tP(this.g);var t=this.g.Ba();let w=this.g.Z();if(!(3>v)&&(3!=v||this.g&&(this.h.h||this.g.oa()||tF(this.g)))){this.J||4!=v||7==t||(8==t||0>=w?eD(3):eD(2)),eW(this);var n=this.g.Z();this.X=n;t:if(eK(this)){var r=tF(this.g);e="";var i=r.length,s=4==tP(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eX(this),eH(this);var a="";break t}this.h.i=new g.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,o=this.i,l=this.u,u=this.A,h=this.l,c=this.R,d=n,o.info(function(){return"XMLHTTP RESP ("+h+") [ attempt "+c+"]: "+l+"\n"+u+"\n"+v+" "+d}),this.o){if(this.T&&!this.K){t:{if(this.g){var o,l,u,h,c,d,f,p=this.g;if((f=p.g?p.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(f)){var m=f;break t}}m=null}if(n=m)eL(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eJ(this,n);else{this.o=!1,this.s=3,ek(12),eX(this),eH(this);break e}}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;)if((e=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?ej:isNaN(n=Number(t.substring(n,r)))?eq:(r+=1)+n>t.length?ej:(t=t.slice(r,r+n),e.C=r+n,t)}(this,a))==ej){4==v&&(this.s=4,ek(14),n=!1),eL(this.i,this.l,null,"[Incomplete Response]");break}else if(e==eq){this.s=4,ek(15),eL(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}else eL(this.i,this.l,e,null),eJ(this,e);if(eK(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=v||0!=a.length||this.h.h||(this.s=1,ek(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var y=this.j;y.g==this&&y.ba&&!y.M&&(y.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),tH(y),y.M=!0,ek(11))}}else eL(this.i,this.l,a,"[Invalid Chunked Response]"),eX(this),eH(this)}else eL(this.i,this.l,a,null),eJ(this,a);4==v&&eX(this),this.o&&!this.J&&(4==v?tY(this.j,this):(this.o=!1,eG(this)))}else(function(e){let t={};e=(e.g&&2<=tP(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(I(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,ek(12)):(this.s=0,ek(13)),eX(this),eH(this)}}}catch(e){}finally{}},eB.prototype.cancel=function(){this.J=!0,eX(this)},eB.prototype.ba=function(){var e,t;this.B=null;let n=Date.now();0<=n-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(eD(),ek(17)),eX(this),this.s=2,eH(this)):eQ(this,this.S-n)};var eY=class{constructor(e,t){this.g=e,this.map=t}};function eZ(e){this.l=e||10,e=g.PerformanceNavigationTiming?0<(e=g.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(g.chrome&&g.chrome.loadTimes&&g.chrome.loadTimes()&&g.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function e0(e){return!!e.h||!!e.g&&e.g.size>=e.j}function e1(e){return e.h?1:e.g?e.g.size:0}function e2(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e6(e,t){e.g?e.g.add(t):e.h=t}function e3(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e5(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return _(e.i)}function e4(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(p(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(p(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(p(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}eZ.prototype.cancel=function(){if(this.i=e5(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e8=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e7(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof e7){this.h=e.h,te(this,e.j),this.o=e.o,this.g=e.g,tt(this,e.s),this.l=e.l;var t=e.i,n=new tf;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tn(this,n),this.m=e.m}else e&&(t=String(e).match(e8))?(this.h=!1,te(this,t[1]||"",!0),this.o=ts(t[2]||""),this.g=ts(t[3]||"",!0),tt(this,t[4]),this.l=ts(t[5]||"",!0),tn(this,t[6]||"",!0),this.m=ts(t[7]||"")):(this.h=!1,this.i=new tf(null,this.h))}function e9(e){return new e7(e)}function te(e,t,n){e.j=n?ts(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tt(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function tn(e,t,n){var r,i;t instanceof tf?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(tg(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tp(this,t),ty(this,n,e))},r)),r.j=i):(n||(t=ta(t,tc)),e.i=new tf(t,e.h))}function tr(e,t,n){e.i.set(t,n)}function ti(e){return tr(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function ts(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ta(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,to),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function to(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e7.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ta(t,tl,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ta(t,tl,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ta(n,"/"==n.charAt(0)?th:tu,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ta(n,td)),e.join("")};var tl=/[#\/\?@]/g,tu=/[#\?:]/g,th=/[#\?]/g,tc=/[#\?@]/g,td=/#/g;function tf(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tg(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tp(e,t){tg(e),t=tv(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tm(e,t){return tg(e),t=tv(e,t),e.g.has(t)}function ty(e,t,n){tp(e,t),0<n.length&&(e.i=null,e.g.set(tv(e,t),_(n)),e.h+=n.length)}function tv(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tw(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tb(){this.g=new ev}function tE(e){this.l=e.Ub||null,this.j=e.eb||!1}function t_(e,t){el.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function tT(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tI(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tS(e)}function tS(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tx(e){let t="";return C(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tA(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tx(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tr(e,t,n))}function tC(e){el.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(n=tf.prototype).add=function(e,t){tg(this),this.i=null,e=tv(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},n.forEach=function(e,t){tg(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},n.na=function(){tg(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},n.V=function(e){tg(this);let t=[];if("string"==typeof e)tm(this,e)&&(t=t.concat(this.g.get(tv(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},n.set=function(e,t){return tg(this),this.i=null,tm(this,e=tv(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},n.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")},E(tE,ew),tE.prototype.g=function(){return new t_(this.l,this.j)},tE.prototype.i=(e={},function(){return e}),E(t_,el),(n=t_.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tS(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||g).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tI(this)),this.readyState=0},n.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tS(this)),this.g&&(this.readyState=3,tS(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==g.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tT(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},n.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tI(this):tS(this),3==this.readyState&&tT(this)}},n.Ra=function(e){this.g&&(this.response=this.responseText=e,tI(this))},n.Qa=function(e){this.g&&(this.response=e,tI(this))},n.ga=function(){this.g&&tI(this)},n.setRequestHeader=function(e,t){this.u.append(e,t)},n.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(t_.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),E(tC,el);var tD=/^https?$/i,tN=["POST","PUT"];function tk(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tR(e),tM(e)}function tR(e){e.A||(e.A=!0,eu(e,"complete"),eu(e,"error"))}function tO(e){if(e.h&&void 0!==f&&(!e.v[1]||4!=tP(e)||2!=e.Z())){if(e.u&&4==tP(e))ec(e.Ea,0,e);else if(eu(e,"readystatechange"),4==tP(e)){e.h=!1;try{let a=e.Z();switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===a){var i=String(e.D).match(e8)[1]||null;!i&&g.self&&g.self.location&&(i=g.self.location.protocol.slice(0,-1)),n=!tD.test(i?i.toLowerCase():"")}t=n}if(t)eu(e,"complete"),eu(e,"success");else{e.m=6;try{var s=2<tP(e)?e.g.statusText:""}catch(e){s=""}e.l=s+" ["+e.Z()+"]",tR(e)}}finally{tM(e)}}}}function tM(e,t){if(e.g){tL(e);let n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||eu(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function tL(e){e.I&&(g.clearTimeout(e.I),e.I=null)}function tP(e){return e.g?e.g.readyState:0}function tF(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tV(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tB(e){this.Aa=0,this.i=[],this.j=new eM,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tV("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tV("baseRetryDelayMs",5e3,e),this.cb=tV("retryDelaySeedMs",1e4,e),this.Wa=tV("forwardChannelMaxRetries",2,e),this.wa=tV("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new eZ(e&&e.concurrentRequestLimit),this.Da=new tb,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tU(e){if(tj(e),3==e.G){var t=e.U++,n=e9(e.I);if(tr(n,"SID",e.K),tr(n,"RID",t),tr(n,"TYPE","terminate"),tK(e,n),(t=new eB(e,e.j,t)).L=2,t.v=ti(e9(n)),n=!1,g.navigator&&g.navigator.sendBeacon)try{n=g.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&g.Image&&((new Image).src=t.v,n=!0),n||(t.g=t6(t.j,null),t.g.ea(t.v)),t.F=Date.now(),eG(t)}t1(e)}function tq(e){e.g&&(tH(e),e.g.cancel(),e.g=null)}function tj(e){tq(e),e.u&&(g.clearTimeout(e.u),e.u=null),tJ(e),e.h.cancel(),e.s&&("number"==typeof e.s&&g.clearTimeout(e.s),e.s=null)}function tz(e){if(!e0(e.h)&&!e.s){e.s=!0;var t=e.Ga;M||F(),L||(M(),L=!0),P.add(t,e),e.B=0}}function t$(e,t){var n;n=t?t.l:e.U++;let r=e9(e.I);tr(r,"SID",e.K),tr(r,"RID",n),tr(r,"AID",e.T),tK(e,r),e.m&&e.o&&tA(r,e.m,e.o),n=new eB(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tG(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e6(e.h,n),ez(n,r,t)}function tK(e,t){e.H&&C(e.H,function(e,n){tr(t,n,e)}),e.l&&e4({},function(e,n){tr(t,n,e)})}function tG(e,t,n){n=Math.min(e.i.length,n);var r=e.l?w(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{!function(e,t,n){let r=n||"";try{e4(e,function(e,n){let i=e;m(e)&&(i=em(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return t.D=e=e.i.splice(0,n),r}function tQ(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;M||F(),L||(M(),L=!0),P.add(t,e),e.v=0}}function tW(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eO(w(e.Fa,e),tZ(e,e.v)),e.v++,!0)}function tH(e){null!=e.A&&(g.clearTimeout(e.A),e.A=null)}function tX(e){e.g=new eB(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=e9(e.qa);tr(t,"RID","rpc"),tr(t,"SID",e.K),tr(t,"AID",e.T),tr(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&tr(t,"TO",e.ja),tr(t,"TYPE","xmlhttp"),tK(e,t),e.m&&e.o&&tA(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ti(e9(t)),n.m=null,n.P=!0,e$(n,e)}function tJ(e){null!=e.C&&(g.clearTimeout(e.C),e.C=null)}function tY(e,t){var n,r=null;if(e.g==t){tJ(e),tH(e),e.g=null;var i=2}else{if(!e2(e.h,t))return;r=t.D,e3(e.h,t),i=1}if(0!=e.G){if(t.o)if(1==i){r=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;eu(i=eA(),new eR(i,r)),tz(e)}else tQ(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==i&&(n=t,!(e1(e.h)>=e.h.j-!!e.s)&&(e.s?(e.i=n.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eO(w(e.Ga,e,n),tZ(e,e.B)),e.B++,!0)))||2==i&&tW(e)))switch(r&&0<r.length&&((t=e.h).i=t.i.concat(r)),s){case 1:t0(e,5);break;case 4:t0(e,10);break;case 3:t0(e,6);break;default:t0(e,2)}}}function tZ(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function t0(e,t){if(e.j.info("Error code "+t),2==t){let t,s,a;var n,r=w(e.fb,e),i=e.Xa;let o=!i;i=new e7(i||"//www.google.com/images/cleardot.gif"),g.location&&"http"==g.location.protocol||te(i,"https"),ti(i),o?function(e,t){let n=new eM;if(g.Image){let r=new Image;r.onload=b(tw,n,"TestLoadImage: loaded",!0,t,r),r.onerror=b(tw,n,"TestLoadImage: error",!1,t,r),r.onabort=b(tw,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=b(tw,n,"TestLoadImage: timeout",!1,t,r),g.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(i.toString(),r):(n=i.toString(),t=new eM,s=new AbortController,a=setTimeout(()=>{s.abort(),tw(t,"TestPingServer: timeout",!1,r)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(a),e.ok?tw(t,"TestPingServer: ok",!0,r):tw(t,"TestPingServer: server error",!1,r)}).catch(()=>{clearTimeout(a),tw(t,"TestPingServer: error",!1,r)}))}else ek(2);e.G=0,e.l&&e.l.sa(t),t1(e),tj(e)}function t1(e){if(e.G=0,e.ka=[],e.l){let t=e5(e.h);(0!=t.length||0!=e.i.length)&&(T(e.ka,t),T(e.ka,e.i),e.h.i.length=0,_(e.i),e.i.length=0),e.l.ra()}}function t2(e,t,n){var r=n instanceof e7?e9(n):new e7(n);if(""!=r.g)t&&(r.g=t+"."+r.g),tt(r,r.s);else{var i=g.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new e7(null);r&&te(s,r),t&&(s.g=t),i&&tt(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&tr(r,n,t),tr(r,"VER",e.la),tK(e,r),r}function t6(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tC(e.Ca&&!e.pa?new tE({eb:n}):e.pa)).Ha(e.J),t}function t3(){}function t5(){}function t4(e,t){el.call(this),this.g=new tB(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!I(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!I(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t9(this)}function t8(e){eT.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t7(){eI.call(this),this.status=1}function t9(e){this.g=e}(n=tC.prototype).Ha=function(e){this.J=e},n.ea=function(e,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);n=n?n.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?eb(this.o):eb(t),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(n,String(e),!0),this.B=!1}catch(e){tk(this,e);return}if(e=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[t,a]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=g.FormData&&e instanceof g.FormData,!(0<=Array.prototype.indexOf.call(tN,n,void 0))||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(t,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tL(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tk(this,e)}},n.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,eu(this,"complete"),eu(this,"abort"),tM(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tM(this,!0)),tC.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?tO(this):this.bb())},n.bb=function(){tO(this)},n.isActive=function(){return!!this.g},n.Z=function(){try{return 2<tP(this)?this.g.status:-1}catch(e){return -1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},n.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ey(t)}},n.Ba=function(){return this.m},n.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(n=tB.prototype).la=8,n.G=1,n.connect=function(e,t,n,r){ek(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=t2(this,null,this.W),tz(this)},n.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new eB(this,this.j,e),s=this.o;if(this.S&&(s?k(s=D(s),this.S):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tG(this,i,t),tr(n=e9(this.I),"RID",e),tr(n,"CVER",22),this.D&&tr(n,"X-HTTP-Session-Id",this.D),tK(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(tx(s)))+"&"+t:this.m&&tA(n,this.m,s)),e6(this.h,i),this.Ua&&tr(n,"TYPE","init"),this.P?(tr(n,"$req",t),tr(n,"SID","null"),i.T=!0,ez(i,n,null)):ez(i,n,t),this.G=2}}else 3==this.G&&(e?t$(this,e):0==this.i.length||e0(this.h)||t$(this))},n.Fa=function(){if(this.u=null,tX(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eO(w(this.ab,this),e)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ek(10),tq(this),tX(this))},n.Za=function(){null!=this.C&&(this.C=null,tq(this),tW(this),ek(19))},n.fb=function(e){e?(this.j.info("Successfully pinged google.com"),ek(2)):(this.j.info("Failed to ping google.com"),ek(1))},n.isActive=function(){return!!this.l&&this.l.isActive(this)},(n=t3.prototype).ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){},t5.prototype.g=function(e,t){return new t4(e,t)},E(t4,el),t4.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t4.prototype.close=function(){tU(this.g)},t4.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=em(e),e=n);t.i.push(new eY(t.Ya++,e)),3==t.G&&tz(t)},t4.prototype.N=function(){this.g.l=null,delete this.j,tU(this.g),delete this.g,t4.aa.N.call(this)},E(t8,eT),E(t7,eI),E(t9,t3),t9.prototype.ua=function(){eu(this.g,"a")},t9.prototype.ta=function(e){eu(this.g,new t8(e))},t9.prototype.sa=function(e){eu(this.g,new t7)},t9.prototype.ra=function(){eu(this.g,"b")},t5.prototype.createWebChannel=t5.prototype.g,t4.prototype.send=t4.prototype.o,t4.prototype.open=t4.prototype.m,t4.prototype.close=t4.prototype.close,h=G.createWebChannelTransport=function(){return new t5},u=G.getStatEventTarget=function(){return eA()},l=G.Event=eS,o=G.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eP.NO_ERROR=0,eP.TIMEOUT=8,eP.HTTP_ERROR=6,a=G.ErrorCode=eP,eF.COMPLETE="complete",s=G.EventType=eF,eE.EventType=e_,e_.OPEN="a",e_.CLOSE="b",e_.ERROR="c",e_.MESSAGE="d",el.prototype.listen=el.prototype.K,i=G.WebChannel=eE,G.FetchXmlHttpFactory=tE,tC.prototype.listenOnce=tC.prototype.L,tC.prototype.getLastError=tC.prototype.Ka,tC.prototype.getLastErrorCode=tC.prototype.Ba,tC.prototype.getStatus=tC.prototype.Z,tC.prototype.getResponseJson=tC.prototype.Oa,tC.prototype.getResponseText=tC.prototype.oa,tC.prototype.send=tC.prototype.ea,tC.prototype.setWithCredentials=tC.prototype.Ha,r=G.XhrIo=tC}).apply(void 0!==K?K:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let Q="@firebase/firestore",W="4.8.0";class H{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}H.UNAUTHENTICATED=new H(null),H.GOOGLE_CREDENTIALS=new H("google-credentials-uid"),H.FIRST_PARTY=new H("first-party-uid"),H.MOCK_USER=new H("mock-user");let X="11.10.0",J=new j.Logger("@firebase/firestore");function Y(){return J.logLevel}function Z(e){J.setLogLevel(e)}function ee(e,...t){if(J.logLevel<=j.LogLevel.DEBUG){let n=t.map(er);J.debug(`Firestore (${X}): ${e}`,...n)}}function et(e,...t){if(J.logLevel<=j.LogLevel.ERROR){let n=t.map(er);J.error(`Firestore (${X}): ${e}`,...n)}}function en(e,...t){if(J.logLevel<=j.LogLevel.WARN){let n=t.map(er);J.warn(`Firestore (${X}): ${e}`,...n)}}function er(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function ei(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,es(e,r,n)}function es(e,t,n){let r=`FIRESTORE (${X}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw et(r),Error(r)}function ea(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||es(t,i,r)}function eo(e,t){e||ei(57014,t)}let el={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class eu extends L{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class eh{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ec{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ed{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(H.UNAUTHENTICATED))}shutdown(){}}class ef{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class eg{constructor(e){this.t=e,this.currentUser=H.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ea(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new eh;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new eh,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{ee("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(ee("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new eh)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(ee("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ea("string"==typeof t.accessToken,31837,{l:t}),new ec(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return ea(null===e||"string"==typeof e,2055,{h:e}),new H(e)}}class ep{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=H.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class em{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new ep(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(H.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ey{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ev{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,y._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ea(void 0===this.o,3512);let n=e=>{null!=e.error&&ee("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,ee("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{ee("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):ee("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new ey(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(ea("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new ey(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class ew{getToken(){return Promise.resolve(new ey(""))}invalidateToken(){}start(e,t){}shutdown(){}}function eb(){return new TextEncoder}class eE{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function e_(e,t){return e<t?-1:+(e>t)}function eT(e,t){let n=0;for(;n<e.length&&n<t.length;){let r=e.codePointAt(n),i=t.codePointAt(n);if(r!==i){if(r<128&&i<128)return e_(r,i);{let s=eb(),a=function(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return e_(e[n],t[n]);return e_(e.length,t.length)}(s.encode(eI(e,n)),s.encode(eI(t,n)));return 0!==a?a:e_(r,i)}}n+=r>65535?2:1}return e_(e.length,t.length)}function eI(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function eS(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}let ex="__name__";class eA{constructor(e,t,n){void 0===t?t=0:t>e.length&&ei(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&ei(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===eA.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof eA?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=eA.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return e_(e.length,t.length)}static compareSegments(e,t){let n=eA.isNumericId(e),r=eA.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?eA.extractNumericId(e).compare(eA.extractNumericId(t)):eT(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return t.fromString(e.substring(4,e.length-2))}}class eC extends eA{construct(e,t,n){return new eC(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new eu(el.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new eC(t)}static emptyPath(){return new eC([])}}let eD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class eN extends eA{construct(e,t,n){return new eN(e,t,n)}static isValidIdentifier(e){return eD.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),eN.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ex}static keyField(){return new eN([ex])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new eu(el.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new eu(el.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new eu(el.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new eu(el.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new eN(t)}static emptyPath(){return new eN([])}}class ek{constructor(e){this.path=e}static fromPath(e){return new ek(eC.fromString(e))}static fromName(e){return new ek(eC.fromString(e).popFirst(5))}static empty(){return new ek(eC.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===eC.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return eC.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ek(new eC(e.slice()))}}function eR(e,t,n){if(!n)throw new eu(el.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function eO(e,t,n,r){if(!0===t&&!0===r)throw new eu(el.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function eM(e){if(!ek.isDocumentKey(e))throw new eu(el.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function eL(e){if(ek.isDocumentKey(e))throw new eu(el.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function eP(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function eF(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":ei(12329,{type:typeof e})}function eV(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new eu(el.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=eF(e);throw new eu(el.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function eB(e,t){if(t<=0)throw new eu(el.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function eU(e,t){let n={typeString:e};return t&&(n.value=t),n}function eq(e,t){let n;if(!eP(e))throw new eu(el.INVALID_ARGUMENT,"JSON must be an object");for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let a=e[r];if(i&&typeof a!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new eu(el.INVALID_ARGUMENT,n);return!0}class ej{static now(){return ej.fromMillis(Date.now())}static fromDate(e){return ej.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new ej(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new eu(el.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new eu(el.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?e_(this.nanoseconds,e.nanoseconds):e_(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ej._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(eq(e,ej._jsonSchema))return new ej(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ej._jsonSchemaVersion="firestore/timestamp/1.0",ej._jsonSchema={type:eU("string",ej._jsonSchemaVersion),seconds:eU("number"),nanoseconds:eU("number")};class ez{static fromTimestamp(e){return new ez(e)}static min(){return new ez(new ej(0,0))}static max(){return new ez(new ej(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class e${constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function eK(e){return e.fields.find(e=>2===e.kind)}function eG(e){return e.fields.filter(e=>2!==e.kind)}function eQ(e,t){let n=e_(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=function(e,t){let n=eN.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:e_(e.kind,t.kind)}(e.fields[r],t.fields[r])))return n;return e_(e.fields.length,t.fields.length)}e$.UNKNOWN_ID=-1;class eW{constructor(e,t){this.fieldPath=e,this.kind=t}}class eH{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new eH(0,eY.min())}}function eX(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new eY(ez.fromTimestamp(1e9===r?new ej(n+1,0):new ej(n,r)),ek.empty(),t)}function eJ(e){return new eY(e.readTime,e.key,-1)}class eY{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new eY(ez.min(),ek.empty(),-1)}static max(){return new eY(ez.max(),ek.empty(),-1)}}function eZ(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=ek.comparator(e.documentKey,t.documentKey))?n:e_(e.largestBatchId,t.largestBatchId)}let e0="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class e1{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function e2(e){if(e.code!==el.FAILED_PRECONDITION||e.message!==e0)throw e;ee("LocalStore","Unexpectedly lost primary lease")}class e6{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ei(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new e6((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof e6?t:e6.resolve(t)}catch(e){return e6.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):e6.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):e6.reject(t)}static resolve(e){return new e6((t,n)=>{t(e)})}static reject(e){return new e6((t,n)=>{n(e)})}static waitFor(e){return new e6((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=e6.resolve(!1);for(let n of e)t=t.next(e=>e?e6.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new e6((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new e6((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}let e3="SimpleDb";class e5{static open(e,t,n,r){try{return new e5(t,e.transaction(r,n))}catch(e){throw new e9(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new eh,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new e9(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let n=ti(t.target.error);this.S.reject(new e9(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(ee(e3,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new tt(this.transaction.objectStore(e))}}class e4{static delete(e){return ee(e3,"Removing database:",e),tn(S().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}())return!1;if(e4.F())return!0;let e=k(),t=e4.M(e),n=e8(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static F(){var e;return void 0!==p.default&&"YES"===(null==(e=p.default.__PRIVATE_env)?void 0:e.O)}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,n){this.name=e,this.version=t,this.B=n,this.L=null,12.2===e4.M(k())&&et("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(ee(e3,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new e9(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new eu(el.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new eu(el.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new e9(e,r))},r.onupgradeneeded=e=>{ee(e3,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;if(null!==this.L&&this.L!==e.oldVersion)throw Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${e.oldVersion}, event.newVersion=${e.newVersion}, db.version=${t.version}`);this.B.q(t,r.transaction,e.oldVersion,this.version).next(()=>{ee(e3,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{let t=e.target;this.L=t.version},{passive:!0})),this.db.addEventListener("versionchange",e=>{var t;null===e.newVersion&&(en('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),null==(t=this.databaseDeletedListener)||t.call(this))},{passive:!0}),this.db}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.k(e);let t=e5.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.v(),e)).catch(e=>(t.abort(e),e6.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(ee(e3,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function e8(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class e7{constructor(e){this.$=e,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(e){this.$=e}done(){this.U=!0}G(e){this.K=e}delete(){return tn(this.$.delete())}}class e9 extends eu{constructor(e,t){super(el.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function te(e){return"IndexedDbTransactionError"===e.name}class tt{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(ee(e3,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(ee(e3,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),tn(n)}add(e){return ee(e3,"ADD",this.store.name,e,e),tn(this.store.add(e))}get(e){return tn(this.store.get(e)).next(t=>(void 0===t&&(t=null),ee(e3,"GET",this.store.name,e,t),t))}delete(e){return ee(e3,"DELETE",this.store.name,e),tn(this.store.delete(e))}count(){return ee(e3,"COUNT",this.store.name),tn(this.store.count())}j(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new e6((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.J(e,(e,n)=>{t.push(n)}).next(()=>t)}}H(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new e6((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}Y(e,t){ee(e3,"DELETE ALL",this.store.name);let n=this.options(e,t);n.Z=!1;let r=this.cursor(n);return this.J(r,(e,t,n)=>n.delete())}X(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.J(r,t)}ee(e){let t=this.cursor({});return new e6((n,r)=>{t.onerror=e=>{r(ti(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}J(e,t){let n=[];return new e6((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new e7(i),a=t(i.primaryKey,i.value,s);if(a instanceof e6){let e=a.catch(e=>(s.done(),e6.reject(e)));n.push(e)}s.isDone?r():null===s.W?i.continue():i.continue(s.W)}}).next(()=>e6.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.Z?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function tn(e){return new e6((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(ti(e.target.error))}})}let tr=!1;function ti(e){let t=e4.M(k());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new eu("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return tr||(tr=!0,setTimeout(()=>{throw e},0)),e}}return e}let ts="IndexBackfiller";class ta{constructor(e,t){this.asyncQueue=e,this.te=t,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ne(e){ee(ts,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.te.re();ee(ts,`Documents written: ${e}`)}catch(e){te(e)?ee(ts,"Ignoring IndexedDB error during index backfill: ",e):await e2(e)}await this.ne(6e4)})}}class to{constructor(e,t){this.localStore=e,this.persistence=t}async re(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ie(t,e))}ie(e,t){let n=new Set,r=t,i=!0;return e6.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return ee(ts,`Processing collection: ${t}`),this.se(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}se(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.oe(r,n)).next(n=>(ee(ts,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}oe(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=eJ(t);eZ(r,n)>0&&(n=r)}),new eY(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class tl{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this._e(e),this.ae=e=>t.writeSequenceNumber(e))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ae&&this.ae(e),e}}function tu(e){return null==e}function th(e){return 0===e&&1/e==-1/0}function tc(e){return"number"==typeof e&&Number.isInteger(e)&&!th(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function td(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}tl.ue=-1;function tf(e){let t=e.length;if(ea(t>=2,64408,{path:e}),2===t)return ea("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),eC.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&ei(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:ei(61167,{path:e})}s=t+2}return new eC(r)}let tg="remoteDocuments",tp="owner",tm="owner",ty="mutationQueues",tv="mutations",tw="batchId",tb="userMutationsIndex",tE=["userId","batchId"],t_={},tT="documentMutations",tI="remoteDocumentsV14",tS=["prefixPath","collectionGroup","readTime","documentId"],tx="documentKeyIndex",tA=["prefixPath","collectionGroup","documentId"],tC="collectionGroupIndex",tD=["collectionGroup","readTime","prefixPath","documentId"],tN="remoteDocumentGlobal",tk="remoteDocumentGlobalKey",tR="targets",tO="queryTargetsIndex",tM=["canonicalId","targetId"],tL="targetDocuments",tP=["targetId","path"],tF="documentTargetsIndex",tV=["path","targetId"],tB="targetGlobalKey",tU="targetGlobal",tq="collectionParents",tj=["collectionId","parent"],tz="clientMetadata",t$="bundles",tK="namedQueries",tG="indexConfiguration",tQ="collectionGroupIndex",tW="indexState",tH=["indexId","uid"],tX="sequenceNumberIndex",tJ=["uid","sequenceNumber"],tY="indexEntries",tZ=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],t0="documentKeyIndex",t1=["indexId","uid","orderedDocumentKey"],t2="documentOverlays",t6=["userId","collectionPath","documentId"],t3="collectionPathOverlayIndex",t5=["userId","collectionPath","largestBatchId"],t4="collectionGroupOverlayIndex",t8=["userId","collectionGroup","largestBatchId"],t7="globals",t9=[ty,tv,tT,tg,tR,tp,tU,tL,tz,tN,tq,t$,tK],ne=[...t9,t2],nt=[ty,tv,tT,tI,tR,tp,tU,tL,tz,tN,tq,t$,tK,t2],nn=[...nt,tG,tW,tY],nr=[...nn,t7];class ni extends e1{constructor(e,t){super(),this.ce=e,this.currentSequenceNumber=t}}function ns(e,t){return e4.N(e.ce,t)}function na(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function no(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function nl(e,t){let n=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}function nu(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class nh{constructor(e,t){this.comparator=e,this.root=t||nd.EMPTY}insert(e,t){return new nh(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nd.BLACK,null,null))}remove(e){return new nh(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nd.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nc(this.root,e,this.comparator,!1)}getReverseIterator(){return new nc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nc(this.root,e,this.comparator,!0)}}class nc{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nd{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:nd.RED,this.left=null!=r?r:nd.EMPTY,this.right=null!=i?i:nd.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new nd(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return nd.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return nd.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,nd.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,nd.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ei(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ei(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw ei(27949);return e+ +!this.isRed()}}nd.EMPTY=null,nd.RED=!0,nd.BLACK=!1,nd.EMPTY=new class{constructor(){this.size=0}get key(){throw ei(57766)}get value(){throw ei(16141)}get color(){throw ei(16727)}get left(){throw ei(29726)}get right(){throw ei(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new nd(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class nf{constructor(e){this.comparator=e,this.data=new nh(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ng(this.data.getIterator())}getIteratorFrom(e){return new ng(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof nf)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new nf(this.comparator);return t.data=e,t}}class ng{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function np(e){return e.hasNext()?e.getNext():void 0}class nm{constructor(e){this.fields=e,e.sort(eN.comparator)}static empty(){return new nm([])}unionWith(e){let t=new nf(eN.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new nm(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return eS(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class ny extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function nv(){return"undefined"!=typeof atob}class nw{constructor(e){this.binaryString=e}static fromBase64String(e){return new nw(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ny("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new nw(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return e_(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}nw.EMPTY_BYTE_STRING=new nw("");let nb=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nE(e){if(ea(!!e,39018),"string"==typeof e){let t=0,n=nb.exec(e);if(ea(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:n_(e.seconds),nanos:n_(e.nanos)}}function n_(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function nT(e){return"string"==typeof e?nw.fromBase64String(e):nw.fromUint8Array(e)}let nI="server_timestamp",nS="__type__",nx="__previous_value__",nA="__local_write_time__";function nC(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[nS])?void 0:n.stringValue)===nI}function nD(e){let t=e.mapValue.fields[nx];return nC(t)?nD(t):t}function nN(e){let t=nE(e.mapValue.fields[nA].timestampValue);return new ej(t.seconds,t.nanos)}class nk{constructor(e,t,n,r,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}let nR="(default)";class nO{constructor(e,t){this.projectId=e,this.database=t||nR}static empty(){return new nO("","")}get isDefaultDatabase(){return this.database===nR}isEqual(e){return e instanceof nO&&e.projectId===this.projectId&&e.database===this.database}}let nM="__type__",nL="__max__",nP={mapValue:{fields:{__type__:{stringValue:nL}}}},nF="__vector__",nV="value",nB={nullValue:"NULL_VALUE"};function nU(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?nC(e)?4:n1(e)?0x1fffffffffffff:nZ(e)?10:11:ei(28295,{value:e})}function nq(e,t){if(e===t)return!0;let n=nU(e);if(n!==nU(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return nN(e).isEqual(nN(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=nE(e.timestampValue),i=nE(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return nT(e.bytesValue).isEqual(nT(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return n_(e.geoPointValue.latitude)===n_(t.geoPointValue.latitude)&&n_(e.geoPointValue.longitude)===n_(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return n_(e.integerValue)===n_(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=n_(e.doubleValue),r=n_(t.doubleValue);return n===r?th(n)===th(r):isNaN(n)&&isNaN(r)}return!1;case 9:return eS(e.arrayValue.values||[],t.arrayValue.values||[],nq);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(na(s)!==na(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!nq(s[e],a[e])))return!1;return!0;default:return ei(52216,{left:e})}}function nj(e,t){return void 0!==(e.values||[]).find(e=>nq(e,t))}function nz(e,t){var n,r,i,s,a,o,l,u,h,c;if(e===t)return 0;let d=nU(e),f=nU(t);if(d!==f)return e_(d,f);switch(d){case 0:case 0x1fffffffffffff:return 0;case 1:return e_(e.booleanValue,t.booleanValue);case 2:let g,p;return g=n_(e.integerValue||e.doubleValue),g<(p=n_(t.integerValue||t.doubleValue))?-1:g>p?1:g===p?0:isNaN(g)?isNaN(p)?0:-1:1;case 3:return n$(e.timestampValue,t.timestampValue);case 4:return n$(nN(e),nN(t));case 5:return eT(e.stringValue,t.stringValue);case 6:let m,y;return n=e.bytesValue,r=t.bytesValue,m=nT(n),y=nT(r),m.compareTo(y);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=e_(n[e],r[e]);if(0!==t)return t}return e_(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:let v;return i=e.geoPointValue,s=t.geoPointValue,0!==(v=e_(n_(i.latitude),n_(s.latitude)))?v:e_(n_(i.longitude),n_(s.longitude));case 9:return nK(e.arrayValue,t.arrayValue);case 10:let w,b,E,_,T;return a=e.mapValue,o=t.mapValue,w=a.fields||{},b=o.fields||{},E=null==(l=w[nV])?void 0:l.arrayValue,_=null==(u=b[nV])?void 0:u.arrayValue,0!==(T=e_((null==(h=null==E?void 0:E.values)?void 0:h.length)||0,(null==(c=null==_?void 0:_.values)?void 0:c.length)||0))?T:nK(E,_);case 11:return function(e,t){if(e===nP.mapValue&&t===nP.mapValue)return 0;if(e===nP.mapValue)return 1;if(t===nP.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=eT(r[e],s[e]);if(0!==t)return t;let a=nz(n[r[e]],i[s[e]]);if(0!==a)return a}return e_(r.length,s.length)}(e.mapValue,t.mapValue);default:throw ei(23264,{le:d})}}function n$(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return e_(e,t);let n=nE(e),r=nE(t),i=e_(n.seconds,r.seconds);return 0!==i?i:e_(n.nanos,r.nanos)}function nK(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=nz(n[e],r[e]);if(t)return t}return e_(n.length,r.length)}function nG(e){var t,n;let r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(r=nE(e.timestampValue),`time(${r.seconds},${r.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?nT(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,ek.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=nG(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${nG(e.fields[i])}`;return n+"}"}(e.mapValue):ei(61005,{value:e})}function nQ(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function nW(e){return!!e&&"integerValue"in e}function nH(e){return!!e&&"arrayValue"in e}function nX(e){return!!e&&"nullValue"in e}function nJ(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function nY(e){return!!e&&"mapValue"in e}function nZ(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[nM])?void 0:n.stringValue)===nF}function n0(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return no(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=n0(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=n0(e.arrayValue.values[n]);return t}return Object.assign({},e)}function n1(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===nL}let n2={mapValue:{fields:{[nM]:{stringValue:nF},[nV]:{arrayValue:{}}}}};function n6(e,t){let n=nz(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function n3(e,t){let n=nz(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class n5{constructor(e){this.value=e}static empty(){return new n5({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!nY(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=n0(t)}setAll(e){let t=eN.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=n0(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());nY(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nq(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];nY(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(no(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new n5(n0(this.value))}}class n4{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new n4(e,0,ez.min(),ez.min(),ez.min(),n5.empty(),0)}static newFoundDocument(e,t,n,r){return new n4(e,1,t,ez.min(),n,r,0)}static newNoDocument(e,t){return new n4(e,2,t,ez.min(),ez.min(),n5.empty(),0)}static newUnknownDocument(e,t){return new n4(e,3,t,ez.min(),ez.min(),n5.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(ez.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=n5.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=n5.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ez.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof n4&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n4(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class n8{constructor(e,t){this.position=e,this.inclusive=t}}function n7(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?ek.comparator(ek.fromName(a.referenceValue),n.key):nz(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function n9(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!nq(e.position[n],t.position[n]))return!1;return!0}class re{constructor(e,t="asc"){this.field=e,this.dir=t}}class rt{}class rn extends rt{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ru(e,t,n):"array-contains"===t?new rf(e,n):"in"===t?new rg(e,n):"not-in"===t?new rp(e,n):"array-contains-any"===t?new rm(e,n):new rn(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new rh(e,n):new rc(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(nz(t,this.value)):null!==t&&nU(this.value)===nU(t)&&this.matchesComparison(nz(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ei(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rr extends rt{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new rr(e,t)}matches(e){return ri(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.he||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function ri(e){return"and"===e.op}function rs(e){return"or"===e.op}function ra(e){return ro(e)&&ri(e)}function ro(e){for(let t of e.filters)if(t instanceof rr)return!1;return!0}function rl(e,t){let n=e.filters.concat(t);return rr.create(n,e.op)}class ru extends rn{constructor(e,t,n){super(e,t,n),this.key=ek.fromName(n.referenceValue)}matches(e){let t=ek.comparator(e.key,this.key);return this.matchesComparison(t)}}class rh extends rn{constructor(e,t){super(e,"in",t),this.keys=rd("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rc extends rn{constructor(e,t){super(e,"not-in",t),this.keys=rd("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rd(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>ek.fromName(e.referenceValue))}class rf extends rn{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return nH(t)&&nj(t.arrayValue,this.value)}}class rg extends rn{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&nj(this.value.arrayValue,t)}}class rp extends rn{constructor(e,t){super(e,"not-in",t)}matches(e){if(nj(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!nj(this.value.arrayValue,t)}}class rm extends rn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!nH(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>nj(this.value.arrayValue,e))}}class ry{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.Pe=null}}function rv(e,t=null,n=[],r=[],i=null,s=null,a=null){return new ry(e,t,n,r,i,s,a)}function rw(e){if(null===e.Pe){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof rn)return t.field.canonicalString()+t.op.toString()+nG(t.value);if(ra(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),tu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>nG(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>nG(e)).join(",")),e.Pe=t}return e.Pe}function rb(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof rn?n instanceof rn&&t.op===n.op&&t.field.isEqual(n.field)&&nq(t.value,n.value):t instanceof rr?n instanceof rr&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void ei(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!n9(e.startAt,t.startAt)&&n9(e.endAt,t.endAt)}function rE(e){return ek.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function r_(e,t){return e.filters.filter(e=>e instanceof rn&&e.field.isEqual(t))}function rT(e,t,n){let r=nB,i=!0;for(let n of r_(e,t)){let e=nB,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?nB:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?nQ(nO.empty(),ek.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?nZ(s)?n2:{mapValue:{}}:ei(35942,{value:s});break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=nB}0>n6({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>n6({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function rI(e,t,n){let r=nP,i=!0;for(let n of r_(e,t)){let e=nP,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?nQ(nO.empty(),ek.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?n2:"mapValue"in s?nZ(s)?{mapValue:{}}:nP:ei(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=nP}n3({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];n3({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class rS{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function rx(e){return new rS(e)}function rA(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function rC(e){return null!==e.collectionGroup}function rD(e){if(null===e.Te){let t;e.Te=[];let n=new Set;for(let t of e.explicitOrderBy)e.Te.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new nf(eN.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Te.push(new re(t,r))}),n.has(eN.keyField().canonicalString())||e.Te.push(new re(eN.keyField(),r))}return e.Te}function rN(e){return e.Ie||(e.Ie=rR(e,rD(e))),e.Ie}function rk(e){return e.de||(e.de=rR(e,e.explicitOrderBy)),e.de}function rR(e,t){if("F"===e.limitType)return rv(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new re(e.field,t)});let n=e.endAt?new n8(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new n8(e.startAt.position,e.startAt.inclusive):null;return rv(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function rO(e,t){let n=e.filters.concat([t]);return new rS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function rM(e,t,n){return new rS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function rL(e,t){return rb(rN(e),rN(t))&&e.limitType===t.limitType}function rP(e){return`${rw(rN(e))}|lt:${e.limitType}`}function rF(e){var t;let n;return`Query(target=${n=(t=rN(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof rn?`${t.field.canonicalString()} ${t.op} ${nG(t.value)}`:t instanceof rr?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),tu(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>nG(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>nG(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function rV(e,t){var n,r,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):ek.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let n of rD(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,r=t,(!n.startAt||(i=n.startAt,o=n7(i,rD(n),r),i.inclusive?!!(o<=0):!!(o<0)))&&(!n.endAt||(s=n.endAt,l=n7(s,rD(n),r),s.inclusive?!!(l>=0):!!(l>0))))}function rB(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function rU(e){return(t,n)=>{let r=!1;for(let i of rD(e)){let e=function(e,t,n){var r;let i,s,a=e.field.isKeyField()?ek.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),s=n.data.field(r),null!==i&&null!==s?nz(i,s):ei(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return ei(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class rq{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){no(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return nu(this.inner)}size(){return this.innerSize}}let rj=new nh(ek.comparator),rz=new nh(ek.comparator);function r$(...e){let t=rz;for(let n of e)t=t.insert(n.key,n);return t}function rK(e){let t=rz;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function rG(){return new rq(e=>e.toString(),(e,t)=>e.isEqual(t))}let rQ=new nh(ek.comparator),rW=new nf(ek.comparator);function rH(...e){let t=rW;for(let n of e)t=t.add(n);return t}let rX=new nf(e_);function rJ(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:th(t)?"-0":t}}function rY(e){return{integerValue:""+e}}function rZ(e,t){return tc(t)?rY(t):rJ(e,t)}class r0{constructor(){this._=void 0}}function r1(e,t){return e instanceof r8?nW(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class r2 extends r0{}class r6 extends r0{constructor(e){super(),this.elements=e}}function r3(e,t){let n=r9(t);for(let t of e.elements)n.some(e=>nq(e,t))||n.push(t);return{arrayValue:{values:n}}}class r5 extends r0{constructor(e){super(),this.elements=e}}function r4(e,t){let n=r9(t);for(let t of e.elements)n=n.filter(e=>!nq(e,t));return{arrayValue:{values:n}}}class r8 extends r0{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function r7(e){return n_(e.integerValue||e.doubleValue)}function r9(e){return nH(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ie{constructor(e,t){this.field=e,this.transform=t}}class it{constructor(e,t){this.version=e,this.transformResults=t}}class ir{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ir}static exists(e){return new ir(void 0,e)}static updateTime(e){return new ir(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ii(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class is{}function ia(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new ip(e.key,ir.none()):new iu(e.key,e.data,ir.none());{let n=e.data,r=n5.empty(),i=new nf(eN.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new ih(e.key,r,new nm(i.toArray()),ir.none())}}function io(e,t,n,r){return e instanceof iu?function(e,t,n,r){if(!ii(e.precondition,t))return n;let i=e.value.clone(),s=ig(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof ih?function(e,t,n,r){if(!ii(e.precondition,t))return n;let i=ig(e.fieldTransforms,r,t),s=t.data;return(s.setAll(ic(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):ii(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function il(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&eS(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof r6&&r instanceof r6||n instanceof r5&&r instanceof r5?eS(n.elements,r.elements,nq):n instanceof r8&&r instanceof r8?nq(n.Ee,r.Ee):n instanceof r2&&r instanceof r2)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class iu extends is{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ih extends is{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ic(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function id(e,t,n){let r=new Map;ea(e.length===n.length,32656,{Ae:n.length,Re:e.length});for(let s=0;s<n.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);r.set(a.field,(i=n[s],o instanceof r6?r3(o,l):o instanceof r5?r4(o,l):i))}return r}function ig(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,function(e,t,n){var r;let i,s,a;return e instanceof r2?(r=t,i={fields:{[nS]:{stringValue:nI},[nA]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&nC(r)&&(r=nD(r)),r&&(i.fields[nx]=r),{mapValue:i}):e instanceof r6?r3(e,t):e instanceof r5?r4(e,t):(a=r7(s=r1(e,t))+r7(e.Ee),nW(s)&&nW(e.Ee)?rY(a):rJ(e.serializer,a))}(e,s,t))}return r}class ip extends is{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class im extends is{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class iy{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){let r,i;e instanceof iu?(r=e.value.clone(),i=id(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof ih?function(e,t,n){if(!ii(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=id(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(ic(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=io(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=io(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=rG();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=ia(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(ez.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),rH())}isEqual(e){return this.batchId===e.batchId&&eS(this.mutations,e.mutations,(e,t)=>il(e,t))&&eS(this.baseMutations,e.baseMutations,(e,t)=>il(e,t))}}class iv{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){ea(e.mutations.length===n.length,58842,{Ve:e.mutations.length,me:n.length});let r=rQ,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new iv(e,t,n,r)}}class iw{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ib{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class iE{constructor(e,t){this.count=e,this.unchangedNames=t}}function i_(e){switch(e){case el.OK:return ei(64938);case el.CANCELLED:case el.UNKNOWN:case el.DEADLINE_EXCEEDED:case el.RESOURCE_EXHAUSTED:case el.INTERNAL:case el.UNAVAILABLE:case el.UNAUTHENTICATED:return!1;case el.INVALID_ARGUMENT:case el.NOT_FOUND:case el.ALREADY_EXISTS:case el.PERMISSION_DENIED:case el.FAILED_PRECONDITION:case el.ABORTED:case el.OUT_OF_RANGE:case el.UNIMPLEMENTED:case el.DATA_LOSS:return!0;default:return ei(15467,{code:e})}}function iT(e){if(void 0===e)return et("GRPC error has no .code"),el.UNKNOWN;switch(e){case c.OK:return el.OK;case c.CANCELLED:return el.CANCELLED;case c.UNKNOWN:return el.UNKNOWN;case c.DEADLINE_EXCEEDED:return el.DEADLINE_EXCEEDED;case c.RESOURCE_EXHAUSTED:return el.RESOURCE_EXHAUSTED;case c.INTERNAL:return el.INTERNAL;case c.UNAVAILABLE:return el.UNAVAILABLE;case c.UNAUTHENTICATED:return el.UNAUTHENTICATED;case c.INVALID_ARGUMENT:return el.INVALID_ARGUMENT;case c.NOT_FOUND:return el.NOT_FOUND;case c.ALREADY_EXISTS:return el.ALREADY_EXISTS;case c.PERMISSION_DENIED:return el.PERMISSION_DENIED;case c.FAILED_PRECONDITION:return el.FAILED_PRECONDITION;case c.ABORTED:return el.ABORTED;case c.OUT_OF_RANGE:return el.OUT_OF_RANGE;case c.UNIMPLEMENTED:return el.UNIMPLEMENTED;case c.DATA_LOSS:return el.DATA_LOSS;default:return ei(39323,{code:e})}}(d=c||(c={}))[d.OK=0]="OK",d[d.CANCELLED=1]="CANCELLED",d[d.UNKNOWN=2]="UNKNOWN",d[d.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",d[d.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",d[d.NOT_FOUND=5]="NOT_FOUND",d[d.ALREADY_EXISTS=6]="ALREADY_EXISTS",d[d.PERMISSION_DENIED=7]="PERMISSION_DENIED",d[d.UNAUTHENTICATED=16]="UNAUTHENTICATED",d[d.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",d[d.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",d[d.ABORTED=10]="ABORTED",d[d.OUT_OF_RANGE=11]="OUT_OF_RANGE",d[d.UNIMPLEMENTED=12]="UNIMPLEMENTED",d[d.INTERNAL=13]="INTERNAL",d[d.UNAVAILABLE=14]="UNAVAILABLE",d[d.DATA_LOSS=15]="DATA_LOSS";let iI=null,iS=new t([0xffffffff,0xffffffff],0);function ix(e){let t=eb().encode(e),r=new n;return r.update(t),new Uint8Array(r.digest())}function iA(e){let n=new DataView(e.buffer),r=n.getUint32(0,!0),i=n.getUint32(4,!0),s=n.getUint32(8,!0),a=n.getUint32(12,!0);return[new t([r,i],0),new t([s,a],0)]}class iC{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new iD(`Invalid padding: ${n}`);if(r<0||e.length>0&&0===this.hashCount)throw new iD(`Invalid hash count: ${r}`);if(0===e.length&&0!==n)throw new iD(`Invalid padding when bitmap length is 0: ${n}`);this.fe=8*e.length-n,this.ge=t.fromNumber(this.fe)}pe(e,n,r){let i=e.add(n.multiply(t.fromNumber(r)));return 1===i.compare(iS)&&(i=new t([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.fe)return!1;let[t,n]=iA(ix(e));for(let e=0;e<this.hashCount;e++){let r=this.pe(t,n,e);if(!this.ye(r))return!1}return!0}static create(e,t,n){let r=new iC(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.fe)return;let[t,n]=iA(ix(e));for(let e=0;e<this.hashCount;e++){let r=this.pe(t,n,e);this.we(r)}}we(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class iD extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class iN{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,ik.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new iN(ez.min(),r,new nh(e_),rj,rH())}}class ik{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ik(n,t,rH(),rH(),rH())}}class iR{constructor(e,t,n,r){this.Se=e,this.removedTargetIds=t,this.key=n,this.be=r}}class iO{constructor(e,t){this.targetId=e,this.De=t}}class iM{constructor(e,t,n=nw.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class iL{constructor(){this.ve=0,this.Ce=iV(),this.Fe=nw.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return 0!==this.ve}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=rH(),t=rH(),n=rH();return this.Ce.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:ei(38017,{changeType:i})}}),new ik(this.Fe,this.Me,e,t,n)}ke(){this.xe=!1,this.Ce=iV()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,ea(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class iP{constructor(e){this.We=e,this.Ge=new Map,this.ze=rj,this.je=iF(),this.Je=iF(),this.He=new nh(e_)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let n=this.tt(t);switch(e.state){case 0:this.nt(t)&&n.Be(e.resumeToken);break;case 1:n.Ue(),n.Oe||n.ke(),n.Be(e.resumeToken);break;case 2:n.Ue(),n.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(n.Ke(),n.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),n.Be(e.resumeToken));break;default:ei(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((e,n)=>{this.nt(n)&&t(n)})}it(e){let t=e.targetId,n=e.De.count,r=this.st(t);if(r){let d=r.target;if(rE(d))if(0===n){let e=new ek(d.path);this.Xe(t,e,n4.newNoDocument(e,ez.min()))}else ea(1===n,20013,{expectedCount:n});else{let r=this.ot(t);if(r!==n){var i,s,a,o,l,u,h,c;let n,d,f=this._t(e),g=f?this.ut(f,e,r):1;0!==g&&(this.rt(t),this.He=this.He.insert(t,2===g?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null==iI||iI.ct((i=e.De,s=this.We.lt(),n={localCacheCount:r,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(d=i.unchangedNames)&&(n.bloomFilter={applied:0===g,hashCount:null!=(a=null==d?void 0:d.hashCount)?a:0,bitmapLength:null!=(u=null==(l=null==(o=null==d?void 0:d.bits)?void 0:o.bitmap)?void 0:l.length)?u:0,padding:null!=(c=null==(h=null==d?void 0:d.bits)?void 0:h.padding)?c:0,mightContain:e=>{var t;return null!=(t=null==f?void 0:f.mightContain(e))&&t}}),n))}}}}_t(e){let t,n,r=e.De.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=nT(i).toUint8Array()}catch(e){if(e instanceof ny)return en("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new iC(t,s,a)}catch(e){return en(e instanceof iD?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.fe?null:n}ut(e,t,n){return 2*(t.De.count!==n-this.ht(e,t.targetId))}ht(e,t){let n=this.We.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.We.lt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.Xe(t,n,null),r++)}),r}Pt(e){let t=new Map;this.Ge.forEach((n,r)=>{let i=this.st(r);if(i){if(n.current&&rE(i.target)){let t=new ek(i.target.path);this.Tt(t).has(r)||this.It(r,t)||this.Xe(r,t,n4.newNoDocument(t,e))}n.Ne&&(t.set(r,n.Le()),n.ke())}});let n=rH();this.Je.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.st(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.ze.forEach((t,n)=>n.setReadTime(e));let r=new iN(e,t,this.He,this.ze,n);return this.ze=rj,this.je=iF(),this.Je=iF(),this.He=new nh(e_),r}Ze(e,t){if(!this.nt(e))return;let n=2*!!this.It(e,t.key);this.tt(e).qe(t.key,n),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,n){if(!this.nt(e))return;let r=this.tt(e);this.It(e,t)?r.qe(t,1):r.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),n&&(this.ze=this.ze.insert(t,n))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new iL,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new nf(e_),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new nf(e_),this.je=this.je.insert(e,t)),t}nt(e){let t=null!==this.st(e);return t||ee("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new iL),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function iF(){return new nh(ek.comparator)}function iV(){return new nh(ek.comparator)}let iB={asc:"ASCENDING",desc:"DESCENDING"},iU={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iq={and:"AND",or:"OR"};class ij{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function iz(e,t){return e.useProto3Json||tu(t)?t:{value:t}}function i$(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function iK(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function iG(e){let t;return ea(!!e,49232),ez.fromTimestamp(new ej((t=nE(e)).seconds,t.nanos))}function iQ(e,t){return iW(e,t).canonicalString()}function iW(e,t){let n=new eC(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function iH(e){let t=eC.fromString(e);return ea(sn(t),10190,{key:t.toString()}),t}function iX(e,t){return iQ(e.databaseId,t.path)}function iJ(e,t){let n=iH(t);if(n.get(1)!==e.databaseId.projectId)throw new eu(el.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new eu(el.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ek(i1(n))}function iY(e,t){return iQ(e.databaseId,t)}function iZ(e){let t=iH(e);return 4===t.length?eC.emptyPath():i1(t)}function i0(e){return new eC(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function i1(e){return ea(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function i2(e,t,n){return{name:iX(e,t),fields:n.value.mapValue.fields}}function i6(e,t,n){let r=iJ(e,t.name),i=iG(t.updateTime),s=t.createTime?iG(t.createTime):ez.min(),a=new n5({mapValue:{fields:t.fields}}),o=n4.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function i3(e,t){var n,r;let i;if(t instanceof iu)i={update:i2(e,t.key,t.value)};else if(t instanceof ip)i={delete:iX(e,t.key)};else if(t instanceof ih){let n;i={update:i2(e,t.key,t.data),updateMask:(r=t.fieldMask,n=[],r.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof im))return ei(16599,{Rt:t.type});i={verify:iX(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof r2)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof r6)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof r5)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof r8)return{fieldPath:t.field.canonicalString(),increment:n.Ee};throw ei(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:i$(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:ei(27497)),i}function i5(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?ir.updateTime(iG(n.updateTime)):void 0!==n.exists?ir.exists(n.exists):ir.none():ir.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let n;return n=null,"setToServerValue"in t?(ea("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new r2):"appendMissingElements"in t?n=new r6(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new r5(t.removeAllFromArray.values||[]):"increment"in t?n=new r8(e,t.increment):ei(16584,{proto:t}),new ie(eN.fromServerFormat(t.fieldPath),n)}):[];if(t.update){t.update.name;let n=iJ(e,t.update.name),s=new n5({mapValue:{fields:t.update.fields}});return t.updateMask?new ih(n,s,new nm((t.updateMask.fieldPaths||[]).map(e=>eN.fromServerFormat(e))),r,i):new iu(n,s,r,i)}return t.delete?new ip(iJ(e,t.delete),r):t.verify?new im(iJ(e,t.verify),r):ei(1463,{proto:t})}function i4(e,t){return{documents:[iY(e,t.path)]}}function i8(e,t){var n,r;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=iY(e,i);let o=function(e){if(0!==e.length)return function e(t){var n;let r;return t instanceof rn?function(e){if("=="===e.op){if(nJ(e.value))return{unaryFilter:{field:se(e.field),op:"IS_NAN"}};if(nX(e.value))return{unaryFilter:{field:se(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(nJ(e.value))return{unaryFilter:{field:se(e.field),op:"IS_NOT_NAN"}};if(nX(e.value))return{unaryFilter:{field:se(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:se(e.field),op:iU[e.op],value:e.value}}}(t):t instanceof rr?1===(r=(n=t).getFilters().map(t=>e(t))).length?r[0]:{compositeFilter:{op:iq[n.op],filters:r}}:ei(54877,{filter:t})}(rr.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:se(e.field),direction:iB[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=iz(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{Vt:s,parent:i}}function i7(e,t,n,r){let{Vt:i,parent:s}=i8(e,t),a={},o=[],l=0;return n.forEach(e=>{let t=r?e.alias:"aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:se(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:se(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},ft:a,parent:s}}function i9(e){var t,n,r;let i,s,a,o,l=iZ(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){ea(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=st(e.unaryFilter.field);return rn.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=st(e.unaryFilter.field);return rn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=st(e.unaryFilter.field);return rn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=st(e.unaryFilter.field);return rn.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ei(61313);default:return ei(60726)}}(t):void 0!==t.fieldFilter?rn.create(st(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ei(58110);default:return ei(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?rr.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return ei(1026)}}(t.compositeFilter.op)):ei(30097,{filter:t})}(u.where))instanceof rr&&ra(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new re(st(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let g=null;u.limit&&(g=tu(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let p=null;u.startAt&&(a=!!(n=u.startAt).before,p=new n8(n.values||[],a));let m=null;return u.endAt&&(o=!(r=u.endAt).before,m=new n8(r.values||[],o)),new rS(l,c,f,d,g,"F",p,m)}function se(e){return{fieldPath:e.canonicalString()}}function st(e){return eN.fromServerFormat(e.fieldPath)}function sn(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class sr{constructor(e,t,n,r,i=ez.min(),s=ez.min(),a=nw.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new sr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new sr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new sr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new sr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class si{constructor(e){this.gt=e}}function ss(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:sa(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:iX(i=e.gt,t.key),fields:t.data.value.mapValue.fields,updateTime:i$(i,t.version.toTimestamp()),createTime:i$(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:so(t.version)};else{if(!t.isUnknownDocument())return ei(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:so(t.version)}}return r}function sa(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function so(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function sl(e){let t=new ej(e.seconds,e.nanoseconds);return ez.fromTimestamp(t)}function su(e,t){let n=(t.baseMutations||[]).map(t=>i5(e.gt,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>i5(e.gt,t)),i=ej.fromMillis(t.localWriteTimeMs);return new iy(t.batchId,i,n,r)}function sh(e){var t;let n,r=sl(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?sl(e.lastLimboFreeSnapshotVersion):ez.min();return new sr(void 0!==e.query.documents?(ea(1===(n=(t=e.query).documents.length),1966,{count:n}),rN(rx(iZ(t.documents[0])))):rN(i9(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,i,nw.fromBase64String(e.resumeToken))}function sc(e,t){let n,r=so(t.snapshotVersion),i=so(t.lastLimboFreeSnapshotVersion);n=rE(t.target)?i4(e.gt,t.target):i8(e.gt,t.target).Vt;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:rw(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function sd(e){let t=i9({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?rM(t,t.limit,"L"):t}function sf(e,t){return new iw(t.largestBatchId,i5(e.gt,t.overlayMutation))}function sg(e,t){let n=t.path.lastSegment();return[e,td(t.path.popLast()),n]}function sp(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:so(r.readTime),documentKey:td(r.documentKey.path),largestBatchId:r.largestBatchId}}class sm{getBundleMetadata(e,t){return ns(e,t$).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:sl(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return ns(e,t$).put({bundleId:t.id,createTime:so(iG(t.createTime)),version:t.version})}getNamedQuery(e,t){return ns(e,tK).get(t).next(e=>{if(e)return{name:e.name,query:sd(e.bundledQuery),readTime:sl(e.readTime)}})}saveNamedQuery(e,t){return ns(e,tK).put({name:t.name,readTime:so(iG(t.readTime)),bundledQuery:t.bundledQuery})}}class sy{constructor(e,t){this.serializer=e,this.userId=t}static yt(e,t){return new sy(e,t.uid||"")}getOverlay(e,t){return ns(e,t2).get(sg(this.userId,t)).next(e=>e?sf(this.serializer,e):null)}getOverlays(e,t){let n=rG();return e6.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new iw(t,i);r.push(this.wt(e,s))}),e6.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(td(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(ns(e,t2).Y(t3,r))}),e6.waitFor(i)}getOverlaysForCollection(e,t,n){let r=rG(),i=td(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,1/0],!0);return ns(e,t2).j(t3,s).next(e=>{for(let t of e){let e=sf(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i,s=rG(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,1/0],!0);return ns(e,t2).X({index:t4,range:a},(e,t,n)=>{let a=sf(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}wt(e,t){return ns(e,t2).put(function(e,t,n){let[r,i,s]=sg(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:i3(e.gt,n.mutation)}}(this.serializer,this.userId,t))}}class sv{St(e){return ns(e,t7)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=null==e?void 0:e.value;return t?nw.fromUint8Array(t):nw.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class sw{bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(+!!e.booleanValue);else if("integerValue"in e)this.Ct(t,15),t.Ft(n_(e.integerValue));else if("doubleValue"in e){let n=n_(e.doubleValue);isNaN(n)?this.Ct(t,13):(this.Ct(t,15),th(n)?t.Ft(0):t.Ft(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ct(t,20),"string"==typeof n&&(n=nE(n)),t.Mt(`${n.seconds||""}`),t.Ft(n.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(nT(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ct(t,45),t.Ft(n.latitude||0),t.Ft(n.longitude||0)}else"mapValue"in e?n1(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):nZ(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):ei(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let n=e.fields||{};for(let e of(this.Ct(t,55),Object.keys(n)))this.xt(e,t),this.Dt(n[e],t)}Lt(e,t){var n,r;let i=e.fields||{};this.Ct(t,53);let s=(null==(r=null==(n=i[nV].arrayValue)?void 0:n.values)?void 0:r.length)||0;this.Ct(t,15),t.Ft(n_(s)),this.xt(nV,t),this.Dt(i[nV],t)}qt(e,t){let n=e.values||[];for(let e of(this.Ct(t,50),n))this.Dt(e,t)}Bt(e,t){this.Ct(t,37),ek.fromName(e).path.forEach(e=>{this.Ct(t,60),this.$t(e,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}function sb(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}sw.Ut=new sw;class sE{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Wt(n.value),n=t.next();this.Gt()}zt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.jt(n.value),n=t.next();this.Jt()}Ht(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Wt(e);else if(e<2048)this.Wt(960|e>>>6),this.Wt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Wt(480|e>>>12),this.Wt(128|63&e>>>6),this.Wt(128|63&e);else{let e=t.codePointAt(0);this.Wt(240|e>>>18),this.Wt(128|63&e>>>12),this.Wt(128|63&e>>>6),this.Wt(128|63&e)}}this.Gt()}Yt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.jt(e);else if(e<2048)this.jt(960|e>>>6),this.jt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.jt(480|e>>>12),this.jt(128|63&e>>>6),this.jt(128|63&e);else{let e=t.codePointAt(0);this.jt(240|e>>>18),this.jt(128|63&e>>>12),this.jt(128|63&e>>>6),this.jt(128|63&e)}}this.Jt()}Zt(e){let t=this.Xt(e),n=sb(t);this.en(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}tn(e){let t=this.Xt(e),n=sb(t);this.en(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}nn(){this.rn(255),this.rn(255)}sn(){this._n(255),this._n(255)}reset(){this.position=0}seed(e){this.en(e.length),this.buffer.set(e,this.position),this.position+=e.length}an(){return this.buffer.slice(0,this.position)}Xt(e){let t,n=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),r=!!(128&n[0]);n[0]^=r?255:128;for(let e=1;e<n.length;++e)n[e]^=255*!!r;return n}Wt(e){let t=255&e;0===t?(this.rn(0),this.rn(255)):255===t?(this.rn(255),this.rn(0)):this.rn(t)}jt(e){let t=255&e;0===t?(this._n(0),this._n(255)):255===t?(this._n(255),this._n(0)):this._n(e)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(e){this.en(1),this.buffer[this.position++]=e}_n(e){this.en(1),this.buffer[this.position++]=~e}en(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class s_{constructor(e){this.un=e}Nt(e){this.un.Kt(e)}Mt(e){this.un.Ht(e)}Ft(e){this.un.Zt(e)}vt(){this.un.nn()}}class sT{constructor(e){this.un=e}Nt(e){this.un.zt(e)}Mt(e){this.un.Yt(e)}Ft(e){this.un.tn(e)}vt(){this.un.sn()}}class sI{constructor(){this.un=new sE,this.cn=new s_(this.un),this.ln=new sT(this.un)}seed(e){this.un.seed(e)}hn(e){return 0===e?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}}class sS{constructor(e,t,n,r){this.Pn=e,this.Tn=t,this.In=n,this.dn=r}En(){let e=this.dn.length,t=0===e||255===this.dn[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new sS(this.Pn,this.Tn,this.In,n)}An(e,t,n){return{indexId:this.Pn,uid:e,arrayValue:sC(this.In),directionalValue:sC(this.dn),orderedDocumentKey:sC(t),documentKey:n.path.toArray()}}Rn(e,t,n){let r=this.An(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function sx(e,t){let n=e.Pn-t.Pn;return 0!==n||0!==(n=sA(e.In,t.In))||0!==(n=sA(e.dn,t.dn))?n:ek.comparator(e.Tn,t.Tn)}function sA(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}function sC(e){return M()?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):e}function sD(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)}class sN{constructor(e){for(const t of(this.Vn=new nf((e,t)=>eN.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.mn=e.orderBy,this.fn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.fn.push(t)}get gn(){return this.Vn.size>1}pn(e){if(ea(e.collectionGroup===this.collectionId,49279),this.gn)return!1;let t=eK(e);if(void 0!==t&&!this.yn(t))return!1;let n=eG(e),r=new Set,i=0,s=0;for(;i<n.length&&this.yn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.wn(e,t)||!this.Sn(this.mn[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.mn.length||!this.Sn(this.mn[s++],e))return!1}return!0}bn(){if(this.gn)return null;let e=new nf(eN.comparator),t=[];for(let n of this.fn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new eW(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new eW(n.field,0))}for(let n of this.mn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new eW(n.field,+("asc"!==n.dir))));return new e$(e$.UNKNOWN_ID,this.collectionId,t,eH.empty())}yn(e){for(let t of this.fn)if(this.wn(t,e))return!0;return!1}wn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}Sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function sk(e){return e instanceof rn}function sR(e){return e instanceof rr&&ra(e)}function sO(e){return sk(e)||sR(e)||function(e){if(e instanceof rr&&rs(e)){for(let t of e.getFilters())if(!sk(t)&&!sR(t))return!1;return!0}return!1}(e)}function sM(e,t){return ea(e instanceof rn||e instanceof rr,38388),ea(t instanceof rn||t instanceof rr,25473),sP(e instanceof rn?t instanceof rn?rr.create([e,t],"and"):sL(e,t):t instanceof rn?sL(t,e):function(e,t){if(ea(e.filters.length>0&&t.filters.length>0,48005),ri(e)&&ri(t))return rl(e,t.getFilters());let n=rs(e)?e:t,r=rs(e)?t:e,i=n.filters.map(e=>sM(e,r));return rr.create(i,"or")}(e,t))}function sL(e,t){if(ri(t))return rl(t,e.getFilters());{let n=t.filters.map(t=>sM(e,t));return rr.create(n,"or")}}function sP(e){if(ea(e instanceof rn||e instanceof rr,11850),e instanceof rn)return e;let t=e.getFilters();if(1===t.length)return sP(t[0]);if(ro(e))return e;let n=t.map(e=>sP(e)),r=[];return n.forEach(t=>{t instanceof rn?r.push(t):t instanceof rr&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:rr.create(r,e.op)}class sF{constructor(){this.Dn=new sV}addToCollectionParentIndex(e,t){return this.Dn.add(t),e6.resolve()}getCollectionParents(e,t){return e6.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return e6.resolve()}deleteFieldIndex(e,t){return e6.resolve()}deleteAllFieldIndexes(e){return e6.resolve()}createTargetIndexes(e,t){return e6.resolve()}getDocumentsMatchingTarget(e,t){return e6.resolve(null)}getIndexType(e,t){return e6.resolve(0)}getFieldIndexes(e,t){return e6.resolve([])}getNextCollectionGroupToUpdate(e){return e6.resolve(null)}getMinOffset(e,t){return e6.resolve(eY.min())}getMinOffsetFromCollectionGroup(e,t){return e6.resolve(eY.min())}updateCollectionGroup(e,t,n){return e6.resolve()}updateIndexEntries(e,t){return e6.resolve()}}class sV{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new nf(eC.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new nf(eC.comparator)).toArray()}}let sB="IndexedDbIndexManager",sU=new Uint8Array(0);class sq{constructor(e,t){this.databaseId=t,this.vn=new sV,this.Cn=new rq(e=>rw(e),(e,t)=>rb(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});let i={collectionId:n,parent:td(r)};return ns(e,tq).put(i)}return e6.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return ns(e,tq).j(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(tf(r.parent))}return n})}addFieldIndex(e,t){let n=ns(e,tG),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=ns(e,tW);return i.next(e=>{n.put(sp(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=ns(e,tG),r=ns(e,tW),i=ns(e,tY);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=ns(e,tG),n=ns(e,tY),r=ns(e,tW);return t.Y().next(()=>n.Y()).next(()=>r.Y())}createTargetIndexes(e,t){return e6.forEach(this.Fn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new sN(t).bn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=ns(e,tY),r=!0,i=new Map;return e6.forEach(this.Fn(t),t=>this.Mn(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=rH(),r=[];return e6.forEach(i,(i,s)=>{ee(sB,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${rw(t)}`);let a=function(e,t){let n=eK(t);if(void 0===n)return null;for(let t of r_(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of eG(t))for(let t of r_(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of eG(t)){let t=0===i.kind?rT(e,i.fieldPath,e.startAt):rI(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new n8(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of eG(t)){let t=0===i.kind?rI(e,i.fieldPath,e.endAt):rT(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new n8(n,r)}(s,i),h=this.xn(i,s,l),c=this.xn(i,s,u),d=this.On(i,s,o),f=this.Nn(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return e6.forEach(f,i=>n.H(i,t.limit).next(t=>{t.forEach(t=>{let n=ek.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return e6.resolve(null)})}Fn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(ea(t instanceof rn||t instanceof rr,34018),t instanceof rn)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=rr.create(n,t.op);return sO(r=sP(r))?r:(ea(r instanceof rr,64498),ea(ri(r),40251),ea(r.filters.length>1,57927),r.filters.reduce((e,t)=>sM(e,t)))}(function e(t){var n,r;if(ea(t instanceof rn||t instanceof rr,20012),t instanceof rn){if(t instanceof rg){let e=(null==(r=null==(n=t.value.arrayValue)?void 0:n.values)?void 0:r.map(e=>rn.create(t.field,"==",e)))||[];return rr.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return rr.create(i,t.op)}(e));return ea(sO(t),7391),sk(t)||sR(t)?[t]:t.getFilters()})(rr.create(e.filters,"and")).map(t=>rv(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}Nn(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Bn(t[h/l]):sU,c=this.Ln(e,o,n[h%l],r),d=this.kn(e,o,i[h%l],s),f=a.map(t=>this.Ln(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}Ln(e,t,n,r){let i=new sS(e,ek.empty(),t,n);return r?i:i.En()}kn(e,t,n,r){let i=new sS(e,ek.empty(),t,n);return r?i.En():i}Mn(e,t){let n=new sN(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.pn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.Fn(t);return e6.forEach(r,t=>this.Mn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new nf(eN.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}qn(e,t){let n=new sI;for(let r of eG(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.hn(r.kind);sw.Ut.bt(e,i)}return n.an()}Bn(e){let t=new sI;return sw.Ut.bt(e,t.hn(0)),t.an()}Qn(e,t){let n,r=new sI;return sw.Ut.bt(nQ(this.databaseId,t),r.hn(0===(n=eG(e)).length?0:n[n.length-1].kind)),r.an()}On(e,t,n){if(null===n)return[];let r=[];r.push(new sI);let i=0;for(let s of eG(e)){let e=n[i++];for(let n of r)if(this.$n(t,s.fieldPath)&&nH(e))r=this.Un(r,s,e);else{let t=n.hn(s.kind);sw.Ut.bt(e,t)}}return this.Kn(r)}xn(e,t,n){return this.On(e,t,n.position)}Kn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].an();return t}Un(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new sI;r.seed(n.an()),sw.Ut.bt(e,r.hn(t.kind)),i.push(r)}return i}$n(e,t){return!!e.filters.find(e=>e instanceof rn&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=ns(e,tG),r=ns(e,tW);return(t?n.j(tQ,IDBKeyRange.bound(t,t)):n.j()).next(e=>{let t=[];return e6.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{let r,i;t.push((r=n?new eH(n.sequenceNumber,new eY(sl(n.readTime),new ek(tf(n.documentKey)),n.largestBatchId)):eH.empty(),i=e.fields.map(([e,t])=>new eW(eN.fromServerFormat(e),t)),new e$(e.indexId,e.collectionGroup,i,r)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:e_(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=ns(e,tG),i=ns(e,tW);return this.Wn(e).next(e=>r.j(tQ,IDBKeyRange.bound(t,t)).next(t=>e6.forEach(t,t=>i.put(sp(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return e6.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?e6.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),e6.forEach(i,n=>this.Gn(e,t,n).next(t=>{let i=this.zn(r,n);return t.isEqual(i)?e6.resolve():this.jn(e,r,n,t,i)}))))})}Jn(e,t,n,r){return ns(e,tY).put(r.An(this.uid,this.Qn(n,t.key),t.key))}Hn(e,t,n,r){return ns(e,tY).delete(r.Rn(this.uid,this.Qn(n,t.key),t.key))}Gn(e,t,n){let r=ns(e,tY),i=new nf(sx);return r.X({index:t0,range:IDBKeyRange.only([n.indexId,this.uid,sC(this.Qn(n,t))])},(e,r)=>{i=i.add(new sS(n.indexId,t,sD(r.arrayValue),sD(r.directionalValue)))}).next(()=>i)}zn(e,t){let n=new nf(sx),r=this.qn(t,e);if(null==r)return n;let i=eK(t);if(null!=i){let s=e.data.field(i.fieldPath);if(nH(s))for(let i of s.arrayValue.values||[])n=n.add(new sS(t.indexId,e.key,this.Bn(i),r))}else n=n.add(new sS(t.indexId,e.key,sU,r));return n}jn(e,t,n,r,i){ee(sB,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=np(s),l=np(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=np(a)):t?(i(o),o=np(s)):(o=np(s),l=np(a))}}(r,i,sx,r=>{s.push(this.Jn(e,t,n,r))},r=>{s.push(this.Hn(e,t,n,r))}),e6.waitFor(s)}Wn(e){let t=1;return ns(e,tW).X({index:tX,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>sx(e,t)).filter((e,t,n)=>!t||0!==sx(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=sx(i,e),s=sx(i,t);if(0===n)r[0]=e.En();else if(n>0&&s<0)r.push(i),r.push(i.En());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.Yn(r[e],r[e+1]))return[];let t=r[e].Rn(this.uid,sU,ek.empty()),n=r[e+1].Rn(this.uid,sU,ek.empty());i.push(IDBKeyRange.bound(t,n))}return i}Yn(e,t){return sx(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sj)}getMinOffset(e,t){return e6.mapArray(this.Fn(t),t=>this.Mn(e,t).next(e=>e||ei(44426))).next(sj)}}function sj(e){ea(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>eZ(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new eY(t.readTime,t.documentKey,n)}let sz={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class s${static withCacheSize(e){return new s$(e,s$.DEFAULT_COLLECTION_PERCENTILE,s$.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function sK(e,t,n){let r=e.store(tv),i=e.store(tT),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.X({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{ea(1===o,47070,{batchId:n.batchId})}));let u=[];for(let e of n.mutations){var h,c;let r=(h=e.key.path,c=n.batchId,[t,td(h),c]);s.push(i.delete(r)),u.push(e.key)}return e6.waitFor(s).next(()=>u)}function sG(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw ei(14731);t=e.noDocument}return JSON.stringify(t).length}s$.DEFAULT_COLLECTION_PERCENTILE=10,s$.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,s$.DEFAULT=new s$(0x2800000,s$.DEFAULT_COLLECTION_PERCENTILE,s$.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),s$.DISABLED=new s$(-1,0,0);class sQ{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Zn={}}static yt(e,t,n,r){return ea(""!==e.uid,64387),new sQ(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return sH(e).X({index:tb,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=ns(e,tT),s=sH(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;ea("number"==typeof a,49019);let f=new iy(a,t,n,r),g=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>i3(o.gt,e)),d=f.mutations.map(e=>i3(o.gt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),p=[],m=new nf((e,t)=>e_(e.canonicalString(),t.canonicalString()));for(let e of r){let t=(u=this.userId,h=e.key.path,[u,td(h),a]);m=m.add(e.key.path.popLast()),p.push(s.put(g)),p.push(i.put(t,t_))}return m.forEach(t=>{p.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=f.keys()}),e6.waitFor(p).next(()=>f)})}lookupMutationBatch(e,t){return sH(e).get(t).next(e=>e?(ea(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),su(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?e6.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.Zn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return sH(e).X({index:tb,range:r},(e,t,r)=>{t.userId===this.userId&&(ea(t.batchId>=n,47524,{er:n}),i=su(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),n=-1;return sH(e).X({index:tb,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return sH(e).j(tb,t).next(e=>e.map(e=>su(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,td(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return ns(e,tT).X({range:r},(n,r,s)=>{let[a,o,l]=n,u=tf(o);if(a===this.userId&&t.path.isEqual(u))return sH(e).get(l).next(e=>{if(!e)throw ei(61480,{tr:n,batchId:l});ea(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(su(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new nf(e_),r=[];return t.forEach(t=>{let i=[this.userId,td(t.path)],s=IDBKeyRange.lowerBound(i),a=ns(e,tT).X({range:s},(e,r,i)=>{let[s,a,o]=e,l=tf(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),e6.waitFor(r).next(()=>this.nr(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,td(n)],s=IDBKeyRange.lowerBound(i),a=new nf(e_);return ns(e,tT).X({range:s},(e,t,i)=>{let[s,o,l]=e,u=tf(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.nr(e,a))}nr(e,t){let n=[],r=[];return t.forEach(t=>{r.push(sH(e).get(t).next(e=>{if(null===e)throw ei(35274,{batchId:t});ea(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(su(this.serializer,e))}))}),e6.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return sK(e.ce,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.rr(t.batchId)}),e6.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}rr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return e6.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return ns(e,tT).X({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=tf(e[1]);r.push(t)}else n.done()}).next(()=>{ea(0===r.length,56720,{ir:r.map(e=>e.canonicalString())})})})}containsKey(e,t){return sW(e,this.userId,t)}sr(e){return ns(e,ty).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function sW(e,t,n){let r=[t,td(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return ns(e,tT).X({range:s,Z:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function sH(e){return ns(e,tv)}class sX{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new sX(0)}static ur(){return new sX(-1)}}class sJ{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.cr(e).next(t=>{let n=new sX(t.highestTargetId);return t.highestTargetId=n.next(),this.lr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.cr(e).next(e=>ez.fromTimestamp(new ej(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.cr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.cr(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.lr(e,r)))}addTargetData(e,t){return this.hr(e,t).next(()=>this.cr(e).next(n=>(n.targetCount+=1,this.Pr(t,n),this.lr(e,n))))}updateTargetData(e,t){return this.hr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ns(e,tR).delete(t.targetId)).next(()=>this.cr(e)).next(t=>(ea(t.targetCount>0,8065),t.targetCount-=1,this.lr(e,t)))}removeTargets(e,t,n){let r=0,i=[];return ns(e,tR).X((s,a)=>{let o=sh(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>e6.waitFor(i)).next(()=>r)}forEachTarget(e,t){return ns(e,tR).X((e,n)=>{t(sh(n))})}cr(e){return ns(e,tU).get(tB).next(e=>(ea(null!==e,2888),e))}lr(e,t){return ns(e,tU).put(tB,t)}hr(e,t){return ns(e,tR).put(sc(this.serializer,t))}Pr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.cr(e).next(e=>e.targetCount)}getTargetData(e,t){let n=rw(t),r=IDBKeyRange.bound([n,-1/0],[n,1/0]),i=null;return ns(e,tR).X({range:r,index:tO},(e,n,r)=>{let s=sh(n);rb(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=sY(e);return t.forEach(t=>{let s=td(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),e6.waitFor(r)}removeMatchingKeys(e,t,n){let r=sY(e);return e6.forEach(t,t=>{let i=td(t.path);return e6.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=sY(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=sY(e),i=rH();return r.X({range:n,Z:!0},(e,t,n)=>{let r=new ek(tf(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=td(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return sY(e).X({index:tF,Z:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}Et(e,t){return ns(e,tR).get(t).next(e=>e?sh(e):null)}}function sY(e){return ns(e,tL)}let sZ="LruGarbageCollector";function s0([e,t],[n,r]){let i=e_(e,n);return 0===i?e_(t,r):i}class s1{constructor(e){this.Tr=e,this.buffer=new nf(s0),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>s0(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class s2{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Ar=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return null!==this.Ar}Rr(e){ee(sZ,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){te(e)?ee(sZ,"Ignoring IndexedDB error during garbage collection: ",e):await e2(e)}await this.Rr(3e5)})}}class s6{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return e6.resolve(tl.ue);let n=new s1(t);return this.Vr.forEachTarget(e,e=>n.Er(e.sequenceNumber)).next(()=>this.Vr.gr(e,e=>n.Er(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(ee("LruGarbageCollector","Garbage collection skipped; disabled"),e6.resolve(sz)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(ee("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sz):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let n,r,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(ee("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),Y()<=j.LogLevel.DEBUG&&ee("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),e6.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class s3{constructor(e,t){this.db=e,this.garbageCollector=new s6(this,t)}mr(e){let t=this.yr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}yr(e){let t=0;return this.gr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}gr(e,t){return this.wr(e,(e,n)=>t(n))}addReference(e,t,n){return s5(e,n)}removeReference(e,t,n){return s5(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return s5(e,t)}Sr(e,t){let n;return n=!1,ns(e,ty).ee(r=>sW(e,r,t).next(e=>(e&&(n=!0),e6.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.wr(e,(s,a)=>{if(a<=t){let t=this.Sr(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,ez.min()),sY(e).delete([0,td(s.path)])))});r.push(t)}}).next(()=>e6.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return s5(e,t)}wr(e,t){let n=sY(e),r,i=tl.ue;return n.X({index:tF},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==tl.ue&&t(new ek(tf(r)),i),i=a,r=s):i=tl.ue}).next(()=>{i!==tl.ue&&t(new ek(tf(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function s5(e,t){var n;return sY(e).put((n=e.currentSequenceNumber,{targetId:0,path:td(t.path),sequenceNumber:n}))}class s4{constructor(){this.changes=new rq(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,n4.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?e6.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class s8{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return ns(e,tI).put(n)}removeEntry(e,t,n){let r;return ns(e,tI).delete([(r=t.path.toArray()).slice(0,r.length-2),r[r.length-2],sa(n),r[r.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.br(e,n)))}getEntry(e,t){let n=n4.newInvalidDocument(t);return ns(e,tI).X({index:tx,range:IDBKeyRange.only(s9(t))},(e,r)=>{n=this.Dr(t,r)}).next(()=>n)}vr(e,t){let n={size:0,document:n4.newInvalidDocument(t)};return ns(e,tI).X({index:tx,range:IDBKeyRange.only(s9(t))},(e,r)=>{n={document:this.Dr(t,r),size:sG(r)}}).next(()=>n)}getEntries(e,t){let n=rj;return this.Cr(e,t,(e,t)=>{let r=this.Dr(e,t);n=n.insert(e,r)}).next(()=>n)}Fr(e,t){let n=rj,r=new nh(ek.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Dr(e,t);n=n.insert(e,i),r=r.insert(e,sG(t))}).next(()=>({documents:n,Mr:r}))}Cr(e,t,n){if(t.isEmpty())return e6.resolve();let r=new nf(at);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(s9(r.first()),s9(r.last())),s=r.getIterator(),a=s.getNext();return ns(e,tI).X({index:tx,range:i},(e,t,r)=>{let i=ek.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>at(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.G(s9(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),sa(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ns(e,tI).j(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=rj;for(let i of e){let e=this.Dr(ek.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(rV(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=rj,s=ae(t,n),a=ae(t,eY.max());return ns(e,tI).X({index:tC,range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.Dr(ek.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new s7(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return ns(e,tN).get(tk).next(e=>(ea(!!e,20021),e))}br(e,t){return ns(e,tN).put(tk,t)}Dr(e,t){if(t){let e=function(e,t){var n;let r,i;if(t.document)r=i6(e.gt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=ek.fromSegments(t.noDocument.path),n=sl(t.noDocument.readTime);r=n4.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return ei(56709);{let e=ek.fromSegments(t.unknownDocument.path),n=sl(t.unknownDocument.version);r=n4.newUnknownDocument(e,n)}}return t.readTime&&r.setReadTime((i=new ej((n=t.readTime)[0],n[1]),ez.fromTimestamp(i))),r}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(ez.min())))return e}return n4.newInvalidDocument(e)}}class s7 extends s4{constructor(e,t){super(),this.Or=e,this.trackRemovals=t,this.Nr=new rq(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new nf((e,t)=>e_(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Nr.get(i);if(t.push(this.Or.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=ss(this.Or.serializer,s);r=r.add(i.path.popLast());let l=sG(o);n+=l-a.size,t.push(this.Or.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=ss(this.Or.serializer,s.convertToNoDocument(ez.min()));t.push(this.Or.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.Or.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Or.updateMetadata(e,n)),e6.waitFor(t)}getFromCache(e,t){return this.Or.vr(e,t).next(e=>(this.Nr.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Or.Fr(e,t).next(({documents:e,Mr:t})=>(t.forEach((t,n)=>{this.Nr.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function s9(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ae(e,t){let n=t.documentKey.path.toArray();return[e,sa(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function at(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=e_(n[e],r[e]))return i;return(i=e_(n.length,r.length))||(i=e_(n[n.length-2],r[r.length-2]))||e_(n[n.length-1],r[r.length-1])}class an{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ar{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&io(n.mutation,e,nm.empty(),ej.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,rH()).next(()=>t))}getLocalViewOfDocuments(e,t,n=rH()){let r=rG();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=r$();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=rG();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,rH()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=rj,s=rG(),a=rG();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof ih)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),io(a.mutation,t,a.mutation.getFieldMask(),ej.now())):s.set(t.key,nm.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new an(t,null!=(n=s.get(e))?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=rG(),r=new nh((e,t)=>e-t),i=rH();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||nm.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||rH()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=rG();l.forEach(e=>{if(!i.has(e)){let r=ia(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return e6.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return ek.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):rC(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):e6.resolve(rG()),a=-1,o=i;return s.next(t=>e6.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?e6.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,rH())).next(e=>({batchId:a,changes:rK(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ek(t)).next(e=>{let t=r$();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=r$();return this.indexManager.getCollectionParents(e,i).next(a=>e6.forEach(a,a=>{let o=new rS(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,n4.newInvalidDocument(r)))});let n=r$();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&io(s.mutation,r,nm.empty(),ej.now()),rV(t,r)&&(n=n.insert(e,r))}),n})}}class ai{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return e6.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,{id:t.id,version:t.version,createTime:iG(t.createTime)}),e6.resolve()}getNamedQuery(e,t){return e6.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,{name:t.name,query:sd(t.bundledQuery),readTime:iG(t.readTime)}),e6.resolve()}}class as{constructor(){this.overlays=new nh(ek.comparator),this.kr=new Map}getOverlay(e,t){return e6.resolve(this.overlays.get(t))}getOverlays(e,t){let n=rG();return e6.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.wt(e,t,r)}),e6.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.kr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.kr.delete(n)),e6.resolve()}getOverlaysForCollection(e,t,n){let r=rG(),i=t.length+1,s=new ek(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return e6.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new nh((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=rG(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=rG(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return e6.resolve(a)}wt(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.kr.get(r.largestBatchId).delete(n.key);this.kr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new iw(t,n));let i=this.kr.get(t);void 0===i&&(i=rH(),this.kr.set(t,i)),this.kr.set(t,i.add(n.key))}}class aa{constructor(){this.sessionToken=nw.EMPTY_BYTE_STRING}getSessionToken(e){return e6.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,e6.resolve()}}class ao{constructor(){this.qr=new nf(al.Qr),this.$r=new nf(al.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let n=new al(e,t);this.qr=this.qr.add(n),this.$r=this.$r.add(n)}Kr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new al(e,t))}Gr(e,t){e.forEach(e=>this.removeReference(e,t))}zr(e){let t=new ek(new eC([])),n=new al(t,e),r=new al(t,e+1),i=[];return this.$r.forEachInRange([n,r],e=>{this.Wr(e),i.push(e.key)}),i}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new ek(new eC([])),n=new al(t,e),r=new al(t,e+1),i=rH();return this.$r.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new al(e,0),n=this.qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class al{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return ek.comparator(e.key,t.key)||e_(e.Hr,t.Hr)}static Ur(e,t){return e_(e.Hr,t.Hr)||ek.comparator(e.key,t.key)}}class au{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new nf(al.Qr)}checkEmpty(e){return e6.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new iy(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Yr=this.Yr.add(new al(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return e6.resolve(s)}lookupMutationBatch(e,t){return e6.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.Xr(t+1),r=n<0?0:n;return e6.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return e6.resolve(0===this.mutationQueue.length?-1:this.er-1)}getAllMutationBatches(e){return e6.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new al(t,0),r=new al(t,1/0),i=[];return this.Yr.forEachInRange([n,r],e=>{let t=this.Zr(e.Hr);i.push(t)}),e6.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new nf(e_);return t.forEach(e=>{let t=new al(e,0),r=new al(e,1/0);this.Yr.forEachInRange([t,r],e=>{n=n.add(e.Hr)})}),e6.resolve(this.ei(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;ek.isDocumentKey(i)||(i=i.child(""));let s=new al(new ek(i),0),a=new nf(e_);return this.Yr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Hr)),!0)},s),e6.resolve(this.ei(a))}ei(e){let t=[];return e.forEach(e=>{let n=this.Zr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){ea(0===this.ti(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Yr;return e6.forEach(t.mutations,r=>{let i=new al(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Yr=n})}rr(e){}containsKey(e,t){let n=new al(t,0),r=this.Yr.firstAfterOrEqual(n);return e6.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,e6.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ah{constructor(e){this.ni=e,this.docs=new nh(ek.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ni(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return e6.resolve(n?n.document.mutableCopy():n4.newInvalidDocument(t))}getEntries(e,t){let n=rj;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():n4.newInvalidDocument(e))}),e6.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=rj,s=t.path,a=new ek(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=eZ(eJ(a),n)||(r.has(a.key)||rV(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return e6.resolve(i)}getAllFromCollectionGroup(e,t,n,r){ei(9500)}ri(e,t){return e6.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new ac(this)}getSize(e){return e6.resolve(this.size)}}class ac extends s4{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Or.addEntry(e,r)):this.Or.removeEntry(n)}),e6.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class ad{constructor(e){this.persistence=e,this.ii=new rq(e=>rw(e),rb),this.lastRemoteSnapshotVersion=ez.min(),this.highestTargetId=0,this.si=0,this.oi=new ao,this.targetCount=0,this._i=sX.ar()}forEachTarget(e,t){return this.ii.forEach((e,n)=>t(n)),e6.resolve()}getLastRemoteSnapshotVersion(e){return e6.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return e6.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),e6.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.si&&(this.si=t),e6.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new sX(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,e6.resolve()}updateTargetData(e,t){return this.hr(t),e6.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,e6.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.ii.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.ii.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),e6.waitFor(i).next(()=>r)}getTargetCount(e){return e6.resolve(this.targetCount)}getTargetData(e,t){let n=this.ii.get(t)||null;return e6.resolve(n)}addMatchingKeys(e,t,n){return this.oi.Kr(t,n),e6.resolve()}removeMatchingKeys(e,t,n){this.oi.Gr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),e6.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),e6.resolve()}getMatchingKeysForTargetId(e,t){let n=this.oi.Jr(t);return e6.resolve(n)}containsKey(e,t){return e6.resolve(this.oi.containsKey(t))}}class af{constructor(e,t){this.ai={},this.overlays={},this.ui=new tl(0),this.ci=!1,this.ci=!0,this.li=new aa,this.referenceDelegate=e(this),this.hi=new ad(this),this.indexManager=new sF,this.remoteDocumentCache=new ah(e=>this.referenceDelegate.Pi(e)),this.serializer=new si(t),this.Ti=new ai(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new as,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ai[e.toKey()];return n||(n=new au(t,this.referenceDelegate),this.ai[e.toKey()]=n),n}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,n){ee("MemoryPersistence","Starting transaction:",e);let r=new ag(this.ui.next());return this.referenceDelegate.Ii(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ei(e,t){return e6.or(Object.values(this.ai).map(n=>()=>n.containsKey(e,t)))}}class ag extends e1{constructor(e){super(),this.currentSequenceNumber=e}}class ap{constructor(e){this.persistence=e,this.Ai=new ao,this.Ri=null}static Vi(e){return new ap(e)}get mi(){if(this.Ri)return this.Ri;throw ei(60996)}addReference(e,t,n){return this.Ai.addReference(n,t),this.mi.delete(n.toString()),e6.resolve()}removeReference(e,t,n){return this.Ai.removeReference(n,t),this.mi.add(n.toString()),e6.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),e6.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(e=>this.mi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.mi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return e6.forEach(this.mi,n=>{let r=ek.fromPath(n);return this.fi(e,r).next(e=>{e||t.removeEntry(r,ez.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(e=>{e?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return e6.or([()=>e6.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class am{constructor(e,t){this.persistence=e,this.gi=new rq(e=>td(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new s6(this,t)}static Vi(e,t){return new am(e,t)}Ii(){}di(e){return e6.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}yr(e){let t=0;return this.gr(e,e=>{t++}).next(()=>t)}gr(e,t){return e6.forEach(this.gi,(n,r)=>this.Sr(e,n,r).next(e=>e?e6.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ri(e,r=>this.Sr(e,r,t).next(e=>{e||(n++,i.removeEntry(r,ez.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),e6.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),e6.resolve()}removeReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),e6.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),e6.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(nU(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=nD(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return nT(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,no(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw ei(13486,{value:t})}}(e.data.value)),t}Sr(e,t,n){return e6.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.gi.get(t);return e6.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ay{constructor(e){this.serializer=e}q(e,t,n,r){let i=new e5("createOrUpgrade",t);n<1&&r>=1&&(e.createObjectStore(tp),e.createObjectStore(ty,{keyPath:"userId"}),e.createObjectStore(tv,{keyPath:tw,autoIncrement:!0}).createIndex(tb,tE,{unique:!0}),e.createObjectStore(tT),av(e),e.createObjectStore(tg));let s=e6.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore(tL),e.deleteObjectStore(tR),e.deleteObjectStore(tU),av(e)),s=s.next(()=>{let e,t;return e=i.store(tU),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ez.min().toTimestamp(),targetCount:0},e.put(tB,t)})),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store(tv).j().next(t=>{e.deleteObjectStore(tv),e.createObjectStore(tv,{keyPath:tw,autoIncrement:!0}).createIndex(tb,tE,{unique:!0});let n=i.store(tv),r=t.map(e=>n.put(e));return e6.waitFor(r)}))),s=s.next(()=>{e.createObjectStore(tz,{keyPath:"clientId"})})),n<5&&r>=5&&(s=s.next(()=>this.pi(i))),n<6&&r>=6&&(s=s.next(()=>(e.createObjectStore(tN),this.yi(i)))),n<7&&r>=7&&(s=s.next(()=>this.wi(i))),n<8&&r>=8&&(s=s.next(()=>this.Si(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.bi(i))),n<11&&r>=11&&(s=s.next(()=>{e.createObjectStore(t$,{keyPath:"bundleId"}),e.createObjectStore(tK,{keyPath:"name"})})),n<12&&r>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(t2,{keyPath:t6})).createIndex(t3,t5,{unique:!1}),t.createIndex(t4,t8,{unique:!1})})),n<13&&r>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(tI,{keyPath:tS})).createIndex(tx,tA),t.createIndex(tC,tD)}).next(()=>this.Di(e,i)).next(()=>e.deleteObjectStore(tg))),n<14&&r>=14&&(s=s.next(()=>this.Ci(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore(tG,{keyPath:"indexId",autoIncrement:!0}).createIndex(tQ,"collectionGroup",{unique:!1}),e.createObjectStore(tW,{keyPath:tH}).createIndex(tX,tJ,{unique:!1}),e.createObjectStore(tY,{keyPath:tZ}).createIndex(t0,t1,{unique:!1})})),n<16&&r>=16&&(s=s.next(()=>{t.objectStore(tW).clear()}).next(()=>{t.objectStore(tY).clear()})),n<17&&r>=17&&(s=s.next(()=>{e.createObjectStore(t7,{keyPath:"name"})})),n<18&&r>=18&&M()&&(s=s.next(()=>{t.objectStore(tW).clear()}).next(()=>{t.objectStore(tY).clear()})),s}yi(e){let t=0;return e.store(tg).X((e,n)=>{t+=sG(n)}).next(()=>{let n={byteSize:t};return e.store(tN).put(tk,n)})}pi(e){let t=e.store(ty),n=e.store(tv);return t.j().next(t=>e6.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.j(tb,r).next(n=>e6.forEach(n,n=>{ea(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});let r=su(this.serializer,n);return sK(e,t.userId,r).next(()=>{})}))}))}wi(e){let t=e.store(tL),n=e.store(tg);return e.store(tU).get(tB).next(e=>{let r=[];return n.X((n,i)=>{let s=new eC(n),a=[0,td(s)];r.push(t.get(a).next(n=>n?e6.resolve():t.put({targetId:0,path:td(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>e6.waitFor(r))})}Si(e,t){e.createObjectStore(tq,{keyPath:tj});let n=t.store(tq),r=new sV,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:td(r)})}};return t.store(tg).X({Z:!0},(e,t)=>i(new eC(e).popLast())).next(()=>t.store(tT).X({Z:!0},([e,t,n],r)=>i(tf(t).popLast())))}bi(e){let t=e.store(tR);return t.X((e,n)=>{let r=sh(n),i=sc(this.serializer,r);return t.put(i)})}Di(e,t){let n=t.store(tg),r=[];return n.X((e,n)=>{let i=t.store(tI),s=(n.document?new ek(eC.fromString(n.document.name).popFirst(5)):n.noDocument?ek.fromSegments(n.noDocument.path):n.unknownDocument?ek.fromSegments(n.unknownDocument.path):ei(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>e6.waitFor(r))}Ci(e,t){let n=t.store(tv),r=new s8(this.serializer),i=new af(ap.Vi,this.serializer.gt);return n.j().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!=(t=n.get(e.userId))?t:rH();su(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),e6.forEach(n,(e,n)=>{let s=new H(n),a=sy.yt(this.serializer,s),o=i.getIndexManager(s);return new ar(r,sQ.yt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new ni(t,tl.ue),e).next()})})}}function av(e){e.createObjectStore(tL,{keyPath:tP}).createIndex(tF,tV,{unique:!0}),e.createObjectStore(tR,{keyPath:"targetId"}).createIndex(tO,tM,{unique:!0}),e.createObjectStore(tU)}let aw="IndexedDbPersistence",ab="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",aE="main";class a_{constructor(e,t,n,r,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Fi=i,this.window=s,this.document=a,this.Mi=l,this.xi=u,this.Oi=h,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=-1/0,this.qi=e=>Promise.resolve(),!a_.C())throw new eu(el.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new s3(this,r),this.Qi=t+aE,this.serializer=new si(o),this.$i=new e4(this.Qi,this.Oi,new ay(this.serializer)),this.li=new sv,this.hi=new sJ(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new s8(this.serializer),this.Ti=new sm,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&et(aw,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new eu(el.FAILED_PRECONDITION,ab);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.hi.getHighestSequenceNumber(e))}).then(e=>{this.ui=new tl(e,this.Mi)}).then(()=>{this.ci=!0}).catch(e=>(this.$i&&this.$i.close(),Promise.reject(e)))}ji(e){return this.qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.$i.setDatabaseDeletedListener(e)}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Fi.enqueueAndForget(async()=>{this.started&&await this.Ki()}))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ns(e,tz).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(e).next(e=>{e||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Yi(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(te(e))return ee(aw,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ee(aw,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Fi.enqueueRetryable(()=>this.qi(e)),this.isPrimary=e})}Ji(e){return ns(e,tp).get(tm).next(e=>e6.resolve(this.Xi(e)))}es(e){return ns(e,tz).delete(this.clientId)}async ts(){if(this.isPrimary&&!this.ns(this.ki,18e5)){this.ki=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=ns(e,tz);return t.j().next(e=>{let n=this.rs(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return e6.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.ss(t.clientId))}}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.xi?e6.resolve(!0):ns(e,tp).get(tm).next(t=>{if(null!==t&&this.ns(t.leaseTimestampMs,5e3)&&!this._s(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new eu(el.FAILED_PRECONDITION,ab);return!1}}return!(!this.networkEnabled||!this.inForeground)||ns(e,tz).j().next(e=>void 0===this.rs(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&ee(aw,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),await this.$i.runTransaction("shutdown","readwrite",[tp,tz],e=>{let t=new ni(e,tl.ue);return this.Yi(t).next(()=>this.es(t))}),this.$i.close(),this.hs()}rs(e,t){return e.filter(e=>this.ns(e.updateTimeMs,t)&&!this._s(e.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",e=>ns(e,tz).j().next(e=>this.rs(e,18e5).map(e=>e.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(e,t){return sQ.yt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new sq(e,this.serializer.gt.databaseId)}getDocumentOverlayCache(e){return sy.yt(this.serializer,e)}getBundleCache(){return this.Ti}runTransaction(e,t,n){var r;let i;ee(aw,"Starting transaction:",e);let s=18===(r=this.Oi)||17===r?nr:16===r||15===r?nn:14===r||13===r?nt:12===r?ne:11===r?t9:void ei(60245);return this.$i.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new ni(r,this.ui?this.ui.next():tl.ue),"readwrite-primary"===t?this.Ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw et(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new eu(el.FAILED_PRECONDITION,e0);return n(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ts(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ts(e){return ns(e,tp).get(tm).next(e=>{if(null!==e&&this.ns(e.leaseTimestampMs,5e3)&&!this._s(e.ownerId)&&!this.Xi(e)&&!(this.xi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new eu(el.FAILED_PRECONDITION,ab)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ns(e,tp).put(tm,t)}static C(){return e4.C()}Yi(e){let t=ns(e,tp);return t.get(tm).next(e=>this.Xi(e)?(ee(aw,"Releasing primary lease."),t.delete(tm)):e6.resolve())}ns(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(et(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground="visible"===this.document.visibilityState)}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.Ni=()=>{this.us();let e=/(?:Version|Mobile)\/1[456]/;O()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(e){var t;try{let n=null!==(null==(t=this.Ui)?void 0:t.getItem(this.ss(e)));return ee(aw,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return et(aw,"Failed to get zombied client id.",e),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(e){et("Failed to set zombie client id.",e)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch(e){}}ss(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function aT(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class aI{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Is=n,this.ds=r}static Es(e,t){let n=rH(),r=rH();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new aI(e,t.fromCache,n,r)}}class aS{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ax{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=O()?8:e8(k())>0?6:4}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ps(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ys(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new aS;return this.ws(e,t,n).next(r=>{if(i.result=r,this.Rs)return this.Ss(e,t,n,r.size)})}).next(()=>i.result)}Ss(e,t,n,r){return n.documentReadCount<this.Vs?(Y()<=j.LogLevel.DEBUG&&ee("QueryEngine","SDK will not create cache indexes for query:",rF(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),e6.resolve()):(Y()<=j.LogLevel.DEBUG&&ee("QueryEngine","Query:",rF(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.fs*r?(Y()<=j.LogLevel.DEBUG&&ee("QueryEngine","The SDK decides to create cache indexes for query:",rF(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,rN(t))):e6.resolve())}ps(e,t){if(rA(t))return e6.resolve(null);let n=rN(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=rN(t=rM(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=rH(...r);return this.gs.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.bs(t,r);return this.Ds(t,s,i,n.readTime)?this.ps(e,rM(t,null,"F")):this.vs(e,s,t,n)}))})))}ys(e,t,n,r){return rA(t)||r.isEqual(ez.min())?e6.resolve(null):this.gs.getDocuments(e,n).next(i=>{let s=this.bs(t,i);return this.Ds(t,s,n,r)?e6.resolve(null):(Y()<=j.LogLevel.DEBUG&&ee("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),rF(t)),this.vs(e,s,t,eX(r,-1)).next(e=>e))})}bs(e,t){let n=new nf(rU(e));return t.forEach((t,r)=>{rV(e,r)&&(n=n.add(r))}),n}Ds(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}ws(e,t,n){return Y()<=j.LogLevel.DEBUG&&ee("QueryEngine","Using full collection scan to execute query:",rF(t)),this.gs.getDocumentsMatchingQuery(e,t,eY.min(),n)}vs(e,t,n,r){return this.gs.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let aA="LocalStore";class aC{constructor(e,t,n,r){this.persistence=e,this.Cs=t,this.serializer=r,this.Fs=new nh(e_),this.Ms=new rq(e=>rw(e),rb),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(n)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ar(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}}async function aD(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Ns(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=rH();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({Bs:e,removedBatchIds:i,addedBatchIds:s}))})})}function aN(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function ak(e,t,n){let r=rH(),i=rH();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=rj;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(ez.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):ee(aA,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{Ls:r,ks:i}})}function aR(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.hi.getTargetData(n,t).next(i=>i?(r=i,e6.resolve(r)):e.hi.allocateTargetId(n).next(i=>(r=new sr(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.hi.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.Fs.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.Fs=e.Fs.insert(n.targetId,n),e.Ms.set(t,n.targetId)),n})}async function aO(e,t,n){let r=e.Fs.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!te(e))throw e;ee(aA,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Fs=e.Fs.remove(t),e.Ms.delete(r.target)}function aM(e,t,n){let r=ez.min(),i=rH();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=rN(t),void 0!==(o=e.Ms.get(a))?e6.resolve(e.Fs.get(o)):e.hi.getTargetData(s,a)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.hi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,n?r:ez.min(),n?i:rH())).next(n=>(aF(e,rB(t),n),{documents:n,qs:i}))})}function aL(e,t){let n=e.hi,r=e.Fs.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n.Et(e,t).next(e=>e?e.target:null))}function aP(e,t){let n=e.xs.get(t)||ez.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.Os.getAllFromCollectionGroup(r,t,eX(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(aF(e,t,n),n))}function aF(e,t,n){let r=e.xs.get(t)||ez.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.xs.set(t,r)}async function aV(e,t,n,r){let i=rH(),s=rj;for(let e of n){let n=t.Qs(e.metadata.name);e.document&&(i=i.add(n));let r=t.$s(e);r.setReadTime(t.Us(e.metadata.readTime)),s=s.insert(n,r)}let a=e.Os.newChangeBuffer({trackRemovals:!0}),o=await aR(e,rN(rx(eC.fromString(`__bundle__/docs/${r}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>ak(t,a,s).next(e=>(a.apply(t),e)).next(n=>e.hi.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.hi.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.Ls,n.ks)).next(()=>n.Ls)))}async function aB(e,t,n=rH()){let r=await aR(e,rN(sd(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=iG(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.Ti.saveNamedQuery(i,t);let a=r.withResumeToken(nw.EMPTY_BYTE_STRING,s);return e.Fs=e.Fs.insert(a.targetId,a),e.hi.updateTargetData(i,a).next(()=>e.hi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.hi.addMatchingKeys(i,n,r.targetId)).next(()=>e.Ti.saveNamedQuery(i,t))})}let aU="firestore_clients";function aq(e,t){return`${aU}_${e}_${t}`}let aj="firestore_mutations";function az(e,t,n){let r=`${aj}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}let a$="firestore_targets";function aK(e,t){return`${a$}_${e}_${t}`}let aG="SharedClientState";class aQ{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Ks(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new eu(r.error.code,r.error.message)),s?new aQ(e,t,r.state,i):(et(aG,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class aW{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ks(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new eu(n.error.code,n.error.message)),i?new aW(e,n.state,r):(et(aG,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class aH{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ks(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=rX;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=tc(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new aH(e,i):(et(aG,`Failed to parse client data for instance '${e}': ${t}`),null)}}class aX{constructor(e,t){this.clientId=e,this.onlineState=t}static Ks(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new aX(t.clientId,t.onlineState):(et(aG,`Failed to parse online state: ${e}`),null)}}class aJ{constructor(){this.activeTargetIds=rX}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class aY{constructor(e,t,n,r,i){var s,a,o;this.window=e,this.Fi=t,this.persistenceKey=n,this.js=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new nh(e_),this.started=!1,this.Zs=[];const l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=aq(this.persistenceKey,this.js),this.eo=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Ys=this.Ys.insert(this.js,new aJ),this.no=RegExp(`^${aU}_${l}_([^_]*)$`),this.ro=RegExp(`^${aj}_${l}_(\\d+)(?:_(.*))?$`),this.io=RegExp(`^${a$}_${l}_(\\d+)$`),this.so=(a=this.persistenceKey,`firestore_online_state_${a}`),this.oo=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.Js)}static C(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.Ps())){if(e===this.js)continue;let t=this.getItem(aq(this.persistenceKey,e));if(t){let n=aH.Ks(e,t);n&&(this.Ys=this.Ys.insert(n.clientId,n))}}this._o();let e=this.storage.getItem(this.so);if(e){let t=this.ao(e);t&&this.uo(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.eo,JSON.stringify(e))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(e){let t=!1;return this.Ys.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.lo(e,"pending")}updateMutationState(e,t,n){this.lo(e,t,n),this.ho(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(aK(this.persistenceKey,e));if(t){let r=aW.Ks(e,t);r&&(n=r.state)}}return t&&this.Po.Gs(e),this._o(),n}removeLocalQueryTarget(e){this.Po.zs(e),this._o()}isLocalQueryTarget(e){return this.Po.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(aK(this.persistenceKey,e))}updateQueryState(e,t,n){this.To(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.ho(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Io(e)}notifyBundleLoaded(e){this.Eo(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return ee(aG,"READ",e,t),t}setItem(e,t){ee(aG,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){ee(aG,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(ee(aG,"EVENT",e.key,e.newValue),e.key===this.Xs)return void et("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.no.test(e.key)){if(null==e.newValue){let t=this.Ao(e.key);return this.Ro(t,null)}{let t=this.Vo(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.mo(e.key,e.newValue);if(t)return this.fo(t)}}else if(this.io.test(e.key)){if(null!==e.newValue){let t=this.po(e.key,e.newValue);if(t)return this.yo(t)}}else if(e.key===this.so){if(null!==e.newValue){let t=this.ao(e.newValue);if(t)return this.uo(t)}}else if(e.key===this.eo){let t=function(e){let t=tl.ue;if(null!=e)try{let n=JSON.parse(e);ea("number"==typeof n,30636,{wo:e}),t=n}catch(e){et(aG,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==tl.ue&&this.sequenceNumberHandler(t)}else if(e.key===this.oo){let t=this.So(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(e,t,n){let r=new aQ(this.currentUser,e,t,n),i=az(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ws())}ho(e){let t=az(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Io(e){let t={clientId:this.js,onlineState:e};this.storage.setItem(this.so,JSON.stringify(t))}To(e,t,n){let r=aK(this.persistenceKey,e),i=new aW(e,t,n);this.setItem(r,i.Ws())}Eo(e){let t=JSON.stringify(Array.from(e));this.setItem(this.oo,t)}Ao(e){let t=this.no.exec(e);return t?t[1]:null}Vo(e,t){let n=this.Ao(e);return aH.Ks(n,t)}mo(e,t){let n=this.ro.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return aQ.Ks(new H(i),r,t)}po(e,t){let n=Number(this.io.exec(e)[1]);return aW.Ks(n,t)}ao(e){return aX.Ks(e)}So(e){return JSON.parse(e)}async fo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Do(e.batchId,e.state,e.error);ee(aG,`Ignoring mutation for non-active user ${e.user.uid}`)}yo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Ro(e,t){let n=t?this.Ys.insert(e,t):this.Ys.remove(e),r=this.co(this.Ys),i=this.co(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Co(s,a).then(()=>{this.Ys=n})}uo(e){this.Ys.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}co(e){let t=rX;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class aZ{constructor(){this.Fo=new aJ,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,n){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new aJ,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class a0{xo(e){}shutdown(){}}let a1="ConnectivityMonitor";class a2{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){for(let e of(ee(a1,"Network connectivity changed: AVAILABLE"),this.ko))e(0)}Lo(){for(let e of(ee(a1,"Network connectivity changed: UNAVAILABLE"),this.ko))e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let a6=null;function a3(){return null===a6?a6=0x10000000+Math.round(0x80000000*Math.random()):a6++,"0x"+a6.toString(16)}let a5="RestConnection",a4={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class a8{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${n}/databases/${r}`,this.Ko=this.databaseId.database===nR?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Wo(e,t,n,r,i){let s=a3(),a=this.Go(e,t.toUriEncodedString());ee(a5,`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(o,r,i);let{host:l}=new URL(a),u=A(l);return this.jo(e,a,o,n,u).then(t=>(ee(a5,`Received RPC '${e}' ${s}: `,t),t),t=>{throw en(a5,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}Jo(e,t,n,r,i,s){return this.Wo(e,t,n,r,i)}zo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+X,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Go(e,t){let n=a4[e];return`${this.$o}/v1/${t}:${n}`}terminate(){}}class a7{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}let a9="WebChannelConnection";class oe extends a8{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,n,i,o){let l=a3();return new Promise((o,u)=>{let h=new r;h.setWithCredentials(!0),h.listenOnce(s.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case a.NO_ERROR:let t=h.getResponseJson();ee(a9,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(t)),o(t);break;case a.TIMEOUT:ee(a9,`RPC '${e}' ${l} timed out`),u(new eu(el.DEADLINE_EXCEEDED,"Request time out"));break;case a.HTTP_ERROR:let n=h.getStatus();if(ee(a9,`RPC '${e}' ${l} failed with status:`,n,"response text:",h.getResponseText()),n>0){let e=h.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(el).indexOf(e)>=0?e:el.UNKNOWN);u(new eu(n,t.message))}else u(new eu(el.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new eu(el.UNAVAILABLE,"Connection failed."));break;default:ei(9055,{c_:e,streamId:l,l_:h.getLastErrorCode(),h_:h.getLastError()})}}finally{ee(a9,`RPC '${e}' ${l} completed.`)}});let c=JSON.stringify(i);ee(a9,`RPC '${e}' ${l} sending request:`,i),h.send(t,"POST",c,n,15)})}P_(e,t,n){let r=a3(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=h(),d=u(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;void 0!==g&&(f.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(f.useFetchStreams=!0),this.zo(f.initMessageHeaders,t,n),f.encodeInitMessageHeaders=!0;let p=s.join("");ee(a9,`Creating RPC '${e}' stream ${r}: ${p}`,f);let m=a.createWebChannel(p,f);this.T_(m);let y=!1,v=!1,w=new a7({Ho:t=>{v?ee(a9,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(y||(ee(a9,`Opening RPC '${e}' stream ${r} transport.`),m.open(),y=!0),ee(a9,`RPC '${e}' stream ${r} sending:`,t),m.send(t))},Yo:()=>m.close()}),b=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return b(m,i.EventType.OPEN,()=>{v||(ee(a9,`RPC '${e}' stream ${r} transport opened.`),w.s_())}),b(m,i.EventType.CLOSE,()=>{v||(v=!0,ee(a9,`RPC '${e}' stream ${r} transport closed`),w.__(),this.I_(m))}),b(m,i.EventType.ERROR,t=>{v||(v=!0,en(a9,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),w.__(new eu(el.UNAVAILABLE,"The operation could not be completed")))}),b(m,i.EventType.MESSAGE,t=>{var n;if(!v){let i=t.data[0];ea(!!i,16349);let s=(null==i?void 0:i.error)||(null==(n=i[0])?void 0:n.error);if(s){ee(a9,`RPC '${e}' stream ${r} received error:`,s);let t=s.status,n=function(e){let t=c[e];if(void 0!==t)return iT(t)}(t),i=s.message;void 0===n&&(n=el.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),v=!0,w.__(new eu(n,i)),m.close()}else ee(a9,`RPC '${e}' stream ${r} received:`,i),w.a_(i)}}),b(d,l.STAT_EVENT,t=>{t.stat===o.PROXY?ee(a9,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===o.NOPROXY&&ee(a9,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{w.o_()},0),w}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}}function ot(){return"undefined"!=typeof window?window:null}function on(){return"undefined"!=typeof document?document:null}function or(e){return new ij(e,!0)}class oi{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Fi=e,this.timerId=t,this.d_=n,this.E_=r,this.A_=i,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),n=Math.max(0,Date.now()-this.m_),r=Math.max(0,t-n);r>0&&ee("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,r,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){null!==this.V_&&(this.V_.skipDelay(),this.V_=null)}cancel(){null!==this.V_&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}let os="PersistentStream";class oa{constructor(e,t,n,r,i,s,a,o){this.Fi=e,this.w_=n,this.S_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new oi(e,t)}M_(){return 1===this.state||5===this.state||this.x_()}x_(){return 2===this.state||3===this.state}start(){this.C_=0,4!==this.state?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&null===this.D_&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,4!==e?this.F_.reset():t&&t.code===el.RESOURCE_EXHAUSTED?(et(t.toString()),et("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===el.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.b_===t&&this.W_(e,n)},t=>{e(()=>{let e=new eu(el.UNKNOWN,"Fetching auth token failed: "+t.message);return this.G_(e)})})}W_(e,t){let n=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.e_(()=>{n(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(e=>{n(()=>this.G_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.C_?this.j_(e):this.onNext(e))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return ee(os,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(ee(os,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class oo extends oa{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:ei(39313,{state:r}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(ea(void 0===i||"string"==typeof i,58123),nw.fromBase64String(i||"")):(ea(void 0===i||i instanceof m.Buffer||i instanceof Uint8Array,16193),nw.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new iM(s,a,o,l&&new eu(void 0===l.code?el.UNKNOWN:iT(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=iJ(e,r.document.name),s=iG(r.document.updateTime),a=r.document.createTime?iG(r.document.createTime):ez.min(),o=new n5({mapValue:{fields:r.document.fields}}),l=n4.newFoundDocument(i,s,a,o);n=new iR(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=iJ(e,r.document),s=r.readTime?iG(r.readTime):ez.min(),a=n4.newNoDocument(i,s);n=new iR([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=iJ(e,r.document);n=new iR([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return ei(11601,{At:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new iE(r,i);n=new iO(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ez.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?ez.min():t.readTime?iG(t.readTime):ez.min()}(e);return this.listener.J_(t,n)}H_(e){let t,n={};n.database=i0(this.serializer),n.addTarget=function(e,t){let n,r=t.target;if((n=rE(r)?{documents:i4(e,r)}:{query:i8(e,r).Vt}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=iK(e,t.resumeToken);let r=iz(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ez.min())>0){n.readTime=i$(e,t.snapshotVersion.toTimestamp());let r=iz(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ei(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.k_(n)}Y_(e){let t={};t.database=i0(this.serializer),t.removeTarget=e,this.k_(t)}}class ol extends oa{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return ea(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ea(!e.writeResults||0===e.writeResults.length,55816),this.listener.ea()}onNext(e){var t,n;ea(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(ea(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?iG(e.updateTime):iG(n)).isEqual(ez.min())&&(t=iG(n)),new it(t,e.transformResults||[])})):[]),i=iG(e.commitTime);return this.listener.ta(i,r)}na(){let e={};e.database=i0(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>i3(this.serializer,e))};this.k_(t)}}class ou{}class oh extends ou{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ra=!1}ia(){if(this.ra)throw new eu(el.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,r){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,iW(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===el.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new eu(el.UNKNOWN,e.toString())})}Jo(e,t,n,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Jo(e,iW(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===el.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new eu(el.UNKNOWN,e.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class oc{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){0===this.sa&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){"Online"===this.state?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,"Online"===e&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(et(t),this._a=!1):ee("OnlineStateTracker",t)}ha(){null!==this.oa&&(this.oa.cancel(),this.oa=null)}}let od="RemoteStore";class of{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=i,this.Ea.xo(e=>{n.enqueueAndForget(async()=>{o_(this)&&(ee(od,"Restarting streams for network reachability change."),await async function(e){e.Ia.add(4),await op(e),e.Aa.set("Unknown"),e.Ia.delete(4),await og(e)}(this))})}),this.Aa=new oc(n,r)}}async function og(e){if(o_(e))for(let t of e.da)await t(!0)}async function op(e){for(let t of e.da)await t(!1)}function om(e,t){e.Ta.has(t.targetId)||(e.Ta.set(t.targetId,t),oE(e)?ob(e):oV(e).x_()&&ov(e,t))}function oy(e,t){let n=oV(e);e.Ta.delete(t),n.x_()&&ow(e,t),0===e.Ta.size&&(n.x_()?n.B_():o_(e)&&e.Aa.set("Unknown"))}function ov(e,t){if(e.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ez.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}oV(e).H_(t)}function ow(e,t){e.Ra.$e(t),oV(e).Y_(t)}function ob(e){e.Ra=new iP({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Ta.get(t)||null,lt:()=>e.datastore.serializer.databaseId}),oV(e).start(),e.Aa.aa()}function oE(e){return o_(e)&&!oV(e).M_()&&e.Ta.size>0}function o_(e){return 0===e.Ia.size}async function oT(e){e.Aa.set("Online")}async function oI(e){e.Ta.forEach((t,n)=>{ov(e,t)})}async function oS(e,t){e.Ra=void 0,oE(e)?(e.Aa.la(t),ob(e)):e.Aa.set("Unknown")}async function ox(e,t,n){if(e.Aa.set("Online"),t instanceof iM&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ta.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ta.delete(r),e.Ra.removeTarget(r))}(e,t)}catch(n){ee(od,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await oA(e,n)}else if(t instanceof iR?e.Ra.Ye(t):t instanceof iO?e.Ra.it(t):e.Ra.et(t),!n.isEqual(ez.min()))try{let t,r=await aN(e.localStore);n.compareTo(r)>=0&&await ((t=e.Ra.Pt(n)).targetChanges.forEach((t,r)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ta.get(r);i&&e.Ta.set(r,i.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let r=e.Ta.get(t);if(!r)return;e.Ta.set(t,r.withResumeToken(nw.EMPTY_BYTE_STRING,r.snapshotVersion)),ow(e,t);let i=new sr(r.target,t,n,r.sequenceNumber);ov(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){ee(od,"Failed to raise snapshot:",t),await oA(e,t)}}async function oA(e,t,n){if(!te(t))throw t;e.Ia.add(1),await op(e),e.Aa.set("Offline"),n||(n=()=>aN(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{ee(od,"Retrying IndexedDB access"),await n(),e.Ia.delete(1),await og(e)})}function oC(e,t){return t().catch(n=>oA(e,n,t))}async function oD(e){var t;let n=oB(e),r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:-1;for(;o_(t=e)&&t.Pa.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Pa.length&&n.B_();break}r=t.batchId,function(e,t){e.Pa.push(t);let n=oB(e);n.x_()&&n.Z_&&n.X_(t.mutations)}(e,t)}catch(t){await oA(e,t)}oN(e)&&ok(e)}function oN(e){return o_(e)&&!oB(e).M_()&&e.Pa.length>0}function ok(e){oB(e).start()}async function oR(e){oB(e).na()}async function oO(e){let t=oB(e);for(let n of e.Pa)t.X_(n.mutations)}async function oM(e,t,n){let r=e.Pa.shift(),i=iv.from(r,t,n);await oC(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await oD(e)}async function oL(e,t){t&&oB(e).Z_&&await async function(e,t){var n;if(i_(n=t.code)&&n!==el.ABORTED){let n=e.Pa.shift();oB(e).N_(),await oC(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await oD(e)}}(e,t),oN(e)&&ok(e)}async function oP(e,t){e.asyncQueue.verifyOperationInProgress(),ee(od,"RemoteStore received new credentials");let n=o_(e);e.Ia.add(3),await op(e),n&&e.Aa.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ia.delete(3),await og(e)}async function oF(e,t){t?(e.Ia.delete(2),await og(e)):t||(e.Ia.add(2),await op(e),e.Aa.set("Unknown"))}function oV(e){var t,n,r;return e.Va||(t=e.datastore,n=e.asyncQueue,r={Zo:oT.bind(null,e),e_:oI.bind(null,e),n_:oS.bind(null,e),J_:ox.bind(null,e)},t.ia(),e.Va=new oo(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.Va.N_(),oE(e)?ob(e):e.Aa.set("Unknown")):(await e.Va.stop(),e.Ra=void 0)})),e.Va}function oB(e){var t,n,r;return e.ma||(t=e.datastore,n=e.asyncQueue,r={Zo:()=>Promise.resolve(),e_:oR.bind(null,e),n_:oL.bind(null,e),ea:oO.bind(null,e),ta:oM.bind(null,e)},t.ia(),e.ma=new ol(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.ma.N_(),await oD(e)):(await e.ma.stop(),e.Pa.length>0&&(ee(od,`Stopping write stream with ${e.Pa.length} pending writes`),e.Pa=[]))})),e.ma}class oU{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new eh,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new oU(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new eu(el.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function oq(e,t){if(et("AsyncQueue",`${t}: ${e}`),te(e))return new eu(el.UNAVAILABLE,`${t}: ${e}`);throw e}class oj{static emptySet(e){return new oj(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||ek.comparator(t.key,n.key):(e,t)=>ek.comparator(e.key,t.key),this.keyedMap=r$(),this.sortedSet=new nh(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof oj)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new oj;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class oz{constructor(){this.fa=new nh(ek.comparator)}track(e){let t=e.doc.key,n=this.fa.get(t);n?0!==e.type&&3===n.type?this.fa=this.fa.insert(t,e):3===e.type&&1!==n.type?this.fa=this.fa.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.fa=this.fa.remove(t):1===e.type&&2===n.type?this.fa=this.fa.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):ei(63341,{At:e,ga:n}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,n)=>{e.push(n)}),e}}class o${constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new o$(e,t,oj.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&rL(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class oK{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class oG{constructor(){this.queries=oQ(),this.onlineState="Unknown",this.Da=new Set}terminate(){var e;let t;e=new eu(el.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=oQ(),t.forEach((t,n)=>{for(let t of n.wa)t.onError(e)})}}function oQ(){return new rq(e=>rP(e),rL)}async function oW(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.Sa()&&t.ba()&&(n=2):(i=new oK,n=+!t.ba());try{switch(n){case 0:i.ya=await e.onListen(r,!0);break;case 1:i.ya=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=oq(n,`Initialization of query '${rF(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.wa.push(t),t.va(e.onlineState),i.ya&&t.Ca(i.ya)&&oY(e)}async function oH(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.wa.indexOf(t);e>=0&&(i.wa.splice(e,1),0===i.wa.length?r=+!t.ba():!i.Sa()&&t.ba()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function oX(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.wa)e.Ca(r)&&(n=!0);i.ya=r}}n&&oY(e)}function oJ(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.wa)e.onError(n);e.queries.delete(t)}function oY(e){e.Da.forEach(e=>{e.next()})}(g=f||(f={})).Fa="default",g.Cache="cache";class oZ{constructor(e,t,n){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=n||{}}Ca(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new o$(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){return!(e.fromCache&&this.ba())||(!this.options.ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}La(e){e=o$.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==f.Cache}}class o0{constructor(e,t){this.qa=e,this.byteLength=t}Qa(){return"metadata"in this.qa}}class o1{constructor(e){this.serializer=e}Qs(e){return iJ(this.serializer,e)}$s(e){return e.metadata.exists?i6(this.serializer,e.document,!1):n4.newNoDocument(this.Qs(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return iG(e)}}class o2{constructor(e,t){this.$a=e,this.serializer=t,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=o6(e)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Ua.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Ka.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let n=eC.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.qa.document&&(this.Ka[this.Ka.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ga(e){let t=new Map,n=new o1(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.Qs(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||rH()).add(e);t.set(n,r)}}return t}async za(e){let t=await aV(e,new o1(this.serializer),this.Ka,this.$a.id),n=this.Ga(this.documents);for(let t of this.Ua)await aB(e,t,n.get(t.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:t}}}function o6(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class o3{constructor(e){this.key=e}}class o5{constructor(e){this.key=e}}class o4{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=rH(),this.mutatedKeys=rH(),this.Xa=rU(e),this.eu=new oj(this.Xa)}get tu(){return this.Ha}nu(e,t){let n=t?t.ru:new oz,r=t?t.eu:this.eu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=rV(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(n.track({type:3,doc:h}),f=!0):this.iu(u,h)||(n.track({type:2,doc:h}),f=!0,(o&&this.Xa(h,o)>0||l&&0>this.Xa(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{eu:s,ru:n,Ds:a,mutatedKeys:i}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let s=e.ru.pa();s.sort((e,t)=>{var n,r;let i;return n=e.type,r=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ei(20277,{At:e})}})(n)-i(r)||this.Xa(e.doc,t.doc)}),this.su(n),r=null!=r&&r;let a=t&&!r?this.ou():[],o=0===this.Za.size&&this.current&&!r?1:0,l=o!==this.Ya;return(this.Ya=o,0!==s.length||l)?{snapshot:new o$(this.query,e.eu,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),_u:a}:{_u:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({eu:this.eu,ru:new oz,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=rH(),this.eu.forEach(e=>{this.au(e.key)&&(this.Za=this.Za.add(e.key))});let t=[];return e.forEach(e=>{this.Za.has(e)||t.push(new o5(e))}),this.Za.forEach(n=>{e.has(n)||t.push(new o3(n))}),t}uu(e){this.Ha=e.qs,this.Za=rH();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return o$.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,0===this.Ya,this.hasCachedResults)}}let o8="SyncEngine";class o7{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class o9{constructor(e){this.key=e,this.lu=!1}}class le{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.hu={},this.Pu=new rq(e=>rP(e),rL),this.Tu=new Map,this.Iu=new Set,this.du=new nh(ek.comparator),this.Eu=new Map,this.Au=new ao,this.Ru={},this.Vu=new Map,this.mu=sX.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return!0===this.fu}}async function lt(e,t,n=!0){let r,i=lR(e),s=i.Pu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.cu()):r=await lr(i,t,n,!0),r}async function ln(e,t){let n=lR(e);await lr(n,t,!0,!1)}async function lr(e,t,n,r){let i,s=await aR(e.localStore,rN(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,n);return r&&(i=await li(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&om(e.remoteStore,s),i}async function li(e,t,n,r,i){e.gu=(t,n,r)=>(async function(e,t,n,r){let i=t.view.nu(n);i.Ds&&(i=await aM(e.localStore,t.query,!1).then(({documents:e})=>t.view.nu(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return lv(e,t.targetId,o._u),o.snapshot})(e,t,n,r);let s=await aM(e.localStore,t,!0),a=new o4(t,s.qs),o=a.nu(s.documents),l=ik.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);lv(e,n,u._u);let h=new o7(t,n,a);return e.Pu.set(t,h),e.Tu.has(n)?e.Tu.get(n).push(t):e.Tu.set(n,[t]),u.snapshot}async function ls(e,t,n){let r=e.Pu.get(t),i=e.Tu.get(r.targetId);i.length>1?(e.Tu.set(r.targetId,i.filter(e=>!rL(e,t))),e.Pu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await aO(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&oy(e.remoteStore,r.targetId),lm(e,r.targetId)}).catch(e2)):(lm(e,r.targetId),await aO(e.localStore,r.targetId,!0))}async function la(e,t){let n=e.Pu.get(t),r=e.Tu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),oy(e.remoteStore,n.targetId))}async function lo(e,t,n){let r=lO(e);try{var i,s;let e,a,o,l,u,h=await (i=r.localStore,o=ej.now(),l=t.reduce((e,t)=>e.add(t.key),rH()),i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let r=rj,s=rH();return i.Os.getEntries(n,l).next(e=>{(r=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,r)).next(r=>{e=r;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=r1(r.transform,e||null);null!=i&&(null===n&&(n=n5.empty()),n.set(r.field,i))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new ih(n.key,t,function e(t){let n=[];return no(t.fields,(t,r)=>{let i=new eN([t]);if(nY(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new nm(n)}(t.value.mapValue),ir.exists(!0)))}return i.mutationQueue.addMutationBatch(n,o,s,t)}).next(t=>{a=t;let r=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(n,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:rK(e)})));r.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=r.Ru[r.currentUser.toKey()])||(u=new nh(e_)),u=u.insert(s,n),r.Ru[r.currentUser.toKey()]=u,await lb(r,h.changes),await oD(r.remoteStore)}catch(t){let e=oq(t,"Failed to persist write");n.reject(e)}}async function ll(e,t){var n;try{let r,i,s=await (n=e.localStore,r=t.snapshotVersion,i=n.Fs,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.Os.newChangeBuffer({trackRemovals:!0});i=n.Fs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(n.hi.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.hi.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(nw.EMPTY_BYTE_STRING,ez.min()).withLastLimboFreeSnapshotVersion(ez.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(n.hi.updateTargetData(e,h))});let o=rj,l=rH();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(ak(e,s,t.documentUpdates).next(e=>{o=e.Ls,l=e.ks})),!r.isEqual(ez.min())){let t=n.hi.getLastRemoteSnapshotVersion(e).next(t=>n.hi.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return e6.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.Fs=i,e)));t.targetChanges.forEach((t,n)=>{let r=e.Eu.get(n);r&&(ea(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.lu=!0:t.modifiedDocuments.size>0?ea(r.lu,14607):t.removedDocuments.size>0&&(ea(r.lu,42227),r.lu=!1))}),await lb(e,s,t)}catch(e){await e2(e)}}function lu(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.Pu.forEach((e,n)=>{let r=n.view.va(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.wa)e.va(t)&&(n=!0)}),n&&oY(r),i.length&&e.hu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function lh(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Eu.get(t),i=r&&r.key;if(i){let n=new nh(ek.comparator);n=n.insert(i,n4.newNoDocument(i,ez.min()));let r=rH().add(i),s=new iN(ez.min(),new Map,new nh(e_),n,r);await ll(e,s),e.du=e.du.remove(i),e.Eu.delete(t),lw(e)}else await aO(e.localStore,t,!1).then(()=>lm(e,t,n)).catch(e2)}async function lc(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r,i,s,a=t.batch.keys(),o=n.Os.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),s=e6.resolve(),i.forEach(n=>{s=s.next(()=>o.getEntry(e,n)).next(e=>{let i=t.docVersions.get(n);ea(null!==i,48541),0>e.version.compareTo(i)&&(r.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,r))).next(()=>o.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=rH();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,a))}));lp(e,r,null),lg(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await lb(e,i)}catch(e){await e2(e)}}async function ld(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(ea(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));lp(e,t,n),lg(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await lb(e,i)}catch(e){await e2(e)}}async function lf(e,t){var n;o_(e.remoteStore)||ee(o8,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=await (n=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>n.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===r)return void t.resolve();let i=e.Vu.get(r)||[];i.push(t),e.Vu.set(r,i)}catch(n){let e=oq(n,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function lg(e,t){(e.Vu.get(t)||[]).forEach(e=>{e.resolve()}),e.Vu.delete(t)}function lp(e,t,n){let r=e.Ru[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Ru[e.currentUser.toKey()]=r}}function lm(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Tu.get(t)))e.Pu.delete(r),n&&e.hu.pu(r,n);e.Tu.delete(t),e.isPrimaryClient&&e.Au.zr(t).forEach(t=>{e.Au.containsKey(t)||ly(e,t)})}function ly(e,t){e.Iu.delete(t.path.canonicalString());let n=e.du.get(t);null!==n&&(oy(e.remoteStore,n),e.du=e.du.remove(t),e.Eu.delete(n),lw(e))}function lv(e,t,n){for(let r of n)r instanceof o3?(e.Au.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Iu.has(r)||(ee(o8,"New document in limbo: "+n),e.Iu.add(r),lw(e))}(e,r)):r instanceof o5?(ee(o8,"Document no longer in limbo: "+r.key),e.Au.removeReference(r.key,t),e.Au.containsKey(r.key)||ly(e,r.key)):ei(19791,{yu:r})}function lw(e){for(;e.Iu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Iu.values().next().value;e.Iu.delete(t);let n=new ek(eC.fromString(t)),r=e.mu.next();e.Eu.set(r,new o9(n)),e.du=e.du.insert(n,r),om(e.remoteStore,new sr(rN(rx(n.path)),r,"TargetPurposeLimboResolution",tl.ue))}}async function lb(e,t,n){let r=[],i=[],s=[];e.Pu.isEmpty()||(e.Pu.forEach((a,o)=>{s.push(e.gu(o,t,n).then(t=>{var s;if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:null==(s=null==n?void 0:n.targetChanges.get(o.targetId))?void 0:s.current;e.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(t){r.push(t);let e=aI.Es(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.hu.J_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>e6.forEach(t,t=>e6.forEach(t.Is,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>e6.forEach(t.ds,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!te(e))throw e;ee(aA,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Fs.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.Fs=e.Fs.insert(t,i)}}}(e.localStore,i))}async function lE(e,t){if(!e.currentUser.isEqual(t)){ee(o8,"User change. New user:",t.toKey());let n=await aD(e.localStore,t);e.currentUser=t,e.Vu.forEach(e=>{e.forEach(e=>{e.reject(new eu(el.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Vu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await lb(e,n.Bs)}}function l_(e,t){let n=e.Eu.get(t);if(n&&n.lu)return rH().add(n.key);{let n=rH(),r=e.Tu.get(t);if(!r)return n;for(let t of r){let r=e.Pu.get(t);n=n.unionWith(r.view.tu)}return n}}async function lT(e,t){let n=await aM(e.localStore,t.query,!0),r=t.view.uu(n);return e.isPrimaryClient&&lv(e,t.targetId,r._u),r}async function lI(e,t){return aP(e.localStore,t).then(t=>lb(e,t))}async function lS(e,t,n,r){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.Xn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):e6.resolve(null))));null!==o?("pending"===n?await oD(e.remoteStore):"acknowledged"===n||"rejected"===n?(lp(e,t,r||null),lg(e,t),s=e.localStore,s.mutationQueue.rr(t)):ei(6720,"Unknown batchState",{wu:n}),await lb(e,o)):ee(o8,"Cannot apply mutation batch with id: "+t)}async function lx(e,t){if(lR(e),lO(e),!0===t&&!0!==e.fu){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await lA(e,t.toArray());for(let t of(e.fu=!0,await oF(e.remoteStore,!0),n))om(e.remoteStore,t)}else if(!1===t&&!1!==e.fu){let t=[],n=Promise.resolve();e.Tu.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(lm(e,i),aO(e.localStore,i,!0))),oy(e.remoteStore,i)}),await n,await lA(e,t),e.Eu.forEach((t,n)=>{oy(e.remoteStore,n)}),e.Au.jr(),e.Eu=new Map,e.du=new nh(ek.comparator),e.fu=!1,await oF(e.remoteStore,!1)}}async function lA(e,t,n){let r=[],i=[];for(let n of t){let t,s=e.Tu.get(n);if(s&&0!==s.length)for(let n of(t=await aR(e.localStore,rN(s[0])),s)){let t=e.Pu.get(n),r=await lT(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await aL(e.localStore,n);t=await aR(e.localStore,r),await li(e,lC(r),n,!1,t.resumeToken)}r.push(t)}return e.hu.J_(i),r}function lC(e){var t,n,r,i,s;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,s=e.limit,new rS(t,n,r,i,s,"F",e.startAt,e.endAt)}function lD(e){return e.localStore.persistence.Ps()}async function lN(e,t,n,r){if(e.fu)return void ee(o8,"Ignoring unexpected query state notification.");let i=e.Tu.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await aP(e.localStore,rB(i[0])),s=iN.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,nw.EMPTY_BYTE_STRING);await lb(e,r,s);break}case"rejected":await aO(e.localStore,t,!0),lm(e,t,r);break;default:ei(64155,n)}}async function lk(e,t,n){let r=lR(e);if(r.fu){for(let e of t){if(r.Tu.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){ee(o8,"Adding an already active target "+e);continue}let t=await aL(r.localStore,e),n=await aR(r.localStore,t);await li(r,lC(t),n.targetId,!1,n.resumeToken),om(r.remoteStore,n)}for(let e of n)r.Tu.has(e)&&await aO(r.localStore,e,!1).then(()=>{oy(r.remoteStore,e),lm(r,e)}).catch(e2)}}function lR(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=ll.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=l_.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=lh.bind(null,e),e.hu.J_=oX.bind(null,e.eventManager),e.hu.pu=oJ.bind(null,e.eventManager),e}function lO(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=lc.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ld.bind(null,e),e}class lM{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=or(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new ax,new aC(t,n,e.initialUser,this.serializer)}Du(e){return new af(ap.Vi,this.serializer)}bu(e){return new aZ}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}lM.provider={build:()=>new lM};class lL extends lM{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){return ea(this.persistence.referenceDelegate instanceof am,46915),new s2(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Du(e){let t=void 0!==this.cacheSizeBytes?s$.withCacheSize(this.cacheSizeBytes):s$.DEFAULT;return new af(e=>am.Vi(e,t),this.serializer)}}class lP extends lM{constructor(e,t,n){super(),this.Mu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Mu.initialize(this,e),await lO(this.Mu.syncEngine),await oD(this.Mu.remoteStore),await this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,n;return t=this.persistence,n=new ax,new aC(t,n,e.initialUser,this.serializer)}Cu(e,t){return new s2(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Fu(e,t){let n=new to(t,this.persistence);return new ta(e.asyncQueue,n)}Du(e){let t=aT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?s$.withCacheSize(this.cacheSizeBytes):s$.DEFAULT;return new a_(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,ot(),on(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new aZ}}class lF extends lP{constructor(e,t){super(e,t,!1),this.Mu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.Mu.syncEngine;this.sharedClientState instanceof aY&&(this.sharedClientState.syncEngine={Do:lS.bind(null,t),vo:lN.bind(null,t),Co:lk.bind(null,t),Ps:lD.bind(null,t),bo:lI.bind(null,t)},await this.sharedClientState.start()),await this.persistence.ji(async e=>{await lx(this.Mu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}bu(e){let t=ot();if(!aY.C(t))throw new eu(el.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=aT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new aY(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class lV{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>lu(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=lE.bind(null,this.syncEngine),await oF(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new oG}createDatastore(e){var t;let n=or(e.databaseInfo.databaseId),r=new oe(e.databaseInfo);return t=e.authCredentials,new oh(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new of(t,n,e.asyncQueue,e=>lu(this.syncEngine,e,0),a2.C()?new a2:new a0)}createSyncEngine(e,t){var n,r,i,s,a,o;let l;return n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new le(n,r,i,s,a,o),t&&(l.fu=!0),l}async terminate(){var e,t;await async function(e){ee(od,"RemoteStore shutting down."),e.Ia.add(5),await op(e),e.Ea.shutdown(),e.Aa.set("Unknown")}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()}}function lB(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}lV.provider={build:()=>new lV};class lU{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):et("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class lq{constructor(e,t){this.Nu=e,this.serializer=t,this.metadata=new eh,this.buffer=new Uint8Array,this.Bu=new TextDecoder("utf-8"),this.Lu().then(e=>{e&&e.Qa()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Nu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.Lu()}async Lu(){let e=await this.ku();if(null===e)return null;let t=this.Bu.decode(e),n=Number(t);return isNaN(n)&&this.qu(`length string (${t}) is not valid number`),new o0(JSON.parse(await this.Qu(n)),e.length+n)}$u(){return this.buffer.findIndex(e=>123===e)}async ku(){for(;0>this.$u()&&!await this.Uu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Qu(e){for(;this.buffer.length<e;)await this.Uu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Bu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Nu.cancel(),Error(`Invalid bundle format: ${e}`)}async Uu(){let e=await this.Nu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class lj{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let n=this.Su();if(!n||!n.Qa())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(null==n?void 0:n.qa)}`);this.metadata=n;do null!==(n=this.Su())&&this.elements.push(n);while(null!==n)}getMetadata(){return this.metadata}Ku(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.ku();return new o0(JSON.parse(this.Qu(e)),e)}Qu(e){if(this.cursor+e>this.bundleData.length)throw new eu(el.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class lz{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new eu(el.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let n={documents:t.map(t=>iX(e.serializer,t))},r=await e.Jo("BatchGetDocuments",e.serializer.databaseId,eC.emptyPath(),n,t.length),i=new Map;r.forEach(t=>{var n;let r,s,a,o,l,u,h=(n=e.serializer,"found"in t?(ea(!!t.found,43571),t.found.name,t.found.updateTime,r=iJ(n,t.found.name),s=iG(t.found.updateTime),a=t.found.createTime?iG(t.found.createTime):ez.min(),o=new n5({mapValue:{fields:t.found.fields}}),n4.newFoundDocument(r,s,a,o)):"missing"in t?(ea(!!t.missing,3894),ea(!!t.readTime,22933),l=iJ(n,t.missing),u=iG(t.readTime),n4.newNoDocument(l,u)):ei(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());ea(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new ip(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=ek.fromPath(t);this.mutations.push(new im(n,this.precondition(n)))}),await async function(e,t){let n={writes:t.map(t=>i3(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,eC.emptyPath(),n)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ei(50498,{Wu:e.constructor.name});t=ez.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new eu(el.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ez.min())?ir.exists(!1):ir.updateTime(t):ir.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ez.min()))throw new eu(el.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ir.updateTime(t)}return ir.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class l${constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Gu=n.maxAttempts,this.F_=new oi(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(async()=>{let e=new lz(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Hu(e)}))}).catch(e=>{this.Hu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!tu(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Hu(e){this.Gu>0&&this.Yu(e)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(e)}Yu(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!i_(t)}return!1}}let lK="FirestoreClient";class lG{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=H.UNAUTHENTICATED,this.clientId=eE.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{ee(lK,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(ee(lK,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new eh;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=oq(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function lQ(e,t){e.asyncQueue.verifyOperationInProgress(),ee(lK,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await aD(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>{en("Terminating Firestore due to IndexedDb database deletion"),e.terminate().then(()=>{ee("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(e=>{en("Terminating Firestore due to IndexedDb database deletion failed",e)})}),e._offlineComponents=t}async function lW(e,t){e.asyncQueue.verifyOperationInProgress();let n=await lH(e);ee(lK,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>oP(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>oP(t.remoteStore,n)),e._onlineComponents=t}async function lH(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){ee(lK,"Using user provided OfflineComponentProvider");try{await lQ(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===el.FAILED_PRECONDITION||t.code===el.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;en("Error using user provided cache. Falling back to memory cache: "+t),await lQ(e,new lM)}}else ee(lK,"Using default OfflineComponentProvider"),await lQ(e,new lL(void 0));return e._offlineComponents}async function lX(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(ee(lK,"Using user provided OnlineComponentProvider"),await lW(e,e._uninitializedComponentsProvider._online)):(ee(lK,"Using default OnlineComponentProvider"),await lW(e,new lV))),e._onlineComponents}function lJ(e){return lH(e).then(e=>e.persistence)}function lY(e){return lH(e).then(e=>e.localStore)}function lZ(e){return lX(e).then(e=>e.remoteStore)}function l0(e){return lX(e).then(e=>e.syncEngine)}function l1(e){return lX(e).then(e=>e.datastore)}async function l2(e){let t=await lX(e),n=t.eventManager;return n.onListen=lt.bind(null,t.syncEngine),n.onUnlisten=ls.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=ln.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=la.bind(null,t.syncEngine),n}function l6(e,t,n={}){let r=new eh;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await l2(e),s=e.asyncQueue,a=new lU({next:e=>{a.Ou(),s.enqueueAndForget(()=>oH(i,o));let l=e.docs.has(t);!l&&e.fromCache?r.reject(new eu(el.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&n&&"server"===n.source?r.reject(new eu(el.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(e)},error:e=>r.reject(e)}),oW(i,o=new oZ(rx(t.path),a,{includeMetadataChanges:!0,ka:!0}))}),r.promise}function l3(e,t,n={}){let r=new eh;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await l2(e),s=e.asyncQueue,o=new oZ(t,a=new lU({next:e=>{a.Ou(),s.enqueueAndForget(()=>oH(i,o)),e.fromCache&&"server"===n.source?r.reject(new eu(el.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(e)},error:e=>r.reject(e)}),{includeMetadataChanges:!0,ka:!0}),oW(i,o)}),r.promise}function l5(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let l4=new Map,l8="firestore.googleapis.com";class l7{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new eu(el.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=l8,this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new eu(el.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}eO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=l5(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new eu(el.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new eu(el.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new eu(el.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class l9{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new l7({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new eu(el.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new eu(el.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new l7(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ed;switch(e.type){case"firstParty":return new em(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new eu(el.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=l4.get(this))&&(ee("ComponentProvider","Removing Datastore"),l4.delete(this),e.terminate()),Promise.resolve()}}function ue(e,t,n,r={}){var i;e=eV(e,l9);let s=A(t),a=e._getSettings(),o=Object.assign(Object.assign({},a),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${n}`;s&&(C(`https://${l}`),function(e,t){if("undefined"==typeof window||"undefined"==typeof document||!A(window.location.host)||D[e]===t||D[e]||N)return;function n(e){return`__firebase__banner__${e}`}D[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(D))D[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),a=n("text"),o=document.getElementById(a)||document.createElement("span"),l=n("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=n("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;N=!0,(e=document.getElementById(r))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,o,u,n),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}("Firestore",!0)),a.host!==l8&&a.host!==l&&en("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let u=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:r});if(!V(u,o)&&(e._setSettings(u),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=H.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[T(JSON.stringify({alg:"none",type:"JWT"})),T(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new eu(el.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new H(s)}e._authCredentials=new ef(new ec(t,n))}}class ut{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new ut(this.firestore,e,this._query)}}class un{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ur(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new un(this.firestore,e,this._key)}toJSON(){return{type:un._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(eq(t,un._jsonSchema))return new un(e,n||null,new ek(eC.fromString(t.referencePath)))}}un._jsonSchemaVersion="firestore/documentReference/1.0",un._jsonSchema={type:eU("string",un._jsonSchemaVersion),referencePath:eU("string")};class ur extends ut{constructor(e,t,n){super(e,t,rx(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new un(this.firestore,null,new ek(e))}withConverter(e){return new ur(this.firestore,e,this._path)}}function ui(e,t,...n){if(e=U(e),eR("collection","path",t),e instanceof l9){let r=eC.fromString(t,...n);return eL(r),new ur(e,null,r)}{if(!(e instanceof un||e instanceof ur))throw new eu(el.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(eC.fromString(t,...n));return eL(r),new ur(e.firestore,null,r)}}function us(e,t){if(e=eV(e,l9),eR("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new eu(el.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ut(e,null,new rS(eC.emptyPath(),t))}function ua(e,t,...n){if(e=U(e),1==arguments.length&&(t=eE.newId()),eR("doc","path",t),e instanceof l9){let r=eC.fromString(t,...n);return eM(r),new un(e,null,new ek(r))}{if(!(e instanceof un||e instanceof ur))throw new eu(el.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(eC.fromString(t,...n));return eM(r),new un(e.firestore,e instanceof ur?e.converter:null,new ek(r))}}function uo(e,t){return e=U(e),t=U(t),(e instanceof un||e instanceof ur)&&(t instanceof un||t instanceof ur)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function ul(e,t){return e=U(e),t=U(t),e instanceof ut&&t instanceof ut&&e.firestore===t.firestore&&rL(e._query,t._query)&&e.converter===t.converter}let uu="AsyncQueue";class uh{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new oi(this,"async_queue_retry"),this.oc=()=>{let e=on();e&&ee(uu,"Visibility state changed to "+e.visibilityState),this.F_.y_()},this._c=e;const t=on();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=on();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new eh;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(0!==this.Zu.length){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!te(e))throw e;ee(uu,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(e=>{throw this.tc=e,this.nc=!1,et("INTERNAL UNHANDLED ERROR: ",uc(e)),e}).then(e=>(this.nc=!1,e))));return this._c=t,t}enqueueAfterDelay(e,t,n){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let r=oU.createAndSchedule(this,e,t,n,e=>this.lc(e));return this.ec.push(r),r}ac(){this.tc&&ei(47125,{hc:uc(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{for(let t of(this.ec.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.ec))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}}function uc(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function ud(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class uf{constructor(){this._progressObserver={},this._taskCompletionResolver=new eh,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class ug extends l9{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new uh,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new uh(e),this._firestoreClient=void 0,await e}}}function up(e,t,n){n||(n=nR);let r=(0,y._getProvider)(e,"firestore");if(r.isInitialized(n)){let e=r.getImmediate({identifier:n});if(V(r.getOptions(n),t))return e;throw new eu(el.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new eu(el.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new eu(el.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&A(t.host)&&C(t.host),r.initialize({options:t,instanceIdentifier:n})}function um(e,t){let n="object"==typeof e?e:(0,y.getApp)(),r="string"==typeof e?e:t||nR,i=(0,y._getProvider)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let e=(e=>{var t,n;let r=null==(n=null==(t=x())?void 0:t.emulatorHosts)?void 0:n[e];if(!r)return;let i=r.lastIndexOf(":");if(i<=0||i+1===r.length)throw Error(`Invalid host ${r} with no separate hostname and port!`);let s=parseInt(r.substring(i+1),10);return"["===r[0]?[r.substring(1,i-1),s]:[r.substring(0,i),s]})("firestore");e&&ue(i,...e)}return i}function uy(e){if(e._terminated)throw new eu(el.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||uv(e),e._firestoreClient}function uv(e){var t,n,r,i,s,a;let o,l=e._freezeSettings(),u=(i=e._databaseId,s=(null==(t=e._app)?void 0:t.options.appId)||"",new nk(i,s,e._persistenceKey,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,l5(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator));e._componentsProvider||(null==(n=l.localCache)?void 0:n._offlineComponentProvider)&&(null==(r=l.localCache)?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),e._firestoreClient=new lG(e._authCredentials,e._appCheckCredentials,e._queue,u,e._componentsProvider&&(o=null==(a=e._componentsProvider)?void 0:a._online.build(),{_offline:null==a?void 0:a._offline.build(o),_online:o}))}function uw(e,t){en("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=e._freezeSettings();return uE(e,lV.provider,{build:e=>new lP(e,n.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()}async function ub(e){en("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();uE(e,lV.provider,{build:e=>new lF(e,t.cacheSizeBytes)})}function uE(e,t,n){if((e=eV(e,ug))._firestoreClient||e._terminated)throw new eu(el.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new eu(el.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},uv(e)}function u_(e){if(e._initialized&&!e._terminated)throw new eu(el.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new eh;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!e4.C())return Promise.resolve();await e4.delete(e+aE)}(aT(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function uT(e){var t;let n;return t=uy(e=eV(e,ug)),n=new eh,t.asyncQueue.enqueueAndForget(async()=>lf(await l0(t),n)),n.promise}function uI(e){var t;return(t=uy(e=eV(e,ug))).asyncQueue.enqueue(async()=>{let e=await lJ(t),n=await lZ(t);return e.setNetworkEnabled(!0),n.Ia.delete(0),og(n)})}function uS(e){var t;return(t=uy(e=eV(e,ug))).asyncQueue.enqueue(async()=>{let e=await lJ(t),n=await lZ(t);return e.setNetworkEnabled(!1),async function(e){e.Ia.add(0),await op(e),e.Aa.set("Offline")}(n)})}function ux(e){return(0,y._removeServiceInstance)(e.app,"firestore",e._databaseId.database),e._delete()}function uA(e,t){let n=uy(e=eV(e,ug)),r=new uf;return function(e,t,n,r){var i;let s=(i=or(t),new lq(function(e,t){if(e instanceof Uint8Array)return lB(e,void 0);if(e instanceof ArrayBuffer)return lB(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?eb().encode(n):n),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,n){try{var r,i;let s,a=await t.getMetadata();if(await (r=e.localStore,s=iG(a.createTime),r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.Ti.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);n._updateProgress(o6(a));let o=new o2(a,t.serializer),l=await t.Su();for(;l;){let e=await o.Wa(l);e&&n._updateProgress(e),l=await t.Su()}let u=await o.za(e.localStore);return await lb(e,u.Ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Ti.saveBundleMetadata(e,a))),n._completeWith(u.progress),Promise.resolve(u.ja)}catch(e){return en(o8,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(t=await l0(e),s,r).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(n,e._databaseId,t,r),r}function uC(e,t){var n;return(n=uy(e=eV(e,ug)),n.asyncQueue.enqueue(async()=>{var e;return e=await lY(n),e.persistence.runTransaction("Get named query","readonly",n=>e.Ti.getNamedQuery(n,t))})).then(t=>t?new ut(e,null,t.query):null)}class uD{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class uN{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class uk{constructor(e){this._byteString=e}static fromBase64String(e){try{return new uk(nw.fromBase64String(e))}catch(e){throw new eu(el.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new uk(nw.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:uk._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(eq(e,uk._jsonSchema))return uk.fromBase64String(e.bytes)}}uk._jsonSchemaVersion="firestore/bytes/1.0",uk._jsonSchema={type:eU("string",uk._jsonSchemaVersion),bytes:eU("string")};class uR{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new eu(el.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new eN(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function uO(){return new uR(ex)}class uM{constructor(e){this._methodName=e}}class uL{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new eu(el.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new eu(el.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return e_(this._lat,e._lat)||e_(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:uL._jsonSchemaVersion}}static fromJSON(e){if(eq(e,uL._jsonSchema))return new uL(e.latitude,e.longitude)}}uL._jsonSchemaVersion="firestore/geoPoint/1.0",uL._jsonSchema={type:eU("string",uL._jsonSchemaVersion),latitude:eU("number"),longitude:eU("number")};class uP{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:uP._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(eq(e,uP._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new uP(e.vectorValues);throw new eu(el.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}uP._jsonSchemaVersion="firestore/vectorValue/1.0",uP._jsonSchema={type:eU("string",uP._jsonSchemaVersion),vectorValues:eU("object")};let uF=/^__.*__$/;class uV{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ih(e,this.data,this.fieldMask,t,this.fieldTransforms):new iu(e,this.data,t,this.fieldTransforms)}}class uB{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ih(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function uU(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ei(40011,{Ec:e})}}class uq{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Ac(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new uq(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.Rc({path:n,mc:!1});return r.fc(e),r}gc(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.Rc({path:n,mc:!1});return r.Ac(),r}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return u8(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(0===e.length)throw this.wc("Document fields must not be empty");if(uU(this.Ec)&&uF.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class uj{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||or(e)}Dc(e,t,n,r=!1){return new uq({Ec:e,methodName:t,bc:n,path:eN.emptyPath(),mc:!1,Sc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function uz(e){let t=e._freezeSettings(),n=or(e._databaseId);return new uj(e._databaseId,!!t.ignoreUndefinedProperties,n)}function u$(e,t,n,r,i,s={}){let a,o,l=e.Dc(s.merge||s.mergeFields?2:0,t,n,i);u6("Data must be an object, but it was:",l,r);let u=u1(r,l);if(s.merge)a=new nm(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=u3(t,r,n);if(!l.contains(i))throw new eu(el.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);u7(e,i)||e.push(i)}a=new nm(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new uV(new n5(u),a,o)}class uK extends uM{_toFieldTransform(e){if(2!==e.Ec)throw 1===e.Ec?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof uK}}function uG(e,t,n){return new uq({Ec:3,bc:t.settings.bc,methodName:e._methodName,mc:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class uQ extends uM{_toFieldTransform(e){return new ie(e.path,new r2)}isEqual(e){return e instanceof uQ}}class uW extends uM{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=uG(this,e,!0),n=new r6(this.vc.map(e=>u0(e,t)));return new ie(e.path,n)}isEqual(e){return e instanceof uW&&V(this.vc,e.vc)}}class uH extends uM{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=uG(this,e,!0),n=new r5(this.vc.map(e=>u0(e,t)));return new ie(e.path,n)}isEqual(e){return e instanceof uH&&V(this.vc,e.vc)}}class uX extends uM{constructor(e,t){super(e),this.Cc=t}_toFieldTransform(e){let t=new r8(e.serializer,rZ(e.serializer,this.Cc));return new ie(e.path,t)}isEqual(e){return e instanceof uX&&this.Cc===e.Cc}}function uJ(e,t,n,r){let i=e.Dc(1,t,n);u6("Data must be an object, but it was:",i,r);let s=[],a=n5.empty();return no(r,(e,r)=>{let o=u4(t,e,n);r=U(r);let l=i.gc(o);if(r instanceof uK)s.push(o);else{let e=u0(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new uB(a,new nm(s),i.fieldTransforms)}function uY(e,t,n,r,i,s){let a=e.Dc(1,t,n),o=[u3(t,r,n)],l=[i];if(s.length%2!=0)throw new eu(el.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(u3(t,s[e])),l.push(s[e+1]);let u=[],h=n5.empty();for(let e=o.length-1;e>=0;--e)if(!u7(u,o[e])){let t=o[e],n=l[e];n=U(n);let r=a.gc(t);if(n instanceof uK)u.push(t);else{let e=u0(n,r);null!=e&&(u.push(t),h.set(t,e))}}return new uB(h,new nm(u),a.fieldTransforms)}function uZ(e,t,n,r=!1){return u0(n,e.Dc(r?4:3,t))}function u0(e,t){if(u2(e=U(e)))return u6("Unsupported field value:",t,e),u1(e,t);if(e instanceof uM)return function(e,t){if(!uU(t.Ec))throw t.wc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.wc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.mc&&4!==t.Ec)throw t.wc("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=u0(i,t.yc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){if(null===(e=U(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return rZ(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=ej.fromDate(e);return{timestampValue:i$(t.serializer,n)}}if(e instanceof ej){let n=new ej(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:i$(t.serializer,n)}}if(e instanceof uL)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof uk)return{bytesValue:iK(t.serializer,e._byteString)};if(e instanceof un){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.wc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:iQ(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof uP)return{mapValue:{fields:{[nM]:{stringValue:nF},[nV]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.wc("VectorValues must only contain numeric values.");return rJ(t.serializer,e)})}}}}};throw t.wc(`Unsupported field value: ${eF(e)}`)}(e,t)}function u1(e,t){let n={};return nu(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):no(e,(e,r)=>{let i=u0(r,t.Vc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function u2(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ej||e instanceof uL||e instanceof uk||e instanceof un||e instanceof uM||e instanceof uP)}function u6(e,t,n){if(!u2(n)||!eP(n)){let r=eF(n);throw"an object"===r?t.wc(e+" a custom object"):t.wc(e+" "+r)}}function u3(e,t,n){if((t=U(t))instanceof uR)return t._internalPath;if("string"==typeof t)return u4(e,t);throw u8("Field path arguments must be of type string or ",e,!1,void 0,n)}let u5=RegExp("[~\\*/\\[\\]]");function u4(e,t,n){if(t.search(u5)>=0)throw u8(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new uR(...t.split("."))._internalPath}catch(r){throw u8(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function u8(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new eu(el.INVALID_ARGUMENT,o+e+l)}function u7(e,t){return e.some(e=>e.isEqual(t))}class u9{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new un(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new he(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(ht("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class he extends u9{data(){return super.data()}}function ht(e,t){return"string"==typeof t?u4(e,t):t instanceof uR?t._internalPath:t._delegate._internalPath}function hn(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new eu(el.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class hr{}class hi extends hr{}function hs(e,t,...n){let r=[];for(let i of(t instanceof hr&&r.push(t),function(e){let t=e.filter(e=>e instanceof hl).length,n=e.filter(e=>e instanceof ha).length;if(t>1||t>0&&n>0)throw new eu(el.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class ha extends hi{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new ha(e,t,n)}_apply(e){let t=this._parse(e);return hS(e._query,t),new ut(e.firestore,e.converter,rO(e._query,t))}_parse(e){let t=uz(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new eu(el.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){hI(a,s);let t=[];for(let n of a)t.push(hT(r,e,n));o={arrayValue:{values:t}}}else o=hT(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||hI(a,s),o=uZ(n,t,a,"in"===s||"not-in"===s);return rn.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function ho(e,t,n){let r=ht("where",e);return ha._create(r,t,n)}class hl extends hr{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new hl(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:rr.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())hS(n,e),n=rO(n,e)}(e._query,t),new ut(e.firestore,e.converter,rO(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function hu(...e){return e.forEach(e=>hx("or",e)),hl._create("or",e)}function hh(...e){return e.forEach(e=>hx("and",e)),hl._create("and",e)}class hc extends hi{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new hc(e,t)}_apply(e){var t;let n,r=function(e,t,n){if(null!==e.startAt)throw new eu(el.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new eu(el.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new re(t,n)}(e._query,this._field,this._direction);return new ut(e.firestore,e.converter,(t=e._query,n=t.explicitOrderBy.concat([r]),new rS(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function hd(e,t="asc"){let n=ht("orderBy",e);return hc._create(n,t)}class hf extends hi{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new hf(e,t,n)}_apply(e){return new ut(e.firestore,e.converter,rM(e._query,this._limit,this._limitType))}}function hg(e){return eB("limit",e),hf._create("limit",e,"F")}function hp(e){return eB("limitToLast",e),hf._create("limitToLast",e,"L")}class hm extends hi{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new hm(e,t,n)}_apply(e){var t;let n=h_(e,this.type,this._docOrFields,this._inclusive);return new ut(e.firestore,e.converter,(t=e._query,new rS(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt)))}}function hy(...e){return hm._create("startAt",e,!0)}function hv(...e){return hm._create("startAfter",e,!1)}class hw extends hi{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new hw(e,t,n)}_apply(e){var t;let n=h_(e,this.type,this._docOrFields,this._inclusive);return new ut(e.firestore,e.converter,(t=e._query,new rS(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n)))}}function hb(...e){return hw._create("endBefore",e,!1)}function hE(...e){return hw._create("endAt",e,!0)}function h_(e,t,n,r){if(n[0]=U(n[0]),n[0]instanceof u9)return function(e,t,n,r,i){if(!r)throw new eu(el.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of rD(e))if(n.field.isKeyField())s.push(nQ(t,r.key));else{let e=r.data.field(n.field);if(nC(e))throw new eu(el.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new eu(el.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new n8(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=uz(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new eu(el.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new eu(el.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!rC(e)&&-1!==l.indexOf("/"))throw new eu(el.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(eC.fromString(l));if(!ek.isDocumentKey(n))throw new eu(el.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new ek(n);o.push(nQ(t,i))}else{let e=uZ(n,r,l);o.push(e)}}return new n8(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function hT(e,t,n){if("string"==typeof(n=U(n))){if(""===n)throw new eu(el.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!rC(t)&&-1!==n.indexOf("/"))throw new eu(el.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(eC.fromString(n));if(!ek.isDocumentKey(r))throw new eu(el.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return nQ(e,new ek(r))}if(n instanceof un)return nQ(e,n._key);throw new eu(el.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${eF(n)}.`)}function hI(e,t){if(!Array.isArray(e)||0===e.length)throw new eu(el.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function hS(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new eu(el.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new eu(el.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function hx(e,t){if(!(t instanceof ha||t instanceof hl))throw new eu(el.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class hA{convertValue(e,t="none"){switch(nU(e)){case 0:return null;case 1:return e.booleanValue;case 2:return n_(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nT(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ei(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return no(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;return new uP(null==(r=null==(n=null==(t=e.fields)?void 0:t[nV].arrayValue)?void 0:n.values)?void 0:r.map(e=>n_(e.doubleValue)))}convertGeoPoint(e){return new uL(n_(e.latitude),n_(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=nD(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(nN(e));default:return null}}convertTimestamp(e){let t=nE(e);return new ej(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=eC.fromString(e);ea(sn(n),9688,{name:e});let r=new nO(n.get(1),n.get(3)),i=new ek(n.popFirst(5));return r.isEqual(t)||et(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function hC(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class hD extends hA{constructor(e){super(),this.firestore=e}convertBytes(e){return new uk(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new un(this.firestore,null,t)}}function hN(e){return new uD("sum",u3("sum",e))}function hk(e){return new uD("avg",u3("average",e))}function hR(){return new uD("count")}function hO(e,t){var n,r;return e instanceof uD&&t instanceof uD&&e.aggregateType===t.aggregateType&&(null==(n=e._internalFieldPath)?void 0:n.canonicalString())===(null==(r=t._internalFieldPath)?void 0:r.canonicalString())}function hM(e,t){return ul(e.query,t.query)&&V(e.data(),t.data())}let hL="NOT SUPPORTED";class hP{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hF extends u9{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new hB(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(ht("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new eu(el.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=hF._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function hV(e,t,n){if(eq(t,hF._jsonSchema)){var r;if(t.bundle===hL)throw new eu(el.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=or(e._databaseId),s=(r=t.bundle,new lj(r,i)),a=s.Ku(),o=new o2(s.getMetadata(),i);for(let e of a)o.Wa(e);let l=o.documents;if(1!==l.length)throw new eu(el.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=i6(i,l[0].document),h=new ek(eC.fromString(t.bundleName));return new hF(e,new hD(e),h,u,new hP(!1,!1),n||null)}}hF._jsonSchemaVersion="firestore/documentSnapshot/1.0",hF._jsonSchema={type:eU("string",hF._jsonSchemaVersion),bundleSource:eU("string","DocumentSnapshot"),bundleName:eU("string"),bundle:eU("string")};class hB extends hF{data(e={}){return super.data(e)}}class hU{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new hP(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new hB(this._firestore,this._userDataWriter,n.key,n,new hP(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new eu(el.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new hB(e._firestore,e._userDataWriter,n.doc.key,n.doc,new hP(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new hB(e._firestore,e._userDataWriter,t.doc.key,t.doc,new hP(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ei(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new eu(el.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=hU._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=eE.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function hq(e,t,n){if(eq(t,hU._jsonSchema)){var r;if(t.bundle===hL)throw new eu(el.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=or(e._databaseId),s=(r=t.bundle,new lj(r,i)),a=s.Ku(),o=new o2(s.getMetadata(),i);for(let e of a)o.Wa(e);if(1!==o.queries.length)throw new eu(el.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=sd(o.queries[0].bundledQuery),u=o.documents,h=new oj;u.map(e=>{let t=i6(i,e.document);h=h.add(t)});let c=o$.fromInitialDocuments(l,h,rH(),!1,!1),d=new ut(e,n||null,l);return new hU(e,new hD(e),d,c)}}function hj(e,t){return e instanceof hF&&t instanceof hF?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof hU&&t instanceof hU&&e._firestore===t._firestore&&ul(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function hz(e){e=eV(e,un);let t=eV(e.firestore,ug);return l6(uy(t),e._key).then(n=>h3(t,e,n))}hU._jsonSchemaVersion="firestore/querySnapshot/1.0",hU._jsonSchema={type:eU("string",hU._jsonSchemaVersion),bundleSource:eU("string","QuerySnapshot"),bundleName:eU("string"),bundle:eU("string")};class h$ extends hA{constructor(e){super(),this.firestore=e}convertBytes(e){return new uk(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new un(this.firestore,null,t)}}function hK(e){var t;let n;e=eV(e,un);let r=eV(e.firestore,ug),i=uy(r),s=new h$(r);return(t=e._key,n=new eh,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await e.persistence.runTransaction("read document","readonly",n=>e.localDocuments.getDocument(n,t));r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new eu(el.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=oq(r,`Failed to get document '${t} from cache`);n.reject(e)}})(await lY(i),t,n)),n.promise).then(t=>new hF(r,s,e._key,t,new hP(null!==t&&t.hasLocalMutations,!0),e.converter))}function hG(e){e=eV(e,un);let t=eV(e.firestore,ug);return l6(uy(t),e._key,{source:"server"}).then(n=>h3(t,e,n))}function hQ(e){e=eV(e,ut);let t=eV(e.firestore,ug),n=uy(t),r=new h$(t);return hn(e._query),l3(n,e._query).then(n=>new hU(t,r,e,n))}function hW(e){var t;let n;e=eV(e,ut);let r=eV(e.firestore,ug),i=uy(r),s=new h$(r);return(t=e._query,n=new eh,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await aM(e,t,!0),i=new o4(t,r.qs),s=i.nu(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(r){let e=oq(r,`Failed to execute query '${t} against cache`);n.reject(e)}})(await lY(i),t,n)),n.promise).then(t=>new hU(r,s,e,t))}function hH(e){e=eV(e,ut);let t=eV(e.firestore,ug),n=uy(t),r=new h$(t);return l3(n,e._query,{source:"server"}).then(n=>new hU(t,r,e,n))}function hX(e,t,n){e=eV(e,un);let r=eV(e.firestore,ug),i=hC(e.converter,t,n);return h6(r,[u$(uz(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,ir.none())])}function hJ(e,t,n,...r){e=eV(e,un);let i=eV(e.firestore,ug),s=uz(i);return h6(i,[("string"==typeof(t=U(t))||t instanceof uR?uY(s,"updateDoc",e._key,t,n,r):uJ(s,"updateDoc",e._key,t)).toMutation(e._key,ir.exists(!0))])}function hY(e){return h6(eV(e.firestore,ug),[new ip(e._key,ir.none())])}function hZ(e,t){let n=eV(e.firestore,ug),r=ua(e),i=hC(e.converter,t);return h6(n,[u$(uz(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,ir.exists(!1))]).then(()=>r)}function h0(e,...t){var n,r,i,s;let a,o,l,u,h;e=U(e);let c={includeMetadataChanges:!1,source:"default"},d=0;"object"!=typeof t[0]||ud(t[d])||(c=t[d++]);let f={includeMetadataChanges:c.includeMetadataChanges,source:c.source};if(ud(t[d])){let e=t[d];t[d]=null==(n=e.next)?void 0:n.bind(e),t[d+1]=null==(r=e.error)?void 0:r.bind(e),t[d+2]=null==(i=e.complete)?void 0:i.bind(e)}if(e instanceof un)o=eV(e.firestore,ug),l=rx(e._key.path),a={next:n=>{t[d]&&t[d](h3(o,e,n))},error:t[d+1],complete:t[d+2]};else{let n=eV(e,ut);o=eV(n.firestore,ug),l=n._query;let r=new h$(o);a={next:e=>{t[d]&&t[d](new hU(o,r,n,e))},error:t[d+1],complete:t[d+2]},hn(e._query)}return s=uy(o),h=new oZ(l,u=new lU(a),f),s.asyncQueue.enqueueAndForget(async()=>oW(await l2(s),h)),()=>{u.Ou(),s.asyncQueue.enqueueAndForget(async()=>oH(await l2(s),h))}}function h1(e,t,...n){var r,i,s,a,o,l;let u=U(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let n of["bundle","bundleName","bundleSource"]){if(!(n in e)){t.error=`snapshotJson missing required field: ${n}`;break}let r=e[n];if("string"!=typeof r){t.error=`snapshotJson field '${n}' must be a string.`;break}if(0===r.length){t.error=`snapshotJson field '${n}' cannot be an empty string.`;break}"bundle"===n?t.bundle=r:"bundleName"===n?t.bundleName=r:"bundleSource"===n&&(t.bundleSource=r)}return t}(t);if(h.error)throw new eu(el.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof n[0]||ud(n[d])||(c=n[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof n[d]&&ud(n[d])){let e=n[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:n[d++],error:n[d++],complete:n[d++]};return r=c,i=a,s=n[d],t=!1,uA(u,h.bundle).then(()=>uC(u,h.bundleName)).then(n=>{n&&!t&&(s&&n.withConverter(s),e=h0(n,r||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,r=null;if("object"==typeof n[d]&&ud(n[d])){let e=n[d++];r={next:e.next,error:e.error,complete:e.complete}}else r={next:n[d++],error:n[d++],complete:n[d++]};return a=c,o=r,l=n[d],t=!1,uA(u,h.bundle).then(()=>{t||(e=h0(new un(u,l||null,ek.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new eu(el.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function h2(e,t){var n;let r;return n=uy(e=eV(e,ug)),r=new lU(ud(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await l2(n),void(e.Da.add(r),r.next())}),()=>{r.Ou(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await l2(n),void e.Da.delete(r)})}}function h6(e,t){var n;let r;return n=uy(e),r=new eh,n.asyncQueue.enqueueAndForget(async()=>lo(await l0(n),t,r)),r.promise}function h3(e,t,n){let r=n.docs.get(t._key),i=new h$(e);return new hF(e,i,t._key,r,new hP(n.hasPendingWrites,n.fromCache),t.converter)}function h5(e){return h4(e,{count:hR()})}function h4(e,t){var n;let r,i=eV(e.firestore,ug),s=uy(i),a=nl(t,(e,t)=>new ib(t,e.aggregateType,e._internalFieldPath));return(n=e._query,r=new eh,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await l1(s);r.resolve(async function(e,t,n){var r;let{request:i,ft:s,parent:a}=i7(e.serializer,rk(t),n);e.connection.Qo||delete i.parent;let o=(await e.Jo("RunAggregationQuery",e.serializer.databaseId,a,i,1)).filter(e=>!!e.result);ea(1===o.length,64727);let l=null==(r=o[0].result)?void 0:r.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}(e,n,a))}catch(e){r.reject(e)}}),r.promise).then(t=>new uN(e,new h$(i),t))}class h8{constructor(e){this.kind="memory",this._onlineComponentProvider=lV.provider,(null==e?void 0:e.garbageCollector)?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new lL(void 0)}}toJSON(){return{kind:this.kind}}}class h7{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=co(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class h9{constructor(){this.kind="memoryEager",this._offlineComponentProvider=lM.provider}toJSON(){return{kind:this.kind}}}class ce{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new lL(e)}}toJSON(){return{kind:this.kind}}}function ct(){return new h9}function cn(e){return new ce(null==e?void 0:e.cacheSizeBytes)}function cr(e){return new h8(e)}function ci(e){return new h7(e)}class cs{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=lV.provider,this._offlineComponentProvider={build:t=>new lP(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class ca{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=lV.provider,this._offlineComponentProvider={build:t=>new lF(t,null==e?void 0:e.cacheSizeBytes)}}}function co(e){return new cs(null==e?void 0:e.forceOwnership)}function cl(){return new ca}let cu={maxAttempts:5};class ch{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=uz(e)}set(e,t,n){this._verifyNotCommitted();let r=cc(e,this._firestore),i=hC(r.converter,t,n),s=u$(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,ir.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=cc(e,this._firestore);return i="string"==typeof(t=U(t))||t instanceof uR?uY(this._dataReader,"WriteBatch.update",s._key,t,n,r):uJ(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,ir.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=cc(e,this._firestore);return this._mutations=this._mutations.concat(new ip(t._key,ir.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new eu(el.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function cc(e,t){if((e=U(e)).firestore!==t)throw new eu(el.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class cd{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=uz(e)}get(e){let t=cc(e,this._firestore),n=new hD(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return ei(24041);let r=e[0];if(r.isFoundDocument())return new u9(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new u9(this._firestore,n,t._key,null,t.converter);throw ei(18433,{doc:r})})}set(e,t,n){let r=cc(e,this._firestore),i=hC(r.converter,t,n),s=u$(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i,s=cc(e,this._firestore);return i="string"==typeof(t=U(t))||t instanceof uR?uY(this._dataReader,"Transaction.update",s._key,t,n,r):uJ(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=cc(e,this._firestore);return this._transaction.delete(t._key),this}}class cf extends cd{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=cc(e,this._firestore),n=new h$(this._firestore);return super.get(e).then(e=>new hF(this._firestore,n,t._key,e._document,new hP(!1,!1),t.converter))}}function cg(e,t,n){var r,i;let s;e=eV(e,ug);let a=Object.assign(Object.assign({},cu),n);if(a.maxAttempts<1)throw new eu(el.INVALID_ARGUMENT,"Max attempts must be at least 1");return r=uy(e),i=n=>t(new cf(e,n)),s=new eh,r.asyncQueue.enqueueAndForget(async()=>{let e=await l1(r);new l$(r.asyncQueue,e,a,i,s).zu()}),s.promise}function cp(){return new uK("deleteField")}function cm(){return new uQ("serverTimestamp")}function cy(...e){return new uW("arrayUnion",e)}function cv(...e){return new uH("arrayRemove",e)}function cw(e){return new uX("increment",e)}function cb(e){return new uP(e)}function cE(e){return uy(e=eV(e,ug)),new ch(e,t=>h6(e,t))}function c_(e,t){let n=uy(e=eV(e,ug));if(!n._uninitializedComponentsProvider||"memory"===n._uninitializedComponentsProvider._offline.kind)return en("Cannot enable indexes when persistence is disabled"),Promise.resolve();let r=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new eu(el.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,n=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=cT(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=u4("setIndexConfiguration",cT(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new eW(e,2)):"ASCENDING"===t.order?r.push(new eW(e,0)):"DESCENDING"===t.order&&r.push(new eW(e,1))}n.push(new e$(e$.UNKNOWN_ID,t,r,eH.empty()))}return n}(t);return n.asyncQueue.enqueue(async()=>(async function(e,t){let n=e.indexManager,r=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(i=>(function(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=n(e[l],t[o]);s<0?i(e[l++]):s>0?r(t[o++]):(o++,l++)}for(;o<a;)r(t[o++]);for(;l<s;)i(e[l++])})(i,t,eQ,t=>{r.push(n.addFieldIndex(e,t))},t=>{r.push(n.deleteFieldIndex(e,t))})).next(()=>e6.waitFor(r)))})(await lY(n),r))}function cT(e,t){if("string"!=typeof e[t])throw new eu(el.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class cI{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function cS(e){var t;e=eV(e,ug);let n=cN.get(e);if(n)return n;if("persistent"!==(null==(t=uy(e)._uninitializedComponentsProvider)?void 0:t._offline.kind))return null;let r=new cI(e);return cN.set(e,r),r}function cx(e){cD(e,!0)}function cA(e){cD(e,!1)}function cC(e){var t;(t=uy(e._firestore)).asyncQueue.enqueue(async()=>{var e;let n;return n=(e=await lY(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>n.deleteAllFieldIndexes(e))}).then(e=>ee("deleting all persistent cache indexes succeeded")).catch(e=>en("deleting all persistent cache indexes failed",e))}function cD(e,t){var n;(n=uy(e._firestore),n.asyncQueue.enqueue(async()=>{var e;return e=await lY(n),void(e.Cs.Rs=t)})).then(e=>ee(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>en(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let cN=new WeakMap;function ck(e){var t;let n=null==(t=uy(eV(e.firestore,ug))._onlineComponents)?void 0:t.datastore.serializer;return void 0===n?null:i8(n,rN(e._query)).Vt}function cR(e,t){var n;let r=nl(t,(e,t)=>new ib(t,e.aggregateType,e._internalFieldPath)),i=null==(n=uy(eV(e.firestore,ug))._onlineComponents)?void 0:n.datastore.serializer;return void 0===i?null:i7(i,rk(e._query),r,!0).request}class cO{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return cM.instance.onExistenceFilterMismatch(e)}}class cM{constructor(){this.Fc=new Map}static get instance(){return cL||function(e){if(iI)throw Error("a TestingHooksSpi instance is already set");iI=e}(cL=new cM),cL}ct(e){this.Fc.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),n=this.Fc;return n.set(t,e),()=>n.delete(t)}}let cL=null;!function(e=!0){X=y.SDK_VERSION,(0,y._registerComponent)(new q("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new ug(new eg(t.getProvider("auth-internal")),new ev(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new eu(el.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nO(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,y.registerVersion)(Q,W,void 0),(0,y.registerVersion)(Q,W,"esm2017")}(),e.s(["AbstractUserDataWriter",()=>hA,"AggregateField",()=>uD,"AggregateQuerySnapshot",()=>uN,"Bytes",()=>uk,"CACHE_SIZE_UNLIMITED",()=>-1,"CollectionReference",()=>ur,"DocumentReference",()=>un,"DocumentSnapshot",()=>hF,"FieldPath",()=>uR,"FieldValue",()=>uM,"Firestore",()=>ug,"FirestoreError",()=>eu,"GeoPoint",()=>uL,"LoadBundleTask",()=>uf,"PersistentCacheIndexManager",()=>cI,"Query",()=>ut,"QueryCompositeFilterConstraint",()=>hl,"QueryConstraint",()=>hi,"QueryDocumentSnapshot",()=>hB,"QueryEndAtConstraint",()=>hw,"QueryFieldFilterConstraint",()=>ha,"QueryLimitConstraint",()=>hf,"QueryOrderByConstraint",()=>hc,"QuerySnapshot",()=>hU,"QueryStartAtConstraint",()=>hm,"SnapshotMetadata",()=>hP,"Timestamp",()=>ej,"Transaction",()=>cf,"VectorValue",()=>uP,"WriteBatch",()=>ch,"_AutoId",()=>eE,"_ByteString",()=>nw,"_DatabaseId",()=>nO,"_DocumentKey",()=>ek,"_EmptyAppCheckTokenProvider",()=>ew,"_EmptyAuthCredentialsProvider",()=>ed,"_FieldPath",()=>eN,"_TestingHooks",()=>cO,"_cast",()=>eV,"_debugAssert",()=>eo,"_internalAggregationQueryToProtoRunAggregationQueryRequest",()=>cR,"_internalQueryToProtoQueryTarget",()=>ck,"_isBase64Available",()=>nv,"_logWarn",()=>en,"_validateIsNotUsedTogether",()=>eO,"addDoc",()=>hZ,"aggregateFieldEqual",()=>hO,"aggregateQuerySnapshotEqual",()=>hM,"and",()=>hh,"arrayRemove",()=>cv,"arrayUnion",()=>cy,"average",()=>hk,"clearIndexedDbPersistence",()=>u_,"collection",()=>ui,"collectionGroup",()=>us,"connectFirestoreEmulator",()=>ue,"count",()=>hR,"deleteAllPersistentCacheIndexes",()=>cC,"deleteDoc",()=>hY,"deleteField",()=>cp,"disableNetwork",()=>uS,"disablePersistentCacheIndexAutoCreation",()=>cA,"doc",()=>ua,"documentId",()=>uO,"documentSnapshotFromJSON",()=>hV,"enableIndexedDbPersistence",()=>uw,"enableMultiTabIndexedDbPersistence",()=>ub,"enableNetwork",()=>uI,"enablePersistentCacheIndexAutoCreation",()=>cx,"endAt",()=>hE,"endBefore",()=>hb,"ensureFirestoreConfigured",()=>uy,"executeWrite",()=>h6,"getAggregateFromServer",()=>h4,"getCountFromServer",()=>h5,"getDoc",()=>hz,"getDocFromCache",()=>hK,"getDocFromServer",()=>hG,"getDocs",()=>hQ,"getDocsFromCache",()=>hW,"getDocsFromServer",()=>hH,"getFirestore",()=>um,"getPersistentCacheIndexManager",()=>cS,"increment",()=>cw,"initializeFirestore",()=>up,"limit",()=>hg,"limitToLast",()=>hp,"loadBundle",()=>uA,"memoryEagerGarbageCollector",()=>ct,"memoryLocalCache",()=>cr,"memoryLruGarbageCollector",()=>cn,"namedQuery",()=>uC,"onSnapshot",()=>h0,"onSnapshotResume",()=>h1,"onSnapshotsInSync",()=>h2,"or",()=>hu,"orderBy",()=>hd,"persistentLocalCache",()=>ci,"persistentMultipleTabManager",()=>cl,"persistentSingleTabManager",()=>co,"query",()=>hs,"queryEqual",()=>ul,"querySnapshotFromJSON",()=>hq,"refEqual",()=>uo,"runTransaction",()=>cg,"serverTimestamp",()=>cm,"setDoc",()=>hX,"setIndexConfiguration",()=>c_,"setLogLevel",()=>Z,"snapshotEqual",()=>hj,"startAfter",()=>hv,"startAt",()=>hy,"sum",()=>hN,"terminate",()=>ux,"updateDoc",()=>hJ,"vector",()=>cb,"waitForPendingWrites",()=>uT,"where",()=>ho,"writeBatch",()=>cE],17875),e.s([],36180)}]);