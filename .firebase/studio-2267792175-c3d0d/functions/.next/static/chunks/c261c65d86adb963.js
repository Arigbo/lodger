(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18200,e=>{"use strict";e.i(61086);var r=e.i(27651);async function a(e){let r=await new Promise((r,a)=>{let o=new FileReader;o.onloadend=()=>{r(o.result.split(",")[1])},o.onerror=a,o.readAsDataURL(e)}),a=await fetch("/api/moderate-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageBase64:r,mimeType:e.type})});if(!a.ok){if(429===a.status)throw Error("Rate limit exceeded. Please wait and try again.");throw Error("Moderation check failed")}return await a.json()}async function o(e,o,t,s){try{if(!t.type.startsWith("image/"))return{success:!1,error:"Invalid file type. Please upload an image file."};if(t.size>5242880)return{success:!1,error:"File is too large. Maximum size is 5MB."};if(s?.skipModeration){let a=(0,r.ref)(e,o),s={contentType:t.type,cacheControl:"public, max-age=3600"},i=await (0,r.uploadBytes)(a,t,s),n=await (0,r.getDownloadURL)(i.ref);return{success:!0,downloadURL:n}}let i=await a(t);if("UNSAFE"===i.safety)return{success:!1,blocked:!0,analysis:i,error:i.reason||"Image contains inappropriate content and cannot be uploaded."};if("IRRELEVANT"===i.context&&!s?.allowIrrelevant)return{success:!1,blocked:!1,analysis:i,error:i.reason||"Image may not be relevant to property listings."};let n=(0,r.ref)(e,o),l={contentType:t.type,cacheControl:"public, max-age=3600",customMetadata:{moderationSafety:i.safety,moderationContext:i.context}},c=await (0,r.uploadBytes)(n,t,l),d=await (0,r.getDownloadURL)(c.ref);return{success:!0,downloadURL:d,analysis:i}}catch(e){return console.error("Moderation and upload error:",e),{success:!1,error:e.message||"Upload failed. Please try again."}}}async function t(e,a,o){try{if(!o.type.startsWith("image/"))throw Error("Invalid file type. Please upload an image file.");if(o.size>5242880)throw Error("File is too large. Maximum size is 5MB.");let t=(0,r.ref)(e,`users/${a}/profile-picture`),s={contentType:o.type,cacheControl:"public, max-age=3600"};console.log(`Starting upload for user ${a}, file: ${o.name}, size: ${o.size}, type: ${o.type}`);let i=await (0,r.uploadBytes)(t,o,s);console.log("Upload successful, retrieving download URL...");let n=await (0,r.getDownloadURL)(i.ref);return console.log("Download URL retrieved successfully"),n}catch(e){throw console.error("Profile image upload error:",{code:e.code,message:e.message,serverResponse:e.serverResponse,fullError:e}),Error(`Upload failed: ${e.message||"Unknown error"}`)}}e.s(["moderateAndUpload",()=>o,"moderateImage",()=>a,"uploadProfileImage",()=>t])}]);