(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67034,(e,t,n)=>{var r={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return(n+r)*3/4-r},t.toByteArray=function(e){var t,n,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(n=0;n<c;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[h++]=255&t),1===o&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],a=0,o=r-i;a<o;a+=16383)s.push(function(e,t,r){for(var i,s=[],a=t;a<r;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[i>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&s.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)n[a]=s[a],r[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}r[45]=62,r[95]=63},72:function(e,t,n){"use strict";var r=n(675),i=n(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(r,i),l=a(s),u=l.write(r,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(D(e,ArrayBuffer)||e&&D(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(D(e,SharedArrayBuffer)||e&&D(e.buffer,SharedArrayBuffer)))return function(e,t,n){var r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),o.prototype),r}(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,n);var g=function(e){if(o.isBuffer(e)){var t=0|d(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(g)return g;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),n=a(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,n){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return x(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return C(e).length;default:if(i)return r?-1:x(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,n){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=k[e[s]];return i}(this,t,n);case"utf8":case"utf-8":return v(this,t,n);case"ascii":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":return i=this,s=t,a=n,0===s&&a===i.length?r.fromByteArray(i):r.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}(this,t,n);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function p(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){var s;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(i)return -1;else n=e.length-1;else if(n<0)if(!i)return -1;else n=0;if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return y(e,[t],n,r,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var s,a=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=n;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),D(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:+(r<n)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,r=o.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(D(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?v(this,0,e):g.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,n,r,i){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var s=i-r,a=n-t,l=Math.min(s,a),u=this.slice(r,i),h=e.slice(t,n),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)};function v(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=n)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=c}var d=r,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var g="",p=0;p<f;)g+=String.fromCharCode.apply(String,d.slice(p,p+=4096));return g}function w(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function b(e,t,n,r,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function T(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function E(e,t,n,r,s){return t*=1,n>>>=0,s||T(e,t,n,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,n,r,23,4),n+4}function I(e,t,n,r,s){return t*=1,n>>>=0,s||T(e,t,n,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,n,r,52,8),n+8}o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var f=!1;;)switch(r){case"hex":return function(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;r>s/2&&(r=s/2);for(var a=0;a<r;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[n+a]=l}return a}(this,e,t,n);case"utf8":case"utf-8":return i=t,s=n,A(x(e,this.length-i),this,i,s);case"ascii":return a=t,o=n,A(S(e),this,a,o);case"latin1":case"binary":return function(e,t,n,r){return A(S(t),e,n,r)}(this,e,t,n);case"base64":return l=t,u=n,A(C(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=n,A(function(e,t){for(var n,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,o.prototype),r},o.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},o.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||w(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},o.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;b(this,e,t,n,i,0)}var s=1,a=0;for(this[t]=255&e;++a<n&&(s*=256);)this[t+a]=e/s&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;b(this,e,t,n,i,0)}var s=n-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);b(this,e,t,n,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<n&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);b(this,e,t,n,i-1,-i)}var s=n-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,n){return E(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return E(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return I(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return I(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var s=i-1;s>=0;--s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===r&&s<128||"latin1"===r)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,r),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%l]}return this};var _=/[^+/0-9A-Za-z-_]/g;function x(e,t){t=t||1/0;for(var n,r=e.length,i=null,s=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319||a+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function S(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function C(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(_,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function D(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var k=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}()},783:function(e,t){t.read=function(e,t,n,r,i){var s,a,o=8*i-r-1,l=(1<<o)-1,u=l>>1,h=-7,c=n?i-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=r;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),s-=u}return(f?-1:1)*a*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=r?0:s-1,g=r?1:-1,p=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&o,f+=g,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[n+f]=255&a,f+=g,a/=256,u-=8);e[n+f-g]|=128*p}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}},a=!0;try{r[e](n,n.exports,s),a=!1}finally{a&&delete i[e]}return n.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},36180,17875,e=>{"use strict";var t,n,r,i,s,a,o,l,u,h,c,d,f,g,p=e.i(47167),m=e.i(67034),y=e.i(85086);let v=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},w=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},b={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),r.push(n[u],n[h],n[c],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(v(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):w(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new T;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class T extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let E=function(e){let t=v(e);return b.encodeByteArray(t,!0)},I=function(e){return E(e).replace(/\./g,"")},_=function(e){try{return b.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function x(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g}let S=()=>{try{return x().__FIREBASE_DEFAULTS__||(()=>{if(void 0===p.default||void 0===p.default.env)return;let e=p.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&_(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}};function C(e){return e.endsWith(".cloudworkstations.dev")}async function A(e){return(await fetch(e,{credentials:"include"})).ok}let D={},k=!1;function N(e,t){if("undefined"==typeof window||"undefined"==typeof document||!C(window.location.host)||D[e]===t||D[e]||k)return;function n(e){return`__firebase__banner__${e}`}D[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(D))D[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),a=n("text"),o=document.getElementById(a)||document.createElement("span"),l=n("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=n("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;k=!0,(e=document.getElementById(r))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,o,u,n),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function R(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function M(){var t;let n=null==(t=S())?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function L(){return!M()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function O(){return!M()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}class P extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,P.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,F.prototype.create)}}class F{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(n=a,r=i,n.replace(V,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new P(s,l,i)}}let V=/\{\$([^}]+)}/g;function B(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(U(n)&&U(s)){if(!B(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function U(e){return null!==e&&"object"==typeof e}function q(e){return e&&e._delegate?e._delegate:e}class z{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}var j=e.i(68483),K="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,$={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}var r=function(){this.blockSize=-1};function i(){}function s(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+0xd76aa478|0;a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[1]+0xe8c7b756|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[2]+0x242070db|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[3]+0xc1bdceee|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[4]+0xf57c0faf|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[5]+0x4787c62a|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[6]+0xa8304613|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[7]+0xfd469501|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[8]+0x698098d8|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[9]+0x8b44f7af|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[10]+0xffff5bb1|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[11]+0x895cd7be|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[12]+0x6b901122|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[13]+0xfd987193|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[14]+0xa679438e|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(a<<22|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,a=t+((n=i+(a<<20|a>>>12))^i^s)+r[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[11]+0x6d9d6122|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[14]+0xfde5380c|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[7]+0xf6bb4b60|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[10]+0xbebfbc70|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[3]+0xd4ef3085|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[6]+0x4881d05|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[15]+0x1fa27cf8|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(a<<23|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function a(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}i.prototype=r.prototype,e.D=r.prototype,e.prototype=new i,e.prototype.constructor=e,e.C=function(e,t,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return r.prototype[t].apply(e,i)},e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.B,i=this.h,a=0;a<t;){if(0==i)for(;a<=n;)s(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(r[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,r),i=0;break}}else for(;a<t;)if(r[i++]=e[a++],i==this.blockSize){s(this,r),i=0;break}}this.h=i,this.o+=t},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var o,l={};function u(e){var t;return -128<=e&&128>e?(t=function(e){return new a([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new a([0|e],0>e?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return m(h(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new a(t,0)}var c=u(0),d=u(1),f=u(0x1000000);function g(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function p(e){return -1==e.h}function m(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new a(n,~e.h).add(d)}function y(e,t){return e.add(m(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function w(e,t){this.g=e,this.h=t}function b(e,t){if(g(t))throw Error("division by zero");if(g(e))return new w(c,c);if(p(e))return t=b(m(e),t),new w(m(t.g),m(t.h));if(p(t))return t=b(e,m(t)),new w(m(t.g),t.h);if(30<e.g.length){if(p(e)||p(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=T(n),r=T(r);var i=E(n,1),s=E(r,1);for(r=E(r,2),n=E(n,2);!g(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=E(r,1),n=E(n,1)}return t=y(e,i.j(t)),new w(i,t)}for(i=c;0<=e.l(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=h(n)).j(t);p(a)||0<a.l(e);)n-=r,a=(s=h(n)).j(t);g(s)&&(s=d),i=i.add(s),e=y(e,a)}return new w(i,e)}function T(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new a(n,e.h)}function E(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new a(i,e.h)}(o=a.prototype).m=function(){if(p(this))return-m(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:0x100000000+r)*t,t*=0x100000000}return e},o.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(g(this))return"0";if(p(this))return"-"+m(this).toString(e);for(var t=h(Math.pow(e,6)),n=this,r="";;){var i=b(n,t).g,s=((0<(n=y(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(g(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},o.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},o.l=function(e){return p(e=y(this,e))?-1:+!g(e)},o.abs=function(){return p(this)?m(this):this},o.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.i(i))+(65535&e.i(i)),o=(s>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new a(n,-0x80000000&n[n.length-1]?-1:0)},o.j=function(e){if(g(this)||g(e))return c;if(p(this))return p(e)?m(this).j(m(e)):m(m(this).j(e));if(p(e))return m(this.j(m(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.i(r)>>>16,o=65535&this.i(r),l=e.i(i)>>>16,u=65535&e.i(i);n[2*r+2*i]+=o*u,v(n,2*r+2*i),n[2*r+2*i+1]+=s*u,v(n,2*r+2*i+1),n[2*r+2*i+1]+=o*l,v(n,2*r+2*i+1),n[2*r+2*i+2]+=s*l,v(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new a(n,0)},o.A=function(e){return b(this,e).h},o.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new a(n,this.h&e.h)},o.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new a(n,this.h|e.h)},o.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new a(n,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,n=$.Md5=e,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return m(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=h(Math.pow(n,8)),i=c,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=h(Math.pow(n,a)),i=i.j(a).add(h(o))):i=(i=i.j(r)).add(h(o))}return i},t=$.Integer=a}).apply(void 0!==K?K:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var G="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,Q={};(function(){var e,t,n,c="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},d=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof G&&G];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=d;e=e.split(".");for(var r=0;r<e.length-1;r++){var i=e[r];if(!(i in n))break e;n=n[i]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&c(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,n,r,i;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),n=0,r=!1,(i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return i},i}});var f=f||{},g=this||self;function p(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function y(e,t,n){return e.call.apply(e.bind,arguments)}function v(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function w(e,t,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function T(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function E(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function I(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(p(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function _(e){return/^[\s\xa0]*$/.test(e)}function x(){var e=g.navigator;return e&&(e=e.userAgent)?e:""}function S(e){return S[" "](e),e}S[" "]=function(){};var C=-1!=x().indexOf("Gecko")&&(-1==x().toLowerCase().indexOf("webkit")||-1!=x().indexOf("Edge"))&&-1==x().indexOf("Trident")&&-1==x().indexOf("MSIE")&&-1==x().indexOf("Edge");function A(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function D(e){let t={};for(let n in e)t[n]=e[n];return t}let k="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<k.length;t++)n=k[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}var R=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new M,e=>e.reset());class M{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let L,O=!1,P=new class{constructor(){this.h=this.g=null}add(e,t){let n=R.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},F=()=>{let e=g.Promise.resolve(void 0);L=()=>{e.then(V)}};var V=()=>{let e;for(var t;e=null,P.g&&(e=P.g,P.g=P.g.next,P.g||(P.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){g.setTimeout(()=>{throw e},0)}(e)}R.j(t),100>R.h&&(R.h++,t.next=R.g,R.g=t)}O=!1};function B(){this.s=this.s,this.C=this.C}function U(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}B.prototype.s=!1,B.prototype.ma=function(){this.s||(this.s=!0,this.N())},B.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},U.prototype.h=function(){this.defaultPrevented=!0};var q=function(){if(!g.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};g.addEventListener("test",e,t),g.removeEventListener("test",e,t)}catch(e){}return e}();function z(e,t){if(U.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(C){e:{try{S(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:j[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&z.aa.h.call(this)}}T(z,U);var j={2:"touch",3:"pen",4:"mouse"};z.prototype.h=function(){z.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var K="closure_listenable_"+(1e6*Math.random()|0),$=0;function H(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++$,this.da=this.fa=!1}function W(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function J(e){this.src=e,this.g={},this.h=0}function X(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(W(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Y(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}J.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=Y(e,t,r,i);return -1<a?(t=e[a],n||(t.fa=!1)):((t=new H(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var Z="closure_lm_"+(1e6*Math.random()|0),ee={};function et(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=m(i)?!!i.capture:!!i,o=es(e);if(o||(e[Z]=o=new J(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return ei.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)q||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(er(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function en(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[K])X(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(er(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=es(t))?(X(n,e),0==n.h&&(n.src=null,t[Z]=null)):W(e)}}}function er(e){return e in ee?ee[e]:ee[e]="on"+e}function ei(e,t){if(e.da)e=!0;else{t=new z(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&en(e),e=n.call(r,t)}return e}function es(e){return(e=e[Z])instanceof J?e:null}var ea="__closure_events_fn_"+(1e9*Math.random()>>>0);function eo(e){return"function"==typeof e?e:(e[ea]||(e[ea]=function(t){return e.handleEvent(t)}),e[ea])}function el(){B.call(this),this.i=new J(this),this.M=this,this.F=null}function eu(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new U(t,e);else if(t instanceof U)t.target=t.target||e;else{var i=t;N(t=new U(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=eh(a,r,!0,t)&&i}if(i=eh(a=t.g=e,r,!0,t)&&i,i=eh(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=eh(a=t.g=n[s],r,!1,t)&&i}function eh(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.fa&&X(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}function ec(e,t,n){if("function"==typeof e)n&&(e=w(e,n));else if(e&&"function"==typeof e.handleEvent)e=w(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:g.setTimeout(e,t||0)}T(el,B),el.prototype[K]=!0,el.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=m(i)?!!i.capture:!!i,r=eo(r),t&&t[K])?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=Y(a=t.g[n],r,i,s))&&(W(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=es(t))&&(n=t.g[n.toString()],t=-1,n&&(t=Y(n,r,i,s)),(r=-1<t?n[t]:null)&&en(r))}(this,e,t,n,r)},el.prototype.N=function(){if(el.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)W(n[r]);delete t.g[e],t.h--}}this.F=null},el.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},el.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ed extends B{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ec(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(g.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ef(e){B.call(this),this.h=e,this.g={}}T(ef,B);var eg=[];function ep(e){A(e.g,function(e,t){this.g.hasOwnProperty(t)&&en(e)},e),e.g={}}ef.prototype.N=function(){ef.aa.N.call(this),ep(this)},ef.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var em=g.JSON.stringify,ey=g.JSON.parse,ev=class{stringify(e){return g.JSON.stringify(e,void 0)}parse(e){return g.JSON.parse(e,void 0)}};function ew(){}function eb(e){return e.h||(e.h=e.i())}function eT(){}ew.prototype.h=null;var eE={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eI(){U.call(this,"d")}function e_(){U.call(this,"c")}T(eI,U),T(e_,U);var ex={},eS=null;function eC(){return eS=eS||new el}function eA(e){U.call(this,ex.La,e)}function eD(e){let t=eC();eu(t,new eA(t))}function ek(e,t){U.call(this,ex.STAT_EVENT,e),this.stat=t}function eN(e){let t=eC();eu(t,new ek(t,e))}function eR(e,t){U.call(this,ex.Ma,e),this.size=t}function eM(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return g.setTimeout(function(){e()},t)}function eL(){this.g=!0}function eO(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return em(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}ex.La="serverreachability",T(eA,U),ex.STAT_EVENT="statevent",T(ek,U),ex.Ma="timingevent",T(eR,U),eL.prototype.xa=function(){this.g=!1},eL.prototype.info=function(){};var eP={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eF={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eV(){}function eB(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ef(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eU}function eU(){this.i=null,this.g="",this.h=!1}T(eV,ew),eV.prototype.g=function(){return new XMLHttpRequest},eV.prototype.i=function(){return{}},t=new eV;var eq={},ez={};function ej(e,t,n){e.L=1,e.v=ti(e9(t)),e.m=n,e.P=!0,eK(e,null)}function eK(e,t){e.F=Date.now(),eG(e),e.A=e9(e.v);var n,r,i,s,a,o,l=e.A,u=e.R;Array.isArray(u)||(u=[String(u)]),ty(l.i,"t",u),e.C=0,l=e.j.J,e.h=new eU,e.g=t6(e.j,l?t:null,!e.m),0<e.O&&(e.M=new ed(w(e.Y,e,e.g),e.O)),t=e.U,l=e.g,u=e.ca;var h="readystatechange";Array.isArray(h)||(h&&(eg[0]=h.toString()),h=eg);for(var c=0;c<h.length;c++){var d=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=eo(r),t&&t[K]?t.L(n,r,m(i)?!!i.capture:!!i,s):et(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=eo(r),t&&t[K]?t.K(n,r,m(i)?!!i.capture:!!i,s):et(t,n,r,!1,i,s)}(l,h[c],u||t.handleEvent,!1,t.h||t);if(!d)break;t.g[d.key]=d}t=e.H?D(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),eD(),n=e.i,r=e.u,i=e.A,s=e.l,a=e.R,o=e.m,n.info(function(){if(n.g)if(o)for(var e="",t=o.split("&"),l=0;l<t.length;l++){var u=t[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");e=2<=c.length&&"type"==c[1]?e+(h+"=")+u+"&":e+(h+"=redacted&")}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function e$(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function eG(e){e.S=Date.now()+e.I,eQ(e,e.I)}function eQ(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eM(w(e.ba,e),t)}function eH(e){e.B&&(g.clearTimeout(e.B),e.B=null)}function eW(e){0==e.j.G||e.J||tY(e.j,e)}function eJ(e){eH(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ep(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eX(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||e2(n.h,e))){if(!e.K&&e2(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)tX(n),tq(n);else break e;tH(n),eN(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=eM(w(n.Za,n),6e3));if(1>=e1(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else t0(n,11)}else if((e.K||n.g==e)&&tX(n),!_(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(n.T=o[0],o=o[1],2==n.G)if("c"==o[0]){n.K=o[1],n.ia=o[2];let t=o[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));let i=o[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(n.L=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(e6(s,s.h),s.h=null))}if(r.D){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,tr(r.I,r.D,e))}}if(n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms")),(r=n).qa=t2(r,r.J?r.ia:null,r.W),e.K){e3(r.h,e);var a=r.L;a&&(e.I=a),e.B&&(eH(e),eG(e)),r.g=e}else tQ(r);0<n.i.length&&tj(n)}else"stop"!=o[0]&&"close"!=o[0]||t0(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?t0(n,7):tU(n):"noop"!=o[0]&&n.l&&n.l.ta(o),n.v=0)}}eD(4)}catch(e){}}eB.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tP(e)?t.j():this.Y(e)},eB.prototype.Y=function(e){try{if(e==this.g)e:{let v=tP(this.g);var t=this.g.Ba();let w=this.g.Z();if(!(3>v)&&(3!=v||this.g&&(this.h.h||this.g.oa()||tF(this.g)))){this.J||4!=v||7==t||(8==t||0>=w?eD(3):eD(2)),eH(this);var n=this.g.Z();this.X=n;t:if(e$(this)){var r=tF(this.g);e="";var i=r.length,s=4==tP(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eJ(this),eW(this);var a="";break t}this.h.i=new g.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,o=this.i,l=this.u,u=this.A,h=this.l,c=this.R,d=n,o.info(function(){return"XMLHTTP RESP ("+h+") [ attempt "+c+"]: "+l+"\n"+u+"\n"+v+" "+d}),this.o){if(this.T&&!this.K){t:{if(this.g){var o,l,u,h,c,d,f,p=this.g;if((f=p.g?p.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(f)){var m=f;break t}}m=null}if(n=m)eO(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eX(this,n);else{this.o=!1,this.s=3,eN(12),eJ(this),eW(this);break e}}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;)if((e=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?ez:isNaN(n=Number(t.substring(n,r)))?eq:(r+=1)+n>t.length?ez:(t=t.slice(r,r+n),e.C=r+n,t)}(this,a))==ez){4==v&&(this.s=4,eN(14),n=!1),eO(this.i,this.l,null,"[Incomplete Response]");break}else if(e==eq){this.s=4,eN(15),eO(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}else eO(this.i,this.l,e,null),eX(this,e);if(e$(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=v||0!=a.length||this.h.h||(this.s=1,eN(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var y=this.j;y.g==this&&y.ba&&!y.M&&(y.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),tW(y),y.M=!0,eN(11))}}else eO(this.i,this.l,a,"[Invalid Chunked Response]"),eJ(this),eW(this)}else eO(this.i,this.l,a,null),eX(this,a);4==v&&eJ(this),this.o&&!this.J&&(4==v?tY(this.j,this):(this.o=!1,eG(this)))}else(function(e){let t={};e=(e.g&&2<=tP(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(_(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,eN(12)):(this.s=0,eN(13)),eJ(this),eW(this)}}}catch(e){}finally{}},eB.prototype.cancel=function(){this.J=!0,eJ(this)},eB.prototype.ba=function(){var e,t;this.B=null;let n=Date.now();0<=n-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(eD(),eN(17)),eJ(this),this.s=2,eW(this)):eQ(this,this.S-n)};var eY=class{constructor(e,t){this.g=e,this.map=t}};function eZ(e){this.l=e||10,e=g.PerformanceNavigationTiming?0<(e=g.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(g.chrome&&g.chrome.loadTimes&&g.chrome.loadTimes()&&g.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function e0(e){return!!e.h||!!e.g&&e.g.size>=e.j}function e1(e){return e.h?1:e.g?e.g.size:0}function e2(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e6(e,t){e.g?e.g.add(t):e.h=t}function e3(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e5(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return E(e.i)}function e4(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(p(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(p(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(p(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}eZ.prototype.cancel=function(){if(this.i=e5(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e8=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e7(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof e7){this.h=e.h,te(this,e.j),this.o=e.o,this.g=e.g,tt(this,e.s),this.l=e.l;var t=e.i,n=new tf;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tn(this,n),this.m=e.m}else e&&(t=String(e).match(e8))?(this.h=!1,te(this,t[1]||"",!0),this.o=ts(t[2]||""),this.g=ts(t[3]||"",!0),tt(this,t[4]),this.l=ts(t[5]||"",!0),tn(this,t[6]||"",!0),this.m=ts(t[7]||"")):(this.h=!1,this.i=new tf(null,this.h))}function e9(e){return new e7(e)}function te(e,t,n){e.j=n?ts(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tt(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function tn(e,t,n){var r,i;t instanceof tf?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(tg(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tp(this,t),ty(this,n,e))},r)),r.j=i):(n||(t=ta(t,tc)),e.i=new tf(t,e.h))}function tr(e,t,n){e.i.set(t,n)}function ti(e){return tr(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function ts(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ta(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,to),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function to(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e7.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ta(t,tl,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ta(t,tl,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ta(n,"/"==n.charAt(0)?th:tu,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ta(n,td)),e.join("")};var tl=/[#\/\?@]/g,tu=/[#\?:]/g,th=/[#\?]/g,tc=/[#\?@]/g,td=/#/g;function tf(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tg(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tp(e,t){tg(e),t=tv(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tm(e,t){return tg(e),t=tv(e,t),e.g.has(t)}function ty(e,t,n){tp(e,t),0<n.length&&(e.i=null,e.g.set(tv(e,t),E(n)),e.h+=n.length)}function tv(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tw(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tb(){this.g=new ev}function tT(e){this.l=e.Ub||null,this.j=e.eb||!1}function tE(e,t){el.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function tI(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function t_(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tx(e)}function tx(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tS(e){let t="";return A(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tC(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tS(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tr(e,t,n))}function tA(e){el.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(n=tf.prototype).add=function(e,t){tg(this),this.i=null,e=tv(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},n.forEach=function(e,t){tg(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},n.na=function(){tg(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},n.V=function(e){tg(this);let t=[];if("string"==typeof e)tm(this,e)&&(t=t.concat(this.g.get(tv(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},n.set=function(e,t){return tg(this),this.i=null,tm(this,e=tv(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},n.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")},T(tT,ew),tT.prototype.g=function(){return new tE(this.l,this.j)},tT.prototype.i=(e={},function(){return e}),T(tE,el),(n=tE.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tx(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||g).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,t_(this)),this.readyState=0},n.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tx(this)),this.g&&(this.readyState=3,tx(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==g.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tI(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},n.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?t_(this):tx(this),3==this.readyState&&tI(this)}},n.Ra=function(e){this.g&&(this.response=this.responseText=e,t_(this))},n.Qa=function(e){this.g&&(this.response=e,t_(this))},n.ga=function(){this.g&&t_(this)},n.setRequestHeader=function(e,t){this.u.append(e,t)},n.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tE.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),T(tA,el);var tD=/^https?$/i,tk=["POST","PUT"];function tN(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tR(e),tL(e)}function tR(e){e.A||(e.A=!0,eu(e,"complete"),eu(e,"error"))}function tM(e){if(e.h&&void 0!==f&&(!e.v[1]||4!=tP(e)||2!=e.Z())){if(e.u&&4==tP(e))ec(e.Ea,0,e);else if(eu(e,"readystatechange"),4==tP(e)){e.h=!1;try{let a=e.Z();switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===a){var i=String(e.D).match(e8)[1]||null;!i&&g.self&&g.self.location&&(i=g.self.location.protocol.slice(0,-1)),n=!tD.test(i?i.toLowerCase():"")}t=n}if(t)eu(e,"complete"),eu(e,"success");else{e.m=6;try{var s=2<tP(e)?e.g.statusText:""}catch(e){s=""}e.l=s+" ["+e.Z()+"]",tR(e)}}finally{tL(e)}}}}function tL(e,t){if(e.g){tO(e);let n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||eu(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function tO(e){e.I&&(g.clearTimeout(e.I),e.I=null)}function tP(e){return e.g?e.g.readyState:0}function tF(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tV(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tB(e){this.Aa=0,this.i=[],this.j=new eL,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tV("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tV("baseRetryDelayMs",5e3,e),this.cb=tV("retryDelaySeedMs",1e4,e),this.Wa=tV("forwardChannelMaxRetries",2,e),this.wa=tV("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new eZ(e&&e.concurrentRequestLimit),this.Da=new tb,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tU(e){if(tz(e),3==e.G){var t=e.U++,n=e9(e.I);if(tr(n,"SID",e.K),tr(n,"RID",t),tr(n,"TYPE","terminate"),t$(e,n),(t=new eB(e,e.j,t)).L=2,t.v=ti(e9(n)),n=!1,g.navigator&&g.navigator.sendBeacon)try{n=g.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&g.Image&&((new Image).src=t.v,n=!0),n||(t.g=t6(t.j,null),t.g.ea(t.v)),t.F=Date.now(),eG(t)}t1(e)}function tq(e){e.g&&(tW(e),e.g.cancel(),e.g=null)}function tz(e){tq(e),e.u&&(g.clearTimeout(e.u),e.u=null),tX(e),e.h.cancel(),e.s&&("number"==typeof e.s&&g.clearTimeout(e.s),e.s=null)}function tj(e){if(!e0(e.h)&&!e.s){e.s=!0;var t=e.Ga;L||F(),O||(L(),O=!0),P.add(t,e),e.B=0}}function tK(e,t){var n;n=t?t.l:e.U++;let r=e9(e.I);tr(r,"SID",e.K),tr(r,"RID",n),tr(r,"AID",e.T),t$(e,r),e.m&&e.o&&tC(r,e.m,e.o),n=new eB(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tG(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e6(e.h,n),ej(n,r,t)}function t$(e,t){e.H&&A(e.H,function(e,n){tr(t,n,e)}),e.l&&e4({},function(e,n){tr(t,n,e)})}function tG(e,t,n){n=Math.min(e.i.length,n);var r=e.l?w(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{!function(e,t,n){let r=n||"";try{e4(e,function(e,n){let i=e;m(e)&&(i=em(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return t.D=e=e.i.splice(0,n),r}function tQ(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;L||F(),O||(L(),O=!0),P.add(t,e),e.v=0}}function tH(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eM(w(e.Fa,e),tZ(e,e.v)),e.v++,!0)}function tW(e){null!=e.A&&(g.clearTimeout(e.A),e.A=null)}function tJ(e){e.g=new eB(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=e9(e.qa);tr(t,"RID","rpc"),tr(t,"SID",e.K),tr(t,"AID",e.T),tr(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&tr(t,"TO",e.ja),tr(t,"TYPE","xmlhttp"),t$(e,t),e.m&&e.o&&tC(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ti(e9(t)),n.m=null,n.P=!0,eK(n,e)}function tX(e){null!=e.C&&(g.clearTimeout(e.C),e.C=null)}function tY(e,t){var n,r=null;if(e.g==t){tX(e),tW(e),e.g=null;var i=2}else{if(!e2(e.h,t))return;r=t.D,e3(e.h,t),i=1}if(0!=e.G){if(t.o)if(1==i){r=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;eu(i=eC(),new eR(i,r)),tj(e)}else tQ(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==i&&(n=t,!(e1(e.h)>=e.h.j-!!e.s)&&(e.s?(e.i=n.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eM(w(e.Ga,e,n),tZ(e,e.B)),e.B++,!0)))||2==i&&tH(e)))switch(r&&0<r.length&&((t=e.h).i=t.i.concat(r)),s){case 1:t0(e,5);break;case 4:t0(e,10);break;case 3:t0(e,6);break;default:t0(e,2)}}}function tZ(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function t0(e,t){if(e.j.info("Error code "+t),2==t){let t,s,a;var n,r=w(e.fb,e),i=e.Xa;let o=!i;i=new e7(i||"//www.google.com/images/cleardot.gif"),g.location&&"http"==g.location.protocol||te(i,"https"),ti(i),o?function(e,t){let n=new eL;if(g.Image){let r=new Image;r.onload=b(tw,n,"TestLoadImage: loaded",!0,t,r),r.onerror=b(tw,n,"TestLoadImage: error",!1,t,r),r.onabort=b(tw,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=b(tw,n,"TestLoadImage: timeout",!1,t,r),g.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(i.toString(),r):(n=i.toString(),t=new eL,s=new AbortController,a=setTimeout(()=>{s.abort(),tw(t,"TestPingServer: timeout",!1,r)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(a),e.ok?tw(t,"TestPingServer: ok",!0,r):tw(t,"TestPingServer: server error",!1,r)}).catch(()=>{clearTimeout(a),tw(t,"TestPingServer: error",!1,r)}))}else eN(2);e.G=0,e.l&&e.l.sa(t),t1(e),tz(e)}function t1(e){if(e.G=0,e.ka=[],e.l){let t=e5(e.h);(0!=t.length||0!=e.i.length)&&(I(e.ka,t),I(e.ka,e.i),e.h.i.length=0,E(e.i),e.i.length=0),e.l.ra()}}function t2(e,t,n){var r=n instanceof e7?e9(n):new e7(n);if(""!=r.g)t&&(r.g=t+"."+r.g),tt(r,r.s);else{var i=g.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new e7(null);r&&te(s,r),t&&(s.g=t),i&&tt(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&tr(r,n,t),tr(r,"VER",e.la),t$(e,r),r}function t6(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tA(e.Ca&&!e.pa?new tT({eb:n}):e.pa)).Ha(e.J),t}function t3(){}function t5(){}function t4(e,t){el.call(this),this.g=new tB(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!_(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!_(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t9(this)}function t8(e){eI.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t7(){e_.call(this),this.status=1}function t9(e){this.g=e}(n=tA.prototype).Ha=function(e){this.J=e},n.ea=function(e,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);n=n?n.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?eb(this.o):eb(t),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(n,String(e),!0),this.B=!1}catch(e){tN(this,e);return}if(e=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[t,a]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=g.FormData&&e instanceof g.FormData,!(0<=Array.prototype.indexOf.call(tk,n,void 0))||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(t,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tO(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tN(this,e)}},n.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,eu(this,"complete"),eu(this,"abort"),tL(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tL(this,!0)),tA.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?tM(this):this.bb())},n.bb=function(){tM(this)},n.isActive=function(){return!!this.g},n.Z=function(){try{return 2<tP(this)?this.g.status:-1}catch(e){return -1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},n.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ey(t)}},n.Ba=function(){return this.m},n.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(n=tB.prototype).la=8,n.G=1,n.connect=function(e,t,n,r){eN(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=t2(this,null,this.W),tj(this)},n.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new eB(this,this.j,e),s=this.o;if(this.S&&(s?N(s=D(s),this.S):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tG(this,i,t),tr(n=e9(this.I),"RID",e),tr(n,"CVER",22),this.D&&tr(n,"X-HTTP-Session-Id",this.D),t$(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(tS(s)))+"&"+t:this.m&&tC(n,this.m,s)),e6(this.h,i),this.Ua&&tr(n,"TYPE","init"),this.P?(tr(n,"$req",t),tr(n,"SID","null"),i.T=!0,ej(i,n,null)):ej(i,n,t),this.G=2}}else 3==this.G&&(e?tK(this,e):0==this.i.length||e0(this.h)||tK(this))},n.Fa=function(){if(this.u=null,tJ(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eM(w(this.ab,this),e)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,eN(10),tq(this),tJ(this))},n.Za=function(){null!=this.C&&(this.C=null,tq(this),tH(this),eN(19))},n.fb=function(e){e?(this.j.info("Successfully pinged google.com"),eN(2)):(this.j.info("Failed to ping google.com"),eN(1))},n.isActive=function(){return!!this.l&&this.l.isActive(this)},(n=t3.prototype).ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){},t5.prototype.g=function(e,t){return new t4(e,t)},T(t4,el),t4.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t4.prototype.close=function(){tU(this.g)},t4.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=em(e),e=n);t.i.push(new eY(t.Ya++,e)),3==t.G&&tj(t)},t4.prototype.N=function(){this.g.l=null,delete this.j,tU(this.g),delete this.g,t4.aa.N.call(this)},T(t8,eI),T(t7,e_),T(t9,t3),t9.prototype.ua=function(){eu(this.g,"a")},t9.prototype.ta=function(e){eu(this.g,new t8(e))},t9.prototype.sa=function(e){eu(this.g,new t7)},t9.prototype.ra=function(){eu(this.g,"b")},t5.prototype.createWebChannel=t5.prototype.g,t4.prototype.send=t4.prototype.o,t4.prototype.open=t4.prototype.m,t4.prototype.close=t4.prototype.close,h=Q.createWebChannelTransport=function(){return new t5},u=Q.getStatEventTarget=function(){return eC()},l=Q.Event=ex,o=Q.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eP.NO_ERROR=0,eP.TIMEOUT=8,eP.HTTP_ERROR=6,a=Q.ErrorCode=eP,eF.COMPLETE="complete",s=Q.EventType=eF,eT.EventType=eE,eE.OPEN="a",eE.CLOSE="b",eE.ERROR="c",eE.MESSAGE="d",el.prototype.listen=el.prototype.K,i=Q.WebChannel=eT,Q.FetchXmlHttpFactory=tT,tA.prototype.listenOnce=tA.prototype.L,tA.prototype.getLastError=tA.prototype.Ka,tA.prototype.getLastErrorCode=tA.prototype.Ba,tA.prototype.getStatus=tA.prototype.Z,tA.prototype.getResponseJson=tA.prototype.Oa,tA.prototype.getResponseText=tA.prototype.oa,tA.prototype.send=tA.prototype.ea,tA.prototype.setWithCredentials=tA.prototype.Ha,r=Q.XhrIo=tA}).apply(void 0!==G?G:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let H="@firebase/firestore",W="4.7.15";class J{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}J.UNAUTHENTICATED=new J(null),J.GOOGLE_CREDENTIALS=new J("google-credentials-uid"),J.FIRST_PARTY=new J("first-party-uid"),J.MOCK_USER=new J("mock-user");let X="11.8.0",Y=new j.Logger("@firebase/firestore");function Z(){return Y.logLevel}function ee(e){Y.setLogLevel(e)}function et(e,...t){if(Y.logLevel<=j.LogLevel.DEBUG){let n=t.map(ei);Y.debug(`Firestore (${X}): ${e}`,...n)}}function en(e,...t){if(Y.logLevel<=j.LogLevel.ERROR){let n=t.map(ei);Y.error(`Firestore (${X}): ${e}`,...n)}}function er(e,...t){if(Y.logLevel<=j.LogLevel.WARN){let n=t.map(ei);Y.warn(`Firestore (${X}): ${e}`,...n)}}function ei(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function es(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,ea(e,r,n)}function ea(e,t,n){let r=`FIRESTORE (${X}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw en(r),Error(r)}function eo(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||ea(t,i,r)}function el(e,t){e||es(57014,t)}let eu={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class eh extends P{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ec{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ed{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ef{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(J.UNAUTHENTICATED))}shutdown(){}}class eg{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ep{constructor(e){this.t=e,this.currentUser=J.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){eo(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new ec;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ec,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{et("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(et("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ec)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(et("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(eo("string"==typeof t.accessToken,31837,{l:t}),new ed(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return eo(null===e||"string"==typeof e,2055,{h:e}),new J(e)}}class em{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=J.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class ey{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new em(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(J.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ev{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ew{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,y._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){eo(void 0===this.o,3512);let n=e=>{null!=e.error&&et("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,et("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{et("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):et("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new ev(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(eo("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new ev(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class eb{getToken(){return Promise.resolve(new ev(""))}invalidateToken(){}start(e,t){}shutdown(){}}function eT(){return new TextEncoder}class eE{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function eI(e,t){return e<t?-1:+(e>t)}function e_(e,t){let n=0;for(;n<e.length&&n<t.length;){let r=e.codePointAt(n),i=t.codePointAt(n);if(r!==i){if(r<128&&i<128)return eI(r,i);{let s=eT(),a=function(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return eI(e[n],t[n]);return eI(e.length,t.length)}(s.encode(ex(e,n)),s.encode(ex(t,n)));return 0!==a?a:eI(r,i)}}n+=r>65535?2:1}return eI(e.length,t.length)}function ex(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function eS(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class eC{static now(){return eC.fromMillis(Date.now())}static fromDate(e){return eC.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new eC(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new eh(eu.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new eh(eu.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?eI(this.nanoseconds,e.nanoseconds):eI(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class eA{static fromTimestamp(e){return new eA(e)}static min(){return new eA(new eC(0,0))}static max(){return new eA(new eC(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let eD="__name__";class ek{constructor(e,t,n){void 0===t?t=0:t>e.length&&es(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&es(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ek.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof ek?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=ek.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return eI(e.length,t.length)}static compareSegments(e,t){let n=ek.isNumericId(e),r=ek.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?ek.extractNumericId(e).compare(ek.extractNumericId(t)):e_(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return t.fromString(e.substring(4,e.length-2))}}class eN extends ek{construct(e,t,n){return new eN(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new eh(eu.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new eN(t)}static emptyPath(){return new eN([])}}let eR=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class eM extends ek{construct(e,t,n){return new eM(e,t,n)}static isValidIdentifier(e){return eR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),eM.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===eD}static keyField(){return new eM([eD])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new eh(eu.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new eh(eu.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new eh(eu.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new eh(eu.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new eM(t)}static emptyPath(){return new eM([])}}class eL{constructor(e){this.path=e}static fromPath(e){return new eL(eN.fromString(e))}static fromName(e){return new eL(eN.fromString(e).popFirst(5))}static empty(){return new eL(eN.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===eN.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return eN.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new eL(new eN(e.slice()))}}class eO{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function eP(e){return e.fields.find(e=>2===e.kind)}function eF(e){return e.fields.filter(e=>2!==e.kind)}function eV(e,t){let n=eI(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=function(e,t){let n=eM.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:eI(e.kind,t.kind)}(e.fields[r],t.fields[r])))return n;return eI(e.fields.length,t.fields.length)}eO.UNKNOWN_ID=-1;class eB{constructor(e,t){this.fieldPath=e,this.kind=t}}class eU{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new eU(0,ej.min())}}function eq(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new ej(eA.fromTimestamp(1e9===r?new eC(n+1,0):new eC(n,r)),eL.empty(),t)}function ez(e){return new ej(e.readTime,e.key,-1)}class ej{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ej(eA.min(),eL.empty(),-1)}static max(){return new ej(eA.max(),eL.empty(),-1)}}function eK(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=eL.comparator(e.documentKey,t.documentKey))?n:eI(e.largestBatchId,t.largestBatchId)}let e$="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eG{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function eQ(e){if(e.code!==eu.FAILED_PRECONDITION||e.message!==e$)throw e;et("LocalStore","Unexpectedly lost primary lease")}class eH{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&es(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new eH((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof eH?t:eH.resolve(t)}catch(e){return eH.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):eH.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):eH.reject(t)}static resolve(e){return new eH((t,n)=>{t(e)})}static reject(e){return new eH((t,n)=>{n(e)})}static waitFor(e){return new eH((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=eH.resolve(!1);for(let n of e)t=t.next(e=>e?eH.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new eH((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new eH((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}let eW="SimpleDb";class eJ{static open(e,t,n,r){try{return new eJ(t,e.transaction(r,n))}catch(e){throw new e0(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new ec,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new e0(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let n=e5(t.target.error);this.S.reject(new e0(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(et(eW,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new e2(this.transaction.objectStore(e))}}class eX{static delete(e){return et(eW,"Removing database:",e),e6(x().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}())return!1;if(eX.F())return!0;let e=R(),t=eX.M(e),n=eY(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static F(){var e;return void 0!==p.default&&"YES"===(null==(e=p.default.__PRIVATE_env)?void 0:e.O)}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,n){this.name=e,this.version=t,this.B=n,this.L=null,12.2===eX.M(R())&&en("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(et(eW,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new e0(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new eh(eu.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new eh(eu.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new e0(e,r))},r.onupgradeneeded=e=>{et(eW,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;if(null!==this.L&&this.L!==e.oldVersion)throw Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${e.oldVersion}, event.newVersion=${e.newVersion}, db.version=${t.version}`);this.B.q(t,r.transaction,e.oldVersion,this.version).next(()=>{et(eW,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{let t=e.target;this.L=t.version},{passive:!0})),this.$&&(this.db.onversionchange=e=>this.$(e)),this.db}U(e){this.$=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.k(e);let t=eJ.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.v(),e)).catch(e=>(t.abort(e),eH.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(et(eW,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function eY(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class eZ{constructor(e){this.K=e,this.W=!1,this.G=null}get isDone(){return this.W}get j(){return this.G}set cursor(e){this.K=e}done(){this.W=!0}H(e){this.G=e}delete(){return e6(this.K.delete())}}class e0 extends eh{constructor(e,t){super(eu.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function e1(e){return"IndexedDbTransactionError"===e.name}class e2{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(et(eW,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(et(eW,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),e6(n)}add(e){return et(eW,"ADD",this.store.name,e,e),e6(this.store.add(e))}get(e){return e6(this.store.get(e)).next(t=>(void 0===t&&(t=null),et(eW,"GET",this.store.name,e,t),t))}delete(e){return et(eW,"DELETE",this.store.name,e),e6(this.store.delete(e))}count(){return et(eW,"COUNT",this.store.name),e6(this.store.count())}J(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new eH((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.Y(e,(e,n)=>{t.push(n)}).next(()=>t)}}Z(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new eH((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}X(e,t){et(eW,"DELETE ALL",this.store.name);let n=this.options(e,t);n.ee=!1;let r=this.cursor(n);return this.Y(r,(e,t,n)=>n.delete())}te(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.Y(r,t)}ne(e){let t=this.cursor({});return new eH((n,r)=>{t.onerror=e=>{r(e5(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}Y(e,t){let n=[];return new eH((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new eZ(i),a=t(i.primaryKey,i.value,s);if(a instanceof eH){let e=a.catch(e=>(s.done(),eH.reject(e)));n.push(e)}s.isDone?r():null===s.j?i.continue():i.continue(s.j)}}).next(()=>eH.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.ee?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function e6(e){return new eH((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(e5(e.target.error))}})}let e3=!1;function e5(e){let t=eX.M(R());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new eh("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return e3||(e3=!0,setTimeout(()=>{throw e},0)),e}}return e}let e4="IndexBackfiller";class e8{constructor(e,t){this.asyncQueue=e,this.re=t,this.task=null}start(){this.ie(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ie(e){et(e4,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.re.se();et(e4,`Documents written: ${e}`)}catch(e){e1(e)?et(e4,"Ignoring IndexedDB error during index backfill: ",e):await eQ(e)}await this.ie(6e4)})}}class e7{constructor(e,t){this.localStore=e,this.persistence=t}async se(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.oe(t,e))}oe(e,t){let n=new Set,r=t,i=!0;return eH.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return et(e4,`Processing collection: ${t}`),this._e(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}_e(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.ae(r,n)).next(n=>(et(e4,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}ae(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=ez(t);eK(r,n)>0&&(n=r)}),new ej(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class e9{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ce&&this.ce(e),e}}function te(e){return null==e}function tt(e){return 0===e&&1/e==-1/0}function tn(e){return"number"==typeof e&&Number.isInteger(e)&&!tt(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function tr(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}e9.le=-1;function ti(e){let t=e.length;if(eo(t>=2,64408,{path:e}),2===t)return eo("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),eN.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&es(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:es(61167,{path:e})}s=t+2}return new eN(r)}let ts="remoteDocuments",ta="owner",to="owner",tl="mutationQueues",tu="mutations",th="batchId",tc="userMutationsIndex",td=["userId","batchId"],tf={},tg="documentMutations",tp="remoteDocumentsV14",tm=["prefixPath","collectionGroup","readTime","documentId"],ty="documentKeyIndex",tv=["prefixPath","collectionGroup","documentId"],tw="collectionGroupIndex",tb=["collectionGroup","readTime","prefixPath","documentId"],tT="remoteDocumentGlobal",tE="remoteDocumentGlobalKey",tI="targets",t_="queryTargetsIndex",tx=["canonicalId","targetId"],tS="targetDocuments",tC=["targetId","path"],tA="documentTargetsIndex",tD=["path","targetId"],tk="targetGlobalKey",tN="targetGlobal",tR="collectionParents",tM=["collectionId","parent"],tL="clientMetadata",tO="bundles",tP="namedQueries",tF="indexConfiguration",tV="collectionGroupIndex",tB="indexState",tU=["indexId","uid"],tq="sequenceNumberIndex",tz=["uid","sequenceNumber"],tj="indexEntries",tK=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],t$="documentKeyIndex",tG=["indexId","uid","orderedDocumentKey"],tQ="documentOverlays",tH=["userId","collectionPath","documentId"],tW="collectionPathOverlayIndex",tJ=["userId","collectionPath","largestBatchId"],tX="collectionGroupOverlayIndex",tY=["userId","collectionGroup","largestBatchId"],tZ="globals",t0=[tl,tu,tg,ts,tI,ta,tN,tS,tL,tT,tR,tO,tP],t1=[...t0,tQ],t2=[tl,tu,tg,tp,tI,ta,tN,tS,tL,tT,tR,tO,tP,tQ],t6=[...t2,tF,tB,tj],t3=[...t6,tZ];class t5 extends eG{constructor(e,t){super(),this.he=e,this.currentSequenceNumber=t}}function t4(e,t){return eX.N(e.he,t)}function t8(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function t7(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function t9(e,t){let n=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}function ne(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class nt{constructor(e,t){this.comparator=e,this.root=t||nr.EMPTY}insert(e,t){return new nt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nr.BLACK,null,null))}remove(e){return new nt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nn(this.root,e,this.comparator,!1)}getReverseIterator(){return new nn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nn(this.root,e,this.comparator,!0)}}class nn{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nr{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:nr.RED,this.left=null!=r?r:nr.EMPTY,this.right=null!=i?i:nr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new nr(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return nr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return nr.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,nr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,nr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw es(43730,{key:this.key,value:this.value});if(this.right.isRed())throw es(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw es(27949);return e+ +!this.isRed()}}nr.EMPTY=null,nr.RED=!0,nr.BLACK=!1,nr.EMPTY=new class{constructor(){this.size=0}get key(){throw es(57766)}get value(){throw es(16141)}get color(){throw es(16727)}get left(){throw es(29726)}get right(){throw es(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new nr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ni{constructor(e){this.comparator=e,this.data=new nt(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ns(this.data.getIterator())}getIteratorFrom(e){return new ns(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof ni)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new ni(this.comparator);return t.data=e,t}}class ns{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function na(e){return e.hasNext()?e.getNext():void 0}class no{constructor(e){this.fields=e,e.sort(eM.comparator)}static empty(){return new no([])}unionWith(e){let t=new ni(eM.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new no(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return eS(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class nl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function nu(){return"undefined"!=typeof atob}class nh{constructor(e){this.binaryString=e}static fromBase64String(e){return new nh(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new nl("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new nh(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return eI(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}nh.EMPTY_BYTE_STRING=new nh("");let nc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nd(e){if(eo(!!e,39018),"string"==typeof e){let t=0,n=nc.exec(e);if(eo(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:nf(e.seconds),nanos:nf(e.nanos)}}function nf(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ng(e){return"string"==typeof e?nh.fromBase64String(e):nh.fromUint8Array(e)}let np="server_timestamp",nm="__type__",ny="__previous_value__",nv="__local_write_time__";function nw(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[nm])?void 0:n.stringValue)===np}function nb(e){let t=e.mapValue.fields[ny];return nw(t)?nb(t):t}function nT(e){let t=nd(e.mapValue.fields[nv].timestampValue);return new eC(t.seconds,t.nanos)}class nE{constructor(e,t,n,r,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}let nI="(default)";class n_{constructor(e,t){this.projectId=e,this.database=t||nI}static empty(){return new n_("","")}get isDefaultDatabase(){return this.database===nI}isEqual(e){return e instanceof n_&&e.projectId===this.projectId&&e.database===this.database}}let nx="__type__",nS="__max__",nC={mapValue:{fields:{__type__:{stringValue:nS}}}},nA="__vector__",nD="value",nk={nullValue:"NULL_VALUE"};function nN(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?nw(e)?4:nG(e)?0x1fffffffffffff:nK(e)?10:11:es(28295,{value:e})}function nR(e,t){if(e===t)return!0;let n=nN(e);if(n!==nN(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return nT(e).isEqual(nT(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=nd(e.timestampValue),i=nd(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return ng(e.bytesValue).isEqual(ng(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return nf(e.geoPointValue.latitude)===nf(t.geoPointValue.latitude)&&nf(e.geoPointValue.longitude)===nf(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return nf(e.integerValue)===nf(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=nf(e.doubleValue),r=nf(t.doubleValue);return n===r?tt(n)===tt(r):isNaN(n)&&isNaN(r)}return!1;case 9:return eS(e.arrayValue.values||[],t.arrayValue.values||[],nR);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(t8(s)!==t8(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!nR(s[e],a[e])))return!1;return!0;default:return es(52216,{left:e})}}function nM(e,t){return void 0!==(e.values||[]).find(e=>nR(e,t))}function nL(e,t){var n,r,i,s,a,o,l,u,h,c;if(e===t)return 0;let d=nN(e),f=nN(t);if(d!==f)return eI(d,f);switch(d){case 0:case 0x1fffffffffffff:return 0;case 1:return eI(e.booleanValue,t.booleanValue);case 2:let g,p;return g=nf(e.integerValue||e.doubleValue),g<(p=nf(t.integerValue||t.doubleValue))?-1:g>p?1:g===p?0:isNaN(g)?isNaN(p)?0:-1:1;case 3:return nO(e.timestampValue,t.timestampValue);case 4:return nO(nT(e),nT(t));case 5:return e_(e.stringValue,t.stringValue);case 6:let m,y;return n=e.bytesValue,r=t.bytesValue,m=ng(n),y=ng(r),m.compareTo(y);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=eI(n[e],r[e]);if(0!==t)return t}return eI(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:let v;return i=e.geoPointValue,s=t.geoPointValue,0!==(v=eI(nf(i.latitude),nf(s.latitude)))?v:eI(nf(i.longitude),nf(s.longitude));case 9:return nP(e.arrayValue,t.arrayValue);case 10:let w,b,T,E,I;return a=e.mapValue,o=t.mapValue,w=a.fields||{},b=o.fields||{},T=null==(l=w[nD])?void 0:l.arrayValue,E=null==(u=b[nD])?void 0:u.arrayValue,0!==(I=eI((null==(h=null==T?void 0:T.values)?void 0:h.length)||0,(null==(c=null==E?void 0:E.values)?void 0:c.length)||0))?I:nP(T,E);case 11:return function(e,t){if(e===nC.mapValue&&t===nC.mapValue)return 0;if(e===nC.mapValue)return 1;if(t===nC.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=e_(r[e],s[e]);if(0!==t)return t;let a=nL(n[r[e]],i[s[e]]);if(0!==a)return a}return eI(r.length,s.length)}(e.mapValue,t.mapValue);default:throw es(23264,{Pe:d})}}function nO(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return eI(e,t);let n=nd(e),r=nd(t),i=eI(n.seconds,r.seconds);return 0!==i?i:eI(n.nanos,r.nanos)}function nP(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=nL(n[e],r[e]);if(t)return t}return eI(n.length,r.length)}function nF(e){var t,n;let r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(r=nd(e.timestampValue),`time(${r.seconds},${r.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?ng(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,eL.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=nF(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${nF(e.fields[i])}`;return n+"}"}(e.mapValue):es(61005,{value:e})}function nV(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function nB(e){return!!e&&"integerValue"in e}function nU(e){return!!e&&"arrayValue"in e}function nq(e){return!!e&&"nullValue"in e}function nz(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function nj(e){return!!e&&"mapValue"in e}function nK(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[nx])?void 0:n.stringValue)===nA}function n$(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return t7(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=n$(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=n$(e.arrayValue.values[n]);return t}return Object.assign({},e)}function nG(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===nS}let nQ={mapValue:{fields:{[nx]:{stringValue:nA},[nD]:{arrayValue:{}}}}};function nH(e,t){let n=nL(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function nW(e,t){let n=nL(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class nJ{constructor(e){this.value=e}static empty(){return new nJ({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!nj(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=n$(t)}setAll(e){let t=eM.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=n$(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());nj(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nR(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];nj(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(t7(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new nJ(n$(this.value))}}class nX{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new nX(e,0,eA.min(),eA.min(),eA.min(),nJ.empty(),0)}static newFoundDocument(e,t,n,r){return new nX(e,1,t,eA.min(),n,r,0)}static newNoDocument(e,t){return new nX(e,2,t,eA.min(),eA.min(),nJ.empty(),0)}static newUnknownDocument(e,t){return new nX(e,3,t,eA.min(),eA.min(),nJ.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(eA.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nJ.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nJ.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=eA.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof nX&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new nX(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class nY{constructor(e,t){this.position=e,this.inclusive=t}}function nZ(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?eL.comparator(eL.fromName(a.referenceValue),n.key):nL(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function n0(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!nR(e.position[n],t.position[n]))return!1;return!0}class n1{constructor(e,t="asc"){this.field=e,this.dir=t}}class n2{}class n6 extends n2{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new re(e,t,n):"array-contains"===t?new ri(e,n):"in"===t?new rs(e,n):"not-in"===t?new ra(e,n):"array-contains-any"===t?new ro(e,n):new n6(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new rt(e,n):new rn(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(nL(t,this.value)):null!==t&&nN(this.value)===nN(t)&&this.matchesComparison(nL(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return es(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class n3 extends n2{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new n3(e,t)}matches(e){return n5(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function n5(e){return"and"===e.op}function n4(e){return"or"===e.op}function n8(e){return n7(e)&&n5(e)}function n7(e){for(let t of e.filters)if(t instanceof n3)return!1;return!0}function n9(e,t){let n=e.filters.concat(t);return n3.create(n,e.op)}class re extends n6{constructor(e,t,n){super(e,t,n),this.key=eL.fromName(n.referenceValue)}matches(e){let t=eL.comparator(e.key,this.key);return this.matchesComparison(t)}}class rt extends n6{constructor(e,t){super(e,"in",t),this.keys=rr("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rn extends n6{constructor(e,t){super(e,"not-in",t),this.keys=rr("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rr(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>eL.fromName(e.referenceValue))}class ri extends n6{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return nU(t)&&nM(t.arrayValue,this.value)}}class rs extends n6{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&nM(this.value.arrayValue,t)}}class ra extends n6{constructor(e,t){super(e,"not-in",t)}matches(e){if(nM(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!nM(this.value.arrayValue,t)}}class ro extends n6{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!nU(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>nM(this.value.arrayValue,e))}}class rl{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.Ie=null}}function ru(e,t=null,n=[],r=[],i=null,s=null,a=null){return new rl(e,t,n,r,i,s,a)}function rh(e){if(null===e.Ie){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof n6)return t.field.canonicalString()+t.op.toString()+nF(t.value);if(n8(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),te(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>nF(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>nF(e)).join(",")),e.Ie=t}return e.Ie}function rc(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof n6?n instanceof n6&&t.op===n.op&&t.field.isEqual(n.field)&&nR(t.value,n.value):t instanceof n3?n instanceof n3&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void es(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!n0(e.startAt,t.startAt)&&n0(e.endAt,t.endAt)}function rd(e){return eL.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function rf(e,t){return e.filters.filter(e=>e instanceof n6&&e.field.isEqual(t))}function rg(e,t,n){let r=nk,i=!0;for(let n of rf(e,t)){let e=nk,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?nk:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?nV(n_.empty(),eL.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?nK(s)?nQ:{mapValue:{}}:es(35942,{value:s});break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=nk}0>nH({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>nH({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function rp(e,t,n){let r=nC,i=!0;for(let n of rf(e,t)){let e=nC,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?nV(n_.empty(),eL.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?nQ:"mapValue"in s?nK(s)?{mapValue:{}}:nC:es(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=nC}nW({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];nW({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class rm{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function ry(e){return new rm(e)}function rv(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function rw(e){return null!==e.collectionGroup}function rb(e){if(null===e.Ee){let t;e.Ee=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ee.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new ni(eM.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ee.push(new n1(t,r))}),n.has(eM.keyField().canonicalString())||e.Ee.push(new n1(eM.keyField(),r))}return e.Ee}function rT(e){return e.de||(e.de=rI(e,rb(e))),e.de}function rE(e){return e.Ae||(e.Ae=rI(e,e.explicitOrderBy)),e.Ae}function rI(e,t){if("F"===e.limitType)return ru(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new n1(e.field,t)});let n=e.endAt?new nY(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new nY(e.startAt.position,e.startAt.inclusive):null;return ru(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function r_(e,t){let n=e.filters.concat([t]);return new rm(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function rx(e,t,n){return new rm(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function rS(e,t){return rc(rT(e),rT(t))&&e.limitType===t.limitType}function rC(e){return`${rh(rT(e))}|lt:${e.limitType}`}function rA(e){var t;let n;return`Query(target=${n=(t=rT(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof n6?`${t.field.canonicalString()} ${t.op} ${nF(t.value)}`:t instanceof n3?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),te(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>nF(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>nF(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function rD(e,t){var n,r,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):eL.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let n of rb(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,r=t,(!n.startAt||(i=n.startAt,o=nZ(i,rb(n),r),i.inclusive?!!(o<=0):!!(o<0)))&&(!n.endAt||(s=n.endAt,l=nZ(s,rb(n),r),s.inclusive?!!(l>=0):!!(l>0))))}function rk(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function rN(e){return(t,n)=>{let r=!1;for(let i of rb(e)){let e=function(e,t,n){var r;let i,s,a=e.field.isKeyField()?eL.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),s=n.data.field(r),null!==i&&null!==s?nL(i,s):es(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return es(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class rR{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){t7(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return ne(this.inner)}size(){return this.innerSize}}let rM=new nt(eL.comparator),rL=new nt(eL.comparator);function rO(...e){let t=rL;for(let n of e)t=t.insert(n.key,n);return t}function rP(e){let t=rL;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function rF(){return new rR(e=>e.toString(),(e,t)=>e.isEqual(t))}let rV=new nt(eL.comparator),rB=new ni(eL.comparator);function rU(...e){let t=rB;for(let n of e)t=t.add(n);return t}let rq=new ni(eI);function rz(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:tt(t)?"-0":t}}function rj(e){return{integerValue:""+e}}function rK(e,t){return tn(t)?rj(t):rz(e,t)}class r${constructor(){this._=void 0}}function rG(e,t){return e instanceof rY?nB(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class rQ extends r${}class rH extends r${constructor(e){super(),this.elements=e}}function rW(e,t){let n=r0(t);for(let t of e.elements)n.some(e=>nR(e,t))||n.push(t);return{arrayValue:{values:n}}}class rJ extends r${constructor(e){super(),this.elements=e}}function rX(e,t){let n=r0(t);for(let t of e.elements)n=n.filter(e=>!nR(e,t));return{arrayValue:{values:n}}}class rY extends r${constructor(e,t){super(),this.serializer=e,this.Re=t}}function rZ(e){return nf(e.integerValue||e.doubleValue)}function r0(e){return nU(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class r1{constructor(e,t){this.field=e,this.transform=t}}class r2{constructor(e,t){this.version=e,this.transformResults=t}}class r6{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r6}static exists(e){return new r6(void 0,e)}static updateTime(e){return new r6(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function r3(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class r5{}function r4(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new is(e.key,r6.none()):new r9(e.key,e.data,r6.none());{let n=e.data,r=nJ.empty(),i=new ni(eM.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new ie(e.key,r,new no(i.toArray()),r6.none())}}function r8(e,t,n,r){return e instanceof r9?function(e,t,n,r){if(!r3(e.precondition,t))return n;let i=e.value.clone(),s=ii(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof ie?function(e,t,n,r){if(!r3(e.precondition,t))return n;let i=ii(e.fieldTransforms,r,t),s=t.data;return(s.setAll(it(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):r3(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function r7(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&eS(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof rH&&r instanceof rH||n instanceof rJ&&r instanceof rJ?eS(n.elements,r.elements,nR):n instanceof rY&&r instanceof rY?nR(n.Re,r.Re):n instanceof rQ&&r instanceof rQ)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class r9 extends r5{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ie extends r5{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function it(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function ir(e,t,n){let r=new Map;eo(e.length===n.length,32656,{Ve:n.length,me:e.length});for(let s=0;s<n.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);r.set(a.field,(i=n[s],o instanceof rH?rW(o,l):o instanceof rJ?rX(o,l):i))}return r}function ii(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,function(e,t,n){var r;let i,s,a;return e instanceof rQ?(r=t,i={fields:{[nm]:{stringValue:np},[nv]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&nw(r)&&(r=nb(r)),r&&(i.fields[ny]=r),{mapValue:i}):e instanceof rH?rW(e,t):e instanceof rJ?rX(e,t):(a=rZ(s=rG(e,t))+rZ(e.Re),nB(s)&&nB(e.Re)?rj(a):rz(e.serializer,a))}(e,s,t))}return r}class is extends r5{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ia extends r5{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class io{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){let r,i;e instanceof r9?(r=e.value.clone(),i=ir(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof ie?function(e,t,n){if(!r3(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=ir(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(it(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=r8(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=r8(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=rF();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=r4(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(eA.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),rU())}isEqual(e){return this.batchId===e.batchId&&eS(this.mutations,e.mutations,(e,t)=>r7(e,t))&&eS(this.baseMutations,e.baseMutations,(e,t)=>r7(e,t))}}class il{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){eo(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let r=rV,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new il(e,t,n,r)}}class iu{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ih{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class ic{constructor(e,t){this.count=e,this.unchangedNames=t}}function id(e){switch(e){case eu.OK:return es(64938);case eu.CANCELLED:case eu.UNKNOWN:case eu.DEADLINE_EXCEEDED:case eu.RESOURCE_EXHAUSTED:case eu.INTERNAL:case eu.UNAVAILABLE:case eu.UNAUTHENTICATED:return!1;case eu.INVALID_ARGUMENT:case eu.NOT_FOUND:case eu.ALREADY_EXISTS:case eu.PERMISSION_DENIED:case eu.FAILED_PRECONDITION:case eu.ABORTED:case eu.OUT_OF_RANGE:case eu.UNIMPLEMENTED:case eu.DATA_LOSS:return!0;default:return es(15467,{code:e})}}function ig(e){if(void 0===e)return en("GRPC error has no .code"),eu.UNKNOWN;switch(e){case c.OK:return eu.OK;case c.CANCELLED:return eu.CANCELLED;case c.UNKNOWN:return eu.UNKNOWN;case c.DEADLINE_EXCEEDED:return eu.DEADLINE_EXCEEDED;case c.RESOURCE_EXHAUSTED:return eu.RESOURCE_EXHAUSTED;case c.INTERNAL:return eu.INTERNAL;case c.UNAVAILABLE:return eu.UNAVAILABLE;case c.UNAUTHENTICATED:return eu.UNAUTHENTICATED;case c.INVALID_ARGUMENT:return eu.INVALID_ARGUMENT;case c.NOT_FOUND:return eu.NOT_FOUND;case c.ALREADY_EXISTS:return eu.ALREADY_EXISTS;case c.PERMISSION_DENIED:return eu.PERMISSION_DENIED;case c.FAILED_PRECONDITION:return eu.FAILED_PRECONDITION;case c.ABORTED:return eu.ABORTED;case c.OUT_OF_RANGE:return eu.OUT_OF_RANGE;case c.UNIMPLEMENTED:return eu.UNIMPLEMENTED;case c.DATA_LOSS:return eu.DATA_LOSS;default:return es(39323,{code:e})}}(d=c||(c={}))[d.OK=0]="OK",d[d.CANCELLED=1]="CANCELLED",d[d.UNKNOWN=2]="UNKNOWN",d[d.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",d[d.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",d[d.NOT_FOUND=5]="NOT_FOUND",d[d.ALREADY_EXISTS=6]="ALREADY_EXISTS",d[d.PERMISSION_DENIED=7]="PERMISSION_DENIED",d[d.UNAUTHENTICATED=16]="UNAUTHENTICATED",d[d.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",d[d.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",d[d.ABORTED=10]="ABORTED",d[d.OUT_OF_RANGE=11]="OUT_OF_RANGE",d[d.UNIMPLEMENTED=12]="UNIMPLEMENTED",d[d.INTERNAL=13]="INTERNAL",d[d.UNAVAILABLE=14]="UNAVAILABLE",d[d.DATA_LOSS=15]="DATA_LOSS";let ip=null,im=new t([0xffffffff,0xffffffff],0);function iy(e){let t=eT().encode(e),r=new n;return r.update(t),new Uint8Array(r.digest())}function iv(e){let n=new DataView(e.buffer),r=n.getUint32(0,!0),i=n.getUint32(4,!0),s=n.getUint32(8,!0),a=n.getUint32(12,!0);return[new t([r,i],0),new t([s,a],0)]}class iw{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new ib(`Invalid padding: ${n}`);if(r<0||e.length>0&&0===this.hashCount)throw new ib(`Invalid hash count: ${r}`);if(0===e.length&&0!==n)throw new ib(`Invalid padding when bitmap length is 0: ${n}`);this.pe=8*e.length-n,this.ye=t.fromNumber(this.pe)}we(e,n,r){let i=e.add(n.multiply(t.fromNumber(r)));return 1===i.compare(im)&&(i=new t([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ye).toNumber()}Se(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.pe)return!1;let[t,n]=iv(iy(e));for(let e=0;e<this.hashCount;e++){let r=this.we(t,n,e);if(!this.Se(r))return!1}return!0}static create(e,t,n){let r=new iw(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.pe)return;let[t,n]=iv(iy(e));for(let e=0;e<this.hashCount;e++){let r=this.we(t,n,e);this.be(r)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ib extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class iT{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,iE.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new iT(eA.min(),r,new nt(eI),rM,rU())}}class iE{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new iE(n,t,rU(),rU(),rU())}}class iI{constructor(e,t,n,r){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=r}}class i_{constructor(e,t){this.targetId=e,this.Ce=t}}class ix{constructor(e,t,n=nh.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class iS{constructor(){this.Fe=0,this.Me=iD(),this.xe=nh.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=rU(),t=rU(),n=rU();return this.Me.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:es(38017,{changeType:i})}}),new iE(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=iD()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,eo(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class iC{constructor(e){this.ze=e,this.je=new Map,this.He=rM,this.Je=iA(),this.Ye=iA(),this.Ze=new nt(eI)}Xe(e){for(let t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(let t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{let n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:es(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((e,n)=>{this.it(n)&&t(n)})}ot(e){let t=e.targetId,n=e.Ce.count,r=this._t(t);if(r){let d=r.target;if(rd(d))if(0===n){let e=new eL(d.path);this.tt(t,e,nX.newNoDocument(e,eA.min()))}else eo(1===n,20013,{expectedCount:n});else{let r=this.ut(t);if(r!==n){var i,s,a,o,l,u,h,c;let n,d,f=this.ct(e),g=f?this.lt(f,e,r):1;0!==g&&(this.st(t),this.Ze=this.Ze.insert(t,2===g?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null==ip||ip.ht((i=e.Ce,s=this.ze.Pt(),n={localCacheCount:r,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(d=i.unchangedNames)&&(n.bloomFilter={applied:0===g,hashCount:null!=(a=null==d?void 0:d.hashCount)?a:0,bitmapLength:null!=(u=null==(l=null==(o=null==d?void 0:d.bits)?void 0:o.bitmap)?void 0:l.length)?u:0,padding:null!=(c=null==(h=null==d?void 0:d.bits)?void 0:h.padding)?c:0,mightContain:e=>{var t;return null!=(t=null==f?void 0:f.mightContain(e))&&t}}),n))}}}}ct(e){let t,n,r=e.Ce.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=ng(i).toUint8Array()}catch(e){if(e instanceof nl)return er("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new iw(t,s,a)}catch(e){return er(e instanceof ib?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.pe?null:n}lt(e,t,n){return 2*(t.Ce.count!==n-this.Tt(e,t.targetId))}Tt(e,t){let n=this.ze.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.ze.Pt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.tt(t,n,null),r++)}),r}It(e){let t=new Map;this.je.forEach((n,r)=>{let i=this._t(r);if(i){if(n.current&&rd(i.target)){let t=new eL(i.target.path);this.Et(t).has(r)||this.dt(r,t)||this.tt(r,t,nX.newNoDocument(t,e))}n.Le&&(t.set(r,n.qe()),n.Qe())}});let n=rU();this.Ye.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this._t(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.He.forEach((t,n)=>n.setReadTime(e));let r=new iT(e,t,this.Ze,this.He,n);return this.He=rM,this.Je=iA(),this.Ye=iA(),this.Ze=new nt(eI),r}et(e,t){if(!this.it(e))return;let n=2*!!this.dt(e,t.key);this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;let r=this.rt(e);this.dt(e,t)?r.$e(t,1):r.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){let t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new iS,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new ni(eI),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new ni(eI),this.Je=this.Je.insert(e,t)),t}it(e){let t=null!==this._t(e);return t||et("WatchChangeAggregator","Detected inactive target",e),t}_t(e){let t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new iS),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function iA(){return new nt(eL.comparator)}function iD(){return new nt(eL.comparator)}let ik={asc:"ASCENDING",desc:"DESCENDING"},iN={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iR={and:"AND",or:"OR"};class iM{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function iL(e,t){return e.useProto3Json||te(t)?t:{value:t}}function iO(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function iP(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function iF(e){let t;return eo(!!e,49232),eA.fromTimestamp(new eC((t=nd(e)).seconds,t.nanos))}function iV(e,t){return iB(e,t).canonicalString()}function iB(e,t){let n=new eN(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function iU(e){let t=eN.fromString(e);return eo(i6(t),10190,{key:t.toString()}),t}function iq(e,t){return iV(e.databaseId,t.path)}function iz(e,t){let n=iU(t);if(n.get(1)!==e.databaseId.projectId)throw new eh(eu.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new eh(eu.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new eL(iG(n))}function ij(e,t){return iV(e.databaseId,t)}function iK(e){let t=iU(e);return 4===t.length?eN.emptyPath():iG(t)}function i$(e){return new eN(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function iG(e){return eo(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function iQ(e,t,n){return{name:iq(e,t),fields:n.value.mapValue.fields}}function iH(e,t,n){let r=iz(e,t.name),i=iF(t.updateTime),s=t.createTime?iF(t.createTime):eA.min(),a=new nJ({mapValue:{fields:t.fields}}),o=nX.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function iW(e,t){var n,r;let i;if(t instanceof r9)i={update:iQ(e,t.key,t.value)};else if(t instanceof is)i={delete:iq(e,t.key)};else if(t instanceof ie){let n;i={update:iQ(e,t.key,t.data),updateMask:(r=t.fieldMask,n=[],r.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof ia))return es(16599,{ft:t.type});i={verify:iq(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof rQ)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof rH)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof rJ)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof rY)return{fieldPath:t.field.canonicalString(),increment:n.Re};throw es(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:iO(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:es(27497)),i}function iJ(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?r6.updateTime(iF(n.updateTime)):void 0!==n.exists?r6.exists(n.exists):r6.none():r6.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let n;return n=null,"setToServerValue"in t?(eo("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new rQ):"appendMissingElements"in t?n=new rH(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new rJ(t.removeAllFromArray.values||[]):"increment"in t?n=new rY(e,t.increment):es(16584,{proto:t}),new r1(eM.fromServerFormat(t.fieldPath),n)}):[];if(t.update){t.update.name;let n=iz(e,t.update.name),s=new nJ({mapValue:{fields:t.update.fields}});return t.updateMask?new ie(n,s,new no((t.updateMask.fieldPaths||[]).map(e=>eM.fromServerFormat(e))),r,i):new r9(n,s,r,i)}return t.delete?new is(iz(e,t.delete),r):t.verify?new ia(iz(e,t.verify),r):es(1463,{proto:t})}function iX(e,t){return{documents:[ij(e,t.path)]}}function iY(e,t){var n,r;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=ij(e,i);let o=function(e){if(0!==e.length)return function e(t){var n;let r;return t instanceof n6?function(e){if("=="===e.op){if(nz(e.value))return{unaryFilter:{field:i1(e.field),op:"IS_NAN"}};if(nq(e.value))return{unaryFilter:{field:i1(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(nz(e.value))return{unaryFilter:{field:i1(e.field),op:"IS_NOT_NAN"}};if(nq(e.value))return{unaryFilter:{field:i1(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:i1(e.field),op:iN[e.op],value:e.value}}}(t):t instanceof n3?1===(r=(n=t).getFilters().map(t=>e(t))).length?r[0]:{compositeFilter:{op:iR[n.op],filters:r}}:es(54877,{filter:t})}(n3.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:i1(e.field),direction:ik[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=iL(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{gt:s,parent:i}}function iZ(e,t,n,r){let{gt:i,parent:s}=iY(e,t),a={},o=[],l=0;return n.forEach(e=>{let t=r?e.alias:"aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:i1(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:i1(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},yt:a,parent:s}}function i0(e){var t,n,r;let i,s,a,o,l=iK(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){eo(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=i2(e.unaryFilter.field);return n6.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=i2(e.unaryFilter.field);return n6.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=i2(e.unaryFilter.field);return n6.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=i2(e.unaryFilter.field);return n6.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return es(61313);default:return es(60726)}}(t):void 0!==t.fieldFilter?n6.create(i2(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return es(58110);default:return es(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?n3.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return es(1026)}}(t.compositeFilter.op)):es(30097,{filter:t})}(u.where))instanceof n3&&n8(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new n1(i2(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let g=null;u.limit&&(g=te(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let p=null;u.startAt&&(a=!!(n=u.startAt).before,p=new nY(n.values||[],a));let m=null;return u.endAt&&(o=!(r=u.endAt).before,m=new nY(r.values||[],o)),new rm(l,c,f,d,g,"F",p,m)}function i1(e){return{fieldPath:e.canonicalString()}}function i2(e){return eM.fromServerFormat(e.fieldPath)}function i6(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class i3{constructor(e,t,n,r,i=eA.min(),s=eA.min(),a=nh.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new i3(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new i3(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new i3(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new i3(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class i5{constructor(e){this.wt=e}}function i4(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:i8(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:iq(i=e.wt,t.key),fields:t.data.value.mapValue.fields,updateTime:iO(i,t.version.toTimestamp()),createTime:iO(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:i7(t.version)};else{if(!t.isUnknownDocument())return es(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:i7(t.version)}}return r}function i8(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function i7(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function i9(e){let t=new eC(e.seconds,e.nanoseconds);return eA.fromTimestamp(t)}function se(e,t){let n=(t.baseMutations||[]).map(t=>iJ(e.wt,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>iJ(e.wt,t)),i=eC.fromMillis(t.localWriteTimeMs);return new io(t.batchId,i,n,r)}function st(e){var t;let n,r=i9(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?i9(e.lastLimboFreeSnapshotVersion):eA.min();return new i3(void 0!==e.query.documents?(eo(1===(n=(t=e.query).documents.length),1966,{count:n}),rT(ry(iK(t.documents[0])))):rT(i0(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,i,nh.fromBase64String(e.resumeToken))}function sn(e,t){let n,r=i7(t.snapshotVersion),i=i7(t.lastLimboFreeSnapshotVersion);n=rd(t.target)?iX(e.wt,t.target):iY(e.wt,t.target).gt;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:rh(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function sr(e){let t=i0({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?rx(t,t.limit,"L"):t}function si(e,t){return new iu(t.largestBatchId,iJ(e.wt,t.overlayMutation))}function ss(e,t){let n=t.path.lastSegment();return[e,tr(t.path.popLast()),n]}function sa(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:i7(r.readTime),documentKey:tr(r.documentKey.path),largestBatchId:r.largestBatchId}}class so{getBundleMetadata(e,t){return t4(e,tO).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:i9(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return t4(e,tO).put({bundleId:t.id,createTime:i7(iF(t.createTime)),version:t.version})}getNamedQuery(e,t){return t4(e,tP).get(t).next(e=>{if(e)return{name:e.name,query:sr(e.bundledQuery),readTime:i9(e.readTime)}})}saveNamedQuery(e,t){return t4(e,tP).put({name:t.name,readTime:i7(iF(t.readTime)),bundledQuery:t.bundledQuery})}}class sl{constructor(e,t){this.serializer=e,this.userId=t}static St(e,t){return new sl(e,t.uid||"")}getOverlay(e,t){return t4(e,tQ).get(ss(this.userId,t)).next(e=>e?si(this.serializer,e):null)}getOverlays(e,t){let n=rF();return eH.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new iu(t,i);r.push(this.bt(e,s))}),eH.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(tr(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(t4(e,tQ).X(tW,r))}),eH.waitFor(i)}getOverlaysForCollection(e,t,n){let r=rF(),i=tr(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,1/0],!0);return t4(e,tQ).J(tW,s).next(e=>{for(let t of e){let e=si(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i,s=rF(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,1/0],!0);return t4(e,tQ).te({index:tX,range:a},(e,t,n)=>{let a=si(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}bt(e,t){return t4(e,tQ).put(function(e,t,n){let[r,i,s]=ss(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:iW(e.wt,n.mutation)}}(this.serializer,this.userId,t))}}class su{Dt(e){return t4(e,tZ)}getSessionToken(e){return this.Dt(e).get("sessionToken").next(e=>{let t=null==e?void 0:e.value;return t?nh.fromUint8Array(t):nh.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Dt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class sh{vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(+!!e.booleanValue);else if("integerValue"in e)this.Mt(t,15),t.xt(nf(e.integerValue));else if("doubleValue"in e){let n=nf(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),tt(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),"string"==typeof n&&(n=nd(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(ng(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?nG(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):nK(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):es(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){let n=e.fields||{};for(let e of(this.Mt(t,55),Object.keys(n)))this.Nt(e,t),this.Ct(n[e],t)}qt(e,t){var n,r;let i=e.fields||{};this.Mt(t,53);let s=(null==(r=null==(n=i[nD].arrayValue)?void 0:n.values)?void 0:r.length)||0;this.Mt(t,15),t.xt(nf(s)),this.Nt(nD,t),this.Ct(i[nD],t)}$t(e,t){let n=e.values||[];for(let e of(this.Mt(t,50),n))this.Ct(e,t)}kt(e,t){this.Mt(t,37),eL.fromName(e).path.forEach(e=>{this.Mt(t,60),this.Kt(e,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}function sc(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}sh.Wt=new sh;class sd{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Gt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.zt(n.value),n=t.next();this.jt()}Ht(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Yt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.zt(e);else if(e<2048)this.zt(960|e>>>6),this.zt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.zt(480|e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e);else{let e=t.codePointAt(0);this.zt(240|e>>>18),this.zt(128|63&e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e)}}this.jt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{let e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Yt()}en(e){let t=this.tn(e),n=sc(t);this.nn(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}rn(e){let t=this.tn(e),n=sc(t);this.nn(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}sn(){this._n(255),this._n(255)}an(){this.un(255),this.un(255)}reset(){this.position=0}seed(e){this.nn(e.length),this.buffer.set(e,this.position),this.position+=e.length}cn(){return this.buffer.slice(0,this.position)}tn(e){let t,n=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),r=!!(128&n[0]);n[0]^=r?255:128;for(let e=1;e<n.length;++e)n[e]^=255*!!r;return n}zt(e){let t=255&e;0===t?(this._n(0),this._n(255)):255===t?(this._n(255),this._n(0)):this._n(t)}Jt(e){let t=255&e;0===t?(this.un(0),this.un(255)):255===t?(this.un(255),this.un(0)):this.un(e)}jt(){this._n(0),this._n(1)}Yt(){this.un(0),this.un(1)}_n(e){this.nn(1),this.buffer[this.position++]=e}un(e){this.nn(1),this.buffer[this.position++]=~e}nn(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class sf{constructor(e){this.ln=e}Lt(e){this.ln.Gt(e)}Ot(e){this.ln.Zt(e)}xt(e){this.ln.en(e)}Ft(){this.ln.sn()}}class sg{constructor(e){this.ln=e}Lt(e){this.ln.Ht(e)}Ot(e){this.ln.Xt(e)}xt(e){this.ln.rn(e)}Ft(){this.ln.an()}}class sp{constructor(){this.ln=new sd,this.hn=new sf(this.ln),this.Pn=new sg(this.ln)}seed(e){this.ln.seed(e)}Tn(e){return 0===e?this.hn:this.Pn}cn(){return this.ln.cn()}reset(){this.ln.reset()}}class sm{constructor(e,t,n,r){this.In=e,this.En=t,this.dn=n,this.An=r}Rn(){let e=this.An.length,t=0===e||255===this.An[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.An,0),t!==e?n.set([0],this.An.length):++n[n.length-1],new sm(this.In,this.En,this.dn,n)}Vn(e,t,n){return{indexId:this.In,uid:e,arrayValue:sw(this.dn),directionalValue:sw(this.An),orderedDocumentKey:sw(t),documentKey:n.path.toArray()}}mn(e,t,n){let r=this.Vn(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function sy(e,t){let n=e.In-t.In;return 0!==n||0!==(n=sv(e.dn,t.dn))||0!==(n=sv(e.An,t.An))?n:eL.comparator(e.En,t.En)}function sv(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}function sw(e){return O()?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):e}function sb(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)}class sT{constructor(e){for(const t of(this.fn=new ni((e,t)=>eM.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.gn=e.orderBy,this.pn=[],e.filters))t.isInequality()?this.fn=this.fn.add(t):this.pn.push(t)}get yn(){return this.fn.size>1}wn(e){if(eo(e.collectionGroup===this.collectionId,49279),this.yn)return!1;let t=eP(e);if(void 0!==t&&!this.Sn(t))return!1;let n=eF(e),r=new Set,i=0,s=0;for(;i<n.length&&this.Sn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.fn.size>0){let e=this.fn.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.bn(e,t)||!this.Dn(this.gn[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.gn.length||!this.Dn(this.gn[s++],e))return!1}return!0}vn(){if(this.yn)return null;let e=new ni(eM.comparator),t=[];for(let n of this.pn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new eB(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new eB(n.field,0))}for(let n of this.gn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new eB(n.field,+("asc"!==n.dir))));return new eO(eO.UNKNOWN_ID,this.collectionId,t,eU.empty())}Sn(e){for(let t of this.pn)if(this.bn(t,e))return!0;return!1}bn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}Dn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function sE(e){return e instanceof n6}function sI(e){return e instanceof n3&&n8(e)}function s_(e){return sE(e)||sI(e)||function(e){if(e instanceof n3&&n4(e)){for(let t of e.getFilters())if(!sE(t)&&!sI(t))return!1;return!0}return!1}(e)}function sx(e,t){return eo(e instanceof n6||e instanceof n3,38388),eo(t instanceof n6||t instanceof n3,25473),sC(e instanceof n6?t instanceof n6?n3.create([e,t],"and"):sS(e,t):t instanceof n6?sS(t,e):function(e,t){if(eo(e.filters.length>0&&t.filters.length>0,48005),n5(e)&&n5(t))return n9(e,t.getFilters());let n=n4(e)?e:t,r=n4(e)?t:e,i=n.filters.map(e=>sx(e,r));return n3.create(i,"or")}(e,t))}function sS(e,t){if(n5(t))return n9(t,e.getFilters());{let n=t.filters.map(t=>sx(e,t));return n3.create(n,"or")}}function sC(e){if(eo(e instanceof n6||e instanceof n3,11850),e instanceof n6)return e;let t=e.getFilters();if(1===t.length)return sC(t[0]);if(n7(e))return e;let n=t.map(e=>sC(e)),r=[];return n.forEach(t=>{t instanceof n6?r.push(t):t instanceof n3&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:n3.create(r,e.op)}class sA{constructor(){this.Cn=new sD}addToCollectionParentIndex(e,t){return this.Cn.add(t),eH.resolve()}getCollectionParents(e,t){return eH.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return eH.resolve()}deleteFieldIndex(e,t){return eH.resolve()}deleteAllFieldIndexes(e){return eH.resolve()}createTargetIndexes(e,t){return eH.resolve()}getDocumentsMatchingTarget(e,t){return eH.resolve(null)}getIndexType(e,t){return eH.resolve(0)}getFieldIndexes(e,t){return eH.resolve([])}getNextCollectionGroupToUpdate(e){return eH.resolve(null)}getMinOffset(e,t){return eH.resolve(ej.min())}getMinOffsetFromCollectionGroup(e,t){return eH.resolve(ej.min())}updateCollectionGroup(e,t,n){return eH.resolve()}updateIndexEntries(e,t){return eH.resolve()}}class sD{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ni(eN.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new ni(eN.comparator)).toArray()}}let sk="IndexedDbIndexManager",sN=new Uint8Array(0);class sR{constructor(e,t){this.databaseId=t,this.Fn=new sD,this.Mn=new rR(e=>rh(e),(e,t)=>rc(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Fn.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Fn.add(t)});let i={collectionId:n,parent:tr(r)};return t4(e,tR).put(i)}return eH.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return t4(e,tR).J(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(ti(r.parent))}return n})}addFieldIndex(e,t){let n=t4(e,tF),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=t4(e,tB);return i.next(e=>{n.put(sa(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=t4(e,tF),r=t4(e,tB),i=t4(e,tj);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=t4(e,tF),n=t4(e,tj),r=t4(e,tB);return t.X().next(()=>n.X()).next(()=>r.X())}createTargetIndexes(e,t){return eH.forEach(this.xn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new sT(t).vn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=t4(e,tj),r=!0,i=new Map;return eH.forEach(this.xn(t),t=>this.On(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=rU(),r=[];return eH.forEach(i,(i,s)=>{et(sk,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${rh(t)}`);let a=function(e,t){let n=eP(t);if(void 0===n)return null;for(let t of rf(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of eF(t))for(let t of rf(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of eF(t)){let t=0===i.kind?rg(e,i.fieldPath,e.startAt):rp(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new nY(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of eF(t)){let t=0===i.kind?rp(e,i.fieldPath,e.endAt):rg(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new nY(n,r)}(s,i),h=this.Nn(i,s,l),c=this.Nn(i,s,u),d=this.Bn(i,s,o),f=this.Ln(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return eH.forEach(f,i=>n.Z(i,t.limit).next(t=>{t.forEach(t=>{let n=eL.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return eH.resolve(null)})}xn(e){let t=this.Mn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(eo(t instanceof n6||t instanceof n3,34018),t instanceof n6)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=n3.create(n,t.op);return s_(r=sC(r))?r:(eo(r instanceof n3,64498),eo(n5(r),40251),eo(r.filters.length>1,57927),r.filters.reduce((e,t)=>sx(e,t)))}(function e(t){var n,r;if(eo(t instanceof n6||t instanceof n3,20012),t instanceof n6){if(t instanceof rs){let e=(null==(r=null==(n=t.value.arrayValue)?void 0:n.values)?void 0:r.map(e=>n6.create(t.field,"==",e)))||[];return n3.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return n3.create(i,t.op)}(e));return eo(s_(t),7391),sE(t)||sI(t)?[t]:t.getFilters()})(n3.create(e.filters,"and")).map(t=>ru(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Mn.set(e,t)),t}Ln(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.kn(t[h/l]):sN,c=this.qn(e,o,n[h%l],r),d=this.Qn(e,o,i[h%l],s),f=a.map(t=>this.qn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}qn(e,t,n,r){let i=new sm(e,eL.empty(),t,n);return r?i:i.Rn()}Qn(e,t,n,r){let i=new sm(e,eL.empty(),t,n);return r?i.Rn():i}On(e,t){let n=new sT(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.wn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.xn(t);return eH.forEach(r,t=>this.On(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new ni(eM.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}$n(e,t){let n=new sp;for(let r of eF(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.Tn(r.kind);sh.Wt.vt(e,i)}return n.cn()}kn(e){let t=new sp;return sh.Wt.vt(e,t.Tn(0)),t.cn()}Un(e,t){let n,r=new sp;return sh.Wt.vt(nV(this.databaseId,t),r.Tn(0===(n=eF(e)).length?0:n[n.length-1].kind)),r.cn()}Bn(e,t,n){if(null===n)return[];let r=[];r.push(new sp);let i=0;for(let s of eF(e)){let e=n[i++];for(let n of r)if(this.Kn(t,s.fieldPath)&&nU(e))r=this.Wn(r,s,e);else{let t=n.Tn(s.kind);sh.Wt.vt(e,t)}}return this.Gn(r)}Nn(e,t,n){return this.Bn(e,t,n.position)}Gn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].cn();return t}Wn(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new sp;r.seed(n.cn()),sh.Wt.vt(e,r.Tn(t.kind)),i.push(r)}return i}Kn(e,t){return!!e.filters.find(e=>e instanceof n6&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=t4(e,tF),r=t4(e,tB);return(t?n.J(tV,IDBKeyRange.bound(t,t)):n.J()).next(e=>{let t=[];return eH.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{let r,i;t.push((r=n?new eU(n.sequenceNumber,new ej(i9(n.readTime),new eL(ti(n.documentKey)),n.largestBatchId)):eU.empty(),i=e.fields.map(([e,t])=>new eB(eM.fromServerFormat(e),t)),new eO(e.indexId,e.collectionGroup,i,r)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:eI(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=t4(e,tF),i=t4(e,tB);return this.zn(e).next(e=>r.J(tV,IDBKeyRange.bound(t,t)).next(t=>eH.forEach(t,t=>i.put(sa(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return eH.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?eH.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),eH.forEach(i,n=>this.jn(e,t,n).next(t=>{let i=this.Hn(r,n);return t.isEqual(i)?eH.resolve():this.Jn(e,r,n,t,i)}))))})}Yn(e,t,n,r){return t4(e,tj).put(r.Vn(this.uid,this.Un(n,t.key),t.key))}Zn(e,t,n,r){return t4(e,tj).delete(r.mn(this.uid,this.Un(n,t.key),t.key))}jn(e,t,n){let r=t4(e,tj),i=new ni(sy);return r.te({index:t$,range:IDBKeyRange.only([n.indexId,this.uid,sw(this.Un(n,t))])},(e,r)=>{i=i.add(new sm(n.indexId,t,sb(r.arrayValue),sb(r.directionalValue)))}).next(()=>i)}Hn(e,t){let n=new ni(sy),r=this.$n(t,e);if(null==r)return n;let i=eP(t);if(null!=i){let s=e.data.field(i.fieldPath);if(nU(s))for(let i of s.arrayValue.values||[])n=n.add(new sm(t.indexId,e.key,this.kn(i),r))}else n=n.add(new sm(t.indexId,e.key,sN,r));return n}Jn(e,t,n,r,i){et(sk,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=na(s),l=na(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=na(a)):t?(i(o),o=na(s)):(o=na(s),l=na(a))}}(r,i,sy,r=>{s.push(this.Yn(e,t,n,r))},r=>{s.push(this.Zn(e,t,n,r))}),eH.waitFor(s)}zn(e){let t=1;return t4(e,tB).te({index:tq,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>sy(e,t)).filter((e,t,n)=>!t||0!==sy(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=sy(i,e),s=sy(i,t);if(0===n)r[0]=e.Rn();else if(n>0&&s<0)r.push(i),r.push(i.Rn());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.Xn(r[e],r[e+1]))return[];let t=r[e].mn(this.uid,sN,eL.empty()),n=r[e+1].mn(this.uid,sN,eL.empty());i.push(IDBKeyRange.bound(t,n))}return i}Xn(e,t){return sy(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sM)}getMinOffset(e,t){return eH.mapArray(this.xn(t),t=>this.On(e,t).next(e=>e||es(44426))).next(sM)}}function sM(e){eo(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>eK(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new ej(t.readTime,t.documentKey,n)}let sL={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class sO{static withCacheSize(e){return new sO(e,sO.DEFAULT_COLLECTION_PERCENTILE,sO.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function sP(e,t,n){let r=e.store(tu),i=e.store(tg),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.te({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{eo(1===o,47070,{batchId:n.batchId})}));let u=[];for(let e of n.mutations){var h,c;let r=(h=e.key.path,c=n.batchId,[t,tr(h),c]);s.push(i.delete(r)),u.push(e.key)}return eH.waitFor(s).next(()=>u)}function sF(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw es(14731);t=e.noDocument}return JSON.stringify(t).length}sO.DEFAULT_COLLECTION_PERCENTILE=10,sO.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sO.DEFAULT=new sO(0x2800000,sO.DEFAULT_COLLECTION_PERCENTILE,sO.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sO.DISABLED=new sO(-1,0,0);class sV{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.er={}}static St(e,t,n,r){return eo(""!==e.uid,64387),new sV(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return sU(e).te({index:tc,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=t4(e,tg),s=sU(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;eo("number"==typeof a,49019);let f=new io(a,t,n,r),g=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>iW(o.wt,e)),d=f.mutations.map(e=>iW(o.wt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),p=[],m=new ni((e,t)=>eI(e.canonicalString(),t.canonicalString()));for(let e of r){let t=(u=this.userId,h=e.key.path,[u,tr(h),a]);m=m.add(e.key.path.popLast()),p.push(s.put(g)),p.push(i.put(t,tf))}return m.forEach(t=>{p.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.er[a]=f.keys()}),eH.waitFor(p).next(()=>f)})}lookupMutationBatch(e,t){return sU(e).get(t).next(e=>e?(eo(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),se(this.serializer,e)):null)}tr(e,t){return this.er[t]?eH.resolve(this.er[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.er[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return sU(e).te({index:tc,range:r},(e,t,r)=>{t.userId===this.userId&&(eo(t.batchId>=n,47524,{nr:n}),i=se(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),n=-1;return sU(e).te({index:tc,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return sU(e).J(tc,t).next(e=>e.map(e=>se(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,tr(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return t4(e,tg).te({range:r},(n,r,s)=>{let[a,o,l]=n,u=ti(o);if(a===this.userId&&t.path.isEqual(u))return sU(e).get(l).next(e=>{if(!e)throw es(61480,{rr:n,batchId:l});eo(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(se(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ni(eI),r=[];return t.forEach(t=>{let i=[this.userId,tr(t.path)],s=IDBKeyRange.lowerBound(i),a=t4(e,tg).te({range:s},(e,r,i)=>{let[s,a,o]=e,l=ti(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),eH.waitFor(r).next(()=>this.ir(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,tr(n)],s=IDBKeyRange.lowerBound(i),a=new ni(eI);return t4(e,tg).te({range:s},(e,t,i)=>{let[s,o,l]=e,u=ti(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.ir(e,a))}ir(e,t){let n=[],r=[];return t.forEach(t=>{r.push(sU(e).get(t).next(e=>{if(null===e)throw es(35274,{batchId:t});eo(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(se(this.serializer,e))}))}),eH.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return sP(e.he,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.sr(t.batchId)}),eH.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}sr(e){delete this.er[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return eH.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return t4(e,tg).te({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=ti(e[1]);r.push(t)}else n.done()}).next(()=>{eo(0===r.length,56720,{_r:r.map(e=>e.canonicalString())})})})}containsKey(e,t){return sB(e,this.userId,t)}ar(e){return t4(e,tl).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function sB(e,t,n){let r=[t,tr(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return t4(e,tg).te({range:s,ee:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function sU(e){return t4(e,tu)}class sq{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new sq(0)}static lr(){return new sq(-1)}}class sz{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.hr(e).next(t=>{let n=new sq(t.highestTargetId);return t.highestTargetId=n.next(),this.Pr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.hr(e).next(e=>eA.fromTimestamp(new eC(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.hr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.hr(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Pr(e,r)))}addTargetData(e,t){return this.Tr(e,t).next(()=>this.hr(e).next(n=>(n.targetCount+=1,this.Ir(t,n),this.Pr(e,n))))}updateTargetData(e,t){return this.Tr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>t4(e,tI).delete(t.targetId)).next(()=>this.hr(e)).next(t=>(eo(t.targetCount>0,8065),t.targetCount-=1,this.Pr(e,t)))}removeTargets(e,t,n){let r=0,i=[];return t4(e,tI).te((s,a)=>{let o=st(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>eH.waitFor(i)).next(()=>r)}forEachTarget(e,t){return t4(e,tI).te((e,n)=>{t(st(n))})}hr(e){return t4(e,tN).get(tk).next(e=>(eo(null!==e,2888),e))}Pr(e,t){return t4(e,tN).put(tk,t)}Tr(e,t){return t4(e,tI).put(sn(this.serializer,t))}Ir(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.hr(e).next(e=>e.targetCount)}getTargetData(e,t){let n=rh(t),r=IDBKeyRange.bound([n,-1/0],[n,1/0]),i=null;return t4(e,tI).te({range:r,index:t_},(e,n,r)=>{let s=st(n);rc(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=sj(e);return t.forEach(t=>{let s=tr(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),eH.waitFor(r)}removeMatchingKeys(e,t,n){let r=sj(e);return eH.forEach(t,t=>{let i=tr(t.path);return eH.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=sj(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=sj(e),i=rU();return r.te({range:n,ee:!0},(e,t,n)=>{let r=new eL(ti(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=tr(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return sj(e).te({index:tA,ee:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}Rt(e,t){return t4(e,tI).get(t).next(e=>e?st(e):null)}}function sj(e){return t4(e,tS)}let sK="LruGarbageCollector";function s$([e,t],[n,r]){let i=eI(e,n);return 0===i?eI(t,r):i}class sG{constructor(e){this.Er=e,this.buffer=new ni(s$),this.dr=0}Ar(){return++this.dr}Rr(e){let t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>s$(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sQ{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Vr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return null!==this.Vr}mr(e){et(sK,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){e1(e)?et(sK,"Ignoring IndexedDB error during garbage collection: ",e):await eQ(e)}await this.mr(3e5)})}}class sH{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return eH.resolve(e9.le);let n=new sG(t);return this.gr.forEachTarget(e,e=>n.Rr(e.sequenceNumber)).next(()=>this.gr.yr(e,e=>n.Rr(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.gr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(et("LruGarbageCollector","Garbage collection skipped; disabled"),eH.resolve(sL)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(et("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sL):this.wr(e,t))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let n,r,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(et("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),Z()<=j.LogLevel.DEBUG&&et("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),eH.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class sW{constructor(e,t){this.db=e,this.garbageCollector=new sH(this,t)}pr(e){let t=this.Sr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Sr(e){let t=0;return this.yr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}yr(e,t){return this.br(e,(e,n)=>t(n))}addReference(e,t,n){return sJ(e,n)}removeReference(e,t,n){return sJ(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return sJ(e,t)}Dr(e,t){let n;return n=!1,t4(e,tl).ne(r=>sB(e,r,t).next(e=>(e&&(n=!0),eH.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.br(e,(s,a)=>{if(a<=t){let t=this.Dr(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,eA.min()),sj(e).delete([0,tr(s.path)])))});r.push(t)}}).next(()=>eH.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return sJ(e,t)}br(e,t){let n=sj(e),r,i=e9.le;return n.te({index:tA},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==e9.le&&t(new eL(ti(r)),i),i=a,r=s):i=e9.le}).next(()=>{i!==e9.le&&t(new eL(ti(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function sJ(e,t){var n;return sj(e).put((n=e.currentSequenceNumber,{targetId:0,path:tr(t.path),sequenceNumber:n}))}class sX{constructor(){this.changes=new rR(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,nX.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?eH.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class sY{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return t4(e,tp).put(n)}removeEntry(e,t,n){let r;return t4(e,tp).delete([(r=t.path.toArray()).slice(0,r.length-2),r[r.length-2],i8(n),r[r.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.vr(e,n)))}getEntry(e,t){let n=nX.newInvalidDocument(t);return t4(e,tp).te({index:ty,range:IDBKeyRange.only(s0(t))},(e,r)=>{n=this.Cr(t,r)}).next(()=>n)}Fr(e,t){let n={size:0,document:nX.newInvalidDocument(t)};return t4(e,tp).te({index:ty,range:IDBKeyRange.only(s0(t))},(e,r)=>{n={document:this.Cr(t,r),size:sF(r)}}).next(()=>n)}getEntries(e,t){let n=rM;return this.Mr(e,t,(e,t)=>{let r=this.Cr(e,t);n=n.insert(e,r)}).next(()=>n)}Or(e,t){let n=rM,r=new nt(eL.comparator);return this.Mr(e,t,(e,t)=>{let i=this.Cr(e,t);n=n.insert(e,i),r=r.insert(e,sF(t))}).next(()=>({documents:n,Nr:r}))}Mr(e,t,n){if(t.isEmpty())return eH.resolve();let r=new ni(s2);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(s0(r.first()),s0(r.last())),s=r.getIterator(),a=s.getNext();return t4(e,tp).te({index:ty,range:i},(e,t,r)=>{let i=eL.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>s2(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.H(s0(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),i8(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return t4(e,tp).J(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=rM;for(let i of e){let e=this.Cr(eL.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(rD(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=rM,s=s1(t,n),a=s1(t,ej.max());return t4(e,tp).te({index:tw,range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.Cr(eL.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new sZ(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return t4(e,tT).get(tE).next(e=>(eo(!!e,20021),e))}vr(e,t){return t4(e,tT).put(tE,t)}Cr(e,t){if(t){let e=function(e,t){var n;let r,i;if(t.document)r=iH(e.wt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=eL.fromSegments(t.noDocument.path),n=i9(t.noDocument.readTime);r=nX.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return es(56709);{let e=eL.fromSegments(t.unknownDocument.path),n=i9(t.unknownDocument.version);r=nX.newUnknownDocument(e,n)}}return t.readTime&&r.setReadTime((i=new eC((n=t.readTime)[0],n[1]),eA.fromTimestamp(i))),r}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(eA.min())))return e}return nX.newInvalidDocument(e)}}class sZ extends sX{constructor(e,t){super(),this.Br=e,this.trackRemovals=t,this.Lr=new rR(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new ni((e,t)=>eI(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Lr.get(i);if(t.push(this.Br.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=i4(this.Br.serializer,s);r=r.add(i.path.popLast());let l=sF(o);n+=l-a.size,t.push(this.Br.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=i4(this.Br.serializer,s.convertToNoDocument(eA.min()));t.push(this.Br.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.Br.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Br.updateMetadata(e,n)),eH.waitFor(t)}getFromCache(e,t){return this.Br.Fr(e,t).next(e=>(this.Lr.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Br.Or(e,t).next(({documents:e,Nr:t})=>(t.forEach((t,n)=>{this.Lr.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function s0(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function s1(e,t){let n=t.documentKey.path.toArray();return[e,i8(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function s2(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=eI(n[e],r[e]))return i;return(i=eI(n.length,r.length))||(i=eI(n[n.length-2],r[r.length-2]))||eI(n[n.length-1],r[r.length-1])}class s6{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class s3{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&r8(n.mutation,e,no.empty(),eC.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,rU()).next(()=>t))}getLocalViewOfDocuments(e,t,n=rU()){let r=rF();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=rO();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=rF();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,rU()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=rM,s=rF(),a=rF();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof ie)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),r8(a.mutation,t,a.mutation.getFieldMask(),eC.now())):s.set(t.key,no.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new s6(t,null!=(n=s.get(e))?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=rF(),r=new nt((e,t)=>e-t),i=rU();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||no.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||rU()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=rF();l.forEach(e=>{if(!i.has(e)){let r=r4(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return eH.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return eL.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):rw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):eH.resolve(rF()),a=-1,o=i;return s.next(t=>eH.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?eH.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,rU())).next(e=>({batchId:a,changes:rP(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new eL(t)).next(e=>{let t=rO();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=rO();return this.indexManager.getCollectionParents(e,i).next(a=>eH.forEach(a,a=>{let o=new rm(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,nX.newInvalidDocument(r)))});let n=rO();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&r8(s.mutation,r,no.empty(),eC.now()),rD(t,r)&&(n=n.insert(e,r))}),n})}}class s5{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return eH.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,{id:t.id,version:t.version,createTime:iF(t.createTime)}),eH.resolve()}getNamedQuery(e,t){return eH.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,{name:t.name,query:sr(t.bundledQuery),readTime:iF(t.readTime)}),eH.resolve()}}class s4{constructor(){this.overlays=new nt(eL.comparator),this.Qr=new Map}getOverlay(e,t){return eH.resolve(this.overlays.get(t))}getOverlays(e,t){let n=rF();return eH.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.bt(e,t,r)}),eH.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.Qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Qr.delete(n)),eH.resolve()}getOverlaysForCollection(e,t,n){let r=rF(),i=t.length+1,s=new eL(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return eH.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new nt((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=rF(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=rF(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return eH.resolve(a)}bt(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.Qr.get(r.largestBatchId).delete(n.key);this.Qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new iu(t,n));let i=this.Qr.get(t);void 0===i&&(i=rU(),this.Qr.set(t,i)),this.Qr.set(t,i.add(n.key))}}class s8{constructor(){this.sessionToken=nh.EMPTY_BYTE_STRING}getSessionToken(e){return eH.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,eH.resolve()}}class s7{constructor(){this.$r=new ni(s9.Ur),this.Kr=new ni(s9.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){let n=new s9(e,t);this.$r=this.$r.add(n),this.Kr=this.Kr.add(n)}Gr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.zr(new s9(e,t))}jr(e,t){e.forEach(e=>this.removeReference(e,t))}Hr(e){let t=new eL(new eN([])),n=new s9(t,e),r=new s9(t,e+1),i=[];return this.Kr.forEachInRange([n,r],e=>{this.zr(e),i.push(e.key)}),i}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){let t=new eL(new eN([])),n=new s9(t,e),r=new s9(t,e+1),i=rU();return this.Kr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new s9(e,0),n=this.$r.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class s9{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return eL.comparator(e.key,t.key)||eI(e.Zr,t.Zr)}static Wr(e,t){return eI(e.Zr,t.Zr)||eL.comparator(e.key,t.key)}}class ae{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new ni(s9.Ur)}checkEmpty(e){return eH.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new io(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Xr=this.Xr.add(new s9(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return eH.resolve(s)}lookupMutationBatch(e,t){return eH.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ti(t+1),r=n<0?0:n;return eH.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return eH.resolve(0===this.mutationQueue.length?-1:this.nr-1)}getAllMutationBatches(e){return eH.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new s9(t,0),r=new s9(t,1/0),i=[];return this.Xr.forEachInRange([n,r],e=>{let t=this.ei(e.Zr);i.push(t)}),eH.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ni(eI);return t.forEach(e=>{let t=new s9(e,0),r=new s9(e,1/0);this.Xr.forEachInRange([t,r],e=>{n=n.add(e.Zr)})}),eH.resolve(this.ni(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;eL.isDocumentKey(i)||(i=i.child(""));let s=new s9(new eL(i),0),a=new ni(eI);return this.Xr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Zr)),!0)},s),eH.resolve(this.ni(a))}ni(e){let t=[];return e.forEach(e=>{let n=this.ei(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){eo(0===this.ri(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Xr;return eH.forEach(t.mutations,r=>{let i=new s9(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Xr=n})}sr(e){}containsKey(e,t){let n=new s9(t,0),r=this.Xr.firstAfterOrEqual(n);return eH.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,eH.resolve()}ri(e,t){return this.ti(e)}ti(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ei(e){let t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class at{constructor(e){this.ii=e,this.docs=new nt(eL.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ii(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return eH.resolve(n?n.document.mutableCopy():nX.newInvalidDocument(t))}getEntries(e,t){let n=rM;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():nX.newInvalidDocument(e))}),eH.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=rM,s=t.path,a=new eL(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=eK(ez(a),n)||(r.has(a.key)||rD(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return eH.resolve(i)}getAllFromCollectionGroup(e,t,n,r){es(9500)}si(e,t){return eH.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new an(this)}getSize(e){return eH.resolve(this.size)}}class an extends sX{constructor(e){super(),this.Br=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Br.addEntry(e,r)):this.Br.removeEntry(n)}),eH.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}class ar{constructor(e){this.persistence=e,this.oi=new rR(e=>rh(e),rc),this.lastRemoteSnapshotVersion=eA.min(),this.highestTargetId=0,this._i=0,this.ai=new s7,this.targetCount=0,this.ui=sq.cr()}forEachTarget(e,t){return this.oi.forEach((e,n)=>t(n)),eH.resolve()}getLastRemoteSnapshotVersion(e){return eH.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return eH.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),eH.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this._i&&(this._i=t),eH.resolve()}Tr(e){this.oi.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ui=new sq(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,eH.resolve()}updateTargetData(e,t){return this.Tr(t),eH.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,eH.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.oi.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.oi.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),eH.waitFor(i).next(()=>r)}getTargetCount(e){return eH.resolve(this.targetCount)}getTargetData(e,t){let n=this.oi.get(t)||null;return eH.resolve(n)}addMatchingKeys(e,t,n){return this.ai.Gr(t,n),eH.resolve()}removeMatchingKeys(e,t,n){this.ai.jr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),eH.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),eH.resolve()}getMatchingKeysForTargetId(e,t){let n=this.ai.Yr(t);return eH.resolve(n)}containsKey(e,t){return eH.resolve(this.ai.containsKey(t))}}class ai{constructor(e,t){this.ci={},this.overlays={},this.li=new e9(0),this.hi=!1,this.hi=!0,this.Pi=new s8,this.referenceDelegate=e(this),this.Ti=new ar(this),this.indexManager=new sA,this.remoteDocumentCache=new at(e=>this.referenceDelegate.Ii(e)),this.serializer=new i5(t),this.Ei=new s5(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new s4,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ci[e.toKey()];return n||(n=new ae(t,this.referenceDelegate),this.ci[e.toKey()]=n),n}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,n){et("MemoryPersistence","Starting transaction:",e);let r=new as(this.li.next());return this.referenceDelegate.di(),n(r).next(e=>this.referenceDelegate.Ai(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ri(e,t){return eH.or(Object.values(this.ci).map(n=>()=>n.containsKey(e,t)))}}class as extends eG{constructor(e){super(),this.currentSequenceNumber=e}}class aa{constructor(e){this.persistence=e,this.Vi=new s7,this.mi=null}static fi(e){return new aa(e)}get gi(){if(this.mi)return this.mi;throw es(60996)}addReference(e,t,n){return this.Vi.addReference(n,t),this.gi.delete(n.toString()),eH.resolve()}removeReference(e,t,n){return this.Vi.removeReference(n,t),this.gi.add(n.toString()),eH.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),eH.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(e=>this.gi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.gi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eH.forEach(this.gi,n=>{let r=eL.fromPath(n);return this.pi(e,r).next(e=>{e||t.removeEntry(r,eA.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(e=>{e?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return eH.or([()=>eH.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class ao{constructor(e,t){this.persistence=e,this.yi=new rR(e=>tr(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new sH(this,t)}static fi(e,t){return new ao(e,t)}di(){}Ai(e){return eH.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){let t=this.Sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Sr(e){let t=0;return this.yr(e,e=>{t++}).next(()=>t)}yr(e,t){return eH.forEach(this.yi,(n,r)=>this.Dr(e,n,r).next(e=>e?eH.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.si(e,r=>this.Dr(e,r,t).next(e=>{e||(n++,i.removeEntry(r,eA.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),eH.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),eH.resolve()}removeReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),eH.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),eH.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(nN(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=nb(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return ng(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,t7(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw es(13486,{value:t})}}(e.data.value)),t}Dr(e,t,n){return eH.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.yi.get(t);return eH.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class al{constructor(e){this.serializer=e}q(e,t,n,r){let i=new eJ("createOrUpgrade",t);n<1&&r>=1&&(e.createObjectStore(ta),e.createObjectStore(tl,{keyPath:"userId"}),e.createObjectStore(tu,{keyPath:th,autoIncrement:!0}).createIndex(tc,td,{unique:!0}),e.createObjectStore(tg),au(e),e.createObjectStore(ts));let s=eH.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore(tS),e.deleteObjectStore(tI),e.deleteObjectStore(tN),au(e)),s=s.next(()=>{let e,t;return e=i.store(tN),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:eA.min().toTimestamp(),targetCount:0},e.put(tk,t)})),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store(tu).J().next(t=>{e.deleteObjectStore(tu),e.createObjectStore(tu,{keyPath:th,autoIncrement:!0}).createIndex(tc,td,{unique:!0});let n=i.store(tu),r=t.map(e=>n.put(e));return eH.waitFor(r)}))),s=s.next(()=>{e.createObjectStore(tL,{keyPath:"clientId"})})),n<5&&r>=5&&(s=s.next(()=>this.wi(i))),n<6&&r>=6&&(s=s.next(()=>(e.createObjectStore(tT),this.Si(i)))),n<7&&r>=7&&(s=s.next(()=>this.bi(i))),n<8&&r>=8&&(s=s.next(()=>this.Di(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.Ci(i))),n<11&&r>=11&&(s=s.next(()=>{e.createObjectStore(tO,{keyPath:"bundleId"}),e.createObjectStore(tP,{keyPath:"name"})})),n<12&&r>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(tQ,{keyPath:tH})).createIndex(tW,tJ,{unique:!1}),t.createIndex(tX,tY,{unique:!1})})),n<13&&r>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(tp,{keyPath:tm})).createIndex(ty,tv),t.createIndex(tw,tb)}).next(()=>this.Fi(e,i)).next(()=>e.deleteObjectStore(ts))),n<14&&r>=14&&(s=s.next(()=>this.Mi(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore(tF,{keyPath:"indexId",autoIncrement:!0}).createIndex(tV,"collectionGroup",{unique:!1}),e.createObjectStore(tB,{keyPath:tU}).createIndex(tq,tz,{unique:!1}),e.createObjectStore(tj,{keyPath:tK}).createIndex(t$,tG,{unique:!1})})),n<16&&r>=16&&(s=s.next(()=>{t.objectStore(tB).clear()}).next(()=>{t.objectStore(tj).clear()})),n<17&&r>=17&&(s=s.next(()=>{e.createObjectStore(tZ,{keyPath:"name"})})),n<18&&r>=18&&O()&&(s=s.next(()=>{t.objectStore(tB).clear()}).next(()=>{t.objectStore(tj).clear()})),s}Si(e){let t=0;return e.store(ts).te((e,n)=>{t+=sF(n)}).next(()=>{let n={byteSize:t};return e.store(tT).put(tE,n)})}wi(e){let t=e.store(tl),n=e.store(tu);return t.J().next(t=>eH.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.J(tc,r).next(n=>eH.forEach(n,n=>{eo(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});let r=se(this.serializer,n);return sP(e,t.userId,r).next(()=>{})}))}))}bi(e){let t=e.store(tS),n=e.store(ts);return e.store(tN).get(tk).next(e=>{let r=[];return n.te((n,i)=>{let s=new eN(n),a=[0,tr(s)];r.push(t.get(a).next(n=>n?eH.resolve():t.put({targetId:0,path:tr(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>eH.waitFor(r))})}Di(e,t){e.createObjectStore(tR,{keyPath:tM});let n=t.store(tR),r=new sD,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:tr(r)})}};return t.store(ts).te({ee:!0},(e,t)=>i(new eN(e).popLast())).next(()=>t.store(tg).te({ee:!0},([e,t,n],r)=>i(ti(t).popLast())))}Ci(e){let t=e.store(tI);return t.te((e,n)=>{let r=st(n),i=sn(this.serializer,r);return t.put(i)})}Fi(e,t){let n=t.store(ts),r=[];return n.te((e,n)=>{let i=t.store(tp),s=(n.document?new eL(eN.fromString(n.document.name).popFirst(5)):n.noDocument?eL.fromSegments(n.noDocument.path):n.unknownDocument?eL.fromSegments(n.unknownDocument.path):es(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>eH.waitFor(r))}Mi(e,t){let n=t.store(tu),r=new sY(this.serializer),i=new ai(aa.fi,this.serializer.wt);return n.J().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!=(t=n.get(e.userId))?t:rU();se(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),eH.forEach(n,(e,n)=>{let s=new J(n),a=sl.St(this.serializer,s),o=i.getIndexManager(s);return new s3(r,sV.St(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new t5(t,e9.le),e).next()})})}}function au(e){e.createObjectStore(tS,{keyPath:tC}).createIndex(tA,tD,{unique:!0}),e.createObjectStore(tI,{keyPath:"targetId"}).createIndex(t_,tx,{unique:!0}),e.createObjectStore(tN)}let ah="IndexedDbPersistence",ac="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ad="main";class af{constructor(e,t,n,r,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.xi=i,this.window=s,this.document=a,this.Oi=l,this.Ni=u,this.Bi=h,this.li=null,this.hi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Li=null,this.inForeground=!1,this.ki=null,this.qi=null,this.Qi=-1/0,this.$i=e=>Promise.resolve(),!af.C())throw new eh(eu.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sW(this,r),this.Ui=t+ad,this.serializer=new i5(o),this.Ki=new eX(this.Ui,this.Bi,new al(this.serializer)),this.Pi=new su,this.Ti=new sz(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new sY(this.serializer),this.Ei=new so,this.window&&this.window.localStorage?this.Wi=this.window.localStorage:(this.Wi=null,!1===u&&en(ah,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Gi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new eh(eu.FAILED_PRECONDITION,ac);return this.zi(),this.ji(),this.Hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ti.getHighestSequenceNumber(e))}).then(e=>{this.li=new e9(e,this.Oi)}).then(()=>{this.hi=!0}).catch(e=>(this.Ki&&this.Ki.close(),Promise.reject(e)))}Ji(e){return this.$i=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ki.U(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.xi.enqueueAndForget(async()=>{this.started&&await this.Gi()}))}Gi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>t4(e,tL).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Yi(e).next(e=>{e||(this.isPrimary=!1,this.xi.enqueueRetryable(()=>this.$i(!1)))})}).next(()=>this.Zi(e)).next(t=>this.isPrimary&&!t?this.Xi(e).next(()=>!1):!!t&&this.es(e).next(()=>!0))).catch(e=>{if(e1(e))return et(ah,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return et(ah,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.xi.enqueueRetryable(()=>this.$i(e)),this.isPrimary=e})}Yi(e){return t4(e,ta).get(to).next(e=>eH.resolve(this.ts(e)))}ns(e){return t4(e,tL).delete(this.clientId)}async rs(){if(this.isPrimary&&!this.ss(this.Qi,18e5)){this.Qi=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=t4(e,tL);return t.J().next(e=>{let n=this._s(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return eH.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Wi)for(let t of e)this.Wi.removeItem(this.us(t.clientId))}}Hi(){this.qi=this.xi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Gi().then(()=>this.rs()).then(()=>this.Hi()))}ts(e){return!!e&&e.ownerId===this.clientId}Zi(e){return this.Ni?eH.resolve(!0):t4(e,ta).get(to).next(t=>{if(null!==t&&this.ss(t.leaseTimestampMs,5e3)&&!this.cs(t.ownerId)){if(this.ts(t)&&this.networkEnabled)return!0;if(!this.ts(t)){if(!t.allowTabSynchronization)throw new eh(eu.FAILED_PRECONDITION,ac);return!1}}return!(!this.networkEnabled||!this.inForeground)||t4(e,tL).J().next(e=>void 0===this._s(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&et(ah,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.hi=!1,this.ls(),this.qi&&(this.qi.cancel(),this.qi=null),this.hs(),this.Ps(),await this.Ki.runTransaction("shutdown","readwrite",[ta,tL],e=>{let t=new t5(e,e9.le);return this.Xi(t).next(()=>this.ns(t))}),this.Ki.close(),this.Ts()}_s(e,t){return e.filter(e=>this.ss(e.updateTimeMs,t)&&!this.cs(e.clientId))}Is(){return this.runTransaction("getActiveClients","readonly",e=>t4(e,tL).J().next(e=>this._s(e,18e5).map(e=>e.clientId)))}get started(){return this.hi}getGlobalsCache(){return this.Pi}getMutationQueue(e,t){return sV.St(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new sR(e,this.serializer.wt.databaseId)}getDocumentOverlayCache(e){return sl.St(this.serializer,e)}getBundleCache(){return this.Ei}runTransaction(e,t,n){var r;let i;et(ah,"Starting transaction:",e);let s=18===(r=this.Bi)||17===r?t3:16===r||15===r?t6:14===r||13===r?t2:12===r?t1:11===r?t0:void es(60245);return this.Ki.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new t5(r,this.li?this.li.next():e9.le),"readwrite-primary"===t?this.Yi(i).next(e=>!!e||this.Zi(i)).next(t=>{if(!t)throw en(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.xi.enqueueRetryable(()=>this.$i(!1)),new eh(eu.FAILED_PRECONDITION,e$);return n(i)}).next(e=>this.es(i).next(()=>e)):this.Es(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Es(e){return t4(e,ta).get(to).next(e=>{if(null!==e&&this.ss(e.leaseTimestampMs,5e3)&&!this.cs(e.ownerId)&&!this.ts(e)&&!(this.Ni||this.allowTabSynchronization&&e.allowTabSynchronization))throw new eh(eu.FAILED_PRECONDITION,ac)})}es(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return t4(e,ta).put(to,t)}static C(){return eX.C()}Xi(e){let t=t4(e,ta);return t.get(to).next(e=>this.ts(e)?(et(ah,"Releasing primary lease."),t.delete(to)):eH.resolve())}ss(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(en(`Detected an update time that is in the future: ${e} > ${n}`),!1))}zi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ki=()=>{this.xi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Gi()))},this.document.addEventListener("visibilitychange",this.ki),this.inForeground="visible"===this.document.visibilityState)}hs(){this.ki&&(this.document.removeEventListener("visibilitychange",this.ki),this.ki=null)}ji(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.Li=()=>{this.ls();let e=/(?:Version|Mobile)\/1[456]/;L()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.xi.enterRestrictedMode(!0),this.xi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Li))}Ps(){this.Li&&(this.window.removeEventListener("pagehide",this.Li),this.Li=null)}cs(e){var t;try{let n=null!==(null==(t=this.Wi)?void 0:t.getItem(this.us(e)));return et(ah,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return en(ah,"Failed to get zombied client id.",e),!1}}ls(){if(this.Wi)try{this.Wi.setItem(this.us(this.clientId),String(Date.now()))}catch(e){en("Failed to set zombie client id.",e)}}Ts(){if(this.Wi)try{this.Wi.removeItem(this.us(this.clientId))}catch(e){}}us(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ag(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class ap{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.ds=n,this.As=r}static Rs(e,t){let n=rU(),r=rU();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new ap(e,t.fromCache,n,r)}}class am{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ay{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=L()?8:eY(R())>0?6:4}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ws(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.Ss(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new am;return this.bs(e,t,n).next(r=>{if(i.result=r,this.fs)return this.Ds(e,t,n,r.size)})}).next(()=>i.result)}Ds(e,t,n,r){return n.documentReadCount<this.gs?(Z()<=j.LogLevel.DEBUG&&et("QueryEngine","SDK will not create cache indexes for query:",rA(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),eH.resolve()):(Z()<=j.LogLevel.DEBUG&&et("QueryEngine","Query:",rA(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ps*r?(Z()<=j.LogLevel.DEBUG&&et("QueryEngine","The SDK decides to create cache indexes for query:",rA(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,rT(t))):eH.resolve())}ws(e,t){if(rv(t))return eH.resolve(null);let n=rT(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=rT(t=rx(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=rU(...r);return this.ys.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.vs(t,r);return this.Cs(t,s,i,n.readTime)?this.ws(e,rx(t,null,"F")):this.Fs(e,s,t,n)}))})))}Ss(e,t,n,r){return rv(t)||r.isEqual(eA.min())?eH.resolve(null):this.ys.getDocuments(e,n).next(i=>{let s=this.vs(t,i);return this.Cs(t,s,n,r)?eH.resolve(null):(Z()<=j.LogLevel.DEBUG&&et("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),rA(t)),this.Fs(e,s,t,eq(r,-1)).next(e=>e))})}vs(e,t){let n=new ni(rN(e));return t.forEach((t,r)=>{rD(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}bs(e,t,n){return Z()<=j.LogLevel.DEBUG&&et("QueryEngine","Using full collection scan to execute query:",rA(t)),this.ys.getDocumentsMatchingQuery(e,t,ej.min(),n)}Fs(e,t,n,r){return this.ys.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let av="LocalStore";class aw{constructor(e,t,n,r){this.persistence=e,this.Ms=t,this.serializer=r,this.xs=new nt(eI),this.Os=new rR(e=>rh(e),rc),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(n)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new s3(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}}async function ab(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Ls(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=rU();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({ks:e,removedBatchIds:i,addedBatchIds:s}))})})}function aT(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ti.getLastRemoteSnapshotVersion(t))}function aE(e,t,n){let r=rU(),i=rU();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=rM;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(eA.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):et(av,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{qs:r,Qs:i}})}function aI(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.Ti.getTargetData(n,t).next(i=>i?(r=i,eH.resolve(r)):e.Ti.allocateTargetId(n).next(i=>(r=new i3(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.Ti.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.xs.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.xs=e.xs.insert(n.targetId,n),e.Os.set(t,n.targetId)),n})}async function a_(e,t,n){let r=e.xs.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!e1(e))throw e;et(av,`Failed to update sequence numbers for target ${t}: ${e}`)}e.xs=e.xs.remove(t),e.Os.delete(r.target)}function ax(e,t,n){let r=eA.min(),i=rU();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=rT(t),void 0!==(o=e.Os.get(a))?eH.resolve(e.xs.get(o)):e.Ti.getTargetData(s,a)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Ti.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Ms.getDocumentsMatchingQuery(s,t,n?r:eA.min(),n?i:rU())).next(n=>(aA(e,rk(t),n),{documents:n,$s:i}))})}function aS(e,t){let n=e.Ti,r=e.xs.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n.Rt(e,t).next(e=>e?e.target:null))}function aC(e,t){let n=e.Ns.get(t)||eA.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.Bs.getAllFromCollectionGroup(r,t,eq(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(aA(e,t,n),n))}function aA(e,t,n){let r=e.Ns.get(t)||eA.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Ns.set(t,r)}async function aD(e,t,n,r){let i=rU(),s=rM;for(let e of n){let n=t.Us(e.metadata.name);e.document&&(i=i.add(n));let r=t.Ks(e);r.setReadTime(t.Ws(e.metadata.readTime)),s=s.insert(n,r)}let a=e.Bs.newChangeBuffer({trackRemovals:!0}),o=await aI(e,rT(ry(eN.fromString(`__bundle__/docs/${r}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>aE(t,a,s).next(e=>(a.apply(t),e)).next(n=>e.Ti.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.Ti.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.qs,n.Qs)).next(()=>n.qs)))}async function ak(e,t,n=rU()){let r=await aI(e,rT(sr(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=iF(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.Ei.saveNamedQuery(i,t);let a=r.withResumeToken(nh.EMPTY_BYTE_STRING,s);return e.xs=e.xs.insert(a.targetId,a),e.Ti.updateTargetData(i,a).next(()=>e.Ti.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.Ti.addMatchingKeys(i,n,r.targetId)).next(()=>e.Ei.saveNamedQuery(i,t))})}let aN="firestore_clients";function aR(e,t){return`${aN}_${e}_${t}`}let aM="firestore_mutations";function aL(e,t,n){let r=`${aM}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}let aO="firestore_targets";function aP(e,t){return`${aO}_${e}_${t}`}let aF="SharedClientState";class aV{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Gs(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new eh(r.error.code,r.error.message)),s?new aV(e,t,r.state,i):(en(aF,`Failed to parse mutation state for ID '${t}': ${n}`),null)}zs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class aB{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Gs(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new eh(n.error.code,n.error.message)),i?new aB(e,n.state,r):(en(aF,`Failed to parse target state for ID '${e}': ${t}`),null)}zs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class aU{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Gs(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=rq;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=tn(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new aU(e,i):(en(aF,`Failed to parse client data for instance '${e}': ${t}`),null)}}class aq{constructor(e,t){this.clientId=e,this.onlineState=t}static Gs(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new aq(t.clientId,t.onlineState):(en(aF,`Failed to parse online state: ${e}`),null)}}class az{constructor(){this.activeTargetIds=rq}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class aj{constructor(e,t,n,r,i){var s,a,o;this.window=e,this.xi=t,this.persistenceKey=n,this.Js=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ys=this.Zs.bind(this),this.Xs=new nt(eI),this.started=!1,this.eo=[];const l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.no=aR(this.persistenceKey,this.Js),this.ro=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Xs=this.Xs.insert(this.Js,new az),this.io=RegExp(`^${aN}_${l}_([^_]*)$`),this.so=RegExp(`^${aM}_${l}_(\\d+)(?:_(.*))?$`),this.oo=RegExp(`^${aO}_${l}_(\\d+)$`),this._o=(a=this.persistenceKey,`firestore_online_state_${a}`),this.ao=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.Ys)}static C(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.Is())){if(e===this.Js)continue;let t=this.getItem(aR(this.persistenceKey,e));if(t){let n=aU.Gs(e,t);n&&(this.Xs=this.Xs.insert(n.clientId,n))}}this.uo();let e=this.storage.getItem(this._o);if(e){let t=this.co(e);t&&this.lo(t)}for(let e of this.eo)this.Zs(e);this.eo=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.ro,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ho(this.Xs)}isActiveQueryTarget(e){let t=!1;return this.Xs.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Po(e,"pending")}updateMutationState(e,t,n){this.Po(e,t,n),this.To(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(aP(this.persistenceKey,e));if(t){let r=aB.Gs(e,t);r&&(n=r.state)}}return t&&this.Io.js(e),this.uo(),n}removeLocalQueryTarget(e){this.Io.Hs(e),this.uo()}isLocalQueryTarget(e){return this.Io.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(aP(this.persistenceKey,e))}updateQueryState(e,t,n){this.Eo(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.To(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Ao(e)}notifyBundleLoaded(e){this.Ro(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ys),this.removeItem(this.no),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return et(aF,"READ",e,t),t}setItem(e,t){et(aF,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){et(aF,"REMOVE",e),this.storage.removeItem(e)}Zs(e){if(e.storageArea===this.storage){if(et(aF,"EVENT",e.key,e.newValue),e.key===this.no)return void en("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.xi.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.io.test(e.key)){if(null==e.newValue){let t=this.Vo(e.key);return this.mo(t,null)}{let t=this.fo(e.key,e.newValue);if(t)return this.mo(t.clientId,t)}}else if(this.so.test(e.key)){if(null!==e.newValue){let t=this.po(e.key,e.newValue);if(t)return this.yo(t)}}else if(this.oo.test(e.key)){if(null!==e.newValue){let t=this.wo(e.key,e.newValue);if(t)return this.So(t)}}else if(e.key===this._o){if(null!==e.newValue){let t=this.co(e.newValue);if(t)return this.lo(t)}}else if(e.key===this.ro){let t=function(e){let t=e9.le;if(null!=e)try{let n=JSON.parse(e);eo("number"==typeof n,30636,{bo:e}),t=n}catch(e){en(aF,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==e9.le&&this.sequenceNumberHandler(t)}else if(e.key===this.ao){let t=this.Do(e.newValue);await Promise.all(t.map(e=>this.syncEngine.vo(e)))}}}else this.eo.push(e)})}}get Io(){return this.Xs.get(this.Js)}uo(){this.setItem(this.no,this.Io.zs())}Po(e,t,n){let r=new aV(this.currentUser,e,t,n),i=aL(this.persistenceKey,this.currentUser,e);this.setItem(i,r.zs())}To(e){let t=aL(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Ao(e){let t={clientId:this.Js,onlineState:e};this.storage.setItem(this._o,JSON.stringify(t))}Eo(e,t,n){let r=aP(this.persistenceKey,e),i=new aB(e,t,n);this.setItem(r,i.zs())}Ro(e){let t=JSON.stringify(Array.from(e));this.setItem(this.ao,t)}Vo(e){let t=this.io.exec(e);return t?t[1]:null}fo(e,t){let n=this.Vo(e);return aU.Gs(n,t)}po(e,t){let n=this.so.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return aV.Gs(new J(i),r,t)}wo(e,t){let n=Number(this.oo.exec(e)[1]);return aB.Gs(n,t)}co(e){return aq.Gs(e)}Do(e){return JSON.parse(e)}async yo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);et(aF,`Ignoring mutation for non-active user ${e.user.uid}`)}So(e){return this.syncEngine.Fo(e.targetId,e.state,e.error)}mo(e,t){let n=t?this.Xs.insert(e,t):this.Xs.remove(e),r=this.ho(this.Xs),i=this.ho(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Mo(s,a).then(()=>{this.Xs=n})}lo(e){this.Xs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ho(e){let t=rq;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class aK{constructor(){this.xo=new az,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,n){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new az,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class a${No(e){}shutdown(){}}let aG="ConnectivityMonitor";class aQ{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){for(let e of(et(aG,"Network connectivity changed: AVAILABLE"),this.Qo))e(0)}qo(){for(let e of(et(aG,"Network connectivity changed: UNAVAILABLE"),this.Qo))e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let aH=null;function aW(){return null===aH?aH=0x10000000+Math.round(0x80000000*Math.random()):aH++,"0x"+aH.toString(16)}let aJ="RestConnection",aX={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class aY{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${n}/databases/${r}`,this.Go=this.databaseId.database===nI?`project_id=${n}`:`project_id=${n}&database_id=${r}`}zo(e,t,n,r,i){let s=aW(),a=this.jo(e,t.toUriEncodedString());et(aJ,`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(o,r,i);let{host:l}=new URL(a),u=C(l);return this.Jo(e,a,o,n,u).then(t=>(et(aJ,`Received RPC '${e}' ${s}: `,t),t),t=>{throw er(aJ,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}Yo(e,t,n,r,i,s){return this.zo(e,t,n,r,i)}Ho(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+X,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}jo(e,t){let n=aX[e];return`${this.Ko}/v1/${t}:${n}`}terminate(){}}class aZ{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}let a0="WebChannelConnection";class a1 extends aY{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,o){let l=aW();return new Promise((o,u)=>{let h=new r;h.setWithCredentials(!0),h.listenOnce(s.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case a.NO_ERROR:let t=h.getResponseJson();et(a0,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(t)),o(t);break;case a.TIMEOUT:et(a0,`RPC '${e}' ${l} timed out`),u(new eh(eu.DEADLINE_EXCEEDED,"Request time out"));break;case a.HTTP_ERROR:let n=h.getStatus();if(et(a0,`RPC '${e}' ${l} failed with status:`,n,"response text:",h.getResponseText()),n>0){let e=h.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(eu).indexOf(e)>=0?e:eu.UNKNOWN);u(new eh(n,t.message))}else u(new eh(eu.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new eh(eu.UNAVAILABLE,"Connection failed."));break;default:es(9055,{l_:e,streamId:l,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{et(a0,`RPC '${e}' ${l} completed.`)}});let c=JSON.stringify(i);et(a0,`RPC '${e}' ${l} sending request:`,i),h.send(t,"POST",c,n,15)})}T_(e,t,n){let r=aW(),s=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=h(),d=u(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;void 0!==g&&(f.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(f.useFetchStreams=!0),this.Ho(f.initMessageHeaders,t,n),f.encodeInitMessageHeaders=!0;let p=s.join("");et(a0,`Creating RPC '${e}' stream ${r}: ${p}`,f);let m=a.createWebChannel(p,f),y=!1,v=!1,w=new aZ({Zo:t=>{v?et(a0,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(y||(et(a0,`Opening RPC '${e}' stream ${r} transport.`),m.open(),y=!0),et(a0,`RPC '${e}' stream ${r} sending:`,t),m.send(t))},Xo:()=>m.close()}),b=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return b(m,i.EventType.OPEN,()=>{v||(et(a0,`RPC '${e}' stream ${r} transport opened.`),w.__())}),b(m,i.EventType.CLOSE,()=>{v||(v=!0,et(a0,`RPC '${e}' stream ${r} transport closed`),w.u_())}),b(m,i.EventType.ERROR,t=>{v||(v=!0,er(a0,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),w.u_(new eh(eu.UNAVAILABLE,"The operation could not be completed")))}),b(m,i.EventType.MESSAGE,t=>{var n;if(!v){let i=t.data[0];eo(!!i,16349);let s=(null==i?void 0:i.error)||(null==(n=i[0])?void 0:n.error);if(s){et(a0,`RPC '${e}' stream ${r} received error:`,s);let t=s.status,n=function(e){let t=c[e];if(void 0!==t)return ig(t)}(t),i=s.message;void 0===n&&(n=eu.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),v=!0,w.u_(new eh(n,i)),m.close()}else et(a0,`RPC '${e}' stream ${r} received:`,i),w.c_(i)}}),b(d,l.STAT_EVENT,t=>{t.stat===o.PROXY?et(a0,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===o.NOPROXY&&et(a0,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{w.a_()},0),w}}function a2(){return"undefined"!=typeof window?window:null}function a6(){return"undefined"!=typeof document?document:null}function a3(e){return new iM(e,!0)}class a5{constructor(e,t,n=1e3,r=1.5,i=6e4){this.xi=e,this.timerId=t,this.I_=n,this.E_=r,this.d_=i,this.A_=0,this.R_=null,this.V_=Date.now(),this.reset()}reset(){this.A_=0}m_(){this.A_=this.d_}f_(e){this.cancel();let t=Math.floor(this.A_+this.g_()),n=Math.max(0,Date.now()-this.V_),r=Math.max(0,t-n);r>0&&et("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.A_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.R_=this.xi.enqueueAfterDelay(this.timerId,r,()=>(this.V_=Date.now(),e())),this.A_*=this.E_,this.A_<this.I_&&(this.A_=this.I_),this.A_>this.d_&&(this.A_=this.d_)}p_(){null!==this.R_&&(this.R_.skipDelay(),this.R_=null)}cancel(){null!==this.R_&&(this.R_.cancel(),this.R_=null)}g_(){return(Math.random()-.5)*this.A_}}let a4="PersistentStream";class a8{constructor(e,t,n,r,i,s,a,o){this.xi=e,this.y_=n,this.w_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.S_=0,this.b_=null,this.D_=null,this.stream=null,this.v_=0,this.C_=new a5(e,t)}F_(){return 1===this.state||5===this.state||this.M_()}M_(){return 2===this.state||3===this.state}start(){this.v_=0,4!==this.state?this.auth():this.x_()}async stop(){this.F_()&&await this.close(0)}O_(){this.state=0,this.C_.reset()}N_(){this.M_()&&null===this.b_&&(this.b_=this.xi.enqueueAfterDelay(this.y_,6e4,()=>this.B_()))}L_(e){this.k_(),this.stream.send(e)}async B_(){if(this.M_())return this.close(0)}k_(){this.b_&&(this.b_.cancel(),this.b_=null)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}async close(e,t){this.k_(),this.q_(),this.C_.cancel(),this.S_++,4!==e?this.C_.reset():t&&t.code===eu.RESOURCE_EXHAUSTED?(en(t.toString()),en("Using maximum backoff delay to prevent overloading the backend."),this.C_.m_()):t&&t.code===eu.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Q_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}Q_(){}auth(){this.state=1;let e=this.U_(this.S_),t=this.S_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.S_===t&&this.K_(e,n)},t=>{e(()=>{let e=new eh(eu.UNKNOWN,"Fetching auth token failed: "+t.message);return this.W_(e)})})}K_(e,t){let n=this.U_(this.S_);this.stream=this.G_(e,t),this.stream.e_(()=>{n(()=>this.listener.e_())}),this.stream.n_(()=>{n(()=>(this.state=2,this.D_=this.xi.enqueueAfterDelay(this.w_,1e4,()=>(this.M_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(e=>{n(()=>this.W_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.v_?this.z_(e):this.onNext(e))})}x_(){this.state=5,this.C_.f_(async()=>{this.state=0,this.start()})}W_(e){return et(a4,`close with error: ${e}`),this.stream=null,this.close(4,e)}U_(e){return t=>{this.xi.enqueueAndForget(()=>this.S_===e?t():(et(a4,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class a7 extends a8{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}G_(e,t){return this.connection.T_("Listen",e,t)}z_(e){return this.onNext(e)}onNext(e){this.C_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:es(39313,{state:r}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(eo(void 0===i||"string"==typeof i,58123),nh.fromBase64String(i||"")):(eo(void 0===i||i instanceof m.Buffer||i instanceof Uint8Array,16193),nh.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new ix(s,a,o,l&&new eh(void 0===l.code?eu.UNKNOWN:ig(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=iz(e,r.document.name),s=iF(r.document.updateTime),a=r.document.createTime?iF(r.document.createTime):eA.min(),o=new nJ({mapValue:{fields:r.document.fields}}),l=nX.newFoundDocument(i,s,a,o);n=new iI(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=iz(e,r.document),s=r.readTime?iF(r.readTime):eA.min(),a=nX.newNoDocument(i,s);n=new iI([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=iz(e,r.document);n=new iI([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return es(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new ic(r,i);n=new i_(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return eA.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?eA.min():t.readTime?iF(t.readTime):eA.min()}(e);return this.listener.j_(t,n)}H_(e){let t,n={};n.database=i$(this.serializer),n.addTarget=function(e,t){let n,r=t.target;if((n=rd(r)?{documents:iX(e,r)}:{query:iY(e,r).gt}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=iP(e,t.resumeToken);let r=iL(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(eA.min())>0){n.readTime=iO(e,t.snapshotVersion.toTimestamp());let r=iL(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return es(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.L_(n)}J_(e){let t={};t.database=i$(this.serializer),t.removeTarget=e,this.L_(t)}}class a9 extends a8{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get Y_(){return this.v_>0}start(){this.lastStreamToken=void 0,super.start()}Q_(){this.Y_&&this.Z_([])}G_(e,t){return this.connection.T_("Write",e,t)}z_(e){return eo(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,eo(!e.writeResults||0===e.writeResults.length,55816),this.listener.X_()}onNext(e){var t,n;eo(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.C_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(eo(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?iF(e.updateTime):iF(n)).isEqual(eA.min())&&(t=iF(n)),new r2(t,e.transformResults||[])})):[]),i=iF(e.commitTime);return this.listener.ea(i,r)}ta(){let e={};e.database=i$(this.serializer),this.L_(e)}Z_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>iW(this.serializer,e))};this.L_(t)}}class oe{}class ot extends oe{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.na=!1}ra(){if(this.na)throw new eh(eu.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,n,r){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.zo(e,iB(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===eu.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new eh(eu.UNKNOWN,e.toString())})}Yo(e,t,n,r,i){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Yo(e,iB(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===eu.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new eh(eu.UNKNOWN,e.toString())})}terminate(){this.na=!0,this.connection.terminate()}}class on{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.ia=0,this.sa=null,this.oa=!0}_a(){0===this.ia&&(this.aa("Unknown"),this.sa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.sa=null,this.ua("Backend didn't respond within 10 seconds."),this.aa("Offline"),Promise.resolve())))}ca(e){"Online"===this.state?this.aa("Unknown"):(this.ia++,this.ia>=1&&(this.la(),this.ua(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.aa("Offline")))}set(e){this.la(),this.ia=0,"Online"===e&&(this.oa=!1),this.aa(e)}aa(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ua(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.oa?(en(t),this.oa=!1):et("OnlineStateTracker",t)}la(){null!==this.sa&&(this.sa.cancel(),this.sa=null)}}let or="RemoteStore";class oi{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.ha=[],this.Pa=new Map,this.Ta=new Set,this.Ia=[],this.Ea=i,this.Ea.No(e=>{n.enqueueAndForget(async()=>{of(this)&&(et(or,"Restarting streams for network reachability change."),await async function(e){e.Ta.add(4),await oa(e),e.da.set("Unknown"),e.Ta.delete(4),await os(e)}(this))})}),this.da=new on(n,r)}}async function os(e){if(of(e))for(let t of e.Ia)await t(!0)}async function oa(e){for(let t of e.Ia)await t(!1)}function oo(e,t){e.Pa.has(t.targetId)||(e.Pa.set(t.targetId,t),od(e)?oc(e):oD(e).M_()&&ou(e,t))}function ol(e,t){let n=oD(e);e.Pa.delete(t),n.M_()&&oh(e,t),0===e.Pa.size&&(n.M_()?n.N_():of(e)&&e.da.set("Unknown"))}function ou(e,t){if(e.Aa.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(eA.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}oD(e).H_(t)}function oh(e,t){e.Aa.Ke(t),oD(e).J_(t)}function oc(e){e.Aa=new iC({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>e.Pa.get(t)||null,Pt:()=>e.datastore.serializer.databaseId}),oD(e).start(),e.da._a()}function od(e){return of(e)&&!oD(e).F_()&&e.Pa.size>0}function of(e){return 0===e.Ta.size}async function og(e){e.da.set("Online")}async function op(e){e.Pa.forEach((t,n)=>{ou(e,t)})}async function om(e,t){e.Aa=void 0,od(e)?(e.da.ca(t),oc(e)):e.da.set("Unknown")}async function oy(e,t,n){if(e.da.set("Online"),t instanceof ix&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Pa.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Pa.delete(r),e.Aa.removeTarget(r))}(e,t)}catch(n){et(or,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ov(e,n)}else if(t instanceof iI?e.Aa.Xe(t):t instanceof i_?e.Aa.ot(t):e.Aa.nt(t),!n.isEqual(eA.min()))try{let t,r=await aT(e.localStore);n.compareTo(r)>=0&&await ((t=e.Aa.It(n)).targetChanges.forEach((t,r)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Pa.get(r);i&&e.Pa.set(r,i.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let r=e.Pa.get(t);if(!r)return;e.Pa.set(t,r.withResumeToken(nh.EMPTY_BYTE_STRING,r.snapshotVersion)),oh(e,t);let i=new i3(r.target,t,n,r.sequenceNumber);ou(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){et(or,"Failed to raise snapshot:",t),await ov(e,t)}}async function ov(e,t,n){if(!e1(t))throw t;e.Ta.add(1),await oa(e),e.da.set("Offline"),n||(n=()=>aT(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{et(or,"Retrying IndexedDB access"),await n(),e.Ta.delete(1),await os(e)})}function ow(e,t){return t().catch(n=>ov(e,n,t))}async function ob(e){var t;let n=ok(e),r=e.ha.length>0?e.ha[e.ha.length-1].batchId:-1;for(;of(t=e)&&t.ha.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.ha.length&&n.N_();break}r=t.batchId,function(e,t){e.ha.push(t);let n=ok(e);n.M_()&&n.Y_&&n.Z_(t.mutations)}(e,t)}catch(t){await ov(e,t)}oT(e)&&oE(e)}function oT(e){return of(e)&&!ok(e).F_()&&e.ha.length>0}function oE(e){ok(e).start()}async function oI(e){ok(e).ta()}async function o_(e){let t=ok(e);for(let n of e.ha)t.Z_(n.mutations)}async function ox(e,t,n){let r=e.ha.shift(),i=il.from(r,t,n);await ow(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await ob(e)}async function oS(e,t){t&&ok(e).Y_&&await async function(e,t){var n;if(id(n=t.code)&&n!==eu.ABORTED){let n=e.ha.shift();ok(e).O_(),await ow(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await ob(e)}}(e,t),oT(e)&&oE(e)}async function oC(e,t){e.asyncQueue.verifyOperationInProgress(),et(or,"RemoteStore received new credentials");let n=of(e);e.Ta.add(3),await oa(e),n&&e.da.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ta.delete(3),await os(e)}async function oA(e,t){t?(e.Ta.delete(2),await os(e)):t||(e.Ta.add(2),await oa(e),e.da.set("Unknown"))}function oD(e){var t,n,r;return e.Ra||(t=e.datastore,n=e.asyncQueue,r={e_:og.bind(null,e),n_:op.bind(null,e),i_:om.bind(null,e),j_:oy.bind(null,e)},t.ra(),e.Ra=new a7(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.Ia.push(async t=>{t?(e.Ra.O_(),od(e)?oc(e):e.da.set("Unknown")):(await e.Ra.stop(),e.Aa=void 0)})),e.Ra}function ok(e){var t,n,r;return e.Va||(t=e.datastore,n=e.asyncQueue,r={e_:()=>Promise.resolve(),n_:oI.bind(null,e),i_:oS.bind(null,e),X_:o_.bind(null,e),ea:ox.bind(null,e)},t.ra(),e.Va=new a9(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.Ia.push(async t=>{t?(e.Va.O_(),await ob(e)):(await e.Va.stop(),e.ha.length>0&&(et(or,`Stopping write stream with ${e.ha.length} pending writes`),e.ha=[]))})),e.Va}class oN{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ec,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new oN(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new eh(eu.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function oR(e,t){if(en("AsyncQueue",`${t}: ${e}`),e1(e))return new eh(eu.UNAVAILABLE,`${t}: ${e}`);throw e}class oM{static emptySet(e){return new oM(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||eL.comparator(t.key,n.key):(e,t)=>eL.comparator(e.key,t.key),this.keyedMap=rO(),this.sortedSet=new nt(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof oM)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new oM;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class oL{constructor(){this.ma=new nt(eL.comparator)}track(e){let t=e.doc.key,n=this.ma.get(t);n?0!==e.type&&3===n.type?this.ma=this.ma.insert(t,e):3===e.type&&1!==n.type?this.ma=this.ma.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ma=this.ma.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ma=this.ma.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ma=this.ma.remove(t):1===e.type&&2===n.type?this.ma=this.ma.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ma=this.ma.insert(t,{type:2,doc:e.doc}):es(63341,{Vt:e,fa:n}):this.ma=this.ma.insert(t,e)}ga(){let e=[];return this.ma.inorderTraversal((t,n)=>{e.push(n)}),e}}class oO{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new oO(e,t,oM.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&rS(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class oP{constructor(){this.pa=void 0,this.ya=[]}wa(){return this.ya.some(e=>e.Sa())}}class oF{constructor(){this.queries=oV(),this.onlineState="Unknown",this.ba=new Set}terminate(){var e;let t;e=new eh(eu.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=oV(),t.forEach((t,n)=>{for(let t of n.ya)t.onError(e)})}}function oV(){return new rR(e=>rC(e),rS)}async function oB(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.wa()&&t.Sa()&&(n=2):(i=new oP,n=+!t.Sa());try{switch(n){case 0:i.pa=await e.onListen(r,!0);break;case 1:i.pa=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=oR(n,`Initialization of query '${rA(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.ya.push(t),t.Da(e.onlineState),i.pa&&t.va(i.pa)&&oj(e)}async function oU(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.ya.indexOf(t);e>=0&&(i.ya.splice(e,1),0===i.ya.length?r=+!t.Sa():!i.wa()&&t.Sa()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function oq(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.ya)e.va(r)&&(n=!0);i.pa=r}}n&&oj(e)}function oz(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.ya)e.onError(n);e.queries.delete(t)}function oj(e){e.ba.forEach(e=>{e.next()})}(g=f||(f={})).Ca="default",g.Cache="cache";class oK{constructor(e,t,n){this.query=e,this.Fa=t,this.Ma=!1,this.xa=null,this.onlineState="Unknown",this.options=n||{}}va(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new oO(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Ma?this.Oa(e)&&(this.Fa.next(e),t=!0):this.Na(e,this.onlineState)&&(this.Ba(e),t=!0),this.xa=e,t}onError(e){this.Fa.error(e)}Da(e){this.onlineState=e;let t=!1;return this.xa&&!this.Ma&&this.Na(this.xa,e)&&(this.Ba(this.xa),t=!0),t}Na(e,t){return!(e.fromCache&&this.Sa())||(!this.options.La||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Oa(e){if(e.docChanges.length>0)return!0;let t=this.xa&&this.xa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Ba(e){e=oO.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Ma=!0,this.Fa.next(e)}Sa(){return this.options.source!==f.Cache}}class o${constructor(e,t){this.ka=e,this.byteLength=t}qa(){return"metadata"in this.ka}}class oG{constructor(e){this.serializer=e}Us(e){return iz(this.serializer,e)}Ks(e){return e.metadata.exists?iH(this.serializer,e.document,!1):nX.newNoDocument(this.Us(e.metadata.name),this.Ws(e.metadata.readTime))}Ws(e){return iF(e)}}class oQ{constructor(e,t,n){this.Qa=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=oH(e)}$a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ka.namedQuery)this.queries.push(e.ka.namedQuery);else if(e.ka.documentMetadata){this.documents.push({metadata:e.ka.documentMetadata}),e.ka.documentMetadata.exists||++t;let n=eN.fromString(e.ka.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ka.document&&(this.documents[this.documents.length-1].document=e.ka.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ua(e){let t=new Map,n=new oG(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.Us(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||rU()).add(e);t.set(n,r)}}return t}async complete(){let e=await aD(this.localStore,new oG(this.serializer),this.documents,this.Qa.id),t=this.Ua(this.documents);for(let e of this.queries)await ak(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Ka:this.collectionGroups,Wa:e}}}function oH(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class oW{constructor(e){this.key=e}}class oJ{constructor(e){this.key=e}}class oX{constructor(e,t){this.query=e,this.Ga=t,this.za=null,this.hasCachedResults=!1,this.current=!1,this.ja=rU(),this.mutatedKeys=rU(),this.Ha=rN(e),this.Ja=new oM(this.Ha)}get Ya(){return this.Ga}Za(e,t){let n=t?t.Xa:new oL,r=t?t.Ja:this.Ja,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=rD(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(n.track({type:3,doc:h}),f=!0):this.eu(u,h)||(n.track({type:2,doc:h}),f=!0,(o&&this.Ha(h,o)>0||l&&0>this.Ha(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ja:s,Xa:n,Cs:a,mutatedKeys:i}}eu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.Ja;this.Ja=e.Ja,this.mutatedKeys=e.mutatedKeys;let s=e.Xa.ga();s.sort((e,t)=>{var n,r;let i;return n=e.type,r=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return es(20277,{Vt:e})}})(n)-i(r)||this.Ha(e.doc,t.doc)}),this.tu(n),r=null!=r&&r;let a=t&&!r?this.nu():[],o=0===this.ja.size&&this.current&&!r?1:0,l=o!==this.za;return(this.za=o,0!==s.length||l)?{snapshot:new oO(this.query,e.Ja,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),ru:a}:{ru:a}}Da(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ja:this.Ja,Xa:new oL,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ru:[]}}iu(e){return!this.Ga.has(e)&&!!this.Ja.has(e)&&!this.Ja.get(e).hasLocalMutations}tu(e){e&&(e.addedDocuments.forEach(e=>this.Ga=this.Ga.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ga=this.Ga.delete(e)),this.current=e.current)}nu(){if(!this.current)return[];let e=this.ja;this.ja=rU(),this.Ja.forEach(e=>{this.iu(e.key)&&(this.ja=this.ja.add(e.key))});let t=[];return e.forEach(e=>{this.ja.has(e)||t.push(new oJ(e))}),this.ja.forEach(n=>{e.has(n)||t.push(new oW(n))}),t}su(e){this.Ga=e.$s,this.ja=rU();let t=this.Za(e.documents);return this.applyChanges(t,!0)}ou(){return oO.fromInitialDocuments(this.query,this.Ja,this.mutatedKeys,0===this.za,this.hasCachedResults)}}let oY="SyncEngine";class oZ{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class o0{constructor(e){this.key=e,this._u=!1}}class o1{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.au={},this.uu=new rR(e=>rC(e),rS),this.cu=new Map,this.lu=new Set,this.hu=new nt(eL.comparator),this.Pu=new Map,this.Tu=new s7,this.Iu={},this.Eu=new Map,this.du=sq.lr(),this.onlineState="Unknown",this.Au=void 0}get isPrimaryClient(){return!0===this.Au}}async function o2(e,t,n=!0){let r,i=lI(e),s=i.uu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.ou()):r=await o3(i,t,n,!0),r}async function o6(e,t){let n=lI(e);await o3(n,t,!0,!1)}async function o3(e,t,n,r){let i,s=await aI(e.localStore,rT(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,n);return r&&(i=await o5(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&oo(e.remoteStore,s),i}async function o5(e,t,n,r,i){e.Ru=(t,n,r)=>(async function(e,t,n,r){let i=t.view.Za(n);i.Cs&&(i=await ax(e.localStore,t.query,!1).then(({documents:e})=>t.view.Za(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return lu(e,t.targetId,o.ru),o.snapshot})(e,t,n,r);let s=await ax(e.localStore,t,!0),a=new oX(t,s.$s),o=a.Za(s.documents),l=iE.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);lu(e,n,u.ru);let h=new oZ(t,n,a);return e.uu.set(t,h),e.cu.has(n)?e.cu.get(n).push(t):e.cu.set(n,[t]),u.snapshot}async function o4(e,t,n){let r=e.uu.get(t),i=e.cu.get(r.targetId);i.length>1?(e.cu.set(r.targetId,i.filter(e=>!rS(e,t))),e.uu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await a_(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&ol(e.remoteStore,r.targetId),lo(e,r.targetId)}).catch(eQ)):(lo(e,r.targetId),await a_(e.localStore,r.targetId,!0))}async function o8(e,t){let n=e.uu.get(t),r=e.cu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),ol(e.remoteStore,n.targetId))}async function o7(e,t,n){let r=l_(e);try{var i,s;let e,a,o,l,u,h=await (i=r.localStore,o=eC.now(),l=t.reduce((e,t)=>e.add(t.key),rU()),i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let r=rM,s=rU();return i.Bs.getEntries(n,l).next(e=>{(r=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,r)).next(r=>{e=r;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=rG(r.transform,e||null);null!=i&&(null===n&&(n=nJ.empty()),n.set(r.field,i))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new ie(n.key,t,function e(t){let n=[];return t7(t.fields,(t,r)=>{let i=new eM([t]);if(nj(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new no(n)}(t.value.mapValue),r6.exists(!0)))}return i.mutationQueue.addMutationBatch(n,o,s,t)}).next(t=>{a=t;let r=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(n,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:rP(e)})));r.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=r.Iu[r.currentUser.toKey()])||(u=new nt(eI)),u=u.insert(s,n),r.Iu[r.currentUser.toKey()]=u,await lc(r,h.changes),await ob(r.remoteStore)}catch(t){let e=oR(t,"Failed to persist write");n.reject(e)}}async function o9(e,t){var n;try{let r,i,s=await (n=e.localStore,r=t.snapshotVersion,i=n.xs,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.Bs.newChangeBuffer({trackRemovals:!0});i=n.xs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(n.Ti.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Ti.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(nh.EMPTY_BYTE_STRING,eA.min()).withLastLimboFreeSnapshotVersion(eA.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(n.Ti.updateTargetData(e,h))});let o=rM,l=rU();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(aE(e,s,t.documentUpdates).next(e=>{o=e.qs,l=e.Qs})),!r.isEqual(eA.min())){let t=n.Ti.getLastRemoteSnapshotVersion(e).next(t=>n.Ti.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return eH.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.xs=i,e)));t.targetChanges.forEach((t,n)=>{let r=e.Pu.get(n);r&&(eo(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r._u=!0:t.modifiedDocuments.size>0?eo(r._u,14607):t.removedDocuments.size>0&&(eo(r._u,42227),r._u=!1))}),await lc(e,s,t)}catch(e){await eQ(e)}}function le(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.uu.forEach((e,n)=>{let r=n.view.Da(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.ya)e.Da(t)&&(n=!0)}),n&&oj(r),i.length&&e.au.j_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function lt(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Pu.get(t),i=r&&r.key;if(i){let n=new nt(eL.comparator);n=n.insert(i,nX.newNoDocument(i,eA.min()));let r=rU().add(i),s=new iT(eA.min(),new Map,new nt(eI),n,r);await o9(e,s),e.hu=e.hu.remove(i),e.Pu.delete(t),lh(e)}else await a_(e.localStore,t,!1).then(()=>lo(e,t,n)).catch(eQ)}async function ln(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r,i,s,a=t.batch.keys(),o=n.Bs.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),s=eH.resolve(),i.forEach(n=>{s=s.next(()=>o.getEntry(e,n)).next(e=>{let i=t.docVersions.get(n);eo(null!==i,48541),0>e.version.compareTo(i)&&(r.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,r))).next(()=>o.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=rU();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,a))}));la(e,r,null),ls(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await lc(e,i)}catch(e){await eQ(e)}}async function lr(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(eo(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));la(e,t,n),ls(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await lc(e,i)}catch(e){await eQ(e)}}async function li(e,t){var n;of(e.remoteStore)||et(oY,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=await (n=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>n.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===r)return void t.resolve();let i=e.Eu.get(r)||[];i.push(t),e.Eu.set(r,i)}catch(n){let e=oR(n,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function ls(e,t){(e.Eu.get(t)||[]).forEach(e=>{e.resolve()}),e.Eu.delete(t)}function la(e,t,n){let r=e.Iu[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Iu[e.currentUser.toKey()]=r}}function lo(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.cu.get(t)))e.uu.delete(r),n&&e.au.Vu(r,n);e.cu.delete(t),e.isPrimaryClient&&e.Tu.Hr(t).forEach(t=>{e.Tu.containsKey(t)||ll(e,t)})}function ll(e,t){e.lu.delete(t.path.canonicalString());let n=e.hu.get(t);null!==n&&(ol(e.remoteStore,n),e.hu=e.hu.remove(t),e.Pu.delete(n),lh(e))}function lu(e,t,n){for(let r of n)r instanceof oW?(e.Tu.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.hu.get(n)||e.lu.has(r)||(et(oY,"New document in limbo: "+n),e.lu.add(r),lh(e))}(e,r)):r instanceof oJ?(et(oY,"Document no longer in limbo: "+r.key),e.Tu.removeReference(r.key,t),e.Tu.containsKey(r.key)||ll(e,r.key)):es(19791,{mu:r})}function lh(e){for(;e.lu.size>0&&e.hu.size<e.maxConcurrentLimboResolutions;){let t=e.lu.values().next().value;e.lu.delete(t);let n=new eL(eN.fromString(t)),r=e.du.next();e.Pu.set(r,new o0(n)),e.hu=e.hu.insert(n,r),oo(e.remoteStore,new i3(rT(ry(n.path)),r,"TargetPurposeLimboResolution",e9.le))}}async function lc(e,t,n){let r=[],i=[],s=[];e.uu.isEmpty()||(e.uu.forEach((a,o)=>{s.push(e.Ru(o,t,n).then(t=>{var s;if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:null==(s=null==n?void 0:n.targetChanges.get(o.targetId))?void 0:s.current;e.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(t){r.push(t);let e=ap.Rs(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.au.j_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>eH.forEach(t,t=>eH.forEach(t.ds,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>eH.forEach(t.As,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!e1(e))throw e;et(av,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.xs.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.xs=e.xs.insert(t,i)}}}(e.localStore,i))}async function ld(e,t){if(!e.currentUser.isEqual(t)){et(oY,"User change. New user:",t.toKey());let n=await ab(e.localStore,t);e.currentUser=t,e.Eu.forEach(e=>{e.forEach(e=>{e.reject(new eh(eu.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Eu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await lc(e,n.ks)}}function lf(e,t){let n=e.Pu.get(t);if(n&&n._u)return rU().add(n.key);{let n=rU(),r=e.cu.get(t);if(!r)return n;for(let t of r){let r=e.uu.get(t);n=n.unionWith(r.view.Ya)}return n}}async function lg(e,t){let n=await ax(e.localStore,t.query,!0),r=t.view.su(n);return e.isPrimaryClient&&lu(e,t.targetId,r.ru),r}async function lp(e,t){return aC(e.localStore,t).then(t=>lc(e,t))}async function lm(e,t,n,r){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.tr(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):eH.resolve(null))));null!==o?("pending"===n?await ob(e.remoteStore):"acknowledged"===n||"rejected"===n?(la(e,t,r||null),ls(e,t),s=e.localStore,s.mutationQueue.sr(t)):es(6720,"Unknown batchState",{fu:n}),await lc(e,o)):et(oY,"Cannot apply mutation batch with id: "+t)}async function ly(e,t){if(lI(e),l_(e),!0===t&&!0!==e.Au){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await lv(e,t.toArray());for(let t of(e.Au=!0,await oA(e.remoteStore,!0),n))oo(e.remoteStore,t)}else if(!1===t&&!1!==e.Au){let t=[],n=Promise.resolve();e.cu.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(lo(e,i),a_(e.localStore,i,!0))),ol(e.remoteStore,i)}),await n,await lv(e,t),e.Pu.forEach((t,n)=>{ol(e.remoteStore,n)}),e.Tu.Jr(),e.Pu=new Map,e.hu=new nt(eL.comparator),e.Au=!1,await oA(e.remoteStore,!1)}}async function lv(e,t,n){let r=[],i=[];for(let n of t){let t,s=e.cu.get(n);if(s&&0!==s.length)for(let n of(t=await aI(e.localStore,rT(s[0])),s)){let t=e.uu.get(n),r=await lg(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await aS(e.localStore,n);t=await aI(e.localStore,r),await o5(e,lw(r),n,!1,t.resumeToken)}r.push(t)}return e.au.j_(i),r}function lw(e){var t,n,r,i,s;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,s=e.limit,new rm(t,n,r,i,s,"F",e.startAt,e.endAt)}function lb(e){return e.localStore.persistence.Is()}async function lT(e,t,n,r){if(e.Au)return void et(oY,"Ignoring unexpected query state notification.");let i=e.cu.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await aC(e.localStore,rk(i[0])),s=iT.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,nh.EMPTY_BYTE_STRING);await lc(e,r,s);break}case"rejected":await a_(e.localStore,t,!0),lo(e,t,r);break;default:es(64155,n)}}async function lE(e,t,n){let r=lI(e);if(r.Au){for(let e of t){if(r.cu.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){et(oY,"Adding an already active target "+e);continue}let t=await aS(r.localStore,e),n=await aI(r.localStore,t);await o5(r,lw(t),n.targetId,!1,n.resumeToken),oo(r.remoteStore,n)}for(let e of n)r.cu.has(e)&&await a_(r.localStore,e,!1).then(()=>{ol(r.remoteStore,e),lo(r,e)}).catch(eQ)}}function lI(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=o9.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lf.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=lt.bind(null,e),e.au.j_=oq.bind(null,e.eventManager),e.au.Vu=oz.bind(null,e.eventManager),e}function l_(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=ln.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=lr.bind(null,e),e}class lx{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=a3(e.databaseInfo.databaseId),this.sharedClientState=this.pu(e),this.persistence=this.yu(e),await this.persistence.start(),this.localStore=this.wu(e),this.gcScheduler=this.Su(e,this.localStore),this.indexBackfillerScheduler=this.bu(e,this.localStore)}Su(e,t){return null}bu(e,t){return null}wu(e){var t,n;return t=this.persistence,n=new ay,new aw(t,n,e.initialUser,this.serializer)}yu(e){return new ai(aa.fi,this.serializer)}pu(e){return new aK}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}lx.provider={build:()=>new lx};class lS extends lx{constructor(e){super(),this.cacheSizeBytes=e}Su(e,t){return eo(this.persistence.referenceDelegate instanceof ao,46915),new sQ(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}yu(e){let t=void 0!==this.cacheSizeBytes?sO.withCacheSize(this.cacheSizeBytes):sO.DEFAULT;return new ai(e=>ao.fi(e,t),this.serializer)}}class lC extends lx{constructor(e,t,n){super(),this.Du=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Du.initialize(this,e),await l_(this.Du.syncEngine),await ob(this.Du.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}wu(e){var t,n;return t=this.persistence,n=new ay,new aw(t,n,e.initialUser,this.serializer)}Su(e,t){return new sQ(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}bu(e,t){let n=new e7(t,this.persistence);return new e8(e.asyncQueue,n)}yu(e){let t=ag(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?sO.withCacheSize(this.cacheSizeBytes):sO.DEFAULT;return new af(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,a2(),a6(),this.serializer,this.sharedClientState,!!this.forceOwnership)}pu(e){return new aK}}class lA extends lC{constructor(e,t){super(e,t,!1),this.Du=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.Du.syncEngine;this.sharedClientState instanceof aj&&(this.sharedClientState.syncEngine={Co:lm.bind(null,t),Fo:lT.bind(null,t),Mo:lE.bind(null,t),Is:lb.bind(null,t),vo:lp.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async e=>{await ly(this.Du.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}pu(e){let t=a2();if(!aj.C(t))throw new eh(eu.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=ag(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new aj(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class lD{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>le(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ld.bind(null,this.syncEngine),await oA(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new oF}createDatastore(e){var t;let n=a3(e.databaseInfo.databaseId),r=new a1(e.databaseInfo);return t=e.authCredentials,new ot(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new oi(t,n,e.asyncQueue,e=>le(this.syncEngine,e,0),aQ.C()?new aQ:new a$)}createSyncEngine(e,t){var n,r,i,s,a,o;let l;return n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new o1(n,r,i,s,a,o),t&&(l.Au=!0),l}async terminate(){var e,t;await async function(e){et(or,"RemoteStore shutting down."),e.Ta.add(5),await oa(e),e.Ea.shutdown(),e.da.set("Unknown")}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()}}function lk(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}lD.provider={build:()=>new lD};class lN{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.vu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.vu(this.observer.error,e):en("Uncaught Error in snapshot listener:",e.toString()))}Cu(){this.muted=!0}vu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class lR{constructor(e,t){this.Fu=e,this.serializer=t,this.metadata=new ec,this.buffer=new Uint8Array,this.Mu=new TextDecoder("utf-8"),this.xu().then(e=>{e&&e.qa()?this.metadata.resolve(e.ka.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.ka)}`))},e=>this.metadata.reject(e))}close(){return this.Fu.cancel()}async getMetadata(){return this.metadata.promise}async gu(){return await this.getMetadata(),this.xu()}async xu(){let e=await this.Ou();if(null===e)return null;let t=this.Mu.decode(e),n=Number(t);return isNaN(n)&&this.Nu(`length string (${t}) is not valid number`),new o$(JSON.parse(await this.Bu(n)),e.length+n)}Lu(){return this.buffer.findIndex(e=>123===e)}async Ou(){for(;0>this.Lu()&&!await this.ku(););if(0===this.buffer.length)return null;let e=this.Lu();e<0&&this.Nu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Bu(e){for(;this.buffer.length<e;)await this.ku()&&this.Nu("Reached the end of bundle when more is expected.");let t=this.Mu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Nu(e){throw this.Fu.cancel(),Error(`Invalid bundle format: ${e}`)}async ku(){let e=await this.Fu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class lM{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new eh(eu.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let n={documents:t.map(t=>iq(e.serializer,t))},r=await e.Yo("BatchGetDocuments",e.serializer.databaseId,eN.emptyPath(),n,t.length),i=new Map;r.forEach(t=>{var n;let r,s,a,o,l,u,h=(n=e.serializer,"found"in t?(eo(!!t.found,43571),t.found.name,t.found.updateTime,r=iz(n,t.found.name),s=iF(t.found.updateTime),a=t.found.createTime?iF(t.found.createTime):eA.min(),o=new nJ({mapValue:{fields:t.found.fields}}),nX.newFoundDocument(r,s,a,o)):"missing"in t?(eo(!!t.missing,3894),eo(!!t.readTime,22933),l=iz(n,t.missing),u=iF(t.readTime),nX.newNoDocument(l,u)):es(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());eo(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new is(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=eL.fromPath(t);this.mutations.push(new ia(n,this.precondition(n)))}),await async function(e,t){let n={writes:t.map(t=>iW(e.serializer,t))};await e.zo("Commit",e.serializer.databaseId,eN.emptyPath(),n)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw es(50498,{qu:e.constructor.name});t=eA.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new eh(eu.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(eA.min())?r6.exists(!1):r6.updateTime(t):r6.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(eA.min()))throw new eh(eu.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return r6.updateTime(t)}return r6.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class lL{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Qu=n.maxAttempts,this.C_=new a5(this.asyncQueue,"transaction_retry")}$u(){this.Qu-=1,this.Uu()}Uu(){this.C_.f_(async()=>{let e=new lM(this.datastore),t=this.Ku(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Wu(e)}))}).catch(e=>{this.Wu(e)})})}Ku(e){try{let t=this.updateFunction(e);return!te(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Wu(e){this.Qu>0&&this.Gu(e)?(this.Qu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Uu(),Promise.resolve()))):this.deferred.reject(e)}Gu(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!id(t)}return!1}}let lO="FirestoreClient";class lP{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=J.UNAUTHENTICATED,this.clientId=eE.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{et(lO,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(et(lO,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ec;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=oR(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function lF(e,t){e.asyncQueue.verifyOperationInProgress(),et(lO,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await ab(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function lV(e,t){e.asyncQueue.verifyOperationInProgress();let n=await lB(e);et(lO,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>oC(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>oC(t.remoteStore,n)),e._onlineComponents=t}async function lB(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){et(lO,"Using user provided OfflineComponentProvider");try{await lF(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===eu.FAILED_PRECONDITION||t.code===eu.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;er("Error using user provided cache. Falling back to memory cache: "+t),await lF(e,new lx)}}else et(lO,"Using default OfflineComponentProvider"),await lF(e,new lS(void 0));return e._offlineComponents}async function lU(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(et(lO,"Using user provided OnlineComponentProvider"),await lV(e,e._uninitializedComponentsProvider._online)):(et(lO,"Using default OnlineComponentProvider"),await lV(e,new lD))),e._onlineComponents}function lq(e){return lB(e).then(e=>e.persistence)}function lz(e){return lB(e).then(e=>e.localStore)}function lj(e){return lU(e).then(e=>e.remoteStore)}function lK(e){return lU(e).then(e=>e.syncEngine)}function l$(e){return lU(e).then(e=>e.datastore)}async function lG(e){let t=await lU(e),n=t.eventManager;return n.onListen=o2.bind(null,t.syncEngine),n.onUnlisten=o4.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=o6.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=o8.bind(null,t.syncEngine),n}function lQ(e,t,n={}){let r=new ec;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await lG(e),s=e.asyncQueue,a=new lN({next:e=>{a.Cu(),s.enqueueAndForget(()=>oU(i,o));let l=e.docs.has(t);!l&&e.fromCache?r.reject(new eh(eu.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&n&&"server"===n.source?r.reject(new eh(eu.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(e)},error:e=>r.reject(e)}),oB(i,o=new oK(ry(t.path),a,{includeMetadataChanges:!0,La:!0}))}),r.promise}function lH(e,t,n={}){let r=new ec;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await lG(e),s=e.asyncQueue,o=new oK(t,a=new lN({next:e=>{a.Cu(),s.enqueueAndForget(()=>oU(i,o)),e.fromCache&&"server"===n.source?r.reject(new eh(eu.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(e)},error:e=>r.reject(e)}),{includeMetadataChanges:!0,La:!0}),oB(i,o)}),r.promise}function lW(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let lJ=new Map;function lX(e,t,n){if(!n)throw new eh(eu.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function lY(e,t,n,r){if(!0===t&&!0===r)throw new eh(eu.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function lZ(e){if(!eL.isDocumentKey(e))throw new eh(eu.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function l0(e){if(eL.isDocumentKey(e))throw new eh(eu.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function l1(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":es(12329,{type:typeof e})}function l2(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new eh(eu.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=l1(e);throw new eh(eu.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function l6(e,t){if(t<=0)throw new eh(eu.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}let l3="firestore.googleapis.com";class l5{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new eh(eu.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=l3,this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new eh(eu.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}lY("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lW(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new eh(eu.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new eh(eu.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new eh(eu.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class l4{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new l5({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new eh(eu.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new eh(eu.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new l5(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ef;switch(e.type){case"firstParty":return new ey(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new eh(eu.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,N("Firestore",this._settings.isUsingEmulator),this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=lJ.get(this))&&(et("ComponentProvider","Removing Datastore"),lJ.delete(this),e.terminate()),Promise.resolve()}}function l8(e,t,n,r={}){var i;e=l2(e,l4);let s=C(t),a=e._getSettings(),o=Object.assign(Object.assign({},a),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${n}`;a.host!==l3&&a.host!==l&&er("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let u=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:r});if(!B(u,o)&&(e._setSettings(u),s&&(A(`https://${l}`),N("Firestore",!0)),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=J.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[I(JSON.stringify({alg:"none",type:"JWT"})),I(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new eh(eu.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new J(s)}e._authCredentials=new eg(new ed(t,n))}}class l7{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new l7(this.firestore,e,this._query)}}class l9{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ue(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new l9(this.firestore,e,this._key)}}class ue extends l7{constructor(e,t,n){super(e,t,ry(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new l9(this.firestore,null,new eL(e))}withConverter(e){return new ue(this.firestore,e,this._path)}}function ut(e,t,...n){if(e=q(e),lX("collection","path",t),e instanceof l4){let r=eN.fromString(t,...n);return l0(r),new ue(e,null,r)}{if(!(e instanceof l9||e instanceof ue))throw new eh(eu.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(eN.fromString(t,...n));return l0(r),new ue(e.firestore,null,r)}}function un(e,t){if(e=l2(e,l4),lX("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new eh(eu.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new l7(e,null,new rm(eN.emptyPath(),t))}function ur(e,t,...n){if(e=q(e),1==arguments.length&&(t=eE.newId()),lX("doc","path",t),e instanceof l4){let r=eN.fromString(t,...n);return lZ(r),new l9(e,null,new eL(r))}{if(!(e instanceof l9||e instanceof ue))throw new eh(eu.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(eN.fromString(t,...n));return lZ(r),new l9(e.firestore,e instanceof ue?e.converter:null,new eL(r))}}function ui(e,t){return e=q(e),t=q(t),(e instanceof l9||e instanceof ue)&&(t instanceof l9||t instanceof ue)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function us(e,t){return e=q(e),t=q(t),e instanceof l7&&t instanceof l7&&e.firestore===t.firestore&&rS(e._query,t._query)&&e.converter===t.converter}let ua="AsyncQueue";class uo{constructor(e=Promise.resolve()){this.zu=[],this.ju=!1,this.Hu=[],this.Ju=null,this.Yu=!1,this.Zu=!1,this.Xu=[],this.C_=new a5(this,"async_queue_retry"),this.ec=()=>{let e=a6();e&&et(ua,"Visibility state changed to "+e.visibilityState),this.C_.p_()},this.tc=e;const t=a6();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ec)}get isShuttingDown(){return this.ju}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.nc(),this.rc(e)}enterRestrictedMode(e){if(!this.ju){this.ju=!0,this.Zu=e||!1;let t=a6();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ec)}}enqueue(e){if(this.nc(),this.ju)return new Promise(()=>{});let t=new ec;return this.rc(()=>this.ju&&this.Zu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.zu.push(e),this.sc()))}async sc(){if(0!==this.zu.length){try{await this.zu[0](),this.zu.shift(),this.C_.reset()}catch(e){if(!e1(e))throw e;et(ua,"Operation failed with retryable error: "+e)}this.zu.length>0&&this.C_.f_(()=>this.sc())}}rc(e){let t=this.tc.then(()=>(this.Yu=!0,e().catch(e=>{throw this.Ju=e,this.Yu=!1,en("INTERNAL UNHANDLED ERROR: ",ul(e)),e}).then(e=>(this.Yu=!1,e))));return this.tc=t,t}enqueueAfterDelay(e,t,n){this.nc(),this.Xu.indexOf(e)>-1&&(t=0);let r=oN.createAndSchedule(this,e,t,n,e=>this.oc(e));return this.Hu.push(r),r}nc(){this.Ju&&es(47125,{_c:ul(this.Ju)})}verifyOperationInProgress(){}async ac(){let e;do e=this.tc,await e;while(e!==this.tc)}uc(e){for(let t of this.Hu)if(t.timerId===e)return!0;return!1}cc(e){return this.ac().then(()=>{for(let t of(this.Hu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.Hu))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.ac()})}lc(e){this.Xu.push(e)}oc(e){let t=this.Hu.indexOf(e);this.Hu.splice(t,1)}}function ul(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function uu(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class uh{constructor(){this._progressObserver={},this._taskCompletionResolver=new ec,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class uc extends l4{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new uo,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new uo(e),this._firestoreClient=void 0,await e}}}function ud(e,t,n){n||(n=nI);let r=(0,y._getProvider)(e,"firestore");if(r.isInitialized(n)){let e=r.getImmediate({identifier:n});if(B(r.getOptions(n),t))return e;throw new eh(eu.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new eh(eu.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new eh(eu.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&C(t.host)&&A(t.host),r.initialize({options:t,instanceIdentifier:n})}function uf(e,t){let n="object"==typeof e?e:(0,y.getApp)(),r="string"==typeof e?e:t||nI,i=(0,y._getProvider)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let e=(e=>{var t,n;let r=null==(n=null==(t=S())?void 0:t.emulatorHosts)?void 0:n[e];if(!r)return;let i=r.lastIndexOf(":");if(i<=0||i+1===r.length)throw Error(`Invalid host ${r} with no separate hostname and port!`);let s=parseInt(r.substring(i+1),10);return"["===r[0]?[r.substring(1,i-1),s]:[r.substring(0,i),s]})("firestore");e&&l8(i,...e)}return i}function ug(e){if(e._terminated)throw new eh(eu.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||up(e),e._firestoreClient}function up(e){var t,n,r,i,s,a;let o,l=e._freezeSettings(),u=(i=e._databaseId,s=(null==(t=e._app)?void 0:t.options.appId)||"",new nE(i,s,e._persistenceKey,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,lW(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator));e._componentsProvider||(null==(n=l.localCache)?void 0:n._offlineComponentProvider)&&(null==(r=l.localCache)?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),e._firestoreClient=new lP(e._authCredentials,e._appCheckCredentials,e._queue,u,e._componentsProvider&&(o=null==(a=e._componentsProvider)?void 0:a._online.build(),{_offline:null==a?void 0:a._offline.build(o),_online:o}))}function um(e,t){er("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=e._freezeSettings();return uv(e,lD.provider,{build:e=>new lC(e,n.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()}async function uy(e){er("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();uv(e,lD.provider,{build:e=>new lA(e,t.cacheSizeBytes)})}function uv(e,t,n){if((e=l2(e,uc))._firestoreClient||e._terminated)throw new eh(eu.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new eh(eu.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},up(e)}function uw(e){if(e._initialized&&!e._terminated)throw new eh(eu.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new ec;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!eX.C())return Promise.resolve();await eX.delete(e+ad)}(ag(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function ub(e){var t;let n;return t=ug(e=l2(e,uc)),n=new ec,t.asyncQueue.enqueueAndForget(async()=>li(await lK(t),n)),n.promise}function uT(e){var t;return(t=ug(e=l2(e,uc))).asyncQueue.enqueue(async()=>{let e=await lq(t),n=await lj(t);return e.setNetworkEnabled(!0),n.Ta.delete(0),os(n)})}function uE(e){var t;return(t=ug(e=l2(e,uc))).asyncQueue.enqueue(async()=>{let e=await lq(t),n=await lj(t);return e.setNetworkEnabled(!1),async function(e){e.Ta.add(0),await oa(e),e.da.set("Offline")}(n)})}function uI(e){return(0,y._removeServiceInstance)(e.app,"firestore",e._databaseId.database),e._delete()}function u_(e,t){let n=ug(e=l2(e,uc)),r=new uh;return function(e,t,n,r){var i;let s=(i=a3(t),new lR(function(e,t){if(e instanceof Uint8Array)return lk(e,void 0);if(e instanceof ArrayBuffer)return lk(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?eT().encode(n):n),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,n){try{var r,i;let s,a=await t.getMetadata();if(await (r=e.localStore,s=iF(a.createTime),r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.Ei.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);n._updateProgress(oH(a));let o=new oQ(a,e.localStore,t.serializer),l=await t.gu();for(;l;){let e=await o.$a(l);e&&n._updateProgress(e),l=await t.gu()}let u=await o.complete();return await lc(e,u.Wa,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Ei.saveBundleMetadata(e,a))),n._completeWith(u.progress),Promise.resolve(u.Ka)}catch(e){return er(oY,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(t=await lK(e),s,r).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(n,e._databaseId,t,r),r}function ux(e,t){var n;return(n=ug(e=l2(e,uc)),n.asyncQueue.enqueue(async()=>{var e;return e=await lz(n),e.persistence.runTransaction("Get named query","readonly",n=>e.Ei.getNamedQuery(n,t))})).then(t=>t?new l7(e,null,t.query):null)}class uS{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class uC{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class uA{constructor(e){this._byteString=e}static fromBase64String(e){try{return new uA(nh.fromBase64String(e))}catch(e){throw new eh(eu.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new uA(nh.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class uD{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new eh(eu.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new eM(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function uk(){return new uD(eD)}class uN{constructor(e){this._methodName=e}}class uR{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new eh(eu.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new eh(eu.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return eI(this._lat,e._lat)||eI(this._long,e._long)}}class uM{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}let uL=/^__.*__$/;class uO{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ie(e,this.data,this.fieldMask,t,this.fieldTransforms):new r9(e,this.data,t,this.fieldTransforms)}}class uP{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ie(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function uF(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw es(40011,{hc:e})}}class uV{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Pc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get hc(){return this.settings.hc}Tc(e){return new uV(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ic(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.Tc({path:n,Ec:!1});return r.dc(e),r}Ac(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.Tc({path:n,Ec:!1});return r.Pc(),r}Rc(e){return this.Tc({path:void 0,Ec:!0})}Vc(e){return u3(e,this.settings.methodName,this.settings.mc||!1,this.path,this.settings.fc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Pc(){if(this.path)for(let e=0;e<this.path.length;e++)this.dc(this.path.get(e))}dc(e){if(0===e.length)throw this.Vc("Document fields must not be empty");if(uF(this.hc)&&uL.test(e))throw this.Vc('Document fields cannot begin and end with "__"')}}class uB{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||a3(e)}gc(e,t,n,r=!1){return new uV({hc:e,methodName:t,fc:n,path:eM.emptyPath(),Ec:!1,mc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function uU(e){let t=e._freezeSettings(),n=a3(e._databaseId);return new uB(e._databaseId,!!t.ignoreUndefinedProperties,n)}function uq(e,t,n,r,i,s={}){let a,o,l=e.gc(s.merge||s.mergeFields?2:0,t,n,i);u0("Data must be an object, but it was:",l,r);let u=uY(r,l);if(s.merge)a=new no(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=u1(t,r,n);if(!l.contains(i))throw new eh(eu.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);u5(e,i)||e.push(i)}a=new no(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new uO(new nJ(u),a,o)}class uz extends uN{_toFieldTransform(e){if(2!==e.hc)throw 1===e.hc?e.Vc(`${this._methodName}() can only appear at the top level of your update data`):e.Vc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof uz}}function uj(e,t,n){return new uV({hc:3,fc:t.settings.fc,methodName:e._methodName,Ec:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class uK extends uN{_toFieldTransform(e){return new r1(e.path,new rQ)}isEqual(e){return e instanceof uK}}class u$ extends uN{constructor(e,t){super(e),this.yc=t}_toFieldTransform(e){let t=uj(this,e,!0),n=new rH(this.yc.map(e=>uX(e,t)));return new r1(e.path,n)}isEqual(e){return e instanceof u$&&B(this.yc,e.yc)}}class uG extends uN{constructor(e,t){super(e),this.yc=t}_toFieldTransform(e){let t=uj(this,e,!0),n=new rJ(this.yc.map(e=>uX(e,t)));return new r1(e.path,n)}isEqual(e){return e instanceof uG&&B(this.yc,e.yc)}}class uQ extends uN{constructor(e,t){super(e),this.wc=t}_toFieldTransform(e){let t=new rY(e.serializer,rK(e.serializer,this.wc));return new r1(e.path,t)}isEqual(e){return e instanceof uQ&&this.wc===e.wc}}function uH(e,t,n,r){let i=e.gc(1,t,n);u0("Data must be an object, but it was:",i,r);let s=[],a=nJ.empty();return t7(r,(e,r)=>{let o=u6(t,e,n);r=q(r);let l=i.Ac(o);if(r instanceof uz)s.push(o);else{let e=uX(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new uP(a,new no(s),i.fieldTransforms)}function uW(e,t,n,r,i,s){let a=e.gc(1,t,n),o=[u1(t,r,n)],l=[i];if(s.length%2!=0)throw new eh(eu.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(u1(t,s[e])),l.push(s[e+1]);let u=[],h=nJ.empty();for(let e=o.length-1;e>=0;--e)if(!u5(u,o[e])){let t=o[e],n=l[e];n=q(n);let r=a.Ac(t);if(n instanceof uz)u.push(t);else{let e=uX(n,r);null!=e&&(u.push(t),h.set(t,e))}}return new uP(h,new no(u),a.fieldTransforms)}function uJ(e,t,n,r=!1){return uX(n,e.gc(r?4:3,t))}function uX(e,t){if(uZ(e=q(e)))return u0("Unsupported field value:",t,e),uY(e,t);if(e instanceof uN)return function(e,t){if(!uF(t.hc))throw t.Vc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Vc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Ec&&4!==t.hc)throw t.Vc("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=uX(i,t.Rc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){if(null===(e=q(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return rK(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=eC.fromDate(e);return{timestampValue:iO(t.serializer,n)}}if(e instanceof eC){let n=new eC(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:iO(t.serializer,n)}}if(e instanceof uR)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof uA)return{bytesValue:iP(t.serializer,e._byteString)};if(e instanceof l9){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Vc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:iV(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof uM)return{mapValue:{fields:{[nx]:{stringValue:nA},[nD]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Vc("VectorValues must only contain numeric values.");return rz(t.serializer,e)})}}}}};throw t.Vc(`Unsupported field value: ${l1(e)}`)}(e,t)}function uY(e,t){let n={};return ne(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):t7(e,(e,r)=>{let i=uX(r,t.Ic(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function uZ(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof eC||e instanceof uR||e instanceof uA||e instanceof l9||e instanceof uN||e instanceof uM)}function u0(e,t,n){if(!uZ(n)||"object"!=typeof n||null===n||Object.getPrototypeOf(n)!==Object.prototype&&null!==Object.getPrototypeOf(n)){let r=l1(n);throw"an object"===r?t.Vc(e+" a custom object"):t.Vc(e+" "+r)}}function u1(e,t,n){if((t=q(t))instanceof uD)return t._internalPath;if("string"==typeof t)return u6(e,t);throw u3("Field path arguments must be of type string or ",e,!1,void 0,n)}let u2=RegExp("[~\\*/\\[\\]]");function u6(e,t,n){if(t.search(u2)>=0)throw u3(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new uD(...t.split("."))._internalPath}catch(r){throw u3(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function u3(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new eh(eu.INVALID_ARGUMENT,o+e+l)}function u5(e,t){return e.some(e=>e.isEqual(t))}class u4{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new l9(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new u8(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(u7("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class u8 extends u4{data(){return super.data()}}function u7(e,t){return"string"==typeof t?u6(e,t):t instanceof uD?t._internalPath:t._delegate._internalPath}function u9(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new eh(eu.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class he{}class ht extends he{}function hn(e,t,...n){let r=[];for(let i of(t instanceof he&&r.push(t),function(e){let t=e.filter(e=>e instanceof hs).length,n=e.filter(e=>e instanceof hr).length;if(t>1||t>0&&n>0)throw new eh(eu.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class hr extends ht{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new hr(e,t,n)}_apply(e){let t=this._parse(e);return hE(e._query,t),new l7(e.firestore,e.converter,r_(e._query,t))}_parse(e){let t=uU(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new eh(eu.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){hT(a,s);let t=[];for(let n of a)t.push(hb(r,e,n));o={arrayValue:{values:t}}}else o=hb(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||hT(a,s),o=uJ(n,t,a,"in"===s||"not-in"===s);return n6.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function hi(e,t,n){let r=u7("where",e);return hr._create(r,t,n)}class hs extends he{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new hs(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:n3.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())hE(n,e),n=r_(n,e)}(e._query,t),new l7(e.firestore,e.converter,r_(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function ha(...e){return e.forEach(e=>hI("or",e)),hs._create("or",e)}function ho(...e){return e.forEach(e=>hI("and",e)),hs._create("and",e)}class hl extends ht{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new hl(e,t)}_apply(e){var t;let n,r=function(e,t,n){if(null!==e.startAt)throw new eh(eu.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new eh(eu.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new n1(t,n)}(e._query,this._field,this._direction);return new l7(e.firestore,e.converter,(t=e._query,n=t.explicitOrderBy.concat([r]),new rm(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function hu(e,t="asc"){let n=u7("orderBy",e);return hl._create(n,t)}class hh extends ht{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new hh(e,t,n)}_apply(e){return new l7(e.firestore,e.converter,rx(e._query,this._limit,this._limitType))}}function hc(e){return l6("limit",e),hh._create("limit",e,"F")}function hd(e){return l6("limitToLast",e),hh._create("limitToLast",e,"L")}class hf extends ht{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new hf(e,t,n)}_apply(e){var t;let n=hw(e,this.type,this._docOrFields,this._inclusive);return new l7(e.firestore,e.converter,(t=e._query,new rm(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt)))}}function hg(...e){return hf._create("startAt",e,!0)}function hp(...e){return hf._create("startAfter",e,!1)}class hm extends ht{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new hm(e,t,n)}_apply(e){var t;let n=hw(e,this.type,this._docOrFields,this._inclusive);return new l7(e.firestore,e.converter,(t=e._query,new rm(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n)))}}function hy(...e){return hm._create("endBefore",e,!1)}function hv(...e){return hm._create("endAt",e,!0)}function hw(e,t,n,r){if(n[0]=q(n[0]),n[0]instanceof u4)return function(e,t,n,r,i){if(!r)throw new eh(eu.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of rb(e))if(n.field.isKeyField())s.push(nV(t,r.key));else{let e=r.data.field(n.field);if(nw(e))throw new eh(eu.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new eh(eu.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new nY(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=uU(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new eh(eu.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new eh(eu.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!rw(e)&&-1!==l.indexOf("/"))throw new eh(eu.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(eN.fromString(l));if(!eL.isDocumentKey(n))throw new eh(eu.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new eL(n);o.push(nV(t,i))}else{let e=uJ(n,r,l);o.push(e)}}return new nY(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function hb(e,t,n){if("string"==typeof(n=q(n))){if(""===n)throw new eh(eu.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!rw(t)&&-1!==n.indexOf("/"))throw new eh(eu.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(eN.fromString(n));if(!eL.isDocumentKey(r))throw new eh(eu.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return nV(e,new eL(r))}if(n instanceof l9)return nV(e,n._key);throw new eh(eu.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${l1(n)}.`)}function hT(e,t){if(!Array.isArray(e)||0===e.length)throw new eh(eu.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function hE(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new eh(eu.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new eh(eu.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function hI(e,t){if(!(t instanceof hr||t instanceof hs))throw new eh(eu.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class h_{convertValue(e,t="none"){switch(nN(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nf(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ng(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw es(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return t7(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;return new uM(null==(r=null==(n=null==(t=e.fields)?void 0:t[nD].arrayValue)?void 0:n.values)?void 0:r.map(e=>nf(e.doubleValue)))}convertGeoPoint(e){return new uR(nf(e.latitude),nf(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=nb(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(nT(e));default:return null}}convertTimestamp(e){let t=nd(e);return new eC(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=eN.fromString(e);eo(i6(n),9688,{name:e});let r=new n_(n.get(1),n.get(3)),i=new eL(n.popFirst(5));return r.isEqual(t)||en(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function hx(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class hS extends h_{constructor(e){super(),this.firestore=e}convertBytes(e){return new uA(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new l9(this.firestore,null,t)}}function hC(e){return new uS("sum",u1("sum",e))}function hA(e){return new uS("avg",u1("average",e))}function hD(){return new uS("count")}function hk(e,t){var n,r;return e instanceof uS&&t instanceof uS&&e.aggregateType===t.aggregateType&&(null==(n=e._internalFieldPath)?void 0:n.canonicalString())===(null==(r=t._internalFieldPath)?void 0:r.canonicalString())}function hN(e,t){return us(e.query,t.query)&&B(e.data(),t.data())}class hR{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hM extends u4{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new hL(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(u7("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class hL extends hM{data(e={}){return super.data(e)}}class hO{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new hR(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new hL(this._firestore,this._userDataWriter,n.key,n,new hR(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new eh(eu.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new hL(e._firestore,e._userDataWriter,n.doc.key,n.doc,new hR(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new hL(e._firestore,e._userDataWriter,t.doc.key,t.doc,new hR(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return es(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function hP(e,t){return e instanceof hM&&t instanceof hM?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof hO&&t instanceof hO&&e._firestore===t._firestore&&us(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function hF(e){e=l2(e,l9);let t=l2(e.firestore,uc);return lQ(ug(t),e._key).then(n=>hX(t,e,n))}class hV extends h_{constructor(e){super(),this.firestore=e}convertBytes(e){return new uA(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new l9(this.firestore,null,t)}}function hB(e){var t;let n;e=l2(e,l9);let r=l2(e.firestore,uc),i=ug(r),s=new hV(r);return(t=e._key,n=new ec,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await e.persistence.runTransaction("read document","readonly",n=>e.localDocuments.getDocument(n,t));r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new eh(eu.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=oR(r,`Failed to get document '${t} from cache`);n.reject(e)}})(await lz(i),t,n)),n.promise).then(t=>new hM(r,s,e._key,t,new hR(null!==t&&t.hasLocalMutations,!0),e.converter))}function hU(e){e=l2(e,l9);let t=l2(e.firestore,uc);return lQ(ug(t),e._key,{source:"server"}).then(n=>hX(t,e,n))}function hq(e){e=l2(e,l7);let t=l2(e.firestore,uc),n=ug(t),r=new hV(t);return u9(e._query),lH(n,e._query).then(n=>new hO(t,r,e,n))}function hz(e){var t;let n;e=l2(e,l7);let r=l2(e.firestore,uc),i=ug(r),s=new hV(r);return(t=e._query,n=new ec,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await ax(e,t,!0),i=new oX(t,r.$s),s=i.Za(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(r){let e=oR(r,`Failed to execute query '${t} against cache`);n.reject(e)}})(await lz(i),t,n)),n.promise).then(t=>new hO(r,s,e,t))}function hj(e){e=l2(e,l7);let t=l2(e.firestore,uc),n=ug(t),r=new hV(t);return lH(n,e._query,{source:"server"}).then(n=>new hO(t,r,e,n))}function hK(e,t,n){e=l2(e,l9);let r=l2(e.firestore,uc),i=hx(e.converter,t,n);return hJ(r,[uq(uU(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,r6.none())])}function h$(e,t,n,...r){e=l2(e,l9);let i=l2(e.firestore,uc),s=uU(i);return hJ(i,[("string"==typeof(t=q(t))||t instanceof uD?uW(s,"updateDoc",e._key,t,n,r):uH(s,"updateDoc",e._key,t)).toMutation(e._key,r6.exists(!0))])}function hG(e){return hJ(l2(e.firestore,uc),[new is(e._key,r6.none())])}function hQ(e,t){let n=l2(e.firestore,uc),r=ur(e),i=hx(e.converter,t);return hJ(n,[uq(uU(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,r6.exists(!1))]).then(()=>r)}function hH(e,...t){var n,r,i,s;let a,o,l,u,h;e=q(e);let c={includeMetadataChanges:!1,source:"default"},d=0;"object"!=typeof t[0]||uu(t[d])||(c=t[d],d++);let f={includeMetadataChanges:c.includeMetadataChanges,source:c.source};if(uu(t[d])){let e=t[d];t[d]=null==(n=e.next)?void 0:n.bind(e),t[d+1]=null==(r=e.error)?void 0:r.bind(e),t[d+2]=null==(i=e.complete)?void 0:i.bind(e)}if(e instanceof l9)o=l2(e.firestore,uc),l=ry(e._key.path),a={next:n=>{t[d]&&t[d](hX(o,e,n))},error:t[d+1],complete:t[d+2]};else{let n=l2(e,l7);o=l2(n.firestore,uc),l=n._query;let r=new hV(o);a={next:e=>{t[d]&&t[d](new hO(o,r,n,e))},error:t[d+1],complete:t[d+2]},u9(e._query)}return s=ug(o),h=new oK(l,u=new lN(a),f),s.asyncQueue.enqueueAndForget(async()=>oB(await lG(s),h)),()=>{u.Cu(),s.asyncQueue.enqueueAndForget(async()=>oU(await lG(s),h))}}function hW(e,t){var n;let r;return n=ug(e=l2(e,uc)),r=new lN(uu(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await lG(n),void(e.ba.add(r),r.next())}),()=>{r.Cu(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await lG(n),void e.ba.delete(r)})}}function hJ(e,t){var n;let r;return n=ug(e),r=new ec,n.asyncQueue.enqueueAndForget(async()=>o7(await lK(n),t,r)),r.promise}function hX(e,t,n){let r=n.docs.get(t._key),i=new hV(e);return new hM(e,i,t._key,r,new hR(n.hasPendingWrites,n.fromCache),t.converter)}function hY(e){return hZ(e,{count:hD()})}function hZ(e,t){var n;let r,i=l2(e.firestore,uc),s=ug(i),a=t9(t,(e,t)=>new ih(t,e.aggregateType,e._internalFieldPath));return(n=e._query,r=new ec,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await l$(s);r.resolve(async function(e,t,n){var r;let{request:i,yt:s,parent:a}=iZ(e.serializer,rE(t),n);e.connection.Uo||delete i.parent;let o=(await e.Yo("RunAggregationQuery",e.serializer.databaseId,a,i,1)).filter(e=>!!e.result);eo(1===o.length,64727);let l=null==(r=o[0].result)?void 0:r.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}(e,n,a))}catch(e){r.reject(e)}}),r.promise).then(t=>new uC(e,new hV(i),t))}class h0{constructor(e){this.kind="memory",this._onlineComponentProvider=lD.provider,(null==e?void 0:e.garbageCollector)?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new lS(void 0)}}toJSON(){return{kind:this.kind}}}class h1{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=ce(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class h2{constructor(){this.kind="memoryEager",this._offlineComponentProvider=lx.provider}toJSON(){return{kind:this.kind}}}class h6{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new lS(e)}}toJSON(){return{kind:this.kind}}}function h3(){return new h2}function h5(e){return new h6(null==e?void 0:e.cacheSizeBytes)}function h4(e){return new h0(e)}function h8(e){return new h1(e)}class h7{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=lD.provider,this._offlineComponentProvider={build:t=>new lC(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class h9{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=lD.provider,this._offlineComponentProvider={build:t=>new lA(t,null==e?void 0:e.cacheSizeBytes)}}}function ce(e){return new h7(null==e?void 0:e.forceOwnership)}function ct(){return new h9}let cn={maxAttempts:5};class cr{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=uU(e)}set(e,t,n){this._verifyNotCommitted();let r=ci(e,this._firestore),i=hx(r.converter,t,n),s=uq(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,r6.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=ci(e,this._firestore);return i="string"==typeof(t=q(t))||t instanceof uD?uW(this._dataReader,"WriteBatch.update",s._key,t,n,r):uH(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,r6.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=ci(e,this._firestore);return this._mutations=this._mutations.concat(new is(t._key,r6.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new eh(eu.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ci(e,t){if((e=q(e)).firestore!==t)throw new eh(eu.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class cs{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=uU(e)}get(e){let t=ci(e,this._firestore),n=new hS(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return es(24041);let r=e[0];if(r.isFoundDocument())return new u4(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new u4(this._firestore,n,t._key,null,t.converter);throw es(18433,{doc:r})})}set(e,t,n){let r=ci(e,this._firestore),i=hx(r.converter,t,n),s=uq(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i,s=ci(e,this._firestore);return i="string"==typeof(t=q(t))||t instanceof uD?uW(this._dataReader,"Transaction.update",s._key,t,n,r):uH(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=ci(e,this._firestore);return this._transaction.delete(t._key),this}}class ca extends cs{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=ci(e,this._firestore),n=new hV(this._firestore);return super.get(e).then(e=>new hM(this._firestore,n,t._key,e._document,new hR(!1,!1),t.converter))}}function co(e,t,n){var r,i;let s;e=l2(e,uc);let a=Object.assign(Object.assign({},cn),n);if(a.maxAttempts<1)throw new eh(eu.INVALID_ARGUMENT,"Max attempts must be at least 1");return r=ug(e),i=n=>t(new ca(e,n)),s=new ec,r.asyncQueue.enqueueAndForget(async()=>{let e=await l$(r);new lL(r.asyncQueue,e,a,i,s).$u()}),s.promise}function cl(){return new uz("deleteField")}function cu(){return new uK("serverTimestamp")}function ch(...e){return new u$("arrayUnion",e)}function cc(...e){return new uG("arrayRemove",e)}function cd(e){return new uQ("increment",e)}function cf(e){return new uM(e)}function cg(e){return ug(e=l2(e,uc)),new cr(e,t=>hJ(e,t))}function cp(e,t){let n=ug(e=l2(e,uc));if(!n._uninitializedComponentsProvider||"memory"===n._uninitializedComponentsProvider._offline.kind)return er("Cannot enable indexes when persistence is disabled"),Promise.resolve();let r=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new eh(eu.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,n=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=cm(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=u6("setIndexConfiguration",cm(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new eB(e,2)):"ASCENDING"===t.order?r.push(new eB(e,0)):"DESCENDING"===t.order&&r.push(new eB(e,1))}n.push(new eO(eO.UNKNOWN_ID,t,r,eU.empty()))}return n}(t);return n.asyncQueue.enqueue(async()=>(async function(e,t){let n=e.indexManager,r=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(i=>(function(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=n(e[l],t[o]);s<0?i(e[l++]):s>0?r(t[o++]):(o++,l++)}for(;o<a;)r(t[o++]);for(;l<s;)i(e[l++])})(i,t,eV,t=>{r.push(n.addFieldIndex(e,t))},t=>{r.push(n.deleteFieldIndex(e,t))})).next(()=>eH.waitFor(r)))})(await lz(n),r))}function cm(e,t){if("string"!=typeof e[t])throw new eh(eu.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class cy{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function cv(e){var t;e=l2(e,uc);let n=cI.get(e);if(n)return n;if("persistent"!==(null==(t=ug(e)._uninitializedComponentsProvider)?void 0:t._offline.kind))return null;let r=new cy(e);return cI.set(e,r),r}function cw(e){cE(e,!0)}function cb(e){cE(e,!1)}function cT(e){var t;(t=ug(e._firestore)).asyncQueue.enqueue(async()=>{var e;let n;return n=(e=await lz(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>n.deleteAllFieldIndexes(e))}).then(e=>et("deleting all persistent cache indexes succeeded")).catch(e=>er("deleting all persistent cache indexes failed",e))}function cE(e,t){var n;(n=ug(e._firestore),n.asyncQueue.enqueue(async()=>{var e;return e=await lz(n),void(e.Ms.fs=t)})).then(e=>et(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>er(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let cI=new WeakMap;function c_(e){var t;let n=null==(t=ug(l2(e.firestore,uc))._onlineComponents)?void 0:t.datastore.serializer;return void 0===n?null:iY(n,rT(e._query)).gt}function cx(e,t){var n;let r=t9(t,(e,t)=>new ih(t,e.aggregateType,e._internalFieldPath)),i=null==(n=ug(l2(e.firestore,uc))._onlineComponents)?void 0:n.datastore.serializer;return void 0===i?null:iZ(i,rE(e._query),r,!0).request}class cS{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return cC.instance.onExistenceFilterMismatch(e)}}class cC{constructor(){this.Sc=new Map}static get instance(){return cA||function(e){if(ip)throw Error("a TestingHooksSpi instance is already set");ip=e}(cA=new cC),cA}ht(e){this.Sc.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),n=this.Sc;return n.set(t,e),()=>n.delete(t)}}let cA=null;!function(e=!0){X=y.SDK_VERSION,(0,y._registerComponent)(new z("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new uc(new ep(t.getProvider("auth-internal")),new ew(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new eh(eu.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new n_(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,y.registerVersion)(H,W,void 0),(0,y.registerVersion)(H,W,"esm2017")}(),e.s(["AbstractUserDataWriter",()=>h_,"AggregateField",()=>uS,"AggregateQuerySnapshot",()=>uC,"Bytes",()=>uA,"CACHE_SIZE_UNLIMITED",()=>-1,"CollectionReference",()=>ue,"DocumentReference",()=>l9,"DocumentSnapshot",()=>hM,"FieldPath",()=>uD,"FieldValue",()=>uN,"Firestore",()=>uc,"FirestoreError",()=>eh,"GeoPoint",()=>uR,"LoadBundleTask",()=>uh,"PersistentCacheIndexManager",()=>cy,"Query",()=>l7,"QueryCompositeFilterConstraint",()=>hs,"QueryConstraint",()=>ht,"QueryDocumentSnapshot",()=>hL,"QueryEndAtConstraint",()=>hm,"QueryFieldFilterConstraint",()=>hr,"QueryLimitConstraint",()=>hh,"QueryOrderByConstraint",()=>hl,"QuerySnapshot",()=>hO,"QueryStartAtConstraint",()=>hf,"SnapshotMetadata",()=>hR,"Timestamp",()=>eC,"Transaction",()=>ca,"VectorValue",()=>uM,"WriteBatch",()=>cr,"_AutoId",()=>eE,"_ByteString",()=>nh,"_DatabaseId",()=>n_,"_DocumentKey",()=>eL,"_EmptyAppCheckTokenProvider",()=>eb,"_EmptyAuthCredentialsProvider",()=>ef,"_FieldPath",()=>eM,"_TestingHooks",()=>cS,"_cast",()=>l2,"_debugAssert",()=>el,"_internalAggregationQueryToProtoRunAggregationQueryRequest",()=>cx,"_internalQueryToProtoQueryTarget",()=>c_,"_isBase64Available",()=>nu,"_logWarn",()=>er,"_validateIsNotUsedTogether",()=>lY,"addDoc",()=>hQ,"aggregateFieldEqual",()=>hk,"aggregateQuerySnapshotEqual",()=>hN,"and",()=>ho,"arrayRemove",()=>cc,"arrayUnion",()=>ch,"average",()=>hA,"clearIndexedDbPersistence",()=>uw,"collection",()=>ut,"collectionGroup",()=>un,"connectFirestoreEmulator",()=>l8,"count",()=>hD,"deleteAllPersistentCacheIndexes",()=>cT,"deleteDoc",()=>hG,"deleteField",()=>cl,"disableNetwork",()=>uE,"disablePersistentCacheIndexAutoCreation",()=>cb,"doc",()=>ur,"documentId",()=>uk,"enableIndexedDbPersistence",()=>um,"enableMultiTabIndexedDbPersistence",()=>uy,"enableNetwork",()=>uT,"enablePersistentCacheIndexAutoCreation",()=>cw,"endAt",()=>hv,"endBefore",()=>hy,"ensureFirestoreConfigured",()=>ug,"executeWrite",()=>hJ,"getAggregateFromServer",()=>hZ,"getCountFromServer",()=>hY,"getDoc",()=>hF,"getDocFromCache",()=>hB,"getDocFromServer",()=>hU,"getDocs",()=>hq,"getDocsFromCache",()=>hz,"getDocsFromServer",()=>hj,"getFirestore",()=>uf,"getPersistentCacheIndexManager",()=>cv,"increment",()=>cd,"initializeFirestore",()=>ud,"limit",()=>hc,"limitToLast",()=>hd,"loadBundle",()=>u_,"memoryEagerGarbageCollector",()=>h3,"memoryLocalCache",()=>h4,"memoryLruGarbageCollector",()=>h5,"namedQuery",()=>ux,"onSnapshot",()=>hH,"onSnapshotsInSync",()=>hW,"or",()=>ha,"orderBy",()=>hu,"persistentLocalCache",()=>h8,"persistentMultipleTabManager",()=>ct,"persistentSingleTabManager",()=>ce,"query",()=>hn,"queryEqual",()=>us,"refEqual",()=>ui,"runTransaction",()=>co,"serverTimestamp",()=>cu,"setDoc",()=>hK,"setIndexConfiguration",()=>cp,"setLogLevel",()=>ee,"snapshotEqual",()=>hP,"startAfter",()=>hp,"startAt",()=>hg,"sum",()=>hC,"terminate",()=>uI,"updateDoc",()=>h$,"vector",()=>cf,"waitForPendingWrites",()=>ub,"where",()=>hi,"writeBatch",()=>cg],17875),e.s([],36180)}]);