{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/redis.ts"],"sourcesContent":["import { Redis } from '@upstash/redis';\r\n\r\nexport const redis = process.env.UPSTASH_REDIS_REST_URL && process.env.UPSTASH_REDIS_REST_TOKEN\r\n    ? new Redis({\r\n        url: process.env.UPSTASH_REDIS_REST_URL,\r\n        token: process.env.UPSTASH_REDIS_REST_TOKEN,\r\n    })\r\n    : null;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,QAAQ,QAAQ,GAAG,CAAC,sBAAsB,IAAI,QAAQ,GAAG,CAAC,wBAAwB,GACzF,IAAI,8KAAK,CAAC;IACR,KAAK,QAAQ,GAAG,CAAC,sBAAsB;IACvC,OAAO,QAAQ,GAAG,CAAC,wBAAwB;AAC/C,KACE"}},
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/rate-limit.ts"],"sourcesContent":["import { Ratelimit } from \"@upstash/ratelimit\";\r\nimport { redis } from \"@/lib/redis\";\r\n\r\n// Different rate limit configurations for different use cases\r\nexport const authRateLimit = redis\r\n    ? new Ratelimit({\r\n        redis,\r\n        limiter: Ratelimit.slidingWindow(5, \"15 m\"), // 5 requests per 15 minutes\r\n        analytics: true,\r\n        prefix: \"ratelimit:auth\",\r\n    })\r\n    : null;\r\n\r\nexport const apiRateLimit = redis\r\n    ? new Ratelimit({\r\n        redis,\r\n        limiter: Ratelimit.slidingWindow(100, \"1 m\"), // 100 requests per minute\r\n        analytics: true,\r\n        prefix: \"ratelimit:api\",\r\n    })\r\n    : null;\r\n\r\nexport const uploadRateLimit = redis\r\n    ? new Ratelimit({\r\n        redis,\r\n        limiter: Ratelimit.slidingWindow(10, \"1 h\"), // 10 requests per hour\r\n        analytics: true,\r\n        prefix: \"ratelimit:upload\",\r\n    })\r\n    : null;\r\n\r\nexport const paymentRateLimit = redis\r\n    ? new Ratelimit({\r\n        redis,\r\n        limiter: Ratelimit.slidingWindow(20, \"1 h\"), // 20 requests per hour\r\n        analytics: true,\r\n        prefix: \"ratelimit:payment\",\r\n    })\r\n    : null;\r\n\r\n// Helper function to get client identifier (IP address or user ID)\r\nexport function getClientIdentifier(request: Request): string {\r\n    // Try to get IP from headers (works with most proxies/load balancers)\r\n    const forwarded = request.headers.get(\"x-forwarded-for\");\r\n    const realIp = request.headers.get(\"x-real-ip\");\r\n\r\n    if (forwarded) {\r\n        return forwarded.split(\",\")[0].trim();\r\n    }\r\n\r\n    if (realIp) {\r\n        return realIp;\r\n    }\r\n\r\n    // Fallback to a default identifier\r\n    return \"anonymous\";\r\n}\r\n\r\n// Helper function to apply rate limiting\r\nexport async function checkRateLimit(\r\n    rateLimit: Ratelimit | null,\r\n    identifier: string\r\n): Promise<{ success: boolean; limit: number; remaining: number; reset: number }> {\r\n    // If rate limiting is not configured (e.g., in development), allow all requests\r\n    if (!rateLimit) {\r\n        return { success: true, limit: 0, remaining: 0, reset: 0 };\r\n    }\r\n\r\n    const { success, limit, remaining, reset } = await rateLimit.limit(identifier);\r\n\r\n    return { success, limit, remaining, reset };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;;;AAGO,MAAM,gBAAgB,oIAAK,GAC5B,IAAI,4KAAS,CAAC;IACZ,OAAA,oIAAK;IACL,SAAS,4KAAS,CAAC,aAAa,CAAC,GAAG;IACpC,WAAW;IACX,QAAQ;AACZ,KACE;AAEC,MAAM,eAAe,oIAAK,GAC3B,IAAI,4KAAS,CAAC;IACZ,OAAA,oIAAK;IACL,SAAS,4KAAS,CAAC,aAAa,CAAC,KAAK;IACtC,WAAW;IACX,QAAQ;AACZ,KACE;AAEC,MAAM,kBAAkB,oIAAK,GAC9B,IAAI,4KAAS,CAAC;IACZ,OAAA,oIAAK;IACL,SAAS,4KAAS,CAAC,aAAa,CAAC,IAAI;IACrC,WAAW;IACX,QAAQ;AACZ,KACE;AAEC,MAAM,mBAAmB,oIAAK,GAC/B,IAAI,4KAAS,CAAC;IACZ,OAAA,oIAAK;IACL,SAAS,4KAAS,CAAC,aAAa,CAAC,IAAI;IACrC,WAAW;IACX,QAAQ;AACZ,KACE;AAGC,SAAS,oBAAoB,OAAgB;IAChD,sEAAsE;IACtE,MAAM,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC;IACtC,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;IAEnC,IAAI,WAAW;QACX,OAAO,UAAU,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI;IACvC;IAEA,IAAI,QAAQ;QACR,OAAO;IACX;IAEA,mCAAmC;IACnC,OAAO;AACX;AAGO,eAAe,eAClB,SAA2B,EAC3B,UAAkB;IAElB,gFAAgF;IAChF,IAAI,CAAC,WAAW;QACZ,OAAO;YAAE,SAAS;YAAM,OAAO;YAAG,WAAW;YAAG,OAAO;QAAE;IAC7D;IAEA,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,MAAM,UAAU,KAAK,CAAC;IAEnE,OAAO;QAAE;QAAS;QAAO;QAAW;IAAM;AAC9C"}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\nimport { apiRateLimit, authRateLimit, paymentRateLimit, uploadRateLimit, getClientIdentifier, checkRateLimit } from '@/lib/rate-limit';\r\n\r\nexport async function middleware(request: NextRequest) {\r\n    try {\r\n        // Skip rate limiting in development if RATE_LIMIT_ENABLED is not set\r\n        if (process.env.NODE_ENV === 'development' && process.env.RATE_LIMIT_ENABLED !== 'true') {\r\n            return NextResponse.next();\r\n        }\r\n\r\n        const pathname = request.nextUrl.pathname;\r\n        const identifier = getClientIdentifier(request);\r\n\r\n        // Determine which rate limit to apply based on the route\r\n        let rateLimit = apiRateLimit;\r\n\r\n        if (pathname.startsWith('/api/auth')) {\r\n            rateLimit = authRateLimit;\r\n        } else if (pathname.includes('/payment') || pathname.includes('/stripe')) {\r\n            rateLimit = paymentRateLimit;\r\n        } else if (pathname.includes('/upload')) {\r\n            rateLimit = uploadRateLimit;\r\n        }\r\n\r\n        // Check rate limit\r\n        const { success, limit, remaining, reset } = await checkRateLimit(rateLimit, identifier);\r\n\r\n        // Create response\r\n        const response = success\r\n            ? NextResponse.next()\r\n            : NextResponse.json(\r\n                {\r\n                    error: 'Too many requests',\r\n                    message: 'You have exceeded the rate limit. Please try again later.',\r\n                },\r\n                { status: 429 }\r\n            );\r\n\r\n        // Add rate limit headers\r\n        if (limit > 0) {\r\n            response.headers.set('X-RateLimit-Limit', limit.toString());\r\n            response.headers.set('X-RateLimit-Remaining', remaining.toString());\r\n            response.headers.set('X-RateLimit-Reset', new Date(reset).toISOString());\r\n        }\r\n\r\n        return response;\r\n    } catch (error) {\r\n        // Log the error and allow the request to proceed\r\n        // This prevents the whole site from going down if the rate limiting service (e.g., Upstash) fails\r\n        console.error('Middleware Error:', error);\r\n        return NextResponse.next();\r\n    }\r\n}\r\n\r\n// Configure which routes to apply middleware to\r\nexport const config = {\r\n    matcher: [\r\n        '/api/:path*',\r\n    ],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEO,eAAe,WAAW,OAAoB;IACjD,IAAI;QACA,qEAAqE;QACrE,IAAI,oDAAyB,iBAAiB,QAAQ,GAAG,CAAC,kBAAkB,KAAK,QAAQ;YACrF,OAAO,gMAAY,CAAC,IAAI;QAC5B;QAEA,MAAM,WAAW,QAAQ,OAAO,CAAC,QAAQ;QACzC,MAAM,aAAa,IAAA,0JAAmB,EAAC;QAEvC,yDAAyD;QACzD,IAAI,YAAY,mJAAY;QAE5B,IAAI,SAAS,UAAU,CAAC,cAAc;YAClC,YAAY,oJAAa;QAC7B,OAAO,IAAI,SAAS,QAAQ,CAAC,eAAe,SAAS,QAAQ,CAAC,YAAY;YACtE,YAAY,uJAAgB;QAChC,OAAO,IAAI,SAAS,QAAQ,CAAC,YAAY;YACrC,YAAY,sJAAe;QAC/B;QAEA,mBAAmB;QACnB,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,MAAM,IAAA,qJAAc,EAAC,WAAW;QAE7E,kBAAkB;QAClB,MAAM,WAAW,UACX,gMAAY,CAAC,IAAI,KACjB,gMAAY,CAAC,IAAI,CACf;YACI,OAAO;YACP,SAAS;QACb,GACA;YAAE,QAAQ;QAAI;QAGtB,yBAAyB;QACzB,IAAI,QAAQ,GAAG;YACX,SAAS,OAAO,CAAC,GAAG,CAAC,qBAAqB,MAAM,QAAQ;YACxD,SAAS,OAAO,CAAC,GAAG,CAAC,yBAAyB,UAAU,QAAQ;YAChE,SAAS,OAAO,CAAC,GAAG,CAAC,qBAAqB,IAAI,KAAK,OAAO,WAAW;QACzE;QAEA,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,iDAAiD;QACjD,kGAAkG;QAClG,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gMAAY,CAAC,IAAI;IAC5B;AACJ;AAGO,MAAM,SAAS;IAClB,SAAS;QACL;KACH;AACL"}}]
}